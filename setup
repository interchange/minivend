# setup: sets up a Vend storefront.
#
# $Id: setup,v 1.28 1996/03/14 20:49:28 amw Exp $
#
# Copyright 1996 by Andrew M. Wilcox <awilcox@world.std.com>
#
# This program is free software; you can redistribute it and/or modify
# it under the terms of the GNU General Public License as published by
# the Free Software Foundation; either version 2 of the License, or
# (at your option) any later version.
#
# This program is distributed in the hope that it will be useful,
# but WITHOUT ANY WARRANTY; without even the implied warranty of
# MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
# GNU General Public License for more details.
#
# You should have received a copy of the GNU General Public License
# along with this program; if not, write to the Free Software
# Foundation, Inc., 675 Mass Ave, Cambridge, MA 02139, USA.

my $Version = "0.3.8";

use Getopt::Long;
use strict;

my $vend_lib;

if (defined $ENV{'VENDLIB'}) {
    $vend_lib = $ENV{'VENDLIB'};
}
else {
    $vend_lib = $0;
    $vend_lib =~ s,/[^/]+$,, or undef $vend_lib;
}

my $config = $ENV{'VENDCFG'} || 'vend.cfg';

unless (GetOptions qw(help config=s vend=s version)) {
    usage();
    exit 1;
}

if ($main::opt_version) {
    version();
    exit 0;
}

if ($main::opt_help) {
    usage();
    exit 0;
}

$vend_lib = $main::opt_vend if defined $main::opt_vend;
$config = $main::opt_config if defined $main::opt_config;

if (defined $vend_lib and ! -e "$vend_lib/Vend/Setup.pm") {
    print <<"END";
'$vend_lib' doesn't appear to be the location of the Vend library
(since I don't see $vend_lib/Vend/Setup.pm, for example).
END
    undef $vend_lib;
}

unless (defined $vend_lib) {
    print <<'END';
Please specify the location of the Vend library with the --vend option,
like this:  setup --vend=/usr/local/lib/vend
END
}

push @INC, $vend_lib;
require Vend::Setup;
Vend::Setup->import();

print "Reading $config\n";
require $config;

setup_modules();
exit 0;

sub version {
    print "Vend version $Version, Copyright 1996 by Andrew M. Wilcox.\n";
}

sub usage {
    version();
    print <<'END';
Usage: perl setup [--vend=/vend/lib/dir] [--config=config_file]
END
}
