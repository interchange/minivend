<!-- $Id: minivend.html,v 2.1 1997/01/07 01:40:44 mike Exp mike $ -->
<HTML><HEAD>
<CENTER><TITLE>minivend</TITLE>
</HEAD>
<BODY BGCOLOR=WHITE></CENTER><p><hr>

<CENTER> <H1> 
<A NAME="minivend_name_0">
MiniVend -- multi-catalog shopping cart and mall
</A>
</CENTER> </H1>
<p>
<H2> 
<A NAME="minivend_version_0">
Version</A>
</H2>
This document describes MiniVend 2.03, based on Andrew Wilcox's
original Vend, Version 0.2, with portions from Vend 0.3.
<p><p><hr>
<H1> 
<A NAME="minivend_description_0">
DESCRIPTION</A>
</H1>
MiniVend allows customers to select items to buy from catalog pages. The
program tracks which products they have selected and the quantity
desired. From the ordering page they may complete the ordering process
by entering their name and address, or return to browsing and select
more items.  Once the order process is completed, MiniVend submits
the order to the system via email or an external order entry program.
<p>MiniVend plugs into a system with an SSL (Secure Sockets Layer) server,
allowing encrypted transmission of sensitive customer data.  This
capability makes the entry of credit card numbers practical and secure.
<p>Many different catalogs can be run from the same MiniVend server,
allowing an ISP to serve many different customers from one or just
a few MiniVend server processes.
<p>Multiple servers can be forked to serve the same set of catalogs.
This ensures fast response, while only one server runs when there is no
catalog activity.
<p>MiniVend is powerful, and correspondingly complex. It can easily handle
catalogs of a million items or more, with excellent performance. It has
completely flexible page display, search, and order entry capability. If
you only have a few items to catalog, MiniVend is probably overkill for
your needs.  But if you are willing to spend some upfront learning time,
it can support your simple catalog with unlimited room to grow. To get a
fast start with a simple catalog, start with the simple demo and customize
from there.
<p><p><hr>

<H1> 
<A NAME="minivend_overview_0">
OVERVIEW OF MINIVEND</A>
</H1>
If you want to get started, just jump to 
<A HREF="minivend.html#minivend_quick_0"><EM>QUICK START</EM></A>
 below.
The following sections briefly describe how MiniVend works.
<p>
<H2> 
<A NAME="minivend_how_0">
How MiniVend Manages Sessions</A>
</H2>
Normally, each request for a World Wide Web page which comes in to a
server stands on its own. While the server will probably know which
machine a request comes from, it may not know if the next request
comes from the same browser or even from the same user on that
machine.
<p>MiniVend keeps track of who is ordering what by including in the URL a
session id: a random string which is different for each customer
browsing the catalog.
<p>So that the session id can be included in URL's within catalog pages,
every page in the catalog is served up by MiniVend running as a cgi-bin
program. Here is an example of such a URL:
<p>
<XMP>
    http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1

</XMP>
<p>An explanation of each part:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_machine_company_com_0">
machine.company.com</A>

</STRONG>
<DD>
Internet address of server
<p>
<DT><STRONG>
<EM>cgi-bin</EM>
</STRONG>
<DD>
Informs server that the requested page will be generated by a
program.
<p>
<DT><STRONG>

<A NAME="minivend_vlink_0">
vlink</A>

</STRONG>
<DD>
Name of the program to run
<p>
<DT><STRONG>

<A NAME="minivend_shirts_0">
shirts</A>

</STRONG>
<DD>
Page of the catalog to display
<p>
<DT><STRONG>

<A NAME="minivend_wehukatn_0">
WehUkATn;;1</A>

</STRONG>
<DD>
The session id
<p>
</DL>
As of Version 1.03, MiniVend now optionally supports 
<A HREF="minivend.html#minivend_cookies_1"><EM>Cookies</EM></A>
, which.allows interspersal of regular HTML references and MiniVend page
references.
<p>Catalog pages are written in regular HTML with extensions to
support catalog ordering. Pages are delivered through the following
steps:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_the_0">
The HTTPD server receives a request for a catalog page.</A>

</STRONG>
<DD>
<p>
<DT><STRONG>

<A NAME="minivend_the_1">
The server is already running as a daemon, and the request calls a small</A>

</STRONG>
<DD>
C program called vlink. The vlink program communicates with the MiniVend
program via a UNIX- or INET-domain socket.
<p>
<DT><STRONG>

<A NAME="minivend_minivend_0">
MiniVend reads the HTML source page from the catalog pages directory,</A>

</STRONG>
<DD>
and interprets the catalog ordering extensions in the file. If the 
page doesn't exist, and corresponds to a part number in the database,
it is built ``on the fly'' using the template page flypage.html.
<p>
<DT><STRONG>

<A NAME="minivend_the_2">
The page, which is now entirely in regular HTML, is delivered to</A>

</STRONG>
<DD>
the HTTPD server, which returns it to the browser.
<p>
</DL>
Once the customer has finished, the completed order is emailed to the.vendor, or placed with an external order entry program (not supplied).
<p>
<H2> 
<A NAME="minivend_where_0">
Where to Download MiniVend</A>
</H2>
The MiniVend version described in this document is available from:
<p>
<XMP>
    http://www.iac.net/~mikeh/download.html

</XMP>
<p>If you are on a Solaris, or another UNIX which does not have native and
complete <EM>flock()</EM> support, you must also obtain the File::Lock module at
the same place that 
<A HREF="minivend.html#minivend_perl_0">Perl</A>
 is available from.  File::Lock is included
in the distribution and will be installed if possible and appropriate.
<p>
<H2> 
<A NAME="minivend_perl_0">
Perl</A>
</H2>
You will need Perl version 5.002 or higher to run MiniVend 2.03. Many
sites are still running lower Perl versions. In addition, on systems
that do not have GDBM or DB_File installed, memory problems may occur.
Large catalogs will use large amounts of memory if the databases must
all reside there.
<p>You can download the latest Perl 5 from any CPAN (Comprehensive Perl
Archive Network) site. Here are some of the many:
<p>NORTH AMERICA
<p>
<XMP>
  Florida 
     ftp://ftp.cis.ufl.edu/pub/perl/CPAN/ 
  Illinois 
     ftp://uiarchive.cso.uiuc.edu/pub/lang/perl/CPAN/ 
  Massachusetts 
     ftp://ftp.delphi.com/pub/mirrors/packages/perl/CPAN/ 
  Oklahoma 
     ftp://ftp.uoknor.edu/mirrors/CPAN/ 
  Texas 
     ftp://ftp.metronet.com/pub/perl/
     ftp://ftp.sedl.org/pub/mirrors/CPAN/ 
     ftp://ftp.sterling.com/programming/languages/perl/ 

</XMP>
<p>EUROPE
<p>
<XMP>
  Czech Republic
     ftp://sunsite.mff.cuni.cz/Languages/Perl/CPAN/
  Finland 
     ftp://ftp.funet.fi/pub/languages/perl/CPAN/ 
  France 
     ftp://ftp.ibp.fr/pub/perl/CPAN/ 
     ftp://ftp.pasteur.fr/pub/computing/unix/perl/CPAN/ 
  Germany 
     ftp://ftp.leo.org/pub/comp/programming/languages/perl/CPAN/ 
     ftp://ftp.rz.ruhr-uni-bochum.de/pub/programming/languages/perl/CPAN/ 
  Great Britain 
     ftp://ftp.demon.co.uk/pub/mirrors/perl/CPAN/ 
     ftp://unix.hensa.ac.uk/mirrors/perl-CPAN/
  The Netherlands 
     ftp://ftp.cs.ruu.nl/pub/PERL/CPAN/ 
  Poland
     ftp://ftp.pk.edu.pl/pub/lang/perl/CPAN/
  Portugal 
     ftp://ftp.ci.uminho.pt/pub/lang/perl/ 
  Slovenia
     ftp://ftp.arnes.si/software/perl/CPAN/
  Sweden 
     ftp://ftp.sunet.se/pub/lang/perl/CPAN/ 
  Switzerland 
     ftp://ftp.switch.ch/mirror/CPAN/ 

</XMP>
<p>AUSTRALASIA
<p>
<XMP>
  Australia 
     ftp://coombs.anu.edu.au/pub/perl/CPAN/
     ftp://ftp.mame.mu.oz.au/pub/perl/CPAN/
  New Zealand 
     ftp://ftp.tekotago.ac.nz/pub/perl/CPAN/ 

</XMP>
<p>ASIA
<p>
<XMP>
  Japan 
     ftp://ftp.lab.kdd.co.jp/lang/perl/CPAN/ 
  Taiwan 
     ftp://dongpo.math.ncu.edu.tw/perl/CPAN/ 

</XMP>
<p>AFRICA
<p>
<XMP>
  South Africa 
     ftp://ftp.is.co.za/programming/perl/CPAN/ 

</XMP>
<p>
<H2> 
<A NAME="minivend_setup_0">
Setup for HTTP Servers</A>
</H2>
The most important issue with MiniVend is the permissions with
which the CGI program and the MiniVend server run.
<p>MiniVend uses a server running <EM>in the background</EM>, with a small
C program called 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 that communicates with MiniVend via
a UNIX-domain socket.
<p>To improve security, MiniVend normally runs with the socket file
having 0600 permissions (rw-------), which mandates that the CGI
program and the server run <EM>as the same user ID</EM>. This means
that the 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 program must be SUID to the same user ID as
the server executes under.  (Or that CGIWRAP is used on a single
catalog system).
<p>With MiniVend 2.0 multiple catalog capability, the permissions
situation gets a bit tricky.  MiniVend comes with a program,
<EM>makecat</EM>, which configures catalogs for a multiple catalog
system. It should properly set up ownership and permissions
if run as the superuser.
<p><p><hr>

<H1> 
<A NAME="minivend_quick_0">
QUICK START</A>
</H1>
Before you begin, select the base directory where you want to install
MiniVend.  You can unpack the tar file either there, or in another
temporary directory -- the configure script handles either. The
suggested directory is /usr/local/lib/minivend -- but really any
directory will do.  You must of course have write permission there; and
you will eventually need to have write permission on your CGI-BIN
and HTML directories.
<p>If you plan on building multiple catalogs, you will probably want
separate directories to hold the catalog pages and databases. The 
<EM>makecat</EM> program supplied with MiniVend will make those for you.
<p>Decompress and untar the distribution:
<p>
<XMP>
    gzip -d mvend200.tar.gz
    tar xf mvend200.tar

</XMP>
<p>If you have GNU tar, you can combine these steps:
<p>
<XMP>
    tar xzf mvend200.tar.gz

</XMP>
<p>Before installing, check the site where you obtained MiniVend for any
patches that might have been issued since the release.
<p>Run the configure script with:
<p>
<XMP>
    ./configure

</XMP>
<p>If you have trouble with ./configure, try this:
<p>
<XMP>
    perl configure.pl /usr/bin/perl

</XMP>
<p>Replace the 'perl' and '/usr/bin/perl' with the proper paths to
your Perl 5 binary.
<p>The process should be self-explanatory. If you discover any problems,
refer to the section 
<A HREF="minivend.html#minivend_if_0"><EM>If something goes wrong</EM></A>
. Otherwise,
MiniVend should be installed at the completion of the script.  It is
strongly suggested that you install the demo catalogs as a starting point for
your own catalog -- the configuration script will give you the
opportunity to do so.
<p><STRONG>IMPORTANT NOTE:</STRONG> One point that is to be emphasized --
<EM>only your base html pages go in the document space of your http server.</EM>
Any pages with MiniVend elements/tags go in the directory set by the

<A HREF="minivend.html#minivend_pagedir_0"><EM>PageDir</EM></A>
 directive (the default is VendRoot/pages). For the demos
supplied with MiniVend, this means that only a few pages will be copied
to your HTML directory, with the remainder of the pages
staying in the directory defined as 
<A HREF="minivend.html#minivend_pagedir_0"><EM>PageDir</EM></A>
.
<p>
<H2> 
<A NAME="minivend_setting_0">
Setting up multiple catalogs</A>
</H2>
MiniVend 2.0 now has multiple catalog capability.  It breaks
the configuration files into two pieces:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_minivend_cfg_0">
minivend.cfg</A>

</STRONG>
<DD>
This file is located in the main MiniVend directory, and
has only a few server-wide configuration parameters. The most
important is the 
<A HREF="minivend.html#minivend_catalog_2"><EM>Catalog</EM></A>
 directive, which sets up the
catalog configuration.  The sample 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 supplied
with the distribution defines two catalogs:
<p>
<XMP>
 Catalog sample /home/catalogs/sample /cgi-bin/sample
 Catalog simple /home/catalogs/simple /cgi-bin/simple

</XMP>
<p>Additional parameters set up multi-server capability and
search parameters.
<p>
<DT><STRONG>

<A NAME="minivend_catalog_cfg_0">
catalog.cfg</A>

</STRONG>
<DD>
Located in the directory where the individual catalog resides,
this file has most of the parameters which define the catalog.
<p>
</DL>
Each catalog can be completely independent, with different databases --.or catalogs can share any or all databases and session files.  This
means that several catalogs can share the same information, allowing
``virtual malls''.  Each catalog maintains its own pages and possibly its
own databases, but can easily share ordering information with other
storefronts.
<p>The steps to set up the multiple server capability are:
<p>
<OL>
<LI>Install the MiniVend software. Use the supplied <EM>makecat</EM> program
to install the demo catalogs, 'sample' and 'simple'.  
<p>
<LI>Select one of the options presented at the beginning. When you initially
select that option (ISP/dedicated, virtual host, or standard user) it
will create a configuration file that will retain the answers to the
first set of questions.  In ISP mode, it is especially important to have
the MiniVendUser and MiniVendGroup directives correct if you will have
multiple users configuring and running catalogs.
<p>
<LI>Select a name for your new catalog. The name will be the default name
for the HTML directory to be used, the vlink executable, but it can be
changed at configuration time.  For this example, our name is 'real'.
<p>
<LI>Run the makecat program:
         
            bin/makecat real
<p>
<LI>Answer the prompts, which should have much of the right information by
default (after you have run the program once to set them).  Reply yes when
the makecat program asks if you wish to place the catalog in minivend.cfg.
<p>
</OL>
.
<p>
<H2> 
<A NAME="minivend_if_0">
If something goes wrong</A>
</H2>
First, check the two error log files -- <EM>error.log</EM> in the MiniVend
home directory (where minivend.cfg resides) and <EM>error.log</EM> in the 
catalog directory (where catalog.cfg resides, there can be many of
these).  Many problems can be diagnosed quickly if these error logs
are consulted.
<p>Second, check the README file, the FAQ and bug list at the official
MiniVend web site for information:
<p>
<XMP>
 http://www.minivend.com/minivend

</XMP>
<p>Third, double check that you have the following things:
<p>1. The 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 program is SUID, or you have made appropriate
changes in the 
<A HREF="minivend.html#minivend_readpermission_0"><EM>ReadPermission</EM></A>
 and <EM>WritePermission</EM> directives.
Unless the files are world-writable, the vlink program and
the MiniVend server must run as the same user ID!
<p>If you are using the new <EM>tlink</EM> INET mode link program,
you must have the proper host name(s) configured into the

<A HREF="minivend.html#minivend_tcphost_0">TcpHost</A>
 directive in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
.  The program selects
port 7786 by default (the ASCII codes for ``M'' and ``V'') -- if you
decide to use another port, you must set the same number in
both the tlink program (before compilation, or by editing
tlink.pl) and the 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file.
<p>2. That you have proper file permissions.
<p><STRONG>IMPORTANT NOTE:</STRONG> The MiniVend server should not run as the user
<EM>nobody</EM>!
<p>The program files can be owned by anyone, but any databases, error logs,
and the directory that holds them must be writable by the proper user ID.
The best way to operate in multi-user, multi-catalog setups is to create
a special <EM>minivend</EM> user, then put that user in the group that each catalog
user is in.  If you can define a group for each individual user, that provides
the best security.  Then all associated files can be in 664 or 775 mode, and
you should have no problems with permissions.
<p>3. The vlink CGI program is SUID, and is owned by the same user
name as the MiniVend server runs as.  You can set the file SUID
with this command:
<p>
<XMP>
    chmod u+s <file>

</XMP>
<p>The <EM>tlink</EM> program does not need to be SUID.
<p>4. The 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 program is being executed on a machine that has the
socket file <EM>etc/socket</EM> on a directly attached disk. UNIX-domain
sockets will not work on NFS-mounted filesystems!  That means the
server <EM>minivend.pl</EM> and the CGI program 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 must be executing
on the same machine.
<p>The <EM>tlink</EM> program does not have this problem, but it must have the
proper host name(s) and TCP ports set in the 
<A HREF="minivend.html#minivend_tcphost_0">TcpHost</A>
 and 
<A HREF="minivend.html#minivend_tcpport_0">TcpPort</A>

directives in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
.
<p>5. If you are using 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
, the server is started with the
<EM>start_unix</EM> command -- with <EM>tlink</EM>, the server is started with
<EM>start_inet</EM>.
<p>If you have a problem you are not able to correct, and you have closely
examined the documentation and support resources from front to end,
you can send email to:
<p>
<XMP>
    <mikeh@iac.net>

</XMP>
<p><STRONG>IMPORTANT:</STRONG> Please include your <STRONG>operating system name</STRONG> and
<STRONG>version</STRONG>, your 
<A HREF="minivend.html#minivend_perl_0">Perl version</A>
 the <STRONG>DBM</STRONG> library in use, the
minivend.cfg file, the appropriate catalog.cfg file, and a directory
listing of the MiniVend directory (and its <EM>etc</EM> directory) <EM>after</EM> the
attempt to run.  This can be done by leaving a message at the MiniVend
problem reporting station:
<p>
<XMP>
    http://www.iac.net/~mikeh/bugreport.html

</XMP>
<p>MiniVend is an ambitious and complex program, and is not presented as
being <EM>easy to use</EM>, <EM>easy to install</EM>, or <EM>bug-free</EM>.  The
configuration scripts were done to try and make a very painful process
only slightly painful.  Some people install in one pass.  Others never
make it, especially when they are running on an ISP.  Determined and
thoughtful users almost always make MiniVend work.
<p><p><hr>

<H1> 
<A NAME="minivend_setting_1">
SETTING UP YOUR CATALOG</A>
</H1>
MiniVend uses its own tags to implement catalog functions -- they
are similar to normal HTML, but are in [square brackets].  They
will be referred to as either <EM>tags</EM> or <EM>elements</EM> in this document.
<p>In order to set up a custom catalog, there are a number of steps.
<p>You will need to become familiar with the MiniVend tags and
directives to make your own catalog.  The demo catalogs are a good
starting point -- in particular we suggest you pay attention to the
order and search pages.
<p>
<H2> 
<A NAME="minivend_start_0">
Start with a database</A>
</H2>
The first thing you must do is develop your product database. This might
contain all of the information used to display pages about your
products -- or just the product code (SKU), short description, and
price.  At the minimum, those three fields are required.
<p>Some other things you might put in:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_image_0">
image</A>

</STRONG>
<DD>
A database field giving the name of an image file to display the
product. Alternatively, you can keep images in files that are named
for the product code -- then display them if they exist (use the
[if file file.gif] TAG [/if] construct).
<p>
<DT><STRONG>

<A NAME="minivend_nontaxable_0">
nontaxable</A>

</STRONG>
<DD>
This field should be present if you have items that do not have
sales tax calculated for them.
<p>
<DT><STRONG>

<A NAME="minivend_weight_0">
weight</A>

</STRONG>
<DD>
The shipping weight of an item is useful for UPS lookup or
other weight-based shipping calculations.
<p>
<DT><STRONG>

<A NAME="minivend_category_0">
category</A>

</STRONG>
<DD>
If you wish to do one-click category searches to build product
directories, you might use this field to select on.
<p>
<DT><STRONG>

<A NAME="minivend_related_0">
related</A>

</STRONG>
<DD>
Items related to the item in the record. Using MiniVend's [loop item]
tag, you could build product subclasses and accessory sets.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_on_the_fly_0">
On-the-fly pages, static, or both?</A>
</H2>
The on-the-fly page capability of MiniVend makes it easy to build
your catalog without hard-coding a single page. To build category
pages, use the one-click search.  To build single-item pages, use 
the flypage.html template and build your own. You can also define
a product database field (with the 
<A HREF="minivend.html#minivend_pageselectfield_0">PageSelectField</A>
 directive)
to hold the name of the base on-the-fly page for that item. You
might define it to be the same as the category of product, for
example.
<p>If you have a large catalog, you will almost certainly want to 
use the on-the-fly page for most products.  But if you want to
mix in a few extra-special pages, perhaps for your best sellers,
you can do so.  Just build the pages and place them in files corresponding
to the part number (in the MiniVend pages directory, of course -- not
your HTML directory).  They will take precedence over the on-the-fly
page.
<p>If you have only a small number of products, hard coded pages are just
fine, though you would be surprised how much of a maintenance headache
they are compared to database definitions.  Build them just about like
normal HTML pages, except for the MiniVend tags to order the item.
Place them whereever they can be reached -- if you are using searches,
you will want to name the file by the part number, or at least make a
link to it.
<p>Some other things you might put in:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_images_0">
Images</A>

</STRONG>
<DD>
You can easily place a thumbnail image (even with a link to
a blowup) only for those items that have them.
<p>
<DT><STRONG>

<A NAME="minivend_accessories_0">
Accessories</A>

</STRONG>
<DD>
The accessories database allows you to pre-define additional
products to offer with a main product.
<p>
<DT><STRONG>

<A NAME="minivend_reviews_testimonials_0">
Reviews/Testimonials</A>

</STRONG>
<DD>
You can key the placement on the existence of a file in
a certain directory.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_use_0">
Use the demo catalogs</A>
</H2>
The demo catalogs supplied with MiniVend are there to give you a starting
point for your own catalog.  Play with them, change them, and rename them --
add your own icons, change flypage.html, change the results.html files,
etc.  
<p>
<H2> 
<A NAME="minivend_tree_0">
Tree design</A>
</H2>
Determine how users will enter and exit your catalog. There are quite
complex and intelligent conditional schemes possible, especially if you
use the 
<A HREF="minivend.html#minivend_cookies_0">Cookies</A>
 capability, but simplicity is often the easiest and
most reliable.
<p><p><hr>

<H1> 
<A NAME="minivend_catalog_0">
CATALOG PAGES</A>
</H1>
Pages in the catalog are written in regular HTML with extensions to
support catalog ordering. To distinguish them from regular HTML, these
extended elements use square brackets instead of angular brackets.
<p>NOTE: As of MiniVend 1.03, there are no real distinctions between
order pages and other pages -- all may access the 
<A HREF="minivend.html#minivend_item_list_0">[item_list]</A>
 tag.
<p>The first page displayed in the catalog, if no argument is supplied
to the 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 or <EM>svend</EM> cgi-bin program, is ``catalog.html''. This page
will contain links to other catalog pages with the [page] element.
Individual products can be ordered by the [order &lt;item-code&gt;] element, which
brings up the order page ``order.html''. The order page contains input
boxes for the customer to type in their name and address. Once the
order has been sent the ``confirmation.html'' page is displayed.
<p>Unless you are using the ``cookie'' support, you will normally not want to
include regular hypertext links to pages outside of the catalog. Such
links will not include the session id, which means that if the customer
follows an external link back to the catalog the list of products
ordered so far will have been lost.
<p>Inline images, on the other hand, are served in the normal fashion.
You should include a regular &lt;IMG SRC=``URL''&gt; element, where the URL
refers to a graphic image.
<p>
<H2> 
<A NAME="minivend_cookies_0">
Cookies</A>
</H2>
As of MiniVend 1.03, all you need to do to have users with cookie-capable
browsers retain session context is enable the 
<A HREF="minivend.html#minivend_cookies_1"><EM>Cookies</EM></A>
 directive.
You can then intermix standard HREF and MiniVend page links without
fear of losing the shopping basket.
<p><STRONG>NOTE:</STRONG> In the descriptions, parameters marked with an asterisk* are
optional.
<p>
<H2> 
<A NAME="minivend_minivend_1">
MiniVend Tags</A>
</H2>
MiniVend has over 60 different elements (we will also interchangeably
refer to them as tags) which are used to access the database, format
and display HTML pages, and perform system control.
A complete reference can be found in the accompanying <EM>tags.html</EM>
file. Some of the commonly used elements used in displaying pages
are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_page_0">
[page pg]</A>

</STRONG>
<DD>
Insert a hyperlink to the specified catalog page pg. For
example, [page shirts] will expand into &lt;
a <A HREF="href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''>">href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''></A>. The
catalog page displayed will come from ``shirts.html'' in the
pages directory.
<p>
<DT><STRONG>

<A NAME="minivend_pagetarget_0">
[pagetarget pg frame]</A>

</STRONG>
<DD>
Same as the page element above, except it specifies an output frame to
target if frames are turned on.  The name <EM>is</EM> case-sensitive, and if
it doesn't exist a new window will be popped up.  This is the same as
the [page ...] tag if frames are not activated.
For example, [pagetarget shirts main] will expand into a link like &lt;a
<A HREF="href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''">href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''</A> TARGET=``main''&gt;. The
catalog page displayed will come from ``shirts.html'' in the
pages directory, and be output to the 'main' frame.  Be careful,
frame names are case-sensitive.
<p>This option also allows specification of secure pages if the target ends with
the string <EM>__secure</EM> (which will be stripped).  If so specified,
the page will be called with 
<A HREF="minivend.html#minivend_secureurl_0"><EM>SecureURL</EM></A>
 instead of 
<A HREF="minivend.html#minivend_vendurl_0"><EM>VendURL</EM></A>
.
<p>
<DT><STRONG>

<A NAME="minivend_areatarget_0">
[areatarget pg frame]</A>

</STRONG>
<DD>
Inserts a Vend URL in a format to provide a targeted reference for a
client-side imagemap.  You set up the &lt;AREA> tag with:
<p>
<XMP>
      <AREA COORDS="220,0,270,20" HREF="[areatarget page frame]">

</XMP>
<p>If frames are enabled, this will expand to:
<p>
<XMP>
      <AREA COORDS="220,0,270,20"
         HREF="http://machine.company.com/vlink/page?ErTxVV8l;;38" TARGET="frame">

</XMP>
<p>If frames are <EM>not</EM> enabled, this will expand to:
<p>
<XMP>
      <AREA COORDS="220,0,270,20"
         HREF="http://machine.company.com/vlink/page?ErTxVV8l;;38">

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_area_0">
[area pg]</A>

</STRONG>
<DD>
Like the <EM>areatarget</EM> element, except it will never yield
a frame target.
<p>
<DT><STRONG>

<A NAME="minivend_page_1">
[/page], [/pagetarget]</A>

</STRONG>
<DD>
Expands into &lt;/a&gt;. Used with the page or pagetarget elements, such as:
[page shirts]Our shirt collection[/page] or [pagetarget pants main] Our
pants collection[/pagetarget].  They are syntactically the same, so
you can use either one to terminate an anchor -- the two different ones
are provided for consistency. 
<p>TIP: A small efficiency boost in large pages is to just use the &lt;/A>
tag.
<p>
<DT><STRONG>

<A NAME="minivend_frames_on_0">
[frames_on]</A>

</STRONG>
<DD>
Turns on the frames processing option, which is disabled by default.
The proper way to use this is to put it ONLY in the first page which
is loaded by frame-based browsers, as part of the initial frame load.
It is persistent for the entire session, or until counteracted with a
[frames_off] tag.
<p>
<DT><STRONG>

<A NAME="minivend_frames_off_0">
[frames_off]</A>

</STRONG>
<DD>
Turns off the frames processing option.  This can be used to disable
frames, perhaps as a clickable option for users.  It is persistent for
the entire session, or until counteracted with a [frames_on] tag.
<p>IMPORTANT NOTE:  This doesn't turn of frames in your browser! If
you let a TARGET tag escape, it will probably cause a new window
to be opened, or other types of anomalous operation.
<p>
<DT><STRONG>

<A NAME="minivend_finish_order_0">
[finish_order page*]</A>

</STRONG>
<DD>
This element is used to give the customer, while browsing, a way to go
to the order page (or optional checkout page) after they have ordered
something. If they haven't ordered anything yet [finish_order] does not
appear at all on the displayed page. If they have ordered an item, the
element will expand into something like:
<p>
<XMP>
 <a href="http://machine.company.com/cgi-bin/vlink/order;WehUkATn;;1">
 Finish Incomplete Order</a>

</XMP>
<p>If the optional page is supplied, that will be the order page used
to finish the order.
<p>
<DT><STRONG>

<A NAME="minivend_order_0">
[order code page*]</A>

</STRONG>
<DD>
Expands into a hypertext link which will include the specified
code in the list of products to order and display the order
page. code should be a product code listed in the ``products''
database.
<p>
<DT><STRONG>

<A NAME="minivend_order_1">
[/order]</A>

</STRONG>
<DD>
Expands into &lt;/a&gt;. Used with the order element, such as: Buy a
[order TK112]Toaster[/order] today.
<p>
<DT><STRONG>

<A NAME="minivend_price_0">
[price code]</A>

</STRONG>
<DD>
Expands into the price of the product identified by code as
found in the products database.
<p>
<DT><STRONG>

<A NAME="minivend_description_1">
[description code]</A>

</STRONG>
<DD>
Expands into the description of code as found in the products
database.
<p>
<DT><STRONG>

<A NAME="minivend_accessories_1">
[accessories code]</A>

</STRONG>
<DD>
Expands into the value of the accessories database entry for the product
identified by 
<A HREF="minivend.html#minivend_code_0">code</A>
 as found in the products database.
<p>
<DT><STRONG>

<A NAME="minivend_field_0">
[field name code]</A>

</STRONG>
<DD>
Expands into the value of the field <EM>name</EM> for the product
identified by 
<A HREF="minivend.html#minivend_code_0">code</A>
 as found in the products database.
<p>
<DT><STRONG>
<EM>[static /html/path] static-area [/static]</EM>
</STRONG>
<DD>
Defines an area (usually an item, loop, or search list) that
will be built with HREFs to regular pages instead of to the
MiniVend server. Search, scan, and order URLs will still be
made to go to the CGI.  Use in conjunction with 
<A HREF="minivend.html#minivend_cookies_0">Cookies</A>
 and

<A HREF="minivend.html#minivend_staticpath_0">StaticPath</A>
 to allow access to static page trees from MiniVend.
This can increase system capacity on heavily-trafficked systems.
<p>
<DT><STRONG>

<A NAME="minivend_body_0">
[body n]</A>

</STRONG>
<DD>
Selects from the predefined color schemes and/or backgrounds, and
just becomes a &lt;BODY> tag if none are defined. See 
<EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_buttonbar_0">
[buttonbar n]</A>

</STRONG>
<DD>
Selects from the predefined buttonbars, and is stripped if it
doesn't exist. See <EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_random_0">
[random]</A>

</STRONG>
<DD>
Selects from the predefined random messages, and is stripped if none
exist. See <EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_random_0">
[random]</A>

</STRONG>
<DD>
Selects from the predefined rotating messages, and is stripped if none
exist. Each user has a separate rotation pattern. See 
<EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_item_list_0">
[item_list]</A>

</STRONG>
<DD>
Places an iterative list of the items in the shopping cart.  See 
<EM>The Order Page</EM> for a description.
<p>
<DT><STRONG>

<A NAME="minivend_item_list_1">
[/item_list]</A>

</STRONG>
<DD>
Terminates the [item_list] tag.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_description_0">
[shipping_description]</A>

</STRONG>
<DD>
The text description of the shipping mode currently selected.
<p>
<DT><STRONG>

<A NAME="minivend_row_0">
[row nn]</A>

</STRONG>
<DD>
Formats text in tables.  Intended for use in reports or &lt;PRE&gt;&lt;/PRE&gt; HTML
areas.  The parameter <EM>nn</EM> gives the number of columns to use. Inside the
row tag, [col param=value ...] tags may be used. 
<p>
<DT><STRONG>

<A NAME="minivend_row_1">
[/row]</A>

</STRONG>
<DD>
Terminates a [row nn] element.
<p>
<DT><STRONG>

<A NAME="minivend_col_0">
[col width=nn wrap=yes|no gutter=n align=left|right|input spacing=n]</A>

</STRONG>
<DD>
Sets up a column for use in a [row]. This parameter can only be contained
inside a [row nn] [/row] tag pair.  Any number of columns (that fit within
the size of the row) can be defined.
<p>The parameters are:
<p>
<XMP>
    width=nn        The column width, I<including the gutter>. Must be
                    supplied, there is no default.  A shorthand method
                    is to just supply the number as the I<first> parameter,
                    as in [col 20].
        
    gutter=n        The number of spaces used to separate the column (on
                    the right-hand side) from the next. Default is 2.
        
    spacing=n       The line spacing used for wrapped text. Default is 1,
                    or single-spaced.
        
    wrap=(yes|no)   Determines whether text that is greater in length than
                    the column width will be wrapped to the next line. Default
                    is I<yes>.
        
    align=(L|R|I)   Determines whether text is aligned to the left (the default),
                    the right, or in a way that might display an HTML text
                    input field correctly.

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_col_1">
[/col]</A>

</STRONG>
<DD>
Terminates the column field.
<p>
<DT><STRONG>

<A NAME="minivend_calc_0">
[calc]</A>

</STRONG>
<DD>
Starts a region where the arguments are calculated according to normal
arithmetic symbols. For instance:
<p>
<XMP>
    [calc] 2 + 2 [/calc]

</XMP>
<p>will display:
<p>
<XMP>
    4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_calc_1">
[/calc]</A>

</STRONG>
<DD>
Terminates the calculated region.
<p>TIP: The [calc] tag is really the same as the [perl] tag, except
that it doesn't accept arguments, is more efficient to parse, and
is interpolated at a higher precedence.
<p>
<DT><STRONG>

<A NAME="minivend_currency_0">
[currency]</A>

</STRONG>
<DD>
When passed a value of a single number, formats it according to the
currency specification. For instance:
<p>
<XMP>
    [currency]4[/currency]

</XMP>
<p>will display:
<p>
<XMP>
    4.00

</XMP>
<p>Uses the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
, 
<A HREF="minivend.html#minivend_pricedivide_0">PriceDivide</A>
, and <EM>PriceComma</EM> settings as
appropriate, and can contain a [calc] region.  If Locale is set to 'pt',
and 
<A HREF="minivend.html#minivend_pricedivide_0">PriceDivide</A>
 to 100, the following
<p>
<XMP>
    [currency] [calc] 50000 + 100000 [/calc] [/currency]

</XMP>
<p>the number 1.500,00 will be displayed.
<p>
<DT><STRONG>

<A NAME="minivend_cart_0">
[cart name]</A>

</STRONG>
<DD>
Sets the name of the current shopping cart for display of shipping, price,
total, subtotal, and nitems tags.  If you wish to use a different price for
the cart, all of the above except [nitems] and [shipping] will reflect the
normal price field -- you must emulate those operations with embedded Perl
or the [item-list], [calc], and [currency] tags.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_minivend_2">
MiniVend Conditional HTML</A>
</H2>
To build complex order forms and reports, MiniVend supplies some conditional
capability with the [if ...] text [else] else-text [/else][/if]
construct.  It allows for testing for a condition within the Vend session,
and if true, inserting text and/or HTML. If the condition is not true, no
text (or the optional [else] text) will be inserted.
<p>This facility cannot be considered a language, for constructs cannot be
nested in a linear fashion, and operations cannot be performed (except
as side effects to the [if] tag).
<p>Starting with MiniVend 2.0, Perl code can be embedded directly in
the pages for additional control. This overcomes some of the limitations
of MiniVend conditional HTML.
<p><STRONG>NOTE:</STRONG> MiniVend interpolates tags in a highly ordered fashion, with
each tag having a precedence.  The order of the tag interpolation can
be changed by enclosing the tag in a set of double square brackets, bringing
it forward in the process.  The order of interpolation is:
<p>
<XMP>
  [[any tag]] cart item-list loop default value scratch calc if lookup
  set data file finish_order frames_on frames_off secure_order framebase
  body help buttonbar random rotate checked selected accessories field
  static pagetarget area areatarget page last_page perl order nitems
  discount subtotal shipping shipping_description salestax total_cost
  price currency description row process_order process_search
  process_target

</XMP>
<p>Most of the tests use Perl code, but MiniVend uses the Safe module with
its default restrictions to help ensure that improper code will not
crash the server or modify the wrong data.  There is nothing to be done
if your code enters an endless loop, though, and you have to use this
capability with caution.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_if_1">
[if type field op* compare*]</A>

</STRONG>
<DD>
Allows conditional building of HTML based on the setting of various MiniVend
session and database values. Accessible areas are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_session_0">
session</A>

</STRONG>
<DD>
The MiniVend session variables. Of particular interest
are <EM>login</EM>, 
<A HREF="minivend.html#minivend_frames_0">frames</A>
, <EM>secure</EM>, and 
<A HREF="minivend.html#minivend_browser_0">browser</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_config_0">
config</A>

</STRONG>
<DD>
The MiniVend configuration variables. These are set
by the directives in your MiniVend configuration file (or
the defaults).
<p>
<DT><STRONG>

<A NAME="minivend_value_0">
value</A>

</STRONG>
<DD>
The MiniVend user variables, typically set in search,
control, or order forms. Variables beginning with 'mv_'
are MiniVend special values, and should be tested/used
with caution.
<p>
<DT><STRONG>

<A NAME="minivend_scratch_0">
scratch</A>

</STRONG>
<DD>
The MiniVend scratchpad variables, which can be set
with the [set name]value[/set] element. 
<p>
<DT><STRONG>

<A NAME="minivend_validcc_0">
validcc</A>

</STRONG>
<DD>
A special case, takes the form [if validcc no type exp_date].
Evaluates to true if the supplied credit card number, type
of card, and expiration date pass a validity test.  Does
checksum digit calculation to weed out typos or phony 
card numbers.
<p>
<DT><STRONG>

<A NAME="minivend_accessory_0">
accessory</A>

</STRONG>
<DD>
The accessories database.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_0">
shipping</A>

</STRONG>
<DD>
The shipping database.
<p>
<DT><STRONG>

<A NAME="minivend_salestax_0">
salestax</A>

</STRONG>
<DD>
The salestax database.
<p>
</DL>
.
<p>
</DL>
The <EM>field</EM> term is the specifier for that area.  For example, [if session.frames] would return true if the 'frames' session parameter was set.
<p>As an example, consider buttonbars for frame-based setups.  It would be
nice to display a different buttonbar (with no frame targets) for sessions
that are not using frames:
<p>
<XMP>
    [if session frames]
        [buttonbar 1]
    [else]
        [buttonbar 2]
    [/else]
    [/if]

</XMP>
<p>Another example might be the when search matches are displayed. If
you use the string '[value mv_match_count] titles found', it will display
a plural for only one match.  Use:
<p>
<XMP>
    [if value mv_match_count != 1]
        [value mv_match_count] matches found.
    [else]
        Only one match was found.
    [/else]
    [/if]

</XMP>
<p>The <EM>op</EM> term is the compare operation to be used. Compare operations are
as in Perl:
<p>
<XMP>
    ==  numeric equivalence
    eq  string equivalence
    >   numeric greater-than
    gt  string greater-than
    <   numeric less-than
    lt  string less-than
    !=  numeric non-equivalence
    ne  string equivalence

</XMP>
<p>Any simple perl test can be used, including some limited regex matching (no
whitespace or conditionals can be contained in the comparison string). Discussion
of this is beyond the scope of this document.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_then_0">
[then] text [/then]</A>

</STRONG>
<DD>
This is optional, as the text immediately following the [if ..] tag is
used as the conditionally substitued text. When used, the [then] [/then]
pair allows more readable constructs, as all whitespace around the [then]
and tags will be stripped.  If you wish to have leading or trailing
whitespace, you can enclose the value in single or double quotes.
<p>
<DT><STRONG>

<A NAME="minivend_else_0">
[else] text [/else]</A>

</STRONG>
<DD>
The optional else-text for an if or if_field conditional.
<p>
<DT><STRONG>

<A NAME="minivend_condition_0">
[condition] text [/condition]</A>

</STRONG>
<DD>
Only used with the [if explicit] tag. Allows an arbitrary expression
<STRONG>in Perl</STRONG> to be placed inside, with its return value interpreted as
the result of the test. If arguments are added to [if explicit args],
those will be passed as arguments are in the <EM>[perl]</EM> construct.
<p>
<DT><STRONG>

<A NAME="minivend_if_2">
[/if]</A>

</STRONG>
<DD>
Terminates an if conditional.
<p>
<DT><STRONG>

<A NAME="minivend_any_0">
[[any]]</A>

</STRONG>
<DD>
Forces early interpolation of any tag. Sometimes needed if the order
of interpolation does not achieve the desired result (meaning you see
MiniVend tags displayed on the page).
<p>
<DT><STRONG>

<A NAME="minivend__0">
[ n [any] HTML n ]</A>

</STRONG>
<DD>
Where n is a single digit in the range 0-9. If present, it forces early
interpolation of that region of MiniVend tags, and is differentiated from
other early interpolation areas.  The enclosed MiniVendtags will still
be interpolated in the normal order, but it can usually be combined
with the [post] [/post] pair to achieve the desired order.
<p>
<DT><STRONG>

<A NAME="minivend_post_0">
[post]</A>

</STRONG>
<DD>
Selects an area that will not be interpolated until after the rest of
the page is interpolated. If followed by a number, will match a terminating
[/post] tag with the corresponding number.
<p>
<DT><STRONG>

<A NAME="minivend_post_1">
[/post]</A>

</STRONG>
<DD>
Terminates a [post] region.
<p>
<DT><STRONG>

<A NAME="minivend_set_0">
[set variable]value[/set]</A>

</STRONG>
<DD>
Sets a scratchpad variable to 
<A HREF="minivend.html#minivend_value_0">value</A>
. One way this is used is to
save pages that a customer has seen -- perhaps for a rotating message.
A rotating message implementation is shown in the sample page 
<A HREF="minivend.html#minivend_flypage_0">flypage.html</A>
.
<p>The mv_* variables that are used for search and order conditionals are
in another namespace -- they can be set by means of hidden fields in a
form.
<p>
<DT><STRONG>

<A NAME="minivend_data_0">
[data area field key]</A>

</STRONG>
<DD>
Returns the value of the field in any of the arbitrary databases,
or from the variable namespaces.  Databases will hide variables, so
don't name a database ``session'', ``scratch'', or any of the other
reserved names! Case is sensitive, so in a pinch you could call the
database ``Session'', but it would be better not to.
<p>
<DT><STRONG>

<A NAME="minivend_loop_0">
[loop item,item,item] value [/loop]</A>

</STRONG>
<DD>
Returns a string consisting of the value, repeated for every item in a
comma-separated or space-separated list.  Operates in the same fashion
as the [item-list] tag, except for order-item-specific values. Intended
to pull multiple attributes from an item modifier -- but can be useful
for other things, like building a pre-ordained product list on a page.
<p>Limited to 1024 values in the list.
<p>
<DT><STRONG>

<A NAME="minivend_perl_1">
[perl args] code [/perl]</A>

</STRONG>
<DD>
See the section on 
<A HREF="minivend.html#minivend_embedded_0"><EM>Embedded Perl Code</EM></A>
.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_embedded_0">
Embedded Perl Code</A>
</H2>
As of MiniVend 2.0, Perl code can be directly embedded in pages. The tag
is specified as [perl arguments] any_legal_perl_code [/perl].
<p>Using MiniVend variables with embedded Perl capability is not recommended
unless you are thoroughly familiar with Perl 5 references.  It is best to
pass the values you need with MiniVend tags, which are mostly interpolated
before the [perl] tags.  Example:
<p>
<XMP>
    # Simple example
    my $shipmode = '[value mv_shipmode]';
    # If the item might contain a single quote
    my $comments = '[value comments escaped]';
    # Another method
    my $comments = q{[value comments]};

</XMP>
<p>This allows you to pass user-space variables for most needed
operations.  You can pass whole lists of items with constructs
like:
<p>
<XMP>
    # Perl ignores the trailing comma
    my(%prices) = ( [item_list]
                    '[item_code]', '[item-price]',
                    [/item_list]);

</XMP>
<p>Even easier is the definition of a subroutine:
<p>
<XMP>
    [set Thanks]
    my($name, $number) = @_;
    "Thanks, $name, for your order! The order number is $number.\n";
    [/set]
    [perl sub]
        Thanks ('[value name escaped]', '[value mv_order_number escaped]')
    [/perl]

</XMP>
<p>(The <EM>escaped</EM> causes any single quotes which might be contained in the
values to be escaped, preventing syntax errors in the case of a name like
``O'Reilly''.)
<p>The arguments that can be passed are any to all of:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_browser_0">
browser</A>

</STRONG>
<DD>
The browser string from the users browser, read-only. Referred
to in your code as <STRONG>$Safe</STRONG>{browser}.
<p>
<DT><STRONG>

<A NAME="minivend_carts_0">
carts</A>

</STRONG>
<DD>
Gives read-write access to all of the shopping carts.  on order. This
is an array of hashes, and includes the product
code, quantity, and any modifiers you have specified.
Referred to in your code as a reference to the
array, <STRONG>$Safe</STRONG>{items} or @{<STRONG>$Safe</STRONG>{items}}.
<p>
<XMP>
    # Move contents of 'layaway' cart to main cart
    $Safe{carts}->{main} = $Safe{carts}->{layaway};
    $Safe{carts}->{main} = [];

</XMP>
<p>Careful with this -- you can lose the items on order with improper
code, though syntax errors will be caught before the code is run.
<p>
<DT><STRONG>

<A NAME="minivend_config_0">
config</A>

</STRONG>
<DD>
Gives read-write access to the configuration of the catalog. USE WITH
EXTREME CAUTION -- many of the variables are references to anonymous
arrays and hashes.  You can crash your catalog if you modify the wrong
thing. Referred to in your code as <STRONG>$Safe</STRONG>{config}, a reference to the
hash containing the configuration structure.  If you use this, it
is recommended that you refer frequently to the MiniVend source code.
<p>
<DT><STRONG>

<A NAME="minivend_discount_0">
discount</A>

</STRONG>
<DD>
Gives read-write access to session discounts, an
anonymous hash. Referred to in your code as <STRONG>$Safe</STRONG>-&gt;{discounts}.
<p>
<DT><STRONG>

<A NAME="minivend_file_0">
file</A>

</STRONG>
<DD>
If specified, the anchor text is a file name to read the Perl code from.
This allows code to be maintained in separate files, though you need
to remember that any MiniVend tags contained will generally not be
interpolated (depending on interpolation order and use of the [[any]]
and [post] modifiers).  The file name is relative to the MiniVend base
directory unless specified as an absolute path.
<p>
<DT><STRONG>

<A NAME="minivend_frames_0">
frames</A>

</STRONG>
<DD>
The true/false value determining whether frames processing is
enabled. Read-only -- you can set the value with [frames-off] or
[frames-on]. Referred to in your code as <STRONG>$Safe</STRONG>{frames}.
<p>
<DT><STRONG>

<A NAME="minivend_items_0">
items</A>

</STRONG>
<DD>
Gives read-only access to the items on order, <EM>for the current cart</EM>.
This is an array of hashes, and includes the product code, quantity,
and any modifiers you have specified.  Referred to in your code as a
reference to the array, <STRONG>$Safe</STRONG>{items} or @{<STRONG>$Safe</STRONG>{items}}.
<p>
<XMP>
    # Product code of first item in cart
    $item_code = $Safe{items}->[0]->{code};  
    # Quantity for third item in cart
    $item_code = $Safe{items}->[2]->{quantity};  
    # Color of second item in cart
    $item_code = $Safe{items}->[2]->{color};  

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_scratch_0">
scratch</A>

</STRONG>
<DD>
Gives read-write access to the scratch variables, a reference to an
anonymous hash. Referred to in your code as <STRONG>$Safe</STRONG>{scratch}.
<p>
<DT><STRONG>

<A NAME="minivend_sub_0">
sub</A>

</STRONG>
<DD>
If specified, the anchor text is a subroutine name and optional
parameters to be passed.  The subroutine can be defined in three
ways; as a global subroutine (works for entire server); as a
catalog-wide pre-defined subroutine; or in a scratchpad variable.
All are called with the same syntax -- the arguments are passed
in via the <STRONG>@_</STRONG> argument array.
<p><STRONG>IMPORTANT NOTE:</STRONG> Global subroutines are not subject to the stringent
security checking of the <EM>Safe</EM> module, so almost anything goes
there. The subroutine will be able to modify any variable in MiniVend,
and will be able to write to read and write any file that the MiniVend
daemon has permission to write. Though this gives great power, it should
be used with caution. Careful! They are defined in the main minivend.cfg
file, so should be safe from individual users in a multi-catalog system.
<p>Global subroutines are defined in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 with the

<A HREF="minivend.html#minivend_globalsub_0">GlobalSub</A>
 directive.
<p>Catalog subroutines are defined in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
, with
the 
<A HREF="minivend.html#minivend_sub_1">Sub</A>
 directive.  They are subject to the stringent <EM>Safe.pm</EM>
security restrictions that are controlled by 
<A HREF="minivend.html#minivend_safeuntrap_0">SafeUntrap</A>
.
<p>Scratch subroutines are defined in the pages, and are also subject
to <EM>Safe.pm</EM> checking.  See the beginning of this section for an
example of a subroutine definition. There is no ``sub name { }'' that
surrounds it -- the subroutine is named from the name of the 
scratch variable.
<p>
<DT><STRONG>

<A NAME="minivend_values_0">
values</A>

</STRONG>
<DD>
Gives read-write access to the user variables, including the MiniVend
special variables, an anonymous hash.  Referred to in your code as
<STRONG>%{</STRONG>Safe{'values'}} or <STRONG>$Safe</STRONG>{'values'}-&gt;{variable}.
<p>
<XMP>
    # Read the user's selected shipping mode
    my $shipmode = $Safe{values}->{mv_shipmode};

</XMP>
<p>
</DL>
The code can be as complex as desired, but cannot use any operators.that modify the filesystem or use ``unsafe'' operations like ``system'',
``exec'', or backticks.  These constraints are enforced with the default
permissions of the standard Perl module <EM>Safe</EM> -- operations may
be untrapped on a system-wide basis with the 
<A HREF="minivend.html#minivend_safeuntrap_0">SafeUntrap</A>
 directive.
<p>The result of the tag will be the result of the last expression
evaluated, just as in a subroutine.  If there is a syntax error
or other problem with the code, there will be no output.
<p>Here is a simple one which does the equivalent of the classic
hello.pl program:
<p>
<XMP>
    [perl] my $tmp = "Hello, world!"; $tmp; [/perl]

</XMP>
<p>Of course you wouldn't need to set the variable -- it is just there
to show the capability.
<p>To echo the user's browser, but within some HTML tags:
<p>
<XMP>
    [perl browser]
    my $html = '<H5>';
    $html .= $browser;
    $html .= '</H5>';
    $html;
    [/perl]

</XMP>
<p>To show the user their name, and the current time:
<p>
<XMP>
    [perl values]
    my $string = "Hi, " . $Safe{values}->{'name'} ". The time is now ";
    $string .= localtime;
    $string;
    [/perl]

</XMP>
<p>
<H2> 
<A NAME="minivend_on_the_fly_1">
On-the-fly Catalog Pages</A>
</H2>
If an item is displayed on the search list (or order list) and there is
a link to a special page keyed on the item, MiniVend will attempt to
build the page ``on the fly''. It will look for the special page
<EM>flypage.html</EM>, which is used as a template for building the page.  If

<A HREF="minivend.html#minivend_item_field_0">[item_field fieldname]</A>
, <EM>[item_price]</EM>, (etc.) elements are used on the page,
quite complex and information-packed pages can be built.  The

<A HREF="minivend.html#minivend_if_field_0">[if_field fieldname]</A>
 HTML 
<A HREF="minivend.html#minivend_if_field_1">[/if_field]</A>
 pair can be used to insert
HTML only if there is a non-blank value in a particular field.
<p>If the directive 
<A HREF="minivend.html#minivend_pageselectfield_0"><EM>PageSelectField</EM></A>
 is set to a valid product database
field which contains a valid MiniVend page name (relative to the catalog
pages directory, without the .html suffix) it will be used to build the
on-the-fly page.
<p>
<H2> 
<A NAME="minivend_required_0">
Required Pages</A>
</H2>
A number of HTML pages are required for MiniVend operation.  Typically they
are used to transmit error messages, status of search or order operations, and
other out of boundary conditions.
<p>As of MiniVend 1.03, the names of these pages can be set with the 
<A HREF="minivend.html#minivend_specialpage_0"><EM>SpecialPage</EM></A>

directive. The standard pages and their default locations:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_badsearch_0">
badsearch (pages/badsearch.html)</A>

</STRONG>
<DD>
The error page displayed if there is a system or user error with the search
engine.
<p>
<DT><STRONG>

<A NAME="minivend_canceled_0">
canceled (pages/canceled.html)</A>

</STRONG>
<DD>
The page displayed by MiniVend when an order has been canceled by
the user.
<p>
<DT><STRONG>

<A NAME="minivend_catalog_1">
catalog (pages/catalog.html)</A>

</STRONG>
<DD>
The main catalog page presented by MiniVend when another page is
not specified.
<p>
<DT><STRONG>

<A NAME="minivend_checkout_0">
checkout (pages/order.html)</A>

</STRONG>
<DD>
The page the customer is sent to when checking out (the
location pointed to by a <EM>[finish_order]</EM> tag.
<p>
<DT><STRONG>

<A NAME="minivend_confirmation_0">
confirmation (pages/confirmation.html)</A>

</STRONG>
<DD>
After the order is completed, the confirmation page is
displayed.
<p>
<DT><STRONG>

<A NAME="minivend_failed_0">
failed (pages/failed.html)</A>

</STRONG>
<DD>
If the sendmail program could not be invoked to email the
completed order, the failed.html page is displayed. (Sadly we
don't know if the email was successfully delivered).
<p>
<DT><STRONG>

<A NAME="minivend_flypage_0">
flypage (pages/flypage.html)</A>

</STRONG>
<DD>
If the catalog page for an item was not found when its [item_link]
is clicked, this page is used as a template to build an on-the-fly
page. See 
<A HREF="minivend.html#minivend_on_the_fly_1"><EM>On-the-fly Catalog Pages</EM></A>
.
<p>
<DT><STRONG>

<A NAME="minivend_interact_0">
interact (pages/interact.html)</A>

</STRONG>
<DD>
Displayed if an unexpected response was received from the
browser, such as not getting expected fields from submitting a
form. This would probably happen from typos in the html pages,
but could be a browser bug.
<p>
<DT><STRONG>

<A NAME="minivend_missing_0">
missing (pages/missing.html)</A>

</STRONG>
<DD>
This page is displayed if the URL from the browser specifies a
page that does not have a matching .html file in the pages
directory. This can happen if the customer saved a bookmark to
a page that was later removed from the database.
<p>
<DT><STRONG>

<A NAME="minivend_needfield_0">
needfield (pages/needfield.html)</A>

</STRONG>
<DD>
Displayed if the user did not fill in a required field in the
order form.  See <EM>REQUIRED FIELDS</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_nomatch_0">
nomatch (pages/nomatch.html)</A>

</STRONG>
<DD>
This page is displayed if the search engine is used, but there
is no match for the search specification.
<p>
<DT><STRONG>

<A NAME="minivend_noproduct_0">
noproduct (pages/noproduct.html)</A>

</STRONG>
<DD>
This page is displayed if the URL from the browser specifies
the ordering of a product code which is not in the products
file.
<p>
<DT><STRONG>

<A NAME="minivend_order_2">
order (pages/order.html)</A>

</STRONG>
<DD>
This page is displayed when the customer orders an item. It can contain
any or all of the customer-entered values, but is commonly used as a
status display (or ``shopping basket'').  If frames are in use, the
special order page can be configured with the directive

<A HREF="minivend.html#minivend_frameorderpage_0"><EM>FrameOrderPage</EM></A>
.
<p>
<DT><STRONG>

<A NAME="minivend_search_0">
search (pages/search.html)</A>

</STRONG>
<DD>
Contains the default output page for the search engine results.  Also
required is an input page, which can be the same as search.html or an
additional page.  Five sample input pages are supplied with the demo -
the query.html, results.html, helpquery.html, mvfaq.html,
and category.html files in the <EM>sample/pages</EM> directory,
<p>
<DT><STRONG>

<A NAME="minivend_violation_0">
violation (pages/violation.html)</A>

</STRONG>
<DD>
Displayed if a security violation is noted, such as an attempt to
submit a credit card number on a non-secured form when in ExtraSecure
mode.
<p>
</DL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_databases_0">
DATABASES</A>
</H1>
MiniVend, as with most powerful shopping cart programs, is all about
databases.  
<p>This version of MiniVend implements the database in either GDBM, DB_File,
or in-memory format. If you use DBM, large catalogs can be used without
using too much memory.  The DBM files are built automatically when they
change, from the the ASCII source file. If you don't have either GDBM
or DB_File, or you set the environment variable MINIVEND_NODBM before
starting the server, an in-memory product database will be used. Catalogs
of more than, say, 1,000 items will use large amounts of memory.
<p>Support for the mSQL database is included. Form-based
updates and inserts allow user input and remote maintenance.
<p>MiniVend reads the data to place in the DBM files from standard
ASCII-delimited files. They can have ^M (carriage return) characters if
desired, but must have a newline character to work -- Mac users
uploading files must use ASCII mode, not binary mode!
<p>Microsoft Excel is a widely-used tool to maintain MiniVend databases,
but has several problems with its standard TAB-delimited export, like
encasing fields containing commas in quotes, generating extra carriage
returns embedded in records, and not including trailing blank fields.  A
small <EM>adjexcel</EM> utility is provided that will correct most of those 
problems.
<p>Three delimiter schemes are provided as standard:
<p><STRONG>IMPORTANT NOTE:</STRONG> The items must be separated by a <STRONG>single</STRONG> delimiter
character. The items are lined up for your reading convenience.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_tab_0">
TAB</A>

</STRONG>
<DD>
Fields separated by ^I characters. No whitespace should be at the
beginning of the line.
<p>
<XMP>
    code    description             price   image
    SH543   Men's fine cotton shirt 14.95   shirts.jpg

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pipe_0">
PIPE</A>

</STRONG>
<DD>
Fields separated by <EM>|</EM> characters. No whitespace should be at the
beginning of the line.
<p>
<XMP>
    code|description|price|image
    SH543|Men's fine cotton shirt|14.95|shirts.jpg

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_csv_0">
CSV</A>

</STRONG>
<DD>
Fields enclosed in quotes, separated by commas. No whitespace should be at the
beginning of the line.
<p>
<XMP>
    "code", "description", "price", "image"
    "SH543", "Men's fine cotton shirt", "14.95", "shirts.jpg"

</XMP>
<p>
</DL>
The 
<A HREF="minivend.html#minivend_delimiter_0"><EM>Delimiter</EM></A>
 directive sets the scheme, and should be set.to one of those three values.  TAB is the default scheme.
<p><STRONG>IMPORTANT NOTE:</STRONG> Field names are always case-sensitive. Unless
you are consistent in the names, you will have problems. All lower
or all upper case names are recommended.
<p>MiniVend uses one mandatory database, the <EM>products file</EM>.  It is
kept in the file 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 in the products directory.
<p>It also has a number of standard but optional databases, some
of which are in fixed special formats:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_shipping_asc_0">
shipping.asc</A>

</STRONG>
<DD>
The database of shipping options if the 
<A HREF="minivend.html#minivend_customshipping_0"><EM>CustomShipping</EM></A>
 directive
is in use. See 
<A HREF="minivend.html#minivend_custom_0"><EM>Custom Shipping</EM></A>
.
<p>
<DT><STRONG>

<A NAME="minivend_salestax_asc_0">
salestax.asc</A>

</STRONG>
<DD>
The database of sales tax information if the [salestax] tag is to
be used.  A default is supplied -- caution, these things change!
See <EM>Sales Tax</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_accessories_asc_0">
accessories.asc</A>

</STRONG>
<DD>
A simple auxiliary database keyed on the product code.  It's value
is available via the [item_accessories] or [accessories code] tags.
See 
<A HREF="minivend.html#minivend_accessories_0"><EM>Accessories</EM></A>
.
<p>
<DT><STRONG>

<A NAME="minivend_pricing_asc_0">
pricing.asc</A>

</STRONG>
<DD>
The database of quantity pricing information. 
See <EM>Quantity Pricing</EM>.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_the_3">
The Products File</A>
</H2>
Each product you are selling should be given a product code: A short
code that identifies the product on the ordering page and in the
catalog. You can use any combination of letters, digits, dashes,
periods, hash signs, or underscores for the product code. The

<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file is a ASCII-delimited list of all the product codes,
along with an arbitrary number of fields which must contain at least the
fields 'description' and 'price' (or whatever you set the PriceField and
DescriptionField directives to).  Any additional information you want in
the catalog can be placed in any arbitrary field.
See <EM>MiniVend Database Capability</EM>for details on the format.
<p>Field names are case-sensitive. Unless you have fields with the names
``description'' and ``price'' field, you will have to appropriately set the

<A HREF="minivend.html#minivend_pricefield_0"><EM>PriceField</EM></A>
 and 
<A HREF="minivend.html#minivend_descriptionfield_0"><EM>DescriptionField</EM></A>
 directives to use the [item-price]
and [item-description] tags.
<p>The product code must be the first field in the line.
<p>The words should be separated by one of the approved delimiting schemes
(TAB, PIPE, or CSV, set with the 
<A HREF="minivend.html#minivend_delimiter_0"><EM>Delimiter</EM></A>
 directive), and are
case-sensitive. If you play with the case of the ``description'' or ``price''
field, you will have to appropriately set the 
<A HREF="minivend.html#minivend_pricefield_0"><EM>PriceField</EM></A>
 and

<A HREF="minivend.html#minivend_descriptionfield_0"><EM>DescriptionField</EM></A>
 directives.
<p><STRONG>NOTE:</STRONG> CSV is not recommended as the scheme for the main products
database. It is much slower than TAB- or PIPE-delimited, and dramatically
reduces search engine functionality -- no field-specific searches are
possible.  Don't use it -- you will be sorry if you do.
<p>
<H2> 
<A NAME="minivend_arbitrary_0">
Arbitrary Databases</A>
</H2>
MiniVend can also manage an unlimited number of arbitrary databases.
They are in the same format as the products file by default, but
7 addressable schemes are available:
<p>
<XMP>
    Type 1      Default - same as products file (TAB, PIPE, or CSV)
    Type 2      Each field on its own line, a blank line or lines
                separates the record. Watch those carriage
                returns!
    Type 3      Fields separated by a \n%%\n combination, records by
                \n%%%\n (where \n is a newline). Watch those carriage
                returns!
    Type 4      CSV
    Type 5      PIPE
    Type 6      TAB
    Type 7      mSQL

</XMP>
<p>The databases are specified in 
<A HREF="minivend.html#minivend_database_0"><EM>Database</EM></A>
 directives, as:
<p>
<XMP>
    Database    Arbitrary /usr/data/arbitrary.asc 4

</XMP>
<p>That specifies a type 4 database, the ASCII version of which
is located in the file /usr/data/arbitrary.asc (the DBM file
will go there too, as /usr/data/arbitrary.db or arbitrary.gdbm),
and the name it will be accessed under in MiniVend is ``Arbitrary''.
The name is case sensitive. Fields are accessed with the
[item_data name field] or [data name field key] elements.
<p><p><hr>

<H1> 
<A NAME="minivend_msql_0">
MSQL SUPPORT</A>
</H1>
MiniVend can use mSQL, the Minerva database facility. Minerva is
not included with MiniVend -- it is widely available on the net.
MiniVend uses the fine Msql.pm Perl module by Andreas Koenig, a
very powerful mSQL access method. 
<p>It is beyond the scope of this document to describe SQL, Minerva,
or MsqlPerl, and we will not attempt to.  Familiarity is assumed, 
though the only familiarity with MsqlPerl should be that required
to install the module -- MiniVend should do the rest.
<p>MiniVend cannot create the initial mSQL database, but once the
database is available via the mSQL server (and is writable or readable
by the user ID running the MiniVend server) it can be created from an
ASCII file as with any other MiniVend database.
<p>
<H2> 
<A NAME="minivend_importing_0">
Importing from an ASCII file</A>
</H2>
There are a couple of differences in the database definition. MiniVend
by default uses the first column of the ASCII file as the primary key, 
with a <EM>char(14)</EM> type, and assigns all other columns a <EM>char (32)</EM>
definition.  These definitions can be changed by placing the proper
definitions along with the field names on the first line of the file,
for example:
 
  code    description char(64)      price   image
  SH543   Men's fine cotton shirt   14.95   shirts.jpg
<p>This keeps the default MiniVend definitions for code (char 14 and
primary key), price (char 32), and image (also char 32), but sets
the description field to a size and type of <EM>char(64)</EM>.  Any
mSQL type may be used.
<p>The delimiter used for the ASCII file is that defined by
the 
<A HREF="minivend.html#minivend_delimiter_0"><EM>Delimiter</EM></A>
 directive -- by default it is a TAB.
<p>If you wish to use an existing mSQL database instead of importing, just
make sure there is no file with the same name as the database in the

<A HREF="minivend.html#minivend_productdir_0">ProductDir</A>
 or 
<A HREF="minivend.html#minivend_datadir_0">DataDir</A>
.  If you must have a file for searching, it
is recommended that you use the 
<A HREF="minivend.html#minivend_mv_search_file_0">mv_search_file</A>
 variable and make it
another name.  If you do have a file there, just make sure there is a
file in the directory with the same base name and a <EM>.msql</EM> extension,
otherwise an import will be attempted.
<p><STRONG>IMPORTANT NOTE:</STRONG> It is recommended that MiniVend NOT have write
permission on the products database.  If it does, and the products.asc
file is changed, the Minerva database could be overwritten.
<p>
<H2> 
<A NAME="minivend_msql_1">
mSQL Access Methods</A>
</H2>
A MiniVend mSQL database can be accessed with the same tags as any of
the other databases can. In addition to those standard methods, direct
SQL support is provided with the [msql function] TEXT [/msql] tag set.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_msql_2">
[msql array] SQL [/msql]</A>

</STRONG>
<DD>
A complete array of arrays, suitable for <EM>eval</EM> by Perl, can be returned
by this query.  This tag pair encloses any valid mSQL query, and returns
the results (if any) as a string representing rows and columns, in Perl
array syntax.  If placed in an embedded Perl area as:
<p>
<XMP>
 [perl]

</XMP>
<PRE>
    my <STRONG>$string</STRONG> =&lt;&lt;'EOF';
 [msql array]select * from arbitrary where code &lt;= '19'[/msql]
 EOF
    my $ary = eval $string;
    my $out = '';
    my $i;
    foreach $i (@$ary) {
        $out .= $i->[0];
        $out .= "<BR>";
    }
    $out;
 [/perl]

</PRE>
<p>NOTE: The 'EOF' string terminator must START the line, and not
have trailing characters.  DOS users, beware of carriage returns!
<p>
<DT><STRONG>

<A NAME="minivend_msql_3">
[msql hash] SQL [/msql]</A>

</STRONG>
<DD>
A complete hash of hashes, suitable for <EM>eval</EM> by Perl, can be returned
by this query.  This tag pair encloses any valid mSQL query, and returns
the results (if any) as a string representing rows and columns, in Perl
associative array, or hash, syntax.  If placed in an embedded Perl area as:
<p>
<XMP>
 [perl]

</XMP>
<PRE>
    my <STRONG>$string</STRONG> =&lt;&lt;'EOF';
 [msql hash]select * from arbitrary where code &lt;= '19'[/msql]
 EOF
    my $hash = eval $string;
    my $out = '';
    my $key;
    foreach $key (keys %$hash) {
        $out .= $key->{field1};
        $out .= "<BR>";
    }
    $out;
 [/perl]

</PRE>
<p>
<DT><STRONG>

<A NAME="minivend_msql_4">
[msql set] SQL [/msql]</A>

</STRONG>
<DD>
Any arbitrary SQL query can be passed with this method. No return
text will be sent.  This might be used for passing an order to an 
order database, perhaps on the order report or receipt page. An
example might be:
<p>
<XMP>
 [msql set]
     insert into orders
     values
      ('[value mv_order_number]',
       '[value name escape]',
       '[value address escape]',
       '[value city escape]',
       '[value state escape]',
       '[value zip escape]',
       '[value phone escape]',
       '[item-list]
         Item: [item-code] Quan: [item-quantity] Price: [item-price]
        [/item-list]'
      )
 [/msql]

</XMP>
<p>The values entered by the user are escaped, which prevents errors if
quote characters have slipped into their entry.
<p>
<DT><STRONG>

<A NAME="minivend_msql_5">
[msql param] SQL [/msql]</A>

</STRONG>
<DD>
A list of keys, or in fact any mSQL fields, can be returned as a set of
parameters suitable for passing to a program or list primitive. This tag pair
encloses any valid mSQL query, and returns the results (if any) as a series of
space separated fields, enclosed in quotes.  This folds the entire return
into a single row, so it may be used as a list of keys.
<p>
<DT><STRONG>

<A NAME="minivend_msql_6">
[msql html] SQL [/msql]</A>

</STRONG>
<DD>
This tag returns a set of HTML table rows with <STRONG>bold</STRONG> field names at
the top, followed by each row in a set of table cells.  The &lt;TABLE&gt;
and &lt;/TABLE&gt; tags are not supplied, so you can set your own border
and shading options. Example:
<p>
<XMP>
  <TABLE BORDER=2>
  [msql html]select * from arbitrary where code > '19' order by field2[/msql]
  </TABLE>

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_msql_7">
[msql list SQL] list [/msql]</A>

</STRONG>
<DD>
This tag differs from the rest in that it passes the query enclosed
inside the tag itself. The enclosed text is then evaluated with the
same method as with a loop list, with data items (in columns) iterated
over for the contents of a list.  The following snippet will place
a three-column list in an HTML table:
<p>
<XMP>
  <TABLE BORDER=2>
  <TR><TH><B>SKU</B></TH><TH><B>Description</B></TH><TH><B>Price</B></TH>
  [msql list
    select * from arbitrary where code > '19' order by field2 ]
  <TR>
    <TD>[page [msql-code]][msql-code]</A></TD>
    <TD>[msql-param 1]</TD>
    <TD>[msql-param 2]</TD>
  </TR>
  [/msql]
  </TABLE>

</XMP>
<p>It uses the same tags as in the [loop_list], except prefixed
with <EM>msql</EM>. Available are the following, in order of interpolation:
<p>
<XMP>
  [msql_param n]        Field n of the returned query (in the row)
  [if_msql_field fld]   Returns enclosed text only product field not empty
  [/if_msql_field]      Terminator for above
  [if_msql_data db fld] Returns enclosed text only if data field not empty
  [/if_msql_field]      Terminator for above
  [msql_increment]      Returns integer count of row
  [msql_code]           The first field of each row returned
  [msql_data db fld]    Database field for [msql_code]
  [msql_description]    Product description for [msql_code]
  [msql_field fld]      Product field for [msql_code]
  [msql_link]           Same as item-link
  [msql_price q*]       Price for [msql_code], optional quantity q

</XMP>
<p>
</DL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_forms_0">
FORMS AND MINIVEND</A>
</H1>
MiniVend uses HTML forms for order, search, and control operations. 
Order operations possibly include ordering an item, selecting item
size or other attributes, and reading user information for payment
and shipment.  Search operations may also be triggered by a form.
In addition, the user can control certain aspects of the session,
such as order security, frames presentation, and background display
via a control form.
<p><p><hr>

<H1> 
<A NAME="minivend_special_0">
Special Form Fields</A>
</H1>
MiniVend treats some form fields specially, to link to the search engine
and provide more control over user presentation.
It has a number of predefined variables, most of whose names are prefixed with
<EM>mv_</EM> to prevent name clashes. It also uses a few variables which are
postfixed with integer digits -- those are used to provide control in its
iterating lists.
<p>These special fields all begin with <EM>mv_</EM>, and include:
<p>(O = order, S = search, C = control, A = all)
<p>
<XMP>
 Name               Type  Description
 mv_alinkcolor        C   Sets access link color
 mv_all_chars         S   Turns on punctuation matching
 mv_background        C   Explained in Controlling Page Appearance
 mv_base_directory    S   Sets base directory for search file names
 mv_bgcolor           C   Sets background color
 mv_case              S   Turns on case sensitivity
 mv_cartname          O   Sets the shopping cart name
 mv_cache_params      S   Determines cacheing of searches
 mv_check             A   Any form, sets multiple user variables after update
 mv_checkout          O   Sets the checkout page
 mv_click             A   Any form, sets multiple form variables before update
 mv_coordinate        S   Enables field/spec matching coordination
 mv_credit_card*      O   Discussed in order security (some are read-only)
 mv_customcolors      C   Enables user-custom colors
 mv_dict_end          S   Upper bound for binary search
 mv_dict_fold         S   Non-case sensitive binary search
 mv_dict_limit        S   Sets upper bound based on character position
 mv_dict_look         S   Search specification for binary search
 mv_dict_order        S   Sets dictionary order mode
 mv_doit              A   Common to all forms, sets default action
 mv_email             O   Reply-to address for orders
 mv_errorpage         O   Sets error page if order check fails
 mv_exact_match       S   Sets word-matching mode
 mv_failpage          O   Sets page to display on failed order check
 mv_head_skip         S   Sets skipping of header line(s) in index
 mv_helpon            C   Turns on the help feature if defined
 mv_helpoff           C   Turns off the help feature if defined
 mv_linkcolor         C   Sets the link color
 mv_matchlimit        S   Sets match page size
 mv_max_matches       S   Sets maximum match return
 mv_min_string        S   Sets minimum search spec size
 mv_nextpage          A   Sets next page user will go to after submission
 mv_order_item        O   Causes the order of an item
 mv_order_number      O   Order number of the last order (read-only)
 mv_order_quantity    O   Sets the quantity of an ordered item
 mv_order_profile     O   Selects the order check profile 
 mv_order_receipt     O   Sets the receipt displayed
 mv_order_report      O   Sest the order report sent
 mv_order_subject     O   Sets the subject line of order email
 mv_orderpage         O   Sets the page to display on refresh
 mv_orsearch          S   Selects AND/OR of search words
 mv_profile           S   Selects search profile
 mv_range_alpha       S   Sets alphanumeric range searching
 mv_range_look        S   Sets the field to do a range check on
 mv_range_max         S   Upper bound of range check
 mv_range_min         S   Lower bound of range check
 mv_resetcolors       C   Causes reset of user color maps
 mv_record_delim      S   Search index record delimiter
 mv_return_all        S   Return all lines found (subject to range search)
 mv_return_delim      S   Return record delimiter
 mv_return_fields     S   Fields to return on a search
 mv_return_file_name  S   Set return of file name for searches
 mv_return_spec       S   Return the MiniVend page specified in search string
 mv_save_session      C   Set to non-zero to prevent expiration of user session
 mv_search_field      S   Sets the fields to be searched
 mv_search_file       S   Sets the file(s) to be searched
 mv_search_match_count S  Returns the number of matches found (read-only)
 mv_search_over_msg   S   Returns string indicating search overflow (read-only)
 mv_search_page       S   Sets the page for search display
 mv_searchspec        S   Search specification
 mv_searchtype        S   Sets search type (text or glimpse)
 mv_separate_items    O   Sets separate order lines (one per item ordered)
 mv_shipmode          O   Sets shipping mode for custom shipping
 mv_sort_command      S   Sets the command to use for sorting searches
 mv_sort_crippled     S   Sets crippled sort mode
 mv_sort_field        S   Field(s) to sort on
 mv_sort_option       S   Options for sort
 mv_spelling_errors   S   Number of spelling errors for Glimpse
 mv_substring_match   S   Turns off word-matching mode
 mv_successpage       O   Page to display on successful order check
 mv_textcolor         C   Sets text color
 mv_todo              A   Common to all forms, sets form action
 mv_todo.map          A   Contains form imagemap
 mv_todo.checkout.x   O   Causes checkout action on click of image
 mv_todo.return.x     O   Causes return action on click of image
 mv_todo.submit.x     O   Causes submit action on click of image
 mv_todo.x            A   Set by form imagemap
 mv_todo.y            A   Set by form imagemap
 mv_vlinkcolor        C   Sets visited link color

</XMP>
<p>
<H2> 
<A NAME="minivend_form_0">
Form Actions</A>
</H2>
Any MiniVend form can be used for any number of actions.  The actions
are mapped by the 
<A HREF="minivend.html#minivend_actionmap_0">ActionMap</A>
 directive in the catalog configuration
file, and are selected on the form with either the <EM>mv_todo</EM> or 
<A HREF="minivend.html#minivend_mv_doit_0">mv_doit</A>

variables.
<p>Mapping of actions in the ActionMap directive means that the 
<A HREF="minivend.html#minivend_value_0">value</A>
 of 
the submit button is scanned to determine the action.  To map the string
``Place Order'' to the action submit, you would put in the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file:
<p>
<XMP>
    ActionMap    submit place order

</XMP>
<p>And on the form you would make a submit button:
<p>
<XMP>
    <INPUT TYPE="submit" NAME="mv_todo" VALUE="Place Order">

</XMP>
<p>When the button is clicked by the user, the 
<A HREF="minivend.html#minivend_submit_0">submit</A>
 action will
be performed.
<p>To set a default action for a form, set the variable 
<A HREF="minivend.html#minivend_mv_doit_0">mv_doit</A>
 as
a hidden variable:
<p>
<XMP>
    <INPUT TYPE="hidden" NAME="mv_doit" VALUE="refresh">

</XMP>
<p>When any other submit button (for a meaningless variable, the MiniVend
demos use <EM>mv_submit</EM>) is pressed, the <EM>mv_todo</EM> value will not be
found, so the 
<A HREF="minivend.html#minivend_refresh_0">refresh</A>
 action defined in 
<A HREF="minivend.html#minivend_mv_doit_0">mv_doit</A>
 will be used.
<p>The defined actions are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_cancel_0">
cancel</A>

</STRONG>
<DD>
All user information (with the exception of the frames and secure
variable settings) is erased, and the shopping cart is emptied. The
user is then mv_nextpage or mv_orderpage.
<p>
<DT><STRONG>

<A NAME="minivend_checkout_0">
checkout</A>

</STRONG>
<DD>
The shopping cart and user variables are updated, and the
user is sent to the page defined in the variable 
<A HREF="minivend.html#minivend_mv_checkout_0">mv_checkout</A>
 or
the CheckoutPage directive.
<p>
<DT><STRONG>

<A NAME="minivend_control_0">
control</A>

</STRONG>
<DD>
The user help, frames, security, and color/background information
is examined and settings changed if appropriate.  The shopping cart
and user variables are also updated.
<p>
<DT><STRONG>

<A NAME="minivend_refresh_0">
refresh</A>

</STRONG>
<DD>
Simply updates the user variables and returns to the page defined
in mv_orderpage.
<p>
<DT><STRONG>

<A NAME="minivend_return_0">
return</A>

</STRONG>
<DD>
Updates the user variables and returns to the page defined
in mv_nextpage, or the user's last non-order/non-search page.
This is difficult to use, for it is hard to predict what that
page will be.  Setting mv_nextpage with the value of a scratch
variable works well.
<p>
<DT><STRONG>

<A NAME="minivend_search_0">
search</A>

</STRONG>
<DD>
The shopping cart and user variables are updated, then the form
variables are interpreted and the search specification contained
therein is dispatched to the search engine -- results are returned
on the defined search page (set by 
<A HREF="minivend.html#minivend_mv_search_page_0">mv_search_page</A>
 or the search
page directives).
<p>
<DT><STRONG>

<A NAME="minivend_submit_0">
submit</A>

</STRONG>
<DD>
Submit the form for order processing. If no order profile is defined
with the <EM>mv_order_profile</EM> variable, the order will be checked to see
if the current cart contains any items and be checked against the fields
defined in the 
<A HREF="minivend.html#minivend_requiredfields_0">RequiredFields</A>
 directive.  Assuming those checks pass,
the order will be submitted.
<p>If there is an order profile defined, the form will be checked against
the definition in the order profile and submitted if the pragma &amp;final
is set to <STRONG>yes</STRONG>.  If &amp;final is set to <STRONG>no</STRONG> (the default), and the check
succeeds, the user will be routed to the MiniVend page defined in mv_successpage,
mv_nextpage, or mv_orderpage. Finally, if the check fails, the user will be
routed to mv_failpage, mv_nextpage, or mv_orderpage in that order.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_one_click_0">
One-click Multiple Variables</A>
</H2>
MiniVend can set multiple variables with a single button or form
control.  You first define the variable set (or profile, as in
search and order profiles) inside a scratch variable:
<p>
<XMP>
  [set Search by Category]
  mv_search_field=category
  mv_search_file=categories
  mv_todo=search
  [/set]

</XMP>
<p>The special variable <EM>mv_click</EM> sets variables just as if they
were put in on the form. It is controlled by a single button,
as in:
<p>
<XMP>
    <INPUT TYPE="submit" NAME="mv_click" VALUE="Search by Category">

</XMP>
<p>When the user clicks the submit button, all three variables will take
on the values defined in the ``Search by Category'' scratch variable. You
can set the scratch variable on the same form as the button is on -- in
fact that is recommended for clarity.
<p>The variable will not be carried from form to form, it must be set
on the form being submitted.
<p>The special variable <EM>mv_check</EM> sets variables for the form actions

<A HREF="minivend.html#minivend_checkout_0">checkout, control, refresh, return, search,</A>
 and 
<A HREF="minivend.html#minivend_submit_0">submit</A>
. 
This setting operates after all of the values are set from the form,
including the ones set by <EM>mv_click</EM>, and can conditionally modify
form variables that have already been set by
<p>The variable sets can contain and be generated by most MiniVend tags --
the profile is interpolated for MiniVend tags before being used. Careful
of interpolation order, and don't use the [post] tag -- it will not work.
Embedded Perl <EM>will</EM> work, and is recommended for most conditional
operations within the profile.
<p>Any setting of variables already containing a value will overwrite
the variable, so to build sets of fields (as in mv_search_field
and mv_return_fields) you must use comma separation or place the
null character with &amp;#0;
<p>
<H2> 
<A NAME="minivend_checks_0">
Checks and Selections</A>
</H2>
You can provide a ``memory'' for drop-down menus, radio buttons, and
checkboxes with the [checked] and [selected] tags.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_checked_0">
[checked var_name value]</A>

</STRONG>
<DD>
This will output CHECKED if the variable <EM>var_name</EM> is equal to

<A HREF="minivend.html#minivend_value_0">value</A>
.  Not case sensitive.
<p>
<DT><STRONG>

<A NAME="minivend_selected_0">
[selected var_name value]</A>

</STRONG>
<DD>
This will output SELECTED if the variable <EM>var_name</EM> is equal to

<A HREF="minivend.html#minivend_value_0">value</A>
.  Not case sensitive.
<p>Here is a drop-down menu that remembers an item-modifier
color selection:
<p>
<XMP>
    <SELECT NAME="color">
    <OPTION [selected color blue]> Blue
    <OPTION [selected color green]> Green
    <OPTION [selected color red]> Red
    </SELECT>

</XMP>
<p>Here is the same thing, but for a shopping-basket color
selection
<p>
<XMP>
    <SELECT NAME="[modifier-name color]">
    <OPTION [selected [modifier-name color] blue]> Blue
    <OPTION [selected [modifier-name color] green]> Green
    <OPTION [selected [modifier-name color] red]> Red
    </SELECT>

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_setting_2">
Setting Form Security</A>
</H2>
You can ensure that a form will be submitted securely (to the base
URL in the SecureURL directive, that is) by specifying your form
input to be ACTION=``[process-target frame secure]''. If you are not
using frames, just specify the special frame ``_self''.
<p>To submit a form to the regular non-secure server, just omit the
<EM>secure</EM> modifier.
<p>
<H2> 
<A NAME="minivend_stacking_0">
Stacking Variables on the Form</A>
</H2>
Many MiniVend variables can be ``stacked'', meaning they can have
multiple values for the same variable name. As an example -- to allow
the user to order multiple items with one click, you can set up
a form like this:
<p>
<XMP>
 <FORM METHOD=POST ACTION="[process-order]">
 <input type=checkbox name="mv_order_item" value="M3243"> Item M3243
 <input type=checkbox name="mv_order_item" value="M3243"> Item M3244
 <input type=checkbox name="mv_order_item" value="M3243"> Item M3245
 <input type=hidden name="mv_doit" value="refresh">
 <input type=submit name="mv_junk" value="Order Checked Items">
 </FORM>

</XMP>
<p>The stackable <EM>mv_order_item</EM> variable with be decoded with multiple
values, causing the order of any items that are checked.
<p>To place a ``delete'' checkbox on your shopping basket display:
<p>
<XMP>
 <FORM METHOD=POST ACTION="[process-order]">
 [item-list]
   <input type=checkbox name="[quantity-name]" value="0"> Delete
   Part number: [item-code]
   Quantity: <input type=text name="[quantity-name]" value="[item-quantity]">
   Description: [item-description]
 [/item-list]
 <input type=hidden name="mv_doit" value="refresh">
 <input type=submit name="mv_junk" value="Order Checked Items">
 </FORM>

</XMP>
<p>In this case, <STRONG>first</STRONG> instance of the variable name set by [quantity-name]
will be used as the order quantity, deleting the item from the form.
<p>Of course, not all variables are stackable. Check the documentation for
which ones can be stacked -- or experiment on your own.
<p>
<H2> 
<A NAME="minivend_setting_3">
Setting mSQL tables with a form</A>
</H2>
You may insert or update records in any mSQL database with the [msql set]
tag, but if you wish to do form-based updates or inserts you can create
a special form to do so. Four special MiniVend variables are used to
select the database parameters:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_data_table_0">
mv_data_table</A>

</STRONG>
<DD>
The table to update. If using mSQL for the products database, the
table is <STRONG>product</STRONG>.
<p>
<DT><STRONG>

<A NAME="minivend_mv_data_key_0">
mv_data_key</A>

</STRONG>
<DD>
The field that is the primary key in the table. Must match the existing
database definition.
<p>
<DT><STRONG>

<A NAME="minivend_mv_data_function_0">
mv_data_function</A>

</STRONG>
<DD>
UPDATE or INSERT.
<p>
<DT><STRONG>

<A NAME="minivend_mv_data_fields_0">
mv_data_fields</A>

</STRONG>
<DD>
Fields from the form which should be inserted or updated. Must be existing
columns in the table in question.
<p>
</DL>
A special submit button calling the action <STRONG>set</STRONG> (see 
<A HREF="minivend.html#minivend_actionmap_0">ActionMap</A>
),.causes the update.  Here is an pair of example forms.  One is used
to set the key to access the record (careful with the name, this one
goes into the user session values). The second actually performs the
update. It uses the [loop] tag to place default/existing values in the
form based on the input from the first form:
<p>
<XMP>
    <FORM METHOD=POST ACTION="[process-target _self]">
    <INPUT TYPE=HIDDEN name="mv_doit" value="refresh">
    <INPUT TYPE=HIDDEN name="mv_orderpage" value="update_proj">
    Sales Order Number <INPUT TYPE=TEXT SIZE=8
                            NAME="update_code"
                            VALUE="[value update_code]">
    <INPUT TYPE=SUBMIT name="mv_submit"  Value="Select">
    </FORM>
    <FORM METHOD=POST ACTION="[process-target _self]">
    <INPUT TYPE=HIDDEN NAME="mv_data_table" VALUE="product">
    <INPUT TYPE=HIDDEN NAME="mv_data_key" VALUE="code">
    <INPUT TYPE=HIDDEN NAME="mv_data_function" VALUE="update">
    <INPUT TYPE=HIDDEN name="mv_nextpage" value="updated">
    <INPUT TYPE=HIDDEN NAME="mv_data_fields"
                VALUE="code,custid,description,rate">
    <PRE>
    [loop [value update_code]]
    Sales Order <INPUT TYPE=TEXT name="code" SIZE=5 VALUE="[loop-code]">
   Customer No. <INPUT TYPE=TEXT name="custid" SIZE=30
                    VALUE="[loop-field customer]">
    Description <INPUT TYPE=TEXT name="description" 
                    SIZE=30 VALUE="[loop-field description]">
           Rate <INPUT TYPE=TEXT name="rate"
                    SIZE=5 VALUE="[loop-field rate]">
    [/loop]
    </PRE>
        <INPUT TYPE=SUBMIT name="mv_todo"  Value="Set">
    </FORM>

</XMP>
<p>The variables in the form do <STRONG>not</STRONG> update the user's session values,
so they can correspond to database field names without fear of corrupting
the user session.
<p><p><hr>

<H1> 
<A NAME="minivend_the_4">
THE SEARCH ENGINE</A>
</H1>
MiniVend implements a search engine which will search the product
database (or any other file) for items based on customer input.  It uses
either forms or URL-based searches (called with the special page name
<EM>scan</EM>).
<p>Examples of search forms are in query.html, results.html, helpquery.html,
mvfaq.html, and browse.html files in the &lt;EM>simple/pages&lt;/EM> directory,
and in the <STRONG>sample/pages/srch/</STRONG> directory. The search engine uses many
special MiniVend tags and variables.
<p>Two search engine interfaces are provided, and four types of searching
are available.  The default is a text-based search of the

<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file.  A binary search of a dictionary-ordered file can
be specified.  An optional Glimpse search is enabled by placing
the command specification for Glimpse in the directive 
<A HREF="minivend.html#minivend_glimpse_1"><EM>Glimpse</EM></A>
.
The last is a range-based search, used in combination with
one of the above.
<p>The default, a text based search, simply sequentially scans the lines in
the target file.  By default it returns the first field (delineated by
the standard 
<A HREF="minivend.html#minivend_delimiter_0"><EM>Delimiter</EM></A>
), for every line matching the search
specification.
<p>
<H2> 
<A NAME="minivend_the_5">
The Search Form</A>
</H2>
A number of variables can be set on search forms to determine which search
will be used, what fields in the database it will search, and what search
behavior will be.
<p>Here is a simple search form:
<p>
<XMP>
  <FORM ACTION="[process-search]" METHOD=POST>
  <INPUT TYPE="text" SIZE="30" NAME="mv_searchspec">
  <INPUT TYPE="submit" NAME="mv_todo" VALUE="Search">
  </FORM>

</XMP>
<p>When the ``Search'' submit button is pressed (or &lt;ENTER&gt; is pressed)
MiniVend will search the 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file for the string entered
into the text field 
<A HREF="minivend.html#minivend_mv_searchspec_0">mv_searchspec</A>
, and return the product
code pertaining to that line.
<p>The same search for a fixed string, say ``shirt'', could be performed with
the use of a hot link, using the special <EM>scan</EM> URL:
<p>
<XMP>
  [page scan/se=shirt]See our shirt collection![/page]

</XMP>
<p>The default is to search every field on the line.
If you only wished to match on the string shirt in the product
database field ``description'', you could modify the search:
<p>
<XMP>
  <INPUT TYPE="hidden" NAME="mv_search_field" VALUE="description">

</XMP>
<p>If you want to let the user decide on the search parameters, you can
use checkboxes or radiobox fields to set the fields:
<p>
<XMP>
    Search by author
       <INPUT TYPE="checkbox" NAME="mv_search_field" VALUE="author">
    Search by title
        <INPUT TYPE="checkbox" NAME="mv_search_field" VALUE="title">

</XMP>
<p>Fields can be stacked -- if more than one is checked, all checked fields
will be searched. (This doesn't work for Glimpse in the return_file_name
mode, though).
<p>
<H2> 
<A NAME="minivend_glimpse_0">
Glimpse</A>
</H2>
<STRONG>To use the Glimpse search</STRONG>, you must build the Glimpse index based on
files in your 
<A HREF="minivend.html#minivend_productdir_0"><EM>ProductDir</EM></A>
, or wherever the files to be searched will
be located. If you installed MiniVend in the default
<EM>/usr/local/lib/minivend</EM>, the command line to build the index for the
products file would be:
<p>
<XMP>
    glimpseindex -b -H /usr/local/lib/minivend/products products.asc

</XMP>
<p>There are several ways to improve search speed for large catalogs.
<p>One method that works well for large 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 files is to split
the 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file into small index files (in the example, 100
lines) with the split(1) UNIX command, then index it with glimpse:
<p>
<XMP>
    split -100 products.asc index.asc.
    glimpseindex -H /usr/local/lib/minivend/products index.asc.*

</XMP>
<p>This will dramatically increase search speeds for large catalogs, at
least if the search term is relatively unique. If it is a common string,
as you might have in a category search, you will be better off to use
the text-based search.
<p>(A large catalog is one of more than a thousand items -- smaller
ones have acceptable speed in any of the search modes.)
<p>If the Glimpse executable is not found at MiniVend startup, the Glimpse
search will be disabled and the regular text-based search used instead.
<p>There are several things you have to watch for while using <STRONG>glimpse</STRONG>,
and a liberal dose of the Glimpse documentation is suggested. In particular,
the spelling error capability will not work in combination with the
field-specific search -- Glimpse selects the line, but MiniVend's
text-based search routines disqualify it when checking to see if the
search string is within one of the specified fields.
<p>
<H2> 
<A NAME="minivend_fast_0">
Fast Binary Search</A>
</H2>
<STRONG>Fast binary searching</STRONG> is useful for scanning large databases for
strings that match the beginning of a line.  They use the standard
Perl module Search::Dict, and are enabled through use of the 
<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
,

<A HREF="minivend.html#minivend_mv_dict_end_0">mv_dict_end</A>
, 
<A HREF="minivend.html#minivend_mv_dict_limit_0">mv_dict_limit</A>
, 
<A HREF="minivend.html#minivend_mv_dict_fold_0">mv_dict_fold</A>
, and 
<A HREF="minivend.html#minivend_mv_dict_order_0">mv_dict_order</A>

variables.
<p>The search must be done on a <STRONG>dictionary-ordered</STRONG> pre-built index, 
production of which is left as an exercise for the user.
<p>See the documentation for Vend::Search for more information. (From the
MiniVend root directory, you can see it by using ``perldoc Vend::Search''.)
<p>
<H2> 
<A NAME="minivend_range_0">
Range Searching</A>
</H2>
Range searching allows you to qualify your search returns with a field
that must be within a certain numeric or alphanumeric range.  To use it,
set the mv_range_look variable to the products database field, or a
column/field number for another file.  Then set the corresponding

<A HREF="minivend.html#minivend_mv_range_min_0">mv_range_min</A>
 and 
<A HREF="minivend.html#minivend_mv_range_max_0">mv_range_max</A>
 variables with a selectable field.
<p>
<XMP>
    <INPUT TYPE="hidden" NAME="mv_range_look" VALUE="price">
        Search on Price
    Min <SELECT NAME="mv_range_min">
             <OPTION value=0 SELECTED> Free
             <OPTION value=1000000> $1,000,000
             <OPTION value=10000000> $10,000,000
             <OPTION value=20000000> $20,000,000
             <OPTION value=40000000> $40,000,000
        </SELECT><BR>
    Max <SELECT NAME="mv_range_max">
            <OPTION value=0 SELECTED> no object
            <OPTION value=1000000> $1,000,000
            <OPTION value=10000000> $10,000,000
            <OPTION value=20000000> $20,000,000
            <OPTION value=40000000> $40,000,000
        </SELECT>

</XMP>
<p>The value of 0 for mv_range_max is equivalent to infinity if doing a
numeric search. (This makes it impossible to search for a ceiling of 0
with a negative mv_range_min, just in case you were planning on trying
that.)
<p>The fields are stackable, so you can set more than one range to
check.  The order is significant, in the sense that the array
of field names and minimum/maximum values must be kept in order
to achieve correspondence.
<p>The optional 
<A HREF="minivend.html#minivend_mv_range_alpha_0">mv_range_alpha</A>
 specification allows alphanumeric range
matching for the corresponding field -- if it is set, and you have
stacked the fields, they must all be set.  The 
<A HREF="minivend.html#minivend_mv_case_0">mv_case</A>
 field does
apply if it is set -- otherwise the comparison is without regard to
case.
<p>If you wish to do ONLY a range search, you must select all lines
with <EM>mv_return_all</EM>=yes in order to make the search operate. Range-only
searches will be quite slow for large databases, since every line
must be scanned.  It should be quite usable for catalogs of less than
100,000 items in size, given a fast machine.  Using it in combination
with another search technique (in the same query) will yield faster search
returns.
<p>
<H2> 
<A NAME="minivend_one_click_1">
One-click searches</A>
</H2>
MiniVend allows you to pass a search in a URL.  Just specify the
search with the special page reference <EM>scan</EM>.  Here is an
example:
<p>
<XMP>
     [page scan/se=Impressionists/sf=category]
        Impressionist Paintings
     [/page]

</XMP>
<p>Here is the same thing from a home page (assuming /cgi-bin/vlink is
the CGI path for MiniVend's vlink):
<p>
<XMP>
     <A HREF="/cgi-bin/vlink/scan/se=Impressionists/sf=category">
        Impressionist Paintings
     </A>

</XMP>
<p>The two-letter abbreviations are mapped with these letters:
<p>
<XMP>
 ac  mv_all_chars          mp  mv_profile                   
 bd  mv_base_directory     ms  mv_min_string       
 co  mv_coordinate         os  mv_orsearch
 cs  mv_case               ra  mv_return_all
 de  mv_dict_end           rd  mv_return_delim
 df  mv_dict_fold          rf  mv_return_fields
 di  mv_dict_limit         rg  mv_range_alpha
 dl  mv_dict_look          rl  mv_range_look
 do  mv_dict_order         rm  mv_range_min
 dr  mv_record_delim       rn  mv_return_file_name
 em  mv_exact_match        rs  mv_return_spec
 er  mv_spelling_errors    rx  mv_range_max
 fi  mv_search_file        se  mv_searchspec
 hs  mv_head_skip          sf  mv_search_field
 id  mv_index_delim        sp  mv_search_page
 ml  mv_matchlimit         st  mv_searchtype
 mm  mv_max_matches        su  mv_substring_match

</XMP>
<p>They can be treated just the same as form variables on the
page, except that they can't contain spaces, '/' in a file
name, or quote marks.  These characters can be used, but only
in URL decimal encoding, i.e. &amp;#32; is a space, &amp;#47 is a
<CODE>/</CODE>, etc. -- <CODE>&amp;sp;</CODE> will not be recognized.
<p>So if you wish to do an OR search on the fields category and artist
for the strings ``Surreal'' and ``Gogh'', while matching substrings,
you would do:
<p>
<XMP>
 [page scan/se=Surreal/se=Gogh/os=yes/su=yes/sf=artist/sf=category]
    Van Gogh -- compare to surrealists
 [/page]

</XMP>
<p>
<H2> 
<A NAME="minivend_search_1">
Search Profiles</A>
</H2>
You can predefine an unlimited number of search profiles that reside
in a file or files.  To use this, make up a series of lines like:
<p>
<XMP>
 mv_searchfield=artist
 mv_searchfield=category
 mv_orsearch=yes

</XMP>
<p>and place them in a file.  Define the file name in the 
<A HREF="minivend.html#minivend_searchprofile_0">SearchProfile</A>

directive. Re-start the server.  The profiles are numbered in the 
order found (not by file name), starting at 0,  and are available by
setting the variable mv_profile to the number of the profile.
The profile may be named by placing a name following a __NAME__
pragma:
<p>
<XMP>
  __NAME__ title_search

</XMP>
<p>The __NAME__ must begin the line, and be followed by whitespace
and then the name.  The search profile can then be accessed by

<A HREF="minivend.html#minivend_mv_profile_0">mv_profile=``title_search''</A>
.
<p>The special variable <EM>mv_last</EM> stops interpretation of search
variables.  The following variables are always interpreted:
<p>
<XMP>
    mv_dict_look
    mv_searchspec
    mv_range_look
    mv_range_min
    mv_range_max

</XMP>
<p>Other than that, if you set mv_last in a search profile, and there
are other variables on the search form, they will not be interpreted.
<p>The search profiles are also available, and especially useful, for
one-click searches.  They are available by setting scan/mp=n/se=text,
where n is the number of the profile.
<p>If you want to place multiple search profiles in the same file,
separate them with __END__, which must be on a line by itself.
Be careful, then they are interpreted in the order found, with 
the second file name not necessarily being the second profile (which
would be numbered 1).
<p>
<H2> 
<A NAME="minivend_search_2">
Search Reference</A>
</H2>
The sample <EM>srch/query.html</EM>, <EM>srch/helpquery.html</EM> and
<EM>srch/category.html</EM> pages show example search forms.  You can modify
them to present the search in any way you like -- just be careful to use
the proper variable names for passing to MiniVend.  It is also necessary
that you copy the hidden variables as-is -- they are required to
interpret the request as a search.  The special form variables are:
<p>The following definitions frequently refer to <EM>field name</EM> and <EM>column</EM>
and <EM>column number</EM> -- all are the references to the columns of a searched
text file as separated by delimiter characters.
<p>The field names can be specified in several ways.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_products_asc_0">
products.asc</A>

</STRONG>
<DD>
If the file to be searched is left empty in the search form or definition
(set with 
<A HREF="minivend.html#minivend_mv_search_file_0">mv_search_file</A>
), then the 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file will be
searched, and field names are already available as named in the first
line of 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_other_0">
other database files</A>

</STRONG>
<DD>
If the file or files to be searched are ASCII delimited files, and
have field names specified on the first line of the file, MiniVend
will read the first line (of the first file) and determine the field
names.
<p>
<DT><STRONG>

<A NAME="minivend_other_1">
other files</A>

</STRONG>
<DD>
If the file or files to be searched are ASCII delimited files, but
<STRONG>don't</STRONG> have field names specified on the first line of the file,
you can set the variable 
<A HREF="minivend.html#minivend_mv_field_names_0">mv_field_names</A>
 to a comma-separated list
of field names as they will be referenced.
<p>
</DL>
Fields can also always be specified by an integer column number, with 0.as the first column. This may reduce system processing somewhat, since
the field names don't have to be indexed every time they are referenced,
and won't have to be read from disk.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_all_chars_0">
mv_all_chars</A>

</STRONG>
<DD>
Set this if you anticipate searching for lots of punctuation characters
that might be special characters for Perl -- the characters ()[]\$^ are
included.
<p>
<DT><STRONG>

<A NAME="minivend_mv_base_directory_0">
mv_base_directory</A>

</STRONG>
<DD>
In the text search, set to the directory from which to base file
searches.  File names without leading / characters will be based from
there.  In the Glimpse search, passed to Glimpse with the <CODE>-H</CODE> option,
and Glimpse will look for its indices there. Default is ProductDir.
<p>
<DT><STRONG>

<A NAME="minivend_mv_case_0">
mv_case</A>

</STRONG>
<DD>
If this item is set to <EM>yes</EM>, the search will return items without regard
to upper or lower case.  This is the default -- set to <EM>yes</EM> if case
should be matched.  Implement with a checkbox &lt;INPUT TYPE=CHECKBOX&gt; field.
<p>
<DT><STRONG>

<A NAME="minivend_mv_coordinate_0">
mv_coordinate</A>

</STRONG>
<DD>
If this item is set to <EM>yes</EM>, and the number of search fields equals
the number of search specs, the search will return only items that
match field to spec. (The search specifications are set by stacked

<A HREF="minivend.html#minivend_mv_searchspec_0">mv_searchspec</A>
 and 
<A HREF="minivend.html#minivend_mv_search_field_0">mv_search_field</A>
 variables.)
<p>
<DT><STRONG>

<A NAME="minivend_mv_dict_end_0">
mv_dict_end</A>

</STRONG>
<DD>
If the string at the beginning of a line lexically exceeds this value,
matching will stop. Ignored without mv_dict_look.
<p>
<DT><STRONG>

<A NAME="minivend_mv_dict_fold_0">
mv_dict_fold</A>

</STRONG>
<DD>
Make dictionary matching case-insensitive. Ignored without mv_dict_look.
NOTE: This is the reverse sense from mv_case.
<p>
<DT><STRONG>

<A NAME="minivend_mv_dict_limit_0">
mv_dict_limit</A>

</STRONG>
<DD>
Automatically set the limiting string (mv_dict_end) to be one character
greater than the mv_dict_look variable, at the character position
specified.  A value of 1, for instance, will set the limiting string
to ``fprsythe'' if the value of 
<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
 is ``forsythe''.  A useful
value is -1, which will increment the last character (setting the 
mv_dict_end to ``forsythf'' in our example).  This prevents having
to scan the whole file once a unique match is found.
<p>The order of this and the 
<A HREF="minivend.html#minivend_mv_dict_end_0">mv_dict_end</A>
 variable is significant -- each
will overwrite the other.
<p>
<DT><STRONG>

<A NAME="minivend_mv_dict_look_0">
mv_dict_look</A>

</STRONG>
<DD>
The string at which to begin matching at in a dictionary-based search. If
not set, the mv_dict_end, mv_dict_fold, and mv_dict_case variables will
be ignored.  May be set in a search profile based on other form variables.
<p>
<DT><STRONG>

<A NAME="minivend_mv_dict_order_0">
mv_dict_order</A>

</STRONG>
<DD>
Make dictionary matching follow dictionary order, where only word characters
and whitespace matter. Ignored without mv_dict_look.
<p>
<DT><STRONG>

<A NAME="minivend_mv_doit_0">
mv_doit</A>

</STRONG>
<DD>
This must be set to 'search' to make this a search page.
<p>
<DT><STRONG>

<A NAME="minivend_mv_exact_match_0">
mv_exact_match</A>

</STRONG>
<DD>
Normally MiniVend searches match words, as opposed to sentences.
This behavior can be overridden with mv_exact_match, which when
set will place quotes around any value in mv_searchspec or mv_dict_look.
<p>
<DT><STRONG>

<A NAME="minivend_mv_field_names_0">
mv_field_names</A>

</STRONG>
<DD>
Defines the field names for the file being searched. This guarantees
that they will be available, and prevents a disk access if using named
fields on a search file (that is not the product database ASCII source,
where field names are already known).  This <STRONG>must</STRONG> be exactly correct,
or it will result in anomalous search operation.  Usually passed in a
hidden field or search profile as a comma-separated list.
<p>NOTE: You should use this on the product database only if you
plan on both pre-sorting with 
<A HREF="minivend.html#minivend_mv_sort_field_0">mv_sort_field</A>
 and then post-sorting
with [sort]field:opt[/sort].
<p>
<DT><STRONG>

<A NAME="minivend_mv_head_skip_0">
mv_head_skip</A>

</STRONG>
<DD>
Normally MiniVend searches all lines of an index/product file but the
first.  Set this to the number of lines to skip at the beginning of the
index.  Default is 1 for the text search, which skips the header line
in the product file. Default is 0 for a Glimpse search.
<p>
<DT><STRONG>

<A NAME="minivend_mv_index_delim_0">
mv_index_delim</A>

</STRONG>
<DD>
Sets the delimiter for counting fields in a search index.  The default
is the same as the 
<A HREF="minivend.html#minivend_delimiter_0">Delimiter</A>
 directive.
<p>
<DT><STRONG>

<A NAME="minivend_mv_matchlimit_0">
mv_matchlimit</A>

</STRONG>
<DD>
The page size for matches that are returned.  If more matches than

<A HREF="minivend.html#minivend_mv_matchlimit_0">mv_matchlimit</A>
 are found, the search paging mechanism will be
employed if the proper 
<A HREF="minivend.html#minivend_more_list_0">[more_list]</A>
 is present.  Can be
implemented as a scrolling list (INPUT TYPE=SELECT) or radiobox 
(INPUT TYPE=RADIO) field.
<p>
<DT><STRONG>

<A NAME="minivend_mv_max_matches_0">
mv_max_matches</A>

</STRONG>
<DD>
The maximum number of records that will be returned in a search.
Default is 2000.
<p>
<DT><STRONG>

<A NAME="minivend_mv_min_string_0">
mv_min_string</A>

</STRONG>
<DD>
Sets the minimum size of a search string for a search operation.
Default is 4 for the Glimpse search, and 1 for the text search.
<p>
<DT><STRONG>

<A NAME="minivend_mv_orsearch_0">
mv_orsearch</A>

</STRONG>
<DD>
If this item is set to <EM>yes</EM>, the search will return items matching any
of the words in <EM>searchspec</EM>. The default is <EM>no</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_mv_profile_0">
mv_profile</A>

</STRONG>
<DD>
Selects one of the pre-defined search specifications set by the

<A HREF="minivend.html#minivend_searchprofile_0"><EM>SearchProfile</EM></A>
 directive.  If the special variable within that file,
<EM>mv_last</EM>, is defined, it will prevent the scanning of the form input
for further search modifications.  The values of 
<A HREF="minivend.html#minivend_mv_searchspec_0">mv_searchspec</A>
 and

<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
 are always scanned, so you can specify this to do the
equivalent of setting multiple checkboxes or radioboxes with one click,
while still reading the search input text.
<p>
<DT><STRONG>

<A NAME="minivend_mv_range_alpha_0">
mv_range_alpha</A>

</STRONG>
<DD>
Sets the type of match, numeric or alphanumeric,  for the range search
in its corresponding range field.  The search will return true (assuming
it is greater than the mv_range_min specification) if the field searched
is less than or equal to mv_range_max, in an alphanumeric sense.
<p>
<DT><STRONG>

<A NAME="minivend_mv_range_look_0">
mv_range_look</A>

</STRONG>
<DD>
This sets a field to scan for a range of numbers.  It must be
accompanied with corresponding mv_range_min and mv_range_max variables.
It can be specified with either a field name or a column number.
<p>
<DT><STRONG>

<A NAME="minivend_mv_range_max_0">
mv_range_max</A>

</STRONG>
<DD>
Sets the high bound for the range search in its corresponding 
range field.  The search will return true (assuming it is greater than
the mv_range_min specification) if the field searched is less than or
equal to mv_range_max. To set the bound at infinity, or whatever your
integer limit is, set mv_range_min to 0.
<p>
<DT><STRONG>

<A NAME="minivend_mv_range_min_0">
mv_range_min</A>

</STRONG>
<DD>
Sets the low bound for the range search in its corresponding 
range field.  The search will return true (assuming it is less than
the mv_range_max specification) if the field searched is less than or
equal to mv_range_min.
<p>
<DT><STRONG>

<A NAME="minivend_mv_record_delim_0">
mv_record_delim</A>

</STRONG>
<DD>
Sets the delimiter for counting records in a search index.  The default
is newline, which works for the products and most line-based index files.
<p>
<DT><STRONG>

<A NAME="minivend_mv_return_fields_0">
mv_return_fields</A>

</STRONG>
<DD>
The fields that should be returned by the match, specified either by
field name or by column number.  You should almost always specify
0 as the first field to be returned if searching the products database,
since that is the key for accessing database fields.
<p>
<DT><STRONG>

<A NAME="minivend_mv_search_field_0">
mv_search_field</A>

</STRONG>
<DD>
The field(s) to be searched, specified either by column name
or by column number.
<p>If the number of instances matches the number of fields specified in the
mv_searchspec variable, and mv_coordinate is set to true, each search
field (in order specified on the form) will be matched with each search
spec (again in that order).
<p>
<DT><STRONG>

<A NAME="minivend_mv_search_file_0">
mv_search_file</A>

</STRONG>
<DD>
In the text search, set this variable to the file(s) to be scanned
for a match.  The default, if not set, is to scan the products.asc
file. If set multiple times in a form (for a text search), will cause a
search all the files. One file name per instance.
<p>In the Glimpse search, follows the Glimpse wildcard-based file name
matching scheme.  Use with caution and a liberal dose of the Glimpse
man page.
<p>
<DT><STRONG>

<A NAME="minivend_mv_search_match_count_0">
mv_search_match_count</A>

</STRONG>
<DD>
Set by the search to indicate the total number of matches found.
<p>
<DT><STRONG>

<A NAME="minivend_mv_search_over_msg_0">
mv_search_over_msg</A>

</STRONG>
<DD>
The message that should be displayed if there is an overflow
condition (max_matches is exceeded). Overrides the SearchOverMsg
directive -- it is cleared by MiniVend if there is no overflow.
Somewhat deprecated by match paging.
<p>
<DT><STRONG>

<A NAME="minivend_mv_search_page_0">
mv_search_page</A>

</STRONG>
<DD>
The MiniVend-style name of the page that should display the search
results.  Overrides the FrameSearchPage directive, and the default
value of 'search'.
<p>
<DT><STRONG>

<A NAME="minivend_mv_searchspec_0">
mv_searchspec</A>

</STRONG>
<DD>
The actual search string that is typed in by the customer. It is 
a text INPUT TYPE=TEXT field, or can be put in a select (drop-down)
list to enable category searches. If multiple instances are found,
they will be concatenated just as if multiple words had been 
placed in a text field.
<p>The user can place quotes around words to specify that they match
as a string. To enable this by default, use the 
<A HREF="minivend.html#minivend_mv_exact_match_0">mv_exact_match</A>

variable.
<p>If 
<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
 has a value, and mv_searchspec does <STRONG>not</STRONG>, then
mv_searchspec will be set to the value of mv_dict_look.
<p>If the number of instances matches the number of fields specified in the
mv_search_field variable, and mv_coordinate is set to true, each search
field (in order specified on the form) will be matched with each search
spec (again in that order).
<p>
<DT><STRONG>

<A NAME="minivend_mv_searchtype_0">
mv_searchtype</A>

</STRONG>
<DD>
If set to <EM>glimpse</EM>, selects the Glimpse search (if Glimpse is defined).
If set to <EM>text</EM>, selects the text-based search. Defaults to <EM>text</EM> if

<A HREF="minivend.html#minivend_glimpse_1"><EM>Glimpse</EM></A>
 is not defined, to Glimpse if it is. This can allow use of
both search types if that is desirable -- for instance, searching for
very common strings is better done by the text-based search. An example
might be searching for categories of items instead of individual items.
<p>
<DT><STRONG>

<A NAME="minivend_mv_sort_command_0">
mv_sort_command</A>

</STRONG>
<DD>
Set to a path name that will access the standard UNIX sort command --
the default is of course <EM>sort</EM>.  If the sort command does not
accept field-specific options, as more recent sorts like the GNU
sort command do, set mv_sort_crippled to <EM>yes</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_mv_sort_field_0">
mv_sort_field</A>

</STRONG>
<DD>
The file field(s) the search is to be sorted on, specified in one of two
ways. If the file(s) to be searched have a header line (the first line)
that contains 
<A HREF="minivend.html#minivend_delimiter_0">Delimiter</A>
-separated field names, it can be specified
by field name.  If can also be specified by column number (the code or key
is specified with a value of 0, for both types).  These can be stacked,
if coming from a form, or placed in a single specification separated
by commas.
<p>NOTE FOR ADVANCED USERS: If specifying a sort for the product database,

<A HREF="minivend.html#minivend_mv_field_names_0">mv_field_names</A>
 must be specified if you will be doing a fieldname-addressed
post-sort.
<p>
<DT><STRONG>

<A NAME="minivend_mv_sort_option_0">
mv_sort_option</A>

</STRONG>
<DD>
The way that each field should be sorted. The flags are 'r', 'n', 
and 'f' -- for reverse, numeric, and case-insensitive respectively.
These can be stacked, if coming from a form, or placed in a single
specification separated by commas.  The stacked options will be 
applied to the sort fields as they are defined, presuming those
are stacked.
<p>
<DT><STRONG>

<A NAME="minivend_mv_spelling_errors_0">
mv_spelling_errors</A>

</STRONG>
<DD>
The number of spelling errors that will be tolerated. Ignored unless
using Glimpse. If you have a large catalog, you might wish to limit this
to two.
<p>
<DT><STRONG>

<A NAME="minivend_mv_substring_match_0">
mv_substring_match</A>

</STRONG>
<DD>
If mv_substring_match is  set to <EM>yes</EM>, matches on substrings as well
as whole words. You would typically want to set this for dictionary-based
searches.
<p>
</DL>
The sample search page also has a link to a help file <EM>(pages/help.html)</EM>.which has rudimentary end-user help for the search engine.
<p>
<H2> 
<A NAME="minivend_the_6">
The Results Page</A>
</H2>
Once a search has been done, there needs to be a way of presenting
the output.  By default, the special page search.html is used -- but
any number of search pages can be specified by passing the value in
the search form, specified in the variable 
<A HREF="minivend.html#minivend_mv_search_page_0">mv_search_page</A>
.
<p>On the search page, some special MiniVend tags are used to format
the otherwise standard HTML.  Each of the iterative tags is
applied to every code returned from the search -- this is normally
the product code, but could be a key to any of the arbitrary
databases. The value placed by the [item-code] tag is set to whatever
the first field (separated by whitespace) is, at least when the 
default of <STRONG>yes</STRONG> is in the UseCode directive. 
<p>NOTE: The special item tags (item_price, item_data, item_accessory,
etc.) still refer to fields in the product database. To access arbitrary
databases, you will need to use the idiom [data database field [item_code]].
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_search_list_0">
[search_list]</A>

</STRONG>
<DD>
Starts the representation of a search list. MiniVend tags can be
embedded in the search list, yielding a table or formatted
list of items with part number, description, price, and  hyperlinks to
order or go to its catalog page. 
<p>In particular, all of the item tags described under order page
are active.  The most useful one might be [item_link], which if
properly used, can allow the user to search the catalog for
an item, then click a link to go to detailed catalog page
for the item. See the sample results.html page for an example.
<p>In fact, any of the MiniVend database access tags can be used,
allowing you to pull data from any of the fields in any of
your predefined databases.  Along with the MiniVend conditional
tags, very complex pages can be built for each individual item
returned in the search.
<p>
<DT><STRONG>

<A NAME="minivend_search_list_1">
[/search_list]</A>

</STRONG>
<DD>
Ends the search list.  
<p>
<DT><STRONG>

<A NAME="minivend_sort_0">
[sort frn]</A>

</STRONG>
<DD>
Placed inside the search list. Causes sorting of the search return,
starting from the first position on the line.  The fields that are there
to sort are set by 
<A HREF="minivend.html#minivend_mv_return_fields_0">mv_return_fields</A>
. Accepts none, any, or combinations
of the flags:
<p>
<XMP>
  f   case-insensitive sort (folded) (mutually exclusive of n)
  n   numeric order (mutually exclusive of f)
  r   reverse sort

</XMP>
<p>
<DT><STRONG>
<EM>[sort]&lt;options&gt;[/sort]</EM>
</STRONG>
<DD>
Placed inside the search list. Causes sorting of the search return
based on the passed options. The fields that are there
to sort are set by 
<A HREF="minivend.html#minivend_mv_return_fields_0">mv_return_fields</A>
.
<p>The field options passed in either numeric or field name form.  If
they are field numbers, they are numbered as sent to the search list
in the order specified by 
<A HREF="minivend.html#minivend_mv_return_fields_0">mv_return_fields</A>
,
starting from 0 and proceeding upwards.  If column names, they are
as found in the first record of the searched file (by default the
ASCII source for the product database), <EM>except for the key or first field</EM>.
followed by a 
<A HREF="minivend.html#minivend_required_1">required</A>
 colon (:) and the options, if any.
<p>Accepts none, any, or combinations of the flags:
<p>
<XMP>
  f   case-insensitive sort (folded) (mutually exclusive of n)
  n   numeric order (mutually exclusive of f)
  r   reverse sort

</XMP>
<p>The &lt;options&gt; are a field number and an optional flag or flags, in a
similar fashion to the Unix sort command, and are interpolated for form
values before being used.  As an example, if you set up the following
fields on your search form:
<p>
<XMP>
  <INPUT TYPE="hidden" NAME="mv_return_fields" VALUE="0,title,artist,price">
  <INPUT TYPE="radio" NAME="the_sort_field" VALUE="title"> Sort by Title
  <INPUT TYPE="radio" NAME="the_sort_field" VALUE="artist"> Sort by Artist
  <INPUT TYPE="radio" NAME="the_sort_option" VALUE=""> Forward sort
  <INPUT TYPE="radio" NAME="the_sort_option" VALUE="r"> Reverse sort
  
  NOTE: The 0 refers to the database code/key used for [item-code]

</XMP>
<p>This would combine with the following search result page fragment
to sort by either title or artist.
<p>[search-list]
  [sort]
    [value the_sort_field]:[value the_sort_option]
  [/sort]
<B&gt;[item-field title]&lt;/B&gt;, by [item-field artist]&lt;BR&gt;
[/search-list]
   
The [value...] lines will end up looking like 'artist:r' or 'title:'.  This
could also be specified with <EM>2r</EM> or &lt;1&gt;.
<p>PERFORMANCE TIP: on heavily trafficed systems, it will pay to use only
column numbers rather than named fields, as it reduces processing and may
obviate an access to the searched file to find the field names.
<p>
<DT><STRONG>

<A NAME="minivend_uniq_0">
[uniq]</A>

</STRONG>
<DD>
Placed <EM>immediately</EM> after the [search_list] tag. If specified on a
sorted return list, causes only the first line containing an [item-code]
to be returned -- all subsequent lines will not be interpreted on the
list. Note that [matches] and [more-list] may not operate as you
wish in this case.
<p>
<DT><STRONG>

<A NAME="minivend_matches_0">
[matches]</A>

</STRONG>
<DD>
Replaced with the range of match numbers displayed by the
search page.  Looks something like ``1-50''. Make sure
you insert this item between a [more_list] and [/more_list]
element pair.
<p>
<DT><STRONG>

<A NAME="minivend_more_list_0">
[more_list]</A>

</STRONG>
<DD>
Starts the section of the search page which is only displayed
if there are more matches than specified in 
<A HREF="minivend.html#minivend_mv_matchlimit_0">mv_matchlimit</A>
.
If there are less matches than the number in mv_matchlimit, all
text/html between the [more_list] and [/more_list] elements is
stripped.
<p>Use in conjunction with the [more] element to place pointers to
additional pages of matches.
<p>
<DT><STRONG>

<A NAME="minivend_more_list_1">
[/more_list]</A>

</STRONG>
<DD>
Companion to [more_list].  
<p>
<DT><STRONG>

<A NAME="minivend_more_0">
[more]</A>

</STRONG>
<DD>
Inserts a series of hyperlinks that will call up the next matches
in a series. They look like this:
<p>
<XMP>
    Previous 1 2 3 4 5 6 Next

</XMP>
<p>The current page will not be a hyperlink.  Every time the new
link is pressed, the list is re-built to correspond to the current
page.  If there is no <EM>Next</EM> or <EM>Previous</EM> page, that link
will not be shown.
<p>See the <EM>fr_resul.html</EM> or 
<A HREF="minivend.html#minivend_search_0">search.html</A>
 files for examples. Make sure
you insert this item between a [more_list] and [/more_list] element pair.
<p>
<DT><STRONG>

<A NAME="minivend_item_link_0">
[item_link code]</A>

</STRONG>
<DD>
Expands into a hyperlink which will jump the user to a page
under the 
<A HREF="minivend.html#minivend_itemlinkdir_0"><EM>ItemLinkDir</EM></A>
 (default is the pages directory),
with anchor text as set in 
<A HREF="minivend.html#minivend_itemlinkvalue_0"><EM>ItemLinkValue</EM></A>
 (default is ``More Details'').
If the page is not present, then <EM>flypage.html</EM> will be used to build
a page from the entry in the database.  If that doesn't work (perhaps
due to a missing flypage.html) then the error page <EM>notfound.html</EM> will
be displayed.  Only active in the search list.
<p>
<DT><STRONG>

<A NAME="minivend_process_search_0">
[process_search]</A>

</STRONG>
<DD>
Calls the search with the proper URL, including MiniVend session tags.  Used
as the ACTION value for the search form.
<p>
<DT><STRONG>

<A NAME="minivend_process_target_0">
[process_target frame]</A>

</STRONG>
<DD>
Calls the search with the proper URL, including MiniVend session tags.
Used as the ACTION value for the search form if the results are to be
targeted to a different window than the one set by SearchFrame (which is
``_self'' by default).
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_using_0">
Using a Search Cache</A>
</H2>
Each catalog may maintain a search cache, which is enabled by
specifying a file name (the name of the search cache DBM) in
the 
<A HREF="minivend.html#minivend_searchcache_0">SearchCache</A>
 directive in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
. It operates by
developing a 32-bit checksum of the combined parameters of a 
one-click scan search, or by combining the variable names/values
specified in <EM>mv_cache_params</EM> on a form-based search.
<p>If your catalog frequently specifies category searches in a
large catalog, speed of search return can be increased by a
large factor.
<p>You needn't do more than just enable the cache for one-click
searches.  To make them operate on a form-based search, specify
the form variable names, separated by a spaces and/or a comma,
that will generate a unique cache key.  Example:
<p>
<XMP>
  <INPUT TYPE=hidden NAME="mv_cache_params"
    VALUE="mv_searchspec,mv_substring_match,mv_search_field">

</XMP>
<p>It is conceivable, but unlikely, that two separate searches
could generate the same 32-bit checksum and return the same
cached search.
<p>IMPORTANT NOTE:  The search cache is only invalidated by a
catalog reconfiguration.  If you change your product database
or any other files you search, you should reconfigure or the
search returns may be wrong.
<p><p><hr>

<H1> 
<A NAME="minivend_the_7">
THE ORDER PROCESS</A>
</H1>
The order page(s) are where the items are tracked and adjusted by the
customer.  It is possible, beginning with MiniVend 1.03, to have an
unlimited number of order pages.  As of MiniVend 2.02, it is also
possible to have multiple shopping carts, as in buy or sell. This allows
a basket/checkout type of ordering scheme, with custom order pages for
items which have many accessories.
<p>The name of the page to display can be configured in several
ways:
<p>
<OL>
<LI>Set the SpecialPage 'order' to the page to display
when an item is ordered.
<p>
<LI>Set the FrameOrderPage directive to the page to use
when frames are enabled. This overrides option 1.
<p>
<LI>Use the [order item page] Order it! [/order] form of
order tag to specify an arbitrary order page for an item.
<p>
<LI>If already on an order page, set the mv_checkout, mv_orderpage,
mv_nextpage, mv_successpage, or mv_failpage variables.
<p>
</OL>
The variables mentioned above modify the page display in the.following ways:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_cartname_0">
mv_cartname</A>

</STRONG>
<DD>
The shopping cart (default is main) to be used for this order
operation.
<p>
<DT><STRONG>

<A NAME="minivend_mv_checkout_0">
mv_checkout</A>

</STRONG>
<DD>
Page to be displayed when checkout is called from the form
<p>
<DT><STRONG>

<A NAME="minivend_mv_failpage_0">
mv_failpage</A>

</STRONG>
<DD>
Page to be displayed on a failed order
check (see 
<A HREF="minivend.html#minivend_advanced_0"><EM>Advanced Multi-level Order Pages</EM></A>
)
<p>
<DT><STRONG>

<A NAME="minivend_mv_nextpage_0">
mv_nextpage</A>

</STRONG>
<DD>
Page to display on a return operation.
<p>
<DT><STRONG>

<A NAME="minivend_mv_orderpage_0">
mv_orderpage</A>

</STRONG>
<DD>
Page to be displayed on a refresh.
<p>
<DT><STRONG>

<A NAME="minivend_mv_successpage_0">
mv_successpage</A>

</STRONG>
<DD>
Page to be displayed on a successful order
check (see 
<A HREF="minivend.html#minivend_advanced_0"><EM>Advanced Multi-level Order Pages</EM></A>
).
<p>
</DL>
The Accessories database is a place to keep conditional accessory.items for display on the order page (or anywhere else, for that matter).
This allows you to place additional conditional items on the order page,
perhaps checkboxes or a drop-down menu to select a color or style. Or
you can have whole conditional trees to automatically configure a product
to a customer's needs.
<p>The structure of the Accessories database is a simple key-value pair --
if you have more complex accessory setups you can define one of the 

<A HREF="minivend.html#minivend_arbitrary_0"><EM>Arbitrary Databases</EM></A>
 and use that.
<p>The following elements are used on the order page:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_value_1">
[value field flag*]</A>

</STRONG>
<DD>
Expands into the current value of the customer input field
named by field. If <EM>flag</EM> is present, single and double
quotes will be escaped with a backslash; this allows reliable
SQL inserts.  See the section on input fields for more
information.
<p>
<DT><STRONG>

<A NAME="minivend_nitems_0">
[nitems cart*]</A>

</STRONG>
<DD>
Expands into the total number of items ordered so far. Takes an
optional cart name as a parameter.
<p>
<DT><STRONG>

<A NAME="minivend_subtotal_0">
[subtotal]</A>

</STRONG>
<DD>
Expands into the subtotal cost, exclusive of sales tax, of
all the items ordered so far.
<p>
<DT><STRONG>

<A NAME="minivend_salestax_1">
[salestax]</A>

</STRONG>
<DD>
Expands into the sales tax on the subtotal of all the
items ordered so far. If there is no key field to derive the
proper percentage, such as state or zip code, it is set to whatever
the default is.  See <EM>Sales Tax</EM> for more information.
<p>
<DT><STRONG>

<A NAME="minivend_total_cost_0">
[total_cost]</A>

</STRONG>
<DD>
Expands into the total cost of all the items ordered so far, including
sales tax (if any).
<p>
</DL>
* marks an optional item.
Within any order page, the [item_list cart*] element shows a list of all the
items ordered by the customer so far. It works by repeating the source
between [item_list] and [/item_list] once for each item ordered.
Between the item_list markers the following elements will return
information for the current item:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_if_field_0">
[if_field fieldname]</A>

</STRONG>
<DD>
If the database field <EM>fieldname</EM> is non-blank, the following
text up to the [/if_field] tag is substituted. This can be used to
substitute IMG or other tags only if the corresponding source
item is present. Also accepts a [else]else text[/else] pair
for the opposite condition.
<p>
<DT><STRONG>

<A NAME="minivend_if_field_1">
[/if_field]</A>

</STRONG>
<DD>
Terminates an [if_field fieldname] element.
<p>COMPATIBILITY NOTE: MiniVend 1.02 used the [/if] end tag for
an [if_field] element. This was supported through MiniVend 1.03,
but is gone in 2.0 -- you may need to change it.
<p>
<DT><STRONG>

<A NAME="minivend_item_accessories_0">
[item_accessories]</A>

</STRONG>
<DD>
Evaluates to the value of the Accessories database entry for
the item.
<p>
<DT><STRONG>

<A NAME="minivend_item_code_0">
[item_code]</A>

</STRONG>
<DD>
Evaluates to the product code for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_data_0">
[item_data database fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the arbitrary database
table <EM>database</EM>, for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_description_0">
[item_description]</A>

</STRONG>
<DD>
Evaluates to the product description (from the products file)
for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_field_0">
[item_field fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the database,  for
the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_increment_0">
[item_increment]</A>

</STRONG>
<DD>
Evaluates to the number of the item in the match list. Used
for numbering search matches or order items in the list.
<p>
<DT><STRONG>

<A NAME="minivend_item_modifier_0">
[item_modifier attribute]</A>

</STRONG>
<DD>
Evaluates to the modifier value of <EM>attribute</EM> for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_price_0">
[item_price n*]</A>

</STRONG>
<DD>
Evaluates to the price for quantity <CODE>n</CODE> (from the products file)
of the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_quantity_0">
[item_quantity]</A>

</STRONG>
<DD>
Evaluates to the quantity ordered for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_subtotal_0">
[item_subtotal]</A>

</STRONG>
<DD>
Evaluates to the subtotal (quantity * price) for the current item.
Quantity price breaks are taken into account.
<p>
<DT><STRONG>

<A NAME="minivend_modifier_name_0">
[modifier_name attribute]</A>

</STRONG>
<DD>
Evaluates to the name to give an input box in which the
customer can specify the modifier to the ordered item.
<p>
<DT><STRONG>

<A NAME="minivend_quantity_name_0">
[quantity_name]</A>

</STRONG>
<DD>
Evaluates to the name to give an input box in which the
customer can enter the quantity to order.
<p>
</DL>
A [loop item,item..] list is similar, but does not include the items.that are associated with the order list, and the tags are prefixed
<EM>loop_</EM>, so that loop and item lists may be interspersed.  Item lists
are evaluated before loop lists, so you can put an item-code inside of
an loop list. If you want to reverse the order, put the loop list in a
double set of brackets to force earlier evaluation.  Up to 1024 items
may be present in a loop list.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_loop_accessories_0">
[loop_accessories]</A>

</STRONG>
<DD>
Evaluates to the value of the Accessories database entry for
the item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_code_0">
[loop_code]</A>

</STRONG>
<DD>
Evaluates to the product code for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_data_0">
[loop_data database fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the arbitrary database
table <EM>database</EM>, for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_description_0">
[loop_description]</A>

</STRONG>
<DD>
Evaluates to the product description (from the products file)
for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_field_0">
[loop_field fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the database,  for
the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_increment_0">
[loop_increment]</A>

</STRONG>
<DD>
Evaluates to the number of the item in the list. Used
for numbering items in the list.
<p>
<DT><STRONG>

<A NAME="minivend_loop_price_0">
[loop_price n*]</A>

</STRONG>
<DD>
Evaluates to the price for optional quantity n (from the products file)
of the current item.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_multiple_0">
Multiple Shopping Carts</A>
</H2>
You can maintain multiple shopping carts with MiniVend (2.02 and above).
One shopping cart -- main, by name -- is defined when the user session
starts.  If the user orders item M1212 with the following tag:
<p>
<XMP>
    [order M1212 layaway] Order this item! [/order]

</XMP>
<p>the order will be placed in the cart named <EM>layaway</EM>. However, by default
you won't see what you want!  That is because the default shopping basket
page won't display the cart you are thinking it will -- it will show
the main cart.  So copy the default cart (pages/ord/basket.html in the demos)
to a new file, insert a [cart layaway] tag, and submit it as a MiniVend
page name addendum to the cart name:
<p>
<XMP>
    [order M1212 layaway/lay_basket] Order this item! [/order]

</XMP>
<p>Now the contents of the <EM>layaway</EM> cart will be displayed.  If you need
to display a different price, you will have to emulate the [subtotal],
[item-price], [item-subtotal], etc. fields with [item-list], [calc], 
and [currency] tags.  This snippet emulates the item-price tag for
a different price field <EM>layaway-price</EM>:
<p>
<XMP>
    [currency] [item-field layaway-price] [/currency]

</XMP>
<p>An item subtotal:
<p>
<XMP>
    [currency]
        [calc]
            [item-field layaway-price] * [item-quantity]
        [/calc]
    [/currency]

</XMP>
<p>A cart subtotal, using the item-list tag:
<p>
<XMP>
    [currency]
        [calc]
            [item-list layaway]
            ([item-field layaway-price] * [item-quantity]) +
            [/item-list]
            0
        [/calc]
    [/currency]

</XMP>
<p>The zero is needed because of the trailing plus sign left by the
iterative [item-list] tag.
<p>Even sales tax can be emulated if you use something like a
[data salestax [value state]] tag, and do some similar calculation.
That is left as an exercise for the user.
<p>Shipping and the [nitems] tag will still work properly with a
different price.
<p>You can also order items from a form, using the <EM>mv_order_item</EM>,

<A HREF="minivend.html#minivend_mv_cartname_0">mv_cartname</A>
, and optional <EM>mv_order_quantity</EM> variables.
<p>
<XMP>
 <FORM METHOD=POST ACTION="[process-order]">
 <input type=checkbox name="mv_order_item" value="M3243"> Item M3243
 <input name="mv_order_quantity" value="1"> Quantity
 <input type=hidden name="mv_cartname" value="layaway">
 <input type=hidden name="mv_doit" value="refresh">
 <input type=submit name="mv_junk" value="Place on Layaway Now!">
 </FORM>

</XMP>
<p>
<H2> 
<A NAME="minivend_advanced_0">
Advanced Multi-level Order Pages</A>
</H2>
An unlimited number of order checking profiles can be defined
with the 
<A HREF="minivend.html#minivend_orderprofile_0"><EM>OrderProfile</EM></A>
 directive. This allows a multi-level ordering
process, with checking for format and validity at every stage.
<p>Specifications take the form of an order page variable (like name
or address), followed by an equals sign and one of five check types:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_required_1">
required</A>

</STRONG>
<DD>
A non-blank value is required
<p>
<DT><STRONG>

<A NAME="minivend_mandatory_0">
mandatory</A>

</STRONG>
<DD>
Must be non-blank, and must have been specified on this
form, not a saved value from a previous form
<p>
<DT><STRONG>

<A NAME="minivend_phone_0">
phone</A>

</STRONG>
<DD>
The field must look like a phone number, by a very
loose specification allowing numbers from all countries
<p>
<DT><STRONG>

<A NAME="minivend_phone_us_0">
phone_us</A>

</STRONG>
<DD>
Must have US phone number formatting, with area code
<p>
<DT><STRONG>

<A NAME="minivend_email_0">
email</A>

</STRONG>
<DD>
Rudimentary email address check, must have an '@' sign,
a name, and a minimal domain
<p>
</DL>
Also, there are three pragmas that can be used to change behavior:.
<p>
<DL COMPACT>
<DT><STRONG>
<EM>&amp;fatal</EM>
</STRONG>
<DD>
Set to '&amp;fatal=yes' if an error should generate
the error page.
<p>
<DT><STRONG>
<EM>&amp;final</EM>
</STRONG>
<DD>
Set to '&amp;final=yes' if a successful check should
cause the order to be placed.
<p>
<DT><STRONG>
<EM>&amp;set</EM>
</STRONG>
<DD>
Set a minivend variable to a value, i.e.  &amp;set=mv_email [value email].
This is usually placed at the end after a &amp;fatal pragma would have
caused the process to stop if there was an error.
<p>
</DL>
As an added measure of control, the specification is evaluated for the.special MiniVend tags to provide conditional setting of order
parameters. With the new [perl] [/perl] capability, quite complex checks
can be done.  Also, the name of the page to be displayed on an error can
be set in the 
<A HREF="minivend.html#minivend_mv_failpage_0">mv_failpage</A>
 variable.
<p>The following file specifies a simple check of formatted parameters:
<p>
<XMP>
 name=required
 address=required
 city=required
 state=required
 zip=required
 email=required
 phone_day=phone_us
 &fatal=yes
 email=email
 &set=mv_email [value email]
 &set=mv_successpage ord/shipping

</XMP>
<p>The profile above only performs the &amp;set directives if all of the
previous checks have passed -- the &amp;fatal=yes will stop processing after
the check of the email address if any of the previous checks failed.
<p>If you want to place multiple order profiles in the same file,
separate them with __END__, which must be on a line by itself.
Be careful, then they are interpreted in the order found, with 
the second file name not necessarily being the second profile.
(Which would be numbered 1, of course, just for clarity. At least
it is clear to a programmer.)
<p>
<H2> 
<A NAME="minivend_simple_0">
Simple Order Report File</A>
</H2>
The simple order report file, ``report'', defines the layout of the order
report which gets mailed on the completion of the order. For example,
<p>
<XMP>
              Order Date: $date
                    Name: $name
           Email address: $email
        Shipping address: $addr
        Town, State, Zip: $town, $state $zip
                 Country: $country

</XMP>
<p>Any input field from the order page can be included using the dollar
sign notation.
<p>To prevent a value from being included in the order report, just add it
to the 
<A HREF="minivend.html#minivend_reportignore_0">ReportIgnore</A>
 configuration directive.  
<p>MiniVend defines some values for use in the search form -- they begin
with 'mv_' and are automatically ignored.
<p>
<H2> 
<A NAME="minivend_fully_configurable_0">
Fully-configurable Order Reports</A>
</H2>
You can specify a fully-configurable order report by setting the hidden
field ``mv_order_report'' to a legal MiniVend page. This page will be
interpolated with all MiniVend tags before sending by email.  The order
number as set by backend ordering is in the variable mv_order_number,
and available for your use.
<p>You could if you wish include HTML in the file, which will be interpreted
by many mailers, but you can choose to use standard ASCII format.
An example report is provided in the demo file &lt;pages/ord/report.html&gt;.
<p>
<H2> 
<A NAME="minivend_order_3">
Order Receipts</A>
</H2>
If you specify a legal MiniVend page name in the ReceiptPage directive,
the user will be sent this page instead of the default ``confirmation''
file.  The file can of course be configured with all MiniVend tags, and
will be interpolated for the ordered items before they are deleted from
the user record.  If you want to have a different receipt for different
carts, set the <EM>mv_order_receipt</EM> variable in the form.
<p>
<H2> 
<A NAME="minivend_the_8">
The Order Counter</A>
</H2>
An order counter can be enabled if the 
<A HREF="minivend.html#minivend_ordercounter_0"><EM>OrderCounter</EM></A>
 directive
is set to a file name.  An incrementing count of all orders will be
kept and assigned as orders are placed.  By default, the number
starts at 0, but you can edit the file and change the default
starting number at any time.
<p>This capability is made possible by the File::CounterFile module,
available (as a part of the fine libwww modules) at the same place you
got MiniVend.  It is included with the distribution.
<p>
<H2> 
<A NAME="minivend_customer_0">
Customer Input Fields</A>
</H2>
On the order (or shopping basket) page, by default order.html, you will
have a number of input fields allowing the customer to enter information
such as their name and address.  You can add more fields simply by
putting more input elements on the order.html page, and the information
will automatically be included in the order report. Input elements
should be written in this way:
<p>
<XMP>
    <input type="text" name="town" value="[value town]" size=30>

</XMP>
<p>Choose a name for this input field such as ``email'' for an email
address. Set the name attribute to the name you have chosen.
<p>The value attribute specifies the default value to give the field when
the page is displayed. Because the customer may enter information on
the order page, return to browsing, and come back to the order page,
you want the default value to be what was entered the first time. This
is done with the [value] element, which returns the last value of an
input field. Thus,
<p>
<XMP>
    value="[value name]"

</XMP>
<p>will evaluate to the name entered on the previous order screen, such
as:
<p>
<XMP>
       value="Jane Smith"

</XMP>
<p>which will be displayed by the browser.
<p>The size attributes specifies how many characters wide the input field
should be on the browser. You do not need to set this to fit the
longest possible value since the browser will scroll the field, but
you should set it large enough to be comfortable for the customer.
<p><p><hr>

<H1> 
<A NAME="minivend_item_0">
ITEM ATTRIBUTES</A>
</H1>
MiniVend allows item attributes to be set for each ordered item. This
allows a size, color, or other modifier to be attached to a common
part number.  If multiple attributes are set, then they should be
separated by commas.  Previous attribute values can be saved by means
of a hidden field on a form, and multiple attributes for each item
can be <EM>stacked</EM> on top of each other.
<p>The configuration file directive 
<A HREF="minivend.html#minivend_usemodifier_0"><EM>UseModifier</EM></A>
 is used to set
the name of the modifier or modifiers. For example
<p>
<XMP>
    UseModifier        size,color

</XMP>
<p>will attach both a size and color attribute to each item code that
is ordered.
<p>The modifier value is accessed in the [item-list] loop with the
[item-modifier attribute] tag, and form input fields are placed with the
[modifier-name attribute] tag.  This is similar to the way that quantity
is handled, except that attributes can be ``stacked'' by setting multiple
values in an input form.
<p>Use the [loop item,item,item] list to reference multiple display or
selection fields for modifiers. The modifier value can then be used to
select data from an arbitrary database for attribute selection and
display.
<p>You cannot define a modifier name of 
<A HREF="minivend.html#minivend_code_0">code</A>
 or <EM>quantity</EM>, as they
are already used.  You must be sure that no fields in your forms
have digits appended to their names if the variable is the same name
as the attribute name you select, as the [modifier-name size] variables
will be placed in the user session as the form variables size0, size1,
size2, etc. 
<p>As of MiniVend 2.02, setting the <EM>mv_separate_items</EM> or global
directive 
<A HREF="minivend.html#minivend_separateitems_0">SeparateItems</A>
 places each ordered item on a separate
line, simplifying attribute handling.
<p>Below is a fragment from a shopping basket display form which 
shows a selectable size with ``sticky'' setting.  Note that this
would always be contained within the [item_list] [/item-list]
pair.
    
    &lt;SELECT NAME=``[modifier-name size]''&gt;
    &lt;OPTION  [selected [modifier-name size] S]&gt; S
    &lt;OPTION  [selected [modifier-name size] M]&gt; M
    &lt;OPTION  [selected [modifier-name size] L]&gt; L
    &lt;OPTION [selected [modifier-name size] XL]&gt; XL
    &lt;/SELECT&gt;
<p>It could just as easily be done with a radiobutton group combined
with the [checked ...] tag.
<p>The value can then be displayed with [item-modifier size] on the
order report, order receipt, or any other page containing an
[item_list]. 
<p>
<H2> 
<A NAME="minivend_product_0">
Product Discounts</A>
</H2>
Product discounts can be set upon display of any page. The discounts
apply only to the customer receiving them, and are of one of three types:
<p>
<XMP>
    1. A discount for one particular item code (key is the item-code)
    2. A discount applying to all item codes (key is ALL_ITEMS)
    3. A discount applied after all items are totaled
       (key is ENTIRE_ORDER)

</XMP>
<p>The discounts are specified via a formula. The formula is scanned for
the variables <STRONG>$q</STRONG> and <STRONG>$s</STRONG>, which are substituted for with the item
<EM>quantity</EM> and <EM>subtotal</EM> respectively. In the case of the item and
all items discount, the formula must evaluate to a new subtotal for all
items <EM>of that code</EM> that are ordered. The discount for the entire
order is applied to the entire order, and would normally be a monetary
amount to subtract or a flat percentage discount.
<p>Discounts are applied to the effective price of the product, including
any quantity discounts.
<p>To apply a straight 20<STRONG>% </STRONG>discount to all items:
<p>
<XMP>
    [discount ALL_ITEMS] $s * .8 [/discount]

</XMP>
<p>To take 25<STRONG>% </STRONG>off of only item 00-342:
<p>
<XMP>
    [discount 00-342] $s * .75 [/discount]

</XMP>
<p>To subtract <STRONG>$5</STRONG>.00 from the customer's order:
<p>
<XMP>
    [discount ENTIRE_ORDER] $s - 5 [/discount]

</XMP>
<p>Perl code can be used to apply the discounts.  Here is an example of a
discount for item code 00-343 which prices the <EM>second</EM> one ordered at
1 cent:
<p>
<XMP>
    [discount 00-343]
    return $s if $q == 1;
    my $p = $s/$q;
    my $t = ($q - 1) * $p;
    $t .= 0.01;
    return $t;
    [/discount]

</XMP>
<p>If you want to display the discount amount, use the [calc] capability.
This example calculates the amount of the discount for all items in
the current shopping cart:
<p>
<XMP>
    [item_list]
    Discount for [item-code]: $[currency]
                                [calc][item-field price] - [item-price 1]
                                [/calc][/currency]
    [/item_list]

</XMP>
<p><p><hr>

<H1> 
<A NAME="minivend_sales_0">
SALES TAX</A>
</H1>
MiniVend allows calculation of sales tax on a straight percentage basis,
with certain items allowed to be tax-exempt.  To enable this feature,
the directive 
<A HREF="minivend.html#minivend_salestax_2"><EM>SalesTax</EM></A>
 is initialized with the name of a field (or
fields) on the order form.  Commonly, this is zipcode and/or state:
<p>
<XMP>
    SalesTax    zip,state

</XMP>
<p>This being done, MiniVend assumes the presence of a file 
<A HREF="minivend.html#minivend_salestax_asc_0">salestax.asc</A>
,
which contains a database with the percentages.  Each line of 

<A HREF="minivend.html#minivend_salestax_asc_0">salestax.asc</A>
 should be a code (again, usually a five-digit zip or
a two letter state) followed by a tab, then a percentage. Example:
<p>
<XMP>
    default 0
    45056   .0525
    61821   .0725
    61801   .075
    IL      .0625
    OH      .0525
    WA      .08

</XMP>
<p>Based on the user's entry of information in the order form, MiniVend
will look up (for our example SalesTax directive) first the zip, then
the state, and apply the percentage to the SUBTOTAL of the order.  The
subtotal will include any taxable items, and will also include the
shipping cost if the state/zip is included in the 
<A HREF="minivend.html#minivend_taxshipping_0"><EM>TaxShipping</EM></A>
 directive.
It will add the percentage, then make that available with the [salestax]
tag for display on the order form. If no match is found, the entry
'default' is applied -- that is normally 0, but can be anything.
<p>If business is being done on a national basis, it is now common to have
to collect sales tax for multiple states.  If you are doing so, it is possible
to subscribe to a service which issues regular updates of the sales tax
percentages -- usually by quarterly or monthly subscription.  Such a
database should be easily converted to MiniVend format -- but some systems
are rather convoluted, and it will be well to check and see if the
program can export to a flat ASCII file format based on zip code.
<p>If some items are not taxable, then you must set up a field in your
database which indicates that. You then place the <STRONG>name</STRONG> of that field
in the 
<A HREF="minivend.html#minivend_nontaxablefield_0"><EM>NonTaxableField</EM></A>
 directive. If the field for that item
evaluates true on a yes-no basis (i.e. is set to 'yes', 'y', 1, or the
like), sales tax will not be applied to the item. If it evaluates false,
it will be taxed.
<p>If your state taxes shipping, use the 
<A HREF="minivend.html#minivend_taxshipping_0"><EM>TaxShipping</EM></A>
 directive.
Utah and Nevada are known to tax shipping -- there may be others.
<p><p><hr>

<H1> 
<A NAME="minivend_shipping_1">
SHIPPING</A>
</H1>
MiniVend allows the addition of a flat shipping charge with
the 
<A HREF="minivend.html#minivend_shipping_2"><EM>Shipping</EM></A>
 directive.  Most catalogs have more elaborate
requirements, requiring use of the 
<A HREF="minivend.html#minivend_custom_0"><EM>Custom Shipping</EM></A>
 capability
of MiniVend.
<p>
<H2> 
<A NAME="minivend_custom_0">
Custom Shipping</A>
</H2>
MiniVend allows custom shipping charges to be added to an order based on
the value of an entry in the database.  To enable custom shipping, enter
the default field to use in the 
<A HREF="minivend.html#minivend_customshipping_0"><EM>CustomShipping</EM></A>
 directive:
<p>
<XMP>
    CustomShipping  weight

</XMP>
<p><STRONG>IMPORTANT NOTE:</STRONG> Before MiniVend 2.0, there could only be one field used to set
the criteria.  As of MiniVend 2.0, the entry in the shipping file
which is <EM>exactly the same</EM> as the value of the mv_shipmode variable
will be used to determine the field criteria for the shipping method.
This allows 
<A HREF="minivend.html#minivend_weight_0">weight</A>
 to be used for one mode, while <EM>price</EM> or
<EM>quantity</EM> is used for another.
<p>The shipping cost database (located in ProductDir/shipping.asc)
is a tab-separated ASCII file with six fields --
code, text description, criteria (quantity or weight, for example),
minimum number, maximum number, and cost.  None of the fields
are case-sensitive.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_code_0">
code</A>

</STRONG>
<DD>
The unique identifier for that shipping method.
<p>
<DT><STRONG>

<A NAME="minivend_description_2">
description</A>

</STRONG>
<DD>
Text to describe the method (can be accessed on a page
with the <EM>[shipping_description]</EM> element).
<p>
<DT><STRONG>

<A NAME="minivend_criteria_0">
criteria</A>

</STRONG>
<DD>
Whether it is for weight, quantity, price, etc.
<STRONG>NOTE:</STRONG> This only makes a difference in the field that
matches the shipping mode exactly!
<p>
<DT><STRONG>

<A NAME="minivend_minimum_0">
minimum</A>

</STRONG>
<DD>
The low bound of quantity/weight this entry applies to.
<p>
<DT><STRONG>

<A NAME="minivend_maximum_0">
maximum</A>

</STRONG>
<DD>
The high bound of quantity/weight this entry applies to.
The low bound wins in case of ties.
<p>
<DT><STRONG>

<A NAME="minivend_cost_0">
cost</A>

</STRONG>
<DD>
The total cost, determined by formula if it begins with 'f',
by multiplier if it begins with 'x', by UPS-style lookup if 
it begins with u, a straight cost otherwise.
<p>
</DL>
The cost is calculated like this:.
<p>
<OL>
<LI>The base code is selected by reading the value of mv_shipmode
in the user session.  If it has not been explicitly set, either
by means of the 
<A HREF="minivend.html#minivend_defaultshipping_0">DefaultShipping</A>
 directive or by setting the
variable on a form (or in an order profile), it will be 'default'.
<p>
<LI>The criterion field is found -- if it is quantity, then it
is the total quantity of items on the order form. If it is any
other name, it is selected from the product database field of
that name.  If the lookup fails, a zero cost will be returned,
and an error is sent to the catalog error log.
<p>
<LI>Entries in the shipping database that begin with the same
string as the shipping mode are examined. If none is found,
a zero cost is returned and an error is sent to the catalog error log.
<p>
<LI>The value of the criteria TIMES THE QUANTITY of the item is determined,
and if it falls with in the minimum and maximum, the cost is then
applied.  This will be called the accumulated criterion.
<p>
<LI>If the cost is fixed, it is simply added.
<p>
<LI>If the cost field begins with an 'x', the cost is multiplied
by the accumulated criterion -- price, weight, etc.
<p>
<LI>If the cost field begins with 'f', the formula following
is applied.  Use <STRONG>$x</STRONG> as the value of the accumulated criterion.
<p>
<LI>If the cost field begins with 'u', a UPS lookup is done.
<p>
</OL>
Here is an example shipping file using all of the methods of.determining shipping cost.
<p>NOTE: The columns are lined up for your reading convenience, the actual
entries should have ONE tab between fields.
<p>
<XMP>
  rpsg   RPS Ground  quantity  0   0         0
  rpsg1  RPS Ground  quantity  1   5         7.00
  rpsg2  RPS Ground  quantity  6   10        10.00
  rpsg3  RPS Ground  quantity  11  99999999  x .95
  usps   US Postal   price     0   0         0
  usps1  US Postal   price     1   50        f 7 + (1 * $x / 10)
  usps2  US Postal   price     50  100       f 12 + (.90 * $x / 10)
  usps3  US Postal   price     100 99999999  f 12 + (.05 * $x)
  upsg   UPS Ground  weight    0   0         0
  upsg1  UPS Ground  weight    1   99999999  u upsg [value zip]

</XMP>
<p>If the user selected RPS, (code RPSG), and the quantity on the order
was 3, the cost of 7.00 from <EM>rpsg1</EM> would be applied.  If the
quantity were 7, the next entry from <EM>rpsg2</EM> would be selected, for a
cost of 10.00.  If the quantity were 15, <EM>rpsg3</EM> would be selected, and
the quantity of 15 multiplied by 0.95, for a total cost of 14.25.
<p>The second one is a more complicated formula -- using price as the
criteria. 
<p>The third is a special case. It specifies a UPS lookup based on three 
things:
<p>
<XMP>
    1. Your UPS zone
    2. Weight (careful, always use weight for this one!)
    3. The zip/postal code of the recipient

</XMP>
<p>The routines use standard UPS lookup tables.  First, the UPS Zone file
must be present.  That is a standard UPS document, <EM>specific to your area</EM>,
that you must obtain from UPS and enter into and make available
to MiniVend in TAB-delimited format. You specify it with the

<A HREF="minivend.html#minivend_upszonefile_0"><EM>UpsZoneFile</EM></A>
 directive. Second, you must obtain the cost tables from
UPS (you can get them from www.ups.com) and place them into a MiniVend
database. That database, selected with the first argument (upsg in the
example) of the cost specification, is consulted to determine the UPS
cost for that weight and zip code.  See the sample demo, which has a
functional implementation, for more information.
<p>Note that the first entry in each class does not have a number appended
to it.  That is the entry used to determine the criteria (quantity,
weight, price, etc) and the text for the [shipping_desc] tag. It is also
used to apply the cost if the value of the criteria is less than 1.
<p>
<H2> 
<A NAME="minivend_default_0">
Default Shipping Mode</A>
</H2>
If a default shipping mode other than 'default' is desired, enter
it into the 
<A HREF="minivend.html#minivend_defaultshipping_0"><EM>DefaultShipping</EM></A>
 directive:
<p>
<XMP>
    DefaultShipping     UPSG

</XMP>
<p>This will make the  entry on the order form checked by default when the
user starts the order process, if it is put in the form:
<p>
<XMP>
  <INPUT TYPE=RADIO NAME=mv_shipmode VALUE=upsg [checked mv_shipmode upsg]> 

</XMP>
<p><p><hr>

<H1> 
<A NAME="minivend_tracking_0">
TRACKING AND BACKEND ORDER ENTRY</A>
</H1>
MiniVend allows the entry of orders into a system via one of several
methods.  The 
<A HREF="minivend.html#minivend_asciibackend_0">AsciiBackend</A>
 capability allows submittal of
parameters to an external order entry script.  Support for mSQL
allows entry of orders directly into an mSQL database. Orders
can be written to an ASCII file.  They can be formatted precisely
for email-based systems.  The orders can be placed in a DBM file.
Finally, embedded Perl allows completely flexible order entry, 
including real-time credit-card verification and settlement.
<p>
<H2> 
<A NAME="minivend_easy_0">
Easy ASCII Tracking</A>
</H2>
If you set AsciiTrack to a legal file name (based in VendRoot unless
it has a leading ``/''), a copy of the order will be saved there as well
as being emailed.
<p>If you set AsciiBackend to a legal file name (based in VendRoot unless
it has a leading ``/''), it will save the backend fields defined in 

<A HREF="minivend.html#minivend_backendorder_0">BackendOrder</A>
 along with the item-code and quantity of items being
ordered.  The fields are separated by TAB characters. 
<p>For either directive, if the file name string begins with a pipe ``|'', 
a program will be run and the output ``piped'' to that program. This
allows easy backend entry of orders with an external program.
<p>
<H2> 
<A NAME="minivend_msql_8">
mSQL Tracking</A>
</H2>
See the <EM>[msql set]</EM> tag for an example of entering orders in
an mSQL database.
<p>
<H2> 
<A NAME="minivend_dbm_0">
DBM Tracking</A>
</H2>
MiniVend has a tracking  option, enabled with the configuration
directive 
<A HREF="minivend.html#minivend_tracking_1"><EM>Tracking</EM></A>
.  Entered orders and page popularity are tracked.
The tracking database is also used to hold encrypted data such as credit
card numbers, expiration dates, and the encrypted MiniVend password.
<p><STRONG>NOTE:</STRONG> Tracking is deprecated by the later support for ASCII tracking,
the order counter, and mSQL.  It's use is not encouraged, and it may
disappear from future versions of MiniVend.
<p>The Tracking directive must be a non-blank value to enable tracking.  In
addition, if the tracking database is not yet initialized, the Tracking
directive is used to initialize the first order number to be placed in
the tracking database. After that initialization, the value of the next
order number is kept in the database (under the key <EM>mv_next_order</EM>) and
incremented when an order is placed.  The incrementation is alpha-numeric,
so it is important to have leading zeros in any string value -- i.e., an
initial value of <STRONG>Order00009</STRONG> will be incremented to <STRONG>Order00010</STRONG>, while
an initial value of <STRONG>Order9</STRONG> will be incremented to <STRONG>Ordes0</STRONG>. Also, any
non-alphanumeric characters will be stripped -- <STRONG>Order_00000</STRONG> becomes
<STRONG>Order00000</STRONG>.
<p>The tracking is done by entering information in the DBM database <EM>tracking</EM> in
the products directory. Orders are tracked under two keys,
the actual key (started by the Tracking Directive) and a key that prepends the
string ``Backend'' to the actual key. The entry in the actual key is a facsimile
of the emailed order report -- the Backend key is the values selected in the 
BackendOrder directive, combined with the actual ordered item codes and
quantities, separated by NUL characters (ASCII code 0).
<p>To illustrate, take a MiniVend system that has tracking enabled with
these two configuration directives in the minivend.cfg file:
<p>
<XMP>
    Tracking        Order00001
    BackendOrder    name,address,city,state,zip,account,mv_shipmode

</XMP>
<p>When the user places an order for quantity 2 of item number <EM>P-133</EM>,
the tracking database will have two keys/values added:
<p>
<XMP>
 Key               Value
 ----------------  ----------------------------
 Order00001        (The order report, filled in -- see "Order Report File")
 BackendOrder00001 Joe J. User<NUL>123 Any St.<NUL>Main Street<NUL>OH<NUL>
                   12345<NUL>Acct#123<NUL>P-133<NUL>2

</XMP>
<p>If the customer left a credit card number with the SSL account information form
(see <EM>Order Security</EM>), the credit card number and its associated expiration
date will be placed in two additional fields:
<p>
<XMP>
 Key               Value
 ----------------  ----------------------------
 CcOrder00001      (encrypted data)
 ExpOrder00001     (encrypted data)

</XMP>
<p>The scheme allows a history of orders to be kept (the Order00001 key)
and a list of unentered orders (the BackendOrder00001 key, along with
the CcOrder00001 and ExpOrder00001 keys).  An external program can read
the tracking database and submit the orders to an order-entry system,
removing (or undefining) the BackendOrder, CcOrder, and ExpOrder keys
when finished.
<p>Page popularity is simply tracked by storing a count of accesses, with
the page name as the key.  No additional information is stored. It is
designed to give the catalog designer an idea of which features, pages,
and menus are popular, and which are rarely used.  Since individual page
accesses are tracked, it might also give marketing or sales an idea of
problems with product perception -- if an item were frequently looked
at, but rarely bought, it might be appropriate to re-write the catalog
page.
<p><p><hr>

<H1> 
<A NAME="minivend_ssl_0">
SSL SECURITY</A>
</H1>
MiniVend has several features that enable secure ordering via SSL
(Secure Sockets Layer). Despite their mystique, SSL servers are actually
quite easy to operate.  The difference between the standard HTTP server
and the SSL HTTPS server, from the standpoint of the user, is only in
the encryption and the specification of the URL -- https: is used for the
URL protocol specification instead of the usual http: designation.
<p><STRONG>IMPORTANT NOTE:</STRONG>  MiniVend attempts to perform operations securely,
but no guarantees or warranties of any kind are made! Since MiniVend
comes with Perl source, it is possible to modify the program to create
bad security problems. One way to minimize this possibility is to record
digital signatures, using MD5 or PGP, of <EM>minivend.pl</EM>,

<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
, and all modules included in minivend.pl (standard ones are
Vend/Server.pm, Vend/Imagemap.pm, Vend/Http.pm, Vend/lock.pm, and
possibly Des). Check them on a regular basis to ensure they have not
been changed.
<p>MiniVend uses the 
<A HREF="minivend.html#minivend_secureurl_0"><EM>SecureURL</EM></A>
 directive to set the base URL for secure
transactions, and the 
<A HREF="minivend.html#minivend_vendurl_0"><EM>VendURL</EM></A>
 directive for normal non-secure transactions.
Secure URLs can be enabled for forms through the [process_target action secure]
element, pages through the [pagetarget page frame__secure] element, and
access to the secure account information form is available through the
[secure_order] element.
<p>MiniVend incorporates additional security for credit card numbers.  Any field
on the order form which has <STRONG>credit_card</STRONG> in its name will not be written
to disk unless it is encrypted. An external encryption program, such
as pgp(1) or des(1) can be used.
<p><STRONG>NOTE:</STRONG> The internal Des encryption mode is no longer supported in
MiniVend 2.02 and higher.  Try PGP instead -- it is more secure and
easier to use.
<p>To accept credit_card fields, you need to define the directive

<A HREF="minivend.html#minivend_creditcardauto_0"><EM>CreditCardAuto</EM></A>
 to <EM>yes</EM>.  
<A HREF="minivend.html#minivend_encryptprogram_0"><EM>EncryptProgram</EM></A>
 also needs
to be defined with some value, one which will, with hope,
encrypt the number.  PGP is now recommended above all other
encryption program. The entries should look something like:
<p>
<XMP>
  CreditCardAuto   Yes
  EncryptProgram   /usr/local/bin/pgp -feat sales@company.com

</XMP>
<p>If encryption is not enabled, MiniVend will silently overwrite any
fields containing credit_card in the order form(s) with X characters.
<p><p><hr>

<H1> 
<A NAME="minivend_controlling_0">
CONTROLLING PAGE APPEARANCE</A>
</H1>
<p>
<H2> 
<A NAME="minivend_using_1">
Using Frames</A>
</H2>
MiniVend fully supports frames, the proposed extension to HTML 3.0. (Currently
only Netscape 2.0 and above browsers support frames.) Frames significantly
enhance the electronic catalog experience, since the user can maintain
a context -- with a search frame, a product details frame, a table-of-contents
frame, etc. The demo included with MiniVend is based on frames, though if
you access it with a non-frame browser it will operate perfectly well.
<p>Frames are accessed by adding a TARGET element to a HREF, naming
the frame that the referenced URL should be placed in. MiniVend
produces targets with the pagetarget and areatarget elements, which
send target tags if frames are enabled (by a [frames_on] element.
Any frame name can be used, including the special frames of _top, _blank,
_parent, and _self.
<p>As shown in the demo pages, the best way to accommodate both types of
browsers is by having an <EM>index.html</EM> page that sets the beginning
frame set.  The &lt;FRAMESET&gt; and &lt;FRAME&gt; tags will be ignored by standard
browsers, which will read the HTML between the &lt;NOFRAMES&gt; and &lt;/NOFRAMES&gt;
tags below.
<p>The format of the first set of URLs passed to the frames is important - only
ONE MiniVend link must be called.  That sets the session ID for the user. If
two URLs were called, MiniVend would assign two session IDs to the user,
scrambling the context of their navigation.  From this single access,
all further references to MiniVend are made, though after the first access
multiple frame targets can be referenced.
<p>This first MiniVend page that is accessed (with a frame browser) should
contain a [frames_on] element.  It is the only page that need (or should)
contain a [frames_on], which is persistent throughout the session. This
page should never be seen by a non-frame browser.
<p>Subsequent accesses to MiniVend URLs will now contain the proper session
information, and as long as pagetarget or page elements are used to
pass the URLs, context will be maintained.
<p>The [pagetarget page frame] element is used to pass target tags in hyperlinks.
The [areatarget page frame] element is used to pass target tags in imagemaps.
The [frames_on] and [frames_off] elements enable and disable frame operation.
The [framebase frame] element sets a base target for a page.
<p>See the sample demo pages:
<p>
<XMP>
    greet.html      Starting frame for frames-based browsers - has [frames_on]
    nf_greet.html   Turns off frames -- has [frames_off]
    reframe.html    Re-enables frames after they have been turned off

</XMP>
<p>
<H2> 
<A NAME="minivend_body_1">
Body and Buttonbar Control</A>
</H2>
MiniVend provides centralized page color and imagemap control through
use of the [body n] and [buttonbar n] elements. It also can place a random
message from a series of messages with the [random] element, and embed
help messages with the [help item] element.
<p>The [body n] element selects a color scheme -- numbered from 1 to 15 --
that is set by the Mv_Background, Mv_TextColor, Mv_BgColor,
Mv_LinkColor, and Mv_VlinkColor directives. Each can contain up to 15
parameters, after an opening BEGIN. Here is an example:
<p>
<XMP>
    Mv_Background  BEGIN /images/blue_pap.gif
    Mv_BgColor     BEGIN none steelblue white
    Mv_LinkColor   BEGIN none white black
    Mv_TextColor   BEGIN none ltgreen blue
    Mv_VlinkColor  BEGIN none orange purple

</XMP>
<p>The above sequence set in the catalog.cfg file, defines three color
schemes, accessed with [body 1], [body 2], and [body 3] elements in
MiniVend pages.  The first scheme uses the file <EM>/images/blue_pap.gif</EM>
as the background pattern, and keeps the user's default colors for
everything else.  It is called by a [body 1] element, which when
expanded becomes &lt;BODY BACKGROUND="/images/blue_pap.gif&gt;.
<p>The second scheme defines no background pattern (there is only one file
in the Mv_Background directive), but defines a background color of 'steelblue',
with a text color of white, a link color of light green, and a visited link
color of orange. It is accessed by the [body 2] element, which when expanded
becomes &lt;BODY BGCOLOR=``steelblue'' TEXT=``white'' LINK=``ltgreen'' VLINK=``orange''&gt;.
<p>The third color scheme is similar to the second, except defines
white-black-blue-purple for the four colors.  It is accessed with
a [body 3] element.
<p>If there is no defined scheme for a body element (as there wouldn't be if
you put [body 4] in a page with the above schemes defined) MiniVend
simply outputs a standard &lt;BODY> tag.
<p>The user can also define their own colors if the Mv_customcolors
variable is set (upon a form submission).  See the supplied

<A HREF="minivend.html#minivend_control_0">control.html</A>
 page for an example of how to set custom colors.
<p>Image maps can be supplied and similarly controlled with the [buttonbar n]
series of tags.  They are defined with the ButtonBars directive 
in catalog.cfg, and take the form of a series of
file names in MiniVend format -- i.e., relative to the PageDir and
without a .html extension. To use the buttonbars, create a file 
with an IMG directive set with the USEMAP element and an associated
client-side image map (defined with &lt;MAP&gt; &lt;/MAP&gt;. The [areatarget]
or [area] tags are used to set the URLs. An example:
<p>
<XMP>
    <IMG SRC="/sample/images/artbar0.gif" USEMAP="#ARTBAR0">
    <MAP NAME=ARTBAR0>
    <AREA COORDS="198,0,278,20" HREF="[areatarget fr_sel search]">
    <AREA COORDS="303,0,363,20" HREF="[areatarget fr_search search]">
    <AREA COORDS="388,0,442,20" HREF="[areatarget fr_greet main]">
    <AREA COORDS="473,0,537,20" HREF="[areatarget control main]">
    <AREA COORDS="0,0,560,20" NOHREF>
    </MAP>

</XMP>
<p>If the above were saved in the file PageDir/bars/artbar0.html (where PageDir
is your MiniVend pages directory), you would be able to access this
imagemap in your pages with a [buttonbar 0] tag, at least after MiniVend
read this line in the configuration file:
<p>
<XMP>
    ButtonBars  bars/artbar0 bars/artbar1 bars/artbar2

</XMP>
<p>The above entry allows you to define three imagemaps and access them in
your pages simply as [buttonbar 0], [buttonbar 1], and [buttonbar 2]. The
advantage of this scheme is central definition of a series of button bars
with only a few tags -- if you change your page colors or mapping, you
need only change one file and the change will roll over to all of your
catalog pages. Since some installations can number in the thousands
of catalog pages, using the pre-defined buttonbars can save a lot of
editing. (Server-side includes cannot be used to achieve the same thing
with MiniVend, since they wouldn't have the proper URLs.)
<p>
<H2> 
<A NAME="minivend_integrated_0">
Integrated Image Maps</A>
</H2>
Imagemaps can also be defined on forms, with the special form variable
<EM>mv_todo.map</EM>.  A series of map actions can be defined --
the action specified in the <EM>default</EM> entry will be applied if none
of the other coordinates match. The image is specified with a standard
HTML 2.0 form field of type <EM>IMAGE</EM>.  Here is an example:
<p>
<XMP>
 <INPUT TYPE="HIDDEN" NAME="mv_todo.map" VALUE="rect submit 0,0 100,20">
 <INPUT TYPE="HIDDEN" NAME="mv_todo.map" VALUE="rect cancel 290,2 342,18">
 <INPUT TYPE="HIDDEN" NAME="mv_todo.map" VALUE="default refresh">
 <INPUT TYPE="IMAGE" NAME="mv_todo" SRC="url_of_image">

</XMP>
<p>All of the actions will be combined together into one image map with
NCSA-style functionality -- see the NCSA imagemap documentation for
details -- except that MiniVend form actions are defined instead
of URLs.  The standard actions are:
<p>
<XMP>
 submit   Submit order
 refresh  Refresh order page (update quantities, etc.)
 cancel   Cancel order and wipe credit card numbers
 return   Go to previous page (or page defined in mv_nextpage variable)
 control  Control help, colors, etc.
 search   Search for an item in the catalog

</XMP>
<p>
<H2> 
<A NAME="minivend_random_1">
Random Banners</A>
</H2>
The [random] element, in conjunction with the 
<A HREF="minivend.html#minivend_random_2">Random</A>
 directive in the
catalog.cfg file, is similar to the buttonbar tag, except it displays
random messages or images.  It can be used to place a random tip, hint,
ad, or message, and can be any legal HTML construct. 
<p>
<H2> 
<A NAME="minivend_rotating_0">
Rotating Banners</A>
</H2>
The [rotate] element, in conjunction with the 
<A HREF="minivend.html#minivend_rotate_0">Rotate</A>
 directive in the
minivend.cfg file, is similar to the random tag, except it displays
messages or images guaranteed to be presented to the user in a specific
order.  It can be used to place a tip, hint, ad, or message, and can be any
legal HTML construct.
<p>
<H2> 
<A NAME="minivend_in_line_0">
In-line Help</A>
</H2>
The [help tag] element, in conjunction with the Help directive in the
minivend.cfg file, is similar to the buttonbar tag, except it displays
help messages or images, and is keyed by item name.  The help can be
contained in any of a series of files defined in the Help directive. It
can contain most MiniVend elements.  The user can turn off help through
a form -- see the 
<A HREF="minivend.html#minivend_control_0">control.html</A>
 file for an example.
<p><p><hr>

<H1> 
<A NAME="minivend_minivend_3">
MINIVEND CONFIGURATION FILES</A>
</H1>
MiniVend 2.0 now runs multiple catalogs on the
same server.  If no 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directives are present in the main

<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file, the server will read only a single catalog's
information from the one 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file, just as in
previous versions of the program.
<p>
<H2> 
<A NAME="minivend_server_0">
Server Configuration File</A>
</H2>
The VendRoot directory, specified in the main program minivend.pl, is
the default location of all of the MiniVend program, configuration,
special, and library files. Unless changed in minivend.pl, the main
MiniVend server configuration file will be minivend.cfg in the VendRoot
directory.
<p>If no 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directives are present, all of the directives
listed under 
<A HREF="minivend.html#minivend_catalog_3"><EM>Catalog Configuration File</EM></A>
 are operative for the
single catalog that will be served by MiniVend.
<p>Otherwise, there are only a few directives that are defined in the 

<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_catalog_2">
Catalog</A>

</STRONG>
<DD>
Specifies a catalog that can run using this MiniVend server.
There are three parameters, separated by spaces and/or tabs.
<p>The first is the name of the catalog -- it will be referred
to as that name in error, warning, and informational messages.
<p>The second is the base directory of the catalog. If the directory
does not contain a 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file, the server will report
an error and refuse to start.
<p>The third directive is very important to get right -- it is the
SCRIPT_NAME of the vlink program that runs the catalog.  It must
be unique from other CGI program paths that run on this server --
that is how the catalog is selected for operation.
<p>
<XMP>
    Catalog    sample   /home/minivend/sample  /cgi-bin/sample

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_displayerrors_0">
DisplayErrors</A>

</STRONG>
<DD>
While all errors are reported in the error log file, you can also have
errors displayed by the browser. This is convenient while you are
testing your configuration. Default is <EM>No</EM>.
<p>
<XMP>
    DisplayErrors       Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_hammerlock_0">
HammerLock</A>

</STRONG>
<DD>
The number of seconds after which a locked session could be
considered to be lost due to malfunction. This will kill the
lock on the session. Only here for monitoring of session
hand-off, if this error shows up in the error log the system
setup should be examined. Default is 30.
<p>
<XMP>
    HammerLock      60

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_globalsub_0">
GlobalSub</A>

</STRONG>
<DD>
Defines a <EM>global</EM> subroutine for use by the <STRONG>[perl sub] subname arg [/perl]</STRONG>
construct.  Use the ``here document'' capability of MiniVend configuration
files to make it easy to define:
<p>
<PRE>
    Sub &lt;&lt;EOF
    sub count_orders {
        my $counter = new File::CounterFile "/tmp/count_orders", '1';
        my $number = $counter->inc();
        return "There have been $number orders placed.\n";
    }
    EOF

</PRE>
<p>As with Perl ``here documents'', the EOF (or other end marker) must be the 
ONLY thing on the line, with no leading or trailing white space. Do not
append a semicolon to the marker.
<p><STRONG>IMPORTANT NOTE:</STRONG> These global subroutines are <STRONG>not</STRONG> subject to
security checks -- they can do most anything!  For most purposes,
scratch subroutines or catalog subroutines (also 
<A HREF="minivend.html#minivend_sub_1">Sub</A>
) are better.
<p>
<DT><STRONG>

<A NAME="minivend_housekeeping_0">
HouseKeeping</A>

</STRONG>
<DD>
How often, in seconds, the MiniVend server will ``wake up''
and look for user reconfiguration requests and hung search
processes. On some systems, this wakeup is the only time the
server will terminate in response to a stop command. Default
is 60.
<p>
<XMP>
    HouseKeeping    10

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_maxservers_0">
MaxServers</A>

</STRONG>
<DD>
The maximum number of servers that will be spawned to handle page
requests.  If more than MaxServers requests are pending, they will
be queued (within the defined capability of the operating system,
usually 5 pending requests) until the number of active servers goes
below that value.
<p>
<XMP>
    MaxServers     4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mailerrorto_0">
MailErrorTo</A>

</STRONG>
<DD>
The email address that server errors should be sent to. No secure
information will normally be forwarded, so any email address is
fine.  If none is specified, no errors will be mailed.
<p>
<XMP>
    MailErrorTo     webmaster

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_multiserver_0">
MultiServer</A>

</STRONG>
<DD>
If defined to be true, then multiple servers can share the
socket and serve users. Not usable on SGI systems. Default is <EM>no</EM>
<p>
<XMP>
    MultiServer     yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_safeuntrap_0">
SafeUntrap</A>

</STRONG>
<DD>
Sets the codes that will be untrapped in the Safe.pm module, used for
embedded Perl and conditional operations.  You can see the Safe.pm 
documentation by typing 'perldoc Safe' at the command prompt.  The default
is <EM>249 148</EM>, which untraps the file existence test operator
and the sort operator. Define it as blank to not allow any besides
the default restrictive operators.
<p>
<XMP>
    SafeUntrap     249

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sendmailprogram_0">
SendMailProgram</A>

</STRONG>
<DD>
Specifies the program used to send email. Defaults to
'/usr/lib/sendmail'. If it is not found at startup, MiniVend
will complain and refuse to start.
<p>
<XMP>
    SendMailProgram     /bin/mailer

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tcphost_0">
TcpHost</A>

</STRONG>
<DD>
When running in INET mode, using <EM>tlink</EM>, specifies the hosts that are
allowed to send/receive transactions from any catalog on this MiniVend
server. Can be either an name or IP number, and multiple hosts can be
specified in a space-separated list. Default is localhost.
<p>
<XMP>
    TcpHost         localhost secure.domain.com

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tcpport_0">
TcpPort</A>

</STRONG>
<DD>
When running in INET mode, using <EM>tlink</EM>, specifies the port
that will be monitored by the MiniVend server.  Default is 7786.
<p>
<XMP>
    TcpPort         7786

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_catalog_3">
Catalog Configuration File</A>
</H2>
If multiple catalogs are to be run, each must have a 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>

file located in the catalog base directory.  It contains most of
the configurable parameters for MiniVend -- each is independent
from catalog to catalog.
<p>
<H2> 
<A NAME="minivend_required_2">
Required Configuration Directives</A>
</H2>
In the catalog configuration file, these directives are 
<A HREF="minivend.html#minivend_required_1">required</A>
:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_vendurl_0">
VendURL</A>

</STRONG>
<DD>
Specifies the base URL that will run vlink as a cgi-bin program.
<p>
<XMP>
        VendURL  http://machine.company.com/cgi-bin/vlink

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mailorderto_0">
MailOrderTo</A>

</STRONG>
<DD>
Specifies the email address to mail completed orders to.
<p>
<XMP>
        MailOrderTo  orders@xyzcorp.com

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_optional_0">
Optional Configuration Directives</A>
</H2>
These directives all have default values and are optional.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_actionmap_0">
ActionMap</A>

</STRONG>
<DD>
Allows setting of button actions for particular names.  The predefined
names are:
<p>
<XMP>
 cancel   Cancel order and wipe credit card numbers
 control  Control help, colors, etc.
 checkout Call checkout form
 refresh  Refresh order page (update quantities, etc.)
 return   Go to previous page (or page defined in mv_nextpage variable)
 search   Search for an item in the catalog
 set      Update a database
 submit   Submit order or form

</XMP>
<p>Actions are overwritten, even the default ones, if re-defined.  Default
is blank.  Can be set as many times as necessary. Not case sensitive.
<p>
<XMP>
    ActionMap           refresh change
    ActionMap           refresh validate
    ActionMap           cancel erase
    ActionMap           submit next
    ActionMap           control color

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_alwayssecure_0">
AlwaysSecure</A>

</STRONG>
<DD>
Determines whether checkout page operations should always be
secure.  Set it to the pages that should always be secure, separated
by spaces and/or tabs.
<p>
<XMP>
    AlwaysSecure    checkout

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_asciibackend_0">
AsciiBackend</A>

</STRONG>
<DD>
A file name to log order fields in (set by BackendOrder).
Unless preceded by a leading '/', will be placed relative to VendRoot.
If the first character is a '|', it is the name of a program to send the
fields to. Disabled by default.
<p>
<XMP>
    AsciiBackend  |/usr/order/scripts/place_order

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_asciitrack_0">
AsciiTrack</A>

</STRONG>
<DD>
A file name to log formatted orders in. Unless preceded by a leading '/',
will be placed relative to VendRoot.  Disabled by default.
<p>
<XMP>
    AsciiTrack     etc/orders.txt

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_backendorder_0">
BackendOrder</A>

</STRONG>
<DD>
Controls the fields that are prepended to the item codes and quantities
for the backend ordering capability.  These are the values from the
user form in 'order.html'.  You can access any value in that
hash. If blank, no backend ordering is in force. Default is blank.
<p>
<XMP>
     BackendOrder    name,address,city,state,zip,mv_shipmode

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_buttonbars_0">
ButtonBars</A>

</STRONG>
<DD>
The ButtonBars directive allows you to define several preset button bars
that reside in files. The button bar file will usually contain an IMG
link, along with its associated client-side image map.  This allows you
to insert a [buttonbar 1] or [buttonbar 2] directive instead of the
equivalent HTML, and is designed to make it easy to change the look of
your pages with the change of one file. If the file does not exist at
program configuration time, the tag is simply stripped.  The line in the

<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file takes the form of the directive, followed by any
number of vend-style file names (relative to the PageDir, with no .html
suffix).
<p>
<XMP>
    ButtonBars  bars/button0 bars/button1 bars/button2 bars/button3

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_checkoutframe_0">
CheckoutFrame</A>

</STRONG>
<DD>
The frame name where the checkout page will go, if frames are
enabled. Default is ``_top''.
<p>
<XMP>
    CheckoutFrame  _blank

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_checkoutpage_0">
CheckoutPage</A>

</STRONG>
<DD>
The name of the default page to send the user to when the [finish-order]
tag is used. Default is ``order''.  This is overridden in any number of
ways from order forms.
<p>
<XMP>
    CheckoutPage  basket

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_collectdata_0">
CollectData</A>

</STRONG>
<DD>
The points at which to log various data items collected by MiniVend,
such as failed or successful searches.  This allows you to find out what
your customers are searching for and NOT finding -- perhaps you want to
add it, or change your product description to match. Uses something
like the HTTP common log format.
<p>The choices to enter are:
<p>
<XMP>
  matched    Search strings that match
  nomatch    Search strings that fail to match
  page       Pages that are accessed
  nopage     Pages that are not found

</XMP>
<p>Enter as a space or comma-separated list, i.e.
<p>
<XMP>
    CollectData   matched,nomatch,page

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_cookies_0">
Cookies</A>

</STRONG>
<DD>
Determines whether we will send (and read back) a cookie to
get the session ID for links that go outside the catalog.
Allows arbitrary HREF links to be placed in MiniVend pages, while
still saving the contents of the session.
<p>
<XMP>
    Cookies         Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_creditcardauto_0">
CreditCardAuto</A>

</STRONG>
<DD>
If set to <EM>Yes</EM>, enables the encryption and saving of 
credit card information. In order for this to work properly, the
EncryptProgram directive must be set to properly encode the field.  The
best way to set EncryptProgram is with PGP in the ASCII armor mode (the
option set '-feat' is used).
<p>This option uses the following standard fields on MiniVend order
processing forms:
<p>
<XMP>
    mv_credit_card_number      The actual credit card number, which
                               will be wiped from memory if it verifies
                               as a valid Amex, Visa, MC, or Discover
                               card number.
    mv_credit_card_exp_all     The expiration date, as a text field in
                               the form MM/YY (will take a four-digit
                               year as well).  If it is not present,
                               the fields mv_credit_card_exp_month and
                               mv_credit_card_exp_year are looked at. 
                               It is set by MiniVend when the card
                               validation returns, if not previously
                               set.
    mv_credit_card_exp_month   The expiration date month, used if the
                               mv_credit_card_exp_all field is not present.
                               It is set by MiniVend when the card
                               validation returns, if not previously
                               set.
    mv_credit_card_exp_year    The expiration date year, used if the
                               mv_credit_card_exp_all field is not present.
                               It is set by MiniVend when the card
                               validation returns, if not previously
                               set.
    mv_credit_card_error       Set by MiniVend to indicate the error
                               if the card does not validate properly.
                               The error message is not too enlightening
                               if validation is the problem.
    mv_credit_card_info        Set by MiniVend to the encrypted card
                               information if the card validates
                               properly. If PGP is used in ASCII armor
                               mode, this field can be placed on the
                               order report and embedded in the order
                               email, replete with markers. This allows
                               a secure order to be read for content,
                               without exposing the credit card number
                               to risk.
    mv_credit_card_valid       Set by Minivend to true, or 1, if the the
                               card validates properly. Set to 0 otherwise.

</XMP>
<p>PGP is recommended as the encryption program, though you should remember
that US commercial organizations may require a license for RSA.
<p>
<XMP>
    CreditCardAuto     Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_customshipping_0">
CustomShipping</A>

</STRONG>
<DD>
If not blank, enables the addition of shipping charges based on
quantity or weight of items ordered.  See 
<A HREF="minivend.html#minivend_custom_0"><EM>Custom Shipping</EM></A>
.
<p>
<XMP>
    CustomShipping      quantity

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_datadir_0">
DataDir</A>

</STRONG>
<DD>
The location of the extra database files if no path
information is provided. Set to ``products'' as the default, and
is relative to VendRoot if there is no leading slash.
<p>
<XMP>
    DataDir             /user/data

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_database_0">
Database</A>

</STRONG>
<DD>
Definition of an arbitrary database, in the form "Database database file
type``, where ''file" is the name of an ASCII file in the same format as
the products database.  The file is relative to VendRoot, and is put in

<A HREF="minivend.html#minivend_datadir_0">DataDir</A>
 if no path is provided.  Records can be accessed with the
[data database field key] tag. The type is an integer from one to six,
and specifies the format. There can be an unlimited number of
databases defined. See 
<A HREF="minivend.html#minivend_arbitrary_0"><EM>Arbitrary Databases</EM></A>
.
<p>
<XMP>
    Database      BookReviews  reviews.txt   3

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_defaultshipping_0">
DefaultShipping</A>

</STRONG>
<DD>
This sets the default shipping mode by initializing the variable
<EM>mv_ship_mode</EM>. If not set in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
, it is <EM>default</EM>.
<p>
<XMP>
    DefaultShipping     UPS

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_delimiter_0">
Delimiter</A>

</STRONG>
<DD>
One of TAB, PIPE, CSV, or your own custom delimiter. (It is not
suggested that you use a custom delimiter). TAB means a tab-delimited
database (the default if not set), PIPE a pipe-delimited one, and CSV a
quote-comma format.
<p>
<XMP>
    Delimiter           CSV

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_descriptionfield_0">
DescriptionField</A>

</STRONG>
<DD>
The field that will be accessed with the [item-description] element.
<p>
<XMP>
    DescriptionField    ProductDescription

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_descriptiontrim_0">
DescriptionTrim</A>

</STRONG>
<DD>
This sets the text string after which no more of the product
description will be displayed in the search area. This is useful to
clip long descriptions, while still having them available to search.
The default is no trimming.
<p>
<XMP>
    DescriptionTrim     DESCRIPTION:

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_encryptprogram_0">
EncryptProgram</A>

</STRONG>
<DD>
Contains a program command line specification that indicates how an
external encryption program will work. Two placeholders, <CODE><STRONG>%p</STRONG></CODE> and
<CODE><STRONG>%f</STRONG></CODE>, are defined, which are replaced at encryption time with the
password and temporary file name respectively.  See <EM>Order Security</EM>.
<p>This is separate from the 
<A HREF="minivend.html#minivend_pgp_0">PGP</A>
 directive, which enables PGP encryption
of the entire order.
<p>If PGP is the encryption program (MiniVend determines this by searching
for the string <EM>pgp</EM> in the command string), no password field or file
field need be used -- the field mv_credit_card_number will never be
written to disk in that case.
<p>
<XMP>
    EncryptProgram      /usr/local/bin/pgp -feat sales@company.com

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_errorfile_0">
ErrorFile</A>

</STRONG>
<DD>
This is where MiniVend will write its runtime errors for THIS CATALOG
ONLY. It can be shared with other catalogs or the main MiniVend error
log, but if you make it root-based, be careful that you have permission to
write the file, or bad things will happen.
<p>
<XMP>
    ErrorFile   /home/minivend/error.log

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_finishorder_0">
FinishOrder</A>

</STRONG>
<DD>
A text string or image tag which is substituted
for the <EM>[finish_order]</EM> tag.
<p>
<XMP>
    FinishOrder <IMG SRC="/icons/fin_ord.gif" ALT="FINISH ORDER">

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_fractionalitems_0">
FractionalItems</A>

</STRONG>
<DD>
Whether items in the shopping cart should be allowed to be
fractional, i.e. 2.5 or 1.25. Default is no.
<p>
<XMP>
    FractionalItems     Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_frameorderpage_0">
FrameOrderPage</A>

</STRONG>
<DD>
The MiniVend-style page name (i.e. no .html extension, relative
to 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
) which contains the special order page for when frames
are in use.  If not set (the default), the standard order page
will be used. Vaguely deprecated, as multiple order pages are better
set with the 
<A HREF="minivend.html#minivend_mv_orderpage_0"><EM>mv_orderpage</EM></A>
 variable.
<p>
<XMP>
    FrameOrderPage      fr_order

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_framesearchpage_0">
FrameSearchPage</A>

</STRONG>
<DD>
The MiniVend-style page name (i.e. no .html extension, relative
to 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
) which contains the special search page for when frames
are in use.  If not set (the default), the standard search page
will be used. Vaguely deprecated, as multiple search pages are better
set with the 
<A HREF="minivend.html#minivend_mv_search_page_0"><EM>mv_search_page</EM></A>
 variable.
<p>
<XMP>
    FrameSearchPage     fr_resul

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_glimpse_0">
Glimpse</A>

</STRONG>
<DD>
The pathname for the glimpse command, used if glimpse searches
are to be enabled.  If you wish to use <EM>glimpseserver</EM>, you
must include the -C, -J,  and -K tags if they are needed.
<p>
<XMP>
    Glimpse  /usr/local/bin/glimpse -C -J srch_engine -K2345

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_help_0">
Help</A>

</STRONG>
<DD>
The Help directive allows you to define an unlimited number of help
messages or image specifications that reside in a file (or files).
It is called by the [help item] tag, where item is the first line
of a help file entry which looks like:
<p>
<XMP>
 help1
 This is help item one. It ends after a blank line, and
 is called by a [help help1] element embedded in a MiniVend page.
 
 help2
 This is help item two.  It ends after a blank line, and
 is called by a [help help2] element embedded in a MiniVend page.

</XMP>
<p>If the file (or the entry) does not exist at program configuration time,
the tag is simply stripped.  The line in the 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file takes
the form of the directive, followed by any number of vend-style file
names (relative to the PageDir, with no .html suffix). See the demo
for an example of how it is used.
<p>
<XMP>
    Help  help/hintfile

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_imagedir_0">
ImageDir</A>

</STRONG>
<DD>
The directory where all <EM>relative</EM> IMG and INPUT source file
specifications are based.  IT MUST HAVE A TRAILING / TO WORK.  If the
images are to be in the DocumentRoot (of the HTTP server or virtual
server) subdirectory <EM>images</EM>, for example, you would use the ImageDir
specification '/images/'. This would change SRC=``order.gif'' to
SRC=``/images/order.gif'' in IMG and INPUT tags.  It has no effect on
other SRC tags.
<p>
<XMP>
    ImageDir /images/

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_itemlinkdir_0">
ItemLinkDir</A>

</STRONG>
<DD>
The directory where the [item_link] tag will base all of its
hot links in, relative to the pages directory. The default is blank,
basing all links in the pages directory.  If set, it needs
a trailing '/' to operate properly.
<p>
<XMP>
    ItemLinkDir     partno/

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_itemlinkvalue_0">
ItemLinkValue</A>

</STRONG>
<DD>
Specifies the text or image you want to use to provide a clickable
link to the catalog page when using the [item_link] tag (in the
search form, or other forms).
<p>
<XMP>
    ItemLinkValue   <IMG SRC="/images/gopage.gif" ALT="GO TO PAGE">

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_locale_0">
Locale</A>

</STRONG>
<DD>

<XMP>
    
Sets the special locale array. Tries to use POSIX setlocale based
on the value of itself, then tries to accept a 'custom' setting with
the proper definitions of decimal_point and mon_thousands_sep, which
are the the only international settings required.  Default if not
set is to use US-English settings.  

</XMP>
<p>Example of the custom setting:
<p>
<XMP>
    Locale     custom decimal_point , mon_thousands_sep .

</XMP>
<p>Example of POSIX setlocale for France, if properly aliased:
<p>
<XMP>
    Locale     fr

</XMP>
<p>See setlocale(3) for more information.  If embedded Perl code
is used to sort search returns, then the <EM>setlocale()</EM> will carry
through to string collation.
<p>
<DT><STRONG>

<A NAME="minivend_logfile_0">
LogFile</A>

</STRONG>
<DD>
A file where user pages accesses and search specifications will
be logged if CollectData is set. Defaults to 'etc/log'.
<p>
<XMP>
    LogFile        etc/log

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_masterhost_0">
MasterHost</A>

</STRONG>
<DD>
The IP address that can reconfigure the catalog. Default is blank,
disabling remote check of IP address.
<p>
<XMP>
    MasterHost    10.10.10.1

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mixmatch_0">
MixMatch</A>

</STRONG>
<DD>
A setting of no says that quantity price breaks will be on TOTAL
quantity, yes says that quantity price breaks are on a per-item quantity.
Default is no.
<p>
<XMP>
    MixMatch        yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_msqldb_0">
MsqlDB</A>

</STRONG>
<DD>
Sets the name of the mSQL database (must be present on the default
server).  Defaults to <EM>minivend</EM>.
<p>
<XMP>
    MsqlDB          catalog

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_msqlproducts_0">
MsqlProducts</A>

</STRONG>
<DD>
Determines whether mSQL will be used for the products database.
Default is no. 
<p>
<XMP>
    MsqlProducts    Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_background_0">
Mv_Background</A>

</STRONG>
<DD>
Sets the background patterns to be used in the color schemes.  The 
line must begin with 'BEGIN', then is followed by up to 15 pattern
URLs containing background patterns to be used with the color schemes.
Each pattern should be separated by one or more spaces.
set to 0 to disable a background pattern for a particular scheme.
Remember, the schemes are numbered in the order that they occur.
<p>
<XMP>
    Mv_Background BEGIN /images/blue_pap.gif 0 /images/temple.jpg

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_bgcolor_0">
Mv_BgColor</A>

</STRONG>
<DD>
Sets the background colors to be used in the color schemes.  The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for background color. The specification can be in #RRGGBB
color format, or can be one of the colors that will be recognized
(steelblue, white, etc.) Each color should be separated by one or more
spaces.  Set to 'none' to disable a color (use the browser default) for
a particular scheme.  Remember, the schemes are numbered in the order
that they occur.
<p>
<XMP>
    Mv_BgColor BEGIN  steelblue none white

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_linkcolor_0">
Mv_LinkColor</A>

</STRONG>
<DD>
Sets the link colors to be used in the color schemes.  The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for link color. The specification can be in #RRGGBB
color format, or can be one of the colors that will be recognized
(steelblue, white, etc.) Each color should be separated by one or more
spaces.  Set to 'none' to disable a color (use the browser default) for
a particular scheme.  Remember, the schemes are numbered in the order
that they occur.
<p>
<XMP>
    Mv_LinkColor BEGIN  ltgreen none red

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_textcolor_0">
Mv_TextColor</A>

</STRONG>
<DD>
Sets the text colors to be used in the color schemes. The colors are
accessed with the [body n] tag, where n is the color scheme number. The
line must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for text color. The specification can be in #RRGGBB color
format, or can be one of the colors that will be recognized (steelblue,
white, etc.) Each color should be separated by one or more spaces.  Set
to 'none' to disable a color (use the browser default) for a particular
scheme.  Remember, the schemes are numbered in the order that they
occur, beginning with 1.
<p>
<XMP>
    Mv_TextColor BEGIN  white none black

</XMP>
<p>
<DT><STRONG>
<EM>Mv_VlinkColor </EM>
</STRONG>
<DD>
Sets the visited link colors to be used in the color schemes. The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for visited link color.  The specification can be in
#RRGGBB color format, or can be one of the colors that will be
recognized (steelblue, white, etc.) Each color should be separated by
one or more spaces. Set to 'none' to disable a color (use the browser
default) for a particular scheme. Remember, the schemes are numbered in
the order that they occur.
<p>
<XMP>
    Mv_VlinkColor BEGIN  orange none blue

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_nontaxablefield_0">
NonTaxableField</A>

</STRONG>
<DD>
The name of the field in the products database that is set (to 1 or yes)
if an item is not to be taxed. Will log an error and tax it anyway
if the field doesn't exist in the database.  Blank by default, disabling
the feature.
<p>
<XMP>
    NonTaxableField    wholesale

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_offlinedir_0">
OfflineDir</A>

</STRONG>
<DD>
The location of the offline database files for use with the MiniVend
offline database build command.  Set to ``offline'' as the default, and
is relative to VendRoot if there is no leading slash.
<p>
<XMP>
    OfflineDir          /usr/data/minivend/offline

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_ordercounter_0">
OrderCounter</A>

</STRONG>
<DD>
The name of the file (relative to VendRoot if no leading /) that
maintains the order number.  The number is guaranteed to be unique
for every order.
<p>
<XMP>
    OrderCounter       etc/order.number

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_orderframe_0">
OrderFrame</A>

</STRONG>
<DD>
The frame name where the order page will go, if frames are enabled.
If the frame doesn't exist, a new frame will be created.  The default
is '_top', which fills the browser window with the page.
<p>
<XMP>
    OrderFrame          _blank

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_orderprofile_0">
OrderProfile</A>

</STRONG>
<DD>
Allows an unlimited number of order profiles to be set up, specifying
complex checks to be performed at each of the steps in the checkout process.
<p>The files specified can be located anywhere -- if relative paths
are used, they are relative to the catalog root directory.
<p>
<XMP>
    OrderProfile    prof/order0 prof/order1 prof/order2

</XMP>
<p>They are accessed by setting the <EM>mv_order_profile</EM> variable to the
number of the order profile, starting at 0.  Multiple profiles can
reside in the same file, if separated by __END__ tokens, which must be
on a line by themselves.
<p>The profile may be named by placing a name following a __NAME__
pragma:
<p>
<XMP>
  __NAME__ billing

</XMP>
<p>The __NAME__ must begin the line, and be followed by whitespace
and then the name.  The search profile can then be accessed by
<EM>mv_order_profile=``billing''</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_orderreport_0">
OrderReport</A>

</STRONG>
<DD>
The location of the simple order report file. Defaults
to <EM>etc/report</EM>.  Not used frequently in later MiniVends, as the
custom order report file is much more flexible.
<p>
<XMP>
    OrderReport          /data/order-form

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pagedir_0">
PageDir</A>

</STRONG>
<DD>
Location of catalog pages. Defaults to the pages subdirectory in the
VendRoot directory.
<p>
<XMP>
    PageDir             /data/catalog/pages

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pgp_0">
PGP</A>

</STRONG>
<DD>
If credit card information is to be accepted, and the emailed order
will go over an insecure network to reach its destination, PGP security
should be used.  The key ring to be used must be for the user that is
running the MiniVend server, and the key user specified must have
a key on the public key ring of that user.
<p>
<XMP>
    PGP             /usr/local/bin/pgp -feat orders@company.com

</XMP>
<p>If this directive is non-null, PGP will be used to encrypt the order,
the stored orders on disk, and the backend order string sent to
an external file or program. If for some reason an error comes from
PGP, the customer will be given the special page 'failed'.
<p>
<DT><STRONG>

<A NAME="minivend_pageselectfield_0">
PageSelectField</A>

</STRONG>
<DD>
Sets a products database column which can be used to select the
on-the-fly template page.  This allows multiple on-the-fly pages to
be defined.  If the field is empty (no spaces, either!) then the default
<flypage&gt; will be used.
<p>
<XMP>
    PageSelectField    display_page

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_password_0">
Password</A>

</STRONG>
<DD>
The encrypted password that, when entered and sent as
RECONFIGURE_MINIVEND by the reconfigure program, will be checked
against the user entry to enable reconfiguration.
<p>If you use MiniVend's htpasswd.pl (from 2.03 or higher) it will write
the catalog configuration file if given 'catalog.cfg' as the file
name. The demo starts with an encrypted blank password, allowing you
to just hit enter.
<p>
<XMP>
    Password                bAWoVkuzphOX.

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pricebreaks_0">
PriceBreaks</A>

</STRONG>
<DD>
The quantities where price breaks should be placed.  Used to set
up the pricing.asc entries to match actual pricing. Unlimited number
of breaks -- only enter the lowest quantity it applies to.
<p>
<XMP>
    PriceBreaks         10 25 50 100 1000

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pricecommas_0">
PriceCommas</A>

</STRONG>
<DD>
If you desire no commas in your price numbers (for the [item_price] tag)
set this to 'no'. The default is to put commas in.
<p>
<XMP>
    PriceCommas         no

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pricedivide_0">
PriceDivide</A>

</STRONG>
<DD>
The number the price should be divided by to get the price
in units (dollars or such). The default is one -- if you use
penny pricing you can set it to 100.
<p>
<XMP>
    PriceDivide         100

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pricefield_0">
PriceField</A>

</STRONG>
<DD>
The field in the product database that will be accessed with
the [item-price] element. Default is ``price''.
<p>
<XMP>
    PriceField          ProductPrice

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_productdir_0">
ProductDir</A>

</STRONG>
<DD>
Location of the product files. Defaults to the products subdirectory
of the VendRoot directory.
<p>
<XMP>
    ProductDir          /data/catalog/for-sale

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_random_2">
Random</A>

</STRONG>
<DD>
The Random directive allows you to define an unlimited number of random
messages or image specifications that reside in files. It is called by
the [random] tag.  You don't know which one will show up! Even I don't,
it is random.  If the file does not exist at program configuration time,
the tag is simply stripped.  The line in the 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file takes
the form of the directive, followed by any number of vend-style file
names (relative to the PageDir, with no .html suffix).
<p>
<XMP>
    Random  rand/message1 rand/message2 rand/message3 rand/message4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_readpermission_0">
ReadPermission and WritePermission</A>

</STRONG>
<DD>
By default, only the user account that MiniVend runs under (as set by the
setuid permission on svend) can read and write files created by MiniVend.
WritePermission and ReadPermission can be set to 'user', 'group', or
'world'.
<p>
<XMP>
    ReadPermission      group
    WritePermission     group

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_receiptpage_0">
ReceiptPage</A>

</STRONG>
<DD>
The page to be displayed as a receipt after the user has submitted
an order. Replaces the standard 'confirmation' page.  Blank by
default, showing no receipt page to the user.  Overridden by the
value of <EM>mv_order_receipt</EM>.
<p>
<XMP>
    ReceiptPage         receipt

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_remoteuser_0">
RemoteUser</A>

</STRONG>
<DD>
The value of the HTTP environment variable REMOTE_USER that will
enable catalog reconfiguration. You need to enable HTTP basic
authentication for this to work. Default is blank, disabling this
check.
<p>
<XMP>
    RemoteUser   Billyboy

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_reportignore_0">
ReportIgnore</A>

</STRONG>
<DD>
A comma-separated list of items you don't want to have sent by email on
the order report. Default is blank, or none. Fields beginning with
'mv_', the MiniVend special variables, are automatically ignored.
<p>
<XMP>
    ReportIgnore        credit_card_no

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_requiredfields_0">
RequiredFields</A>

</STRONG>
<DD>
A comma-separated list of items you want to make sure the customer fills
in before an order can be submitted.  If an empty field is found when
the customer submits the order, the special page 
<A HREF="minivend.html#minivend_needfield_0">needfield.html</A>
 will
be displayed to request that they enter the information. No default.  If
custom order profiles are used, this is only done upon the final
placement of the order.
<p>
<XMP>
    RequiredFields      name,company,email,address,city,state,zip

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_rotate_0">
Rotate</A>

</STRONG>
<DD>
The Rotate directive allows you to define an unlimited number of rotating
messages or image specifications that reside in files. It is called by
the [rotate] tag.  If the file does not exist at program configuration time,
the tag is simply stripped.  The line in the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file takes
the form of the directive, followed by any number of vend-style file
names (relative to the PageDir, with no .html suffix).
<p>
<XMP>
    Rotate  rotate/banner1 rotate/banner2 rotate/banner3 rotate/banner4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_salestax_2">
SalesTax</A>

</STRONG>
<DD>
If non-blank, enables automatic addition of sales tax based on the order
form.  The value is a comma-separated list of the field names (as placed
in order.html), in priority order, which should be used to look up sales
tax percentage in the salestax.asc database. This database is not
supplied with MiniVend -- it is typically received from a third party by
quarterly or monthly subscription.
<p>
<XMP>
    SalesTax            zip,state

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_scratchdir_0">
ScratchDir</A>

</STRONG>
<DD>
The directory where scratch files will be written, notably cached
searches. Defaults to VendRoot/etc.
<p>
<XMP>
    ScratchDir          /tmp

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchcache_0">
SearchCache</A>

</STRONG>
<DD>
A file name (the appropriate DBM extension will be added) to store
search cache in, enabling search cache in the process.  Relative to
the catalog directory if not an absolute path.
<p>
<XMP>
    SearchCache         etc/search_cache

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchframe_0">
SearchFrame</A>

</STRONG>
<DD>
The frame name where search results will go, if frames are enabled.
If the frame doesn't exist, a new frame will be created.  The default
is '_self'.
<p>
<XMP>
    SearchFrame         main

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchovermsg_0">
SearchOverMsg</A>

</STRONG>
<DD>
A string that is substituted for a [search_over_msg] tag, used to
indicate that the search engine returned more than the number
of items it was limited to. 
<p>
<XMP>
    SearchOverMsg       You had more than

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchprofile_0">
SearchProfile</A>

</STRONG>
<DD>
Allows an unlimited number of search profiles to be set up, specifying
complex searches based on a single click. Takes a series of MiniVend
variable specifications.
<p>As an added measure of control, the specification is evaluated with the
special MiniVend [if area value ....]value[else]other value[/else][/if]
syntax to provide conditional setting of search parameters.
<p>The following file specifies a dictionary-based search in the file
'dict.product':
<p>
<XMP>
        mv_search_file=dict.product
        mv_return_fields=1
        [if value fast_search]
            mv_dict_limit=-1
            mv_last=1
        [/if]

</XMP>
<p>The search profiles are specified in the same manner as the

<A HREF="minivend.html#minivend_buttonbars_0">ButtonBars</A>
 directive, with files to be located in the MiniVend page
tree and read <EM>at program startup</EM>. If you change a search profile, you
must stop and start MiniVend to have the changes take effect.
<p>
<XMP>
    SearchProfile    srch/search0 srch/search1 srch/search2

</XMP>
<p>They are accessed by setting the 
<A HREF="minivend.html#minivend_mv_profile_0"><EM>mv_profile</EM></A>
 variable to the number
of the search profile, starting at 0.  Multiple profiles can reside in
the same file, if separated by __END__ tokens, which must be on a line
by themselves.
<p>
<DT><STRONG>

<A NAME="minivend_secureurl_0">
SecureURL</A>

</STRONG>
<DD>
The base URL for secure forms/page transmissions.  Normally it is
the same as 
<A HREF="minivend.html#minivend_vendurl_0">VendURL</A>
 except for the <EM>https:</EM> protocol definition.
Default is blank, disabling secure access.
<p>
<XMP>
    SecureURL   https://machine.com/xyzcorp/cgi-bin/vlink

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sendmailprogram_0">
SendMailProgram</A>

</STRONG>
<DD>
The location of the sendmail binary, needed for mailing orders.
Must be found at startup.  This often needs to be set for FreeBSD
or BSDI.
<p>
<XMP>
   SendMailProgram    /usr/sbin/sendmail

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_separateitems_0">
SeparateItems</A>

</STRONG>
<DD>
Changes the default when ordering an item via MiniVend to allowing multiple
lines on the order form for each item.  The default, <EM>No</EM>, puts all
orders with the same part number on the same line. 
<p>Setting SeparateItems to <EM>Yes</EM> allows the item attributes to be
easily set for different instances of the same part number, allowing
easy setting of things such as size or color.
<p>
<XMP>
    SeparateItems       Yes

</XMP>
<p>Can be overridden with the <EM>mv_separate_items</EM> variable.
<p>
<DT><STRONG>

<A NAME="minivend_sessiondatabase_0">
SessionDatabase</A>

</STRONG>
<DD>
When storing sessions in a DBM database, specify the base name of the
DBM file to use. The file extensions of .pag, .dir, .db, or .gdbm
(depending on the DBM implementation used) will be appended.
<p>
<XMP>
    SessionDatabase     session-data

</XMP>
<p>Starting at MiniVend 2.0, it is possible for multiple catalogs to share
the same session file.  This allows a ``mall'' to be set up where many
storefronts use a common ordering point.  It would be wise to share the
order pages, salestax database,  and shipping database if that is the
case.  You will also need to set 
<A HREF="minivend.html#minivend_sessionlockfile_0">SessionLockFile</A>
 appropriately if the
database is to be shared.  Defaults to 'session', which is appropriate
for separate session files (and therefore standalone catalogs). Can be
an absolute path name if desired.
<p>
<DT><STRONG>

<A NAME="minivend_sessionexpire_0">
SessionExpire</A>

</STRONG>
<DD>
A customer can exit their browser or leave the catalog pages at any
time, and no indication is given to the HTTPD server aside from the
lack of further requests that have the same session id. Old session
information needs to be periodically expired. The SessionExpire
specifies the minimum time to keep track of session information.
Defaults to one day.
<p>
<XMP>
    SessionExpire       4 hours

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sessionlockfile_0">
SessionLockFile</A>

</STRONG>
<DD>
The file to use for locking coordination of the sessions.
<p>
<XMP>
    SessionLockFile     session-data.lock

</XMP>
<p>It is possible for multiple catalogs to share the same session file.
You will also need to set 
<A HREF="minivend.html#minivend_sessiondatabase_0">SessionDatabase</A>
 appropriately if the
database is to be shared. Defaults to 'session.lock', which is
appropriate for separate session files (and therefore standalone
catalogs). Can be an absolute path name if desired.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_2">
Shipping</A>

</STRONG>
<DD>
Specifies a shipping charge to add onto the total price for items
ordered. If you do not want to include a fixed shipping charge on the
order page, leave this 0 and do not include the [shipping] element in
the order page. Defaults to 0.  Overridden by the 
<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>

directive.
<p>
<XMP>
    Shipping            5.00

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_specialpage_0">
SpecialPage</A>

</STRONG>
<DD>
Sets a special page to other than its default value. Can be set as
many times as necessary -- will have no effect if not one of the
MiniVend 
<A HREF="minivend.html#minivend_required_0"><EM>Required Pages</EM></A>
.
<p>
<XMP>
    SpecialPage         checkout ord/checkout
    SpecialPage         failed special/error_on_order
    SpecialPage         interact special/browser_problem
    SpecialPage         noproduct special/no_product_found
    SpecialPage         order  ord/basket
    SpecialPage         search srch/results

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticpath_0">
StaticPath</A>

</STRONG>
<DD>
The path (relative to HTTP document root) which should be used
in references built by and referred to by the [static] tag and
the page-building capability of MiniVend.
<p>
<XMP>
     StaticPath   /catalog/items

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sub_1">
Sub</A>

</STRONG>
<DD>
Defines a catalog subroutine for use by the B<[perl sub] subname
arg [/perl]&gt; construct. Use the ``here document'' capability of MiniVend
configuration files to make it easy to define:
<p>
<PRE>
    Sub &lt;&lt;EOF
    sub sort_cart {
        my(%items) = @_;
        my($item,$name);
        my $out = '&ltTABLE BORDER=1>';
        foreach $name (sort keys %items) {
            $out .= '&lt;TR>&lt;TD>';
            $out .= $items{$name};
            $out .= '&lt;/TD>&lt;TD>';
            $out .= $name;
            $out .= '&lt;/TD>&lt;/TR>';
        }
        $out .= '&lt/TABLE>';
        return $out;
    }
    EOF

</PRE>
<p>As with Perl ``here documents'', the EOF (or other end marker) must be the
ONLY thing on the line, with no leading or trailing white space. Do not
append a semicolon to the marker.
<p>The above would be called with:
<p>
<XMP>
    [perl sub]
        sort_cart ( [item-list]
                        "[item-description]", "[item-code]",
                    [/item-list] )
    [/perl] 

</XMP>
<p>and will display an HTML table of the items in the current shopping cart,
sorted by the description. (Using an alternative form of quoting such
as q{ } will minimize problems with quotes in the passed parameters --
you may use any style you like, including here documents. Syntax errors
will be reported to <EM>error.log</EM>.)
<p>Catalog subroutines may not perform unsafe operations -- the <EM>Safe.pm</EM>
module enforces this.
<p>
<DT><STRONG>

<A NAME="minivend_taxshipping_0">
TaxShipping</A>

</STRONG>
<DD>
A comma or space separated list of states or jurisdictions that
tax shipping cost, i.e. UT. Blank by default, never taxing shipping.
<p>
<XMP>
    TaxShipping         UT,NV,94024

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tracking_1">
Tracking</A>

</STRONG>
<DD>
Enables order and popularity tracking when entered, as well as enabling
password and credit card encryption for order security (in combination
with the 
<A HREF="minivend.html#minivend_encryptprogram_0">EncryptProgram</A>
 directive). Its value is the initial order
number that will be used as the beginning key for orders in the tracking
database. See <EM>Tracking and Backend Order Entry</EM> and <EM>Order Security</EM>.
<p>
<XMP>
    Tracking            Order100001

</XMP>
<p>Most users now use the simpler and more flexible 
<A HREF="minivend.html#minivend_easy_0"><EM>Easy ASCII Tracking</EM></A>

capability.
<p>
<DT><STRONG>

<A NAME="minivend_upszonefile_0">
UpsZoneFile</A>

</STRONG>
<DD>
The file containing the UPS zone information,  specified relative to the
catalog directory unless it begins with a /. The file containing
the zone information should be in a tab-delimited format, with the
three-letter zip prefix of the customer used to determine the zone.  It
interpolates based on the value in <EM>mv_shipmode</EM>. A user database
<STRONG>named the same as the mv_shipmode variable</STRONG> must be present or the
lookup will return zero.
<p><IMPORTANT NOTE:&gt; You must obtain the zone information and updated
pricing from UPS in order for this to work properly.  The zone information
is specific to your region!
<p>
<XMP>
    UpsZoneFile         /usr/minivend/data/ups_zone.asc

</XMP>
<p>See the sample demo for an implementation -- the zone file in use
is for Denver, CO and environs.
<p>
<DT><STRONG>

<A NAME="minivend_usecode_0">
UseCode</A>

</STRONG>
<DD>
This determines whether the part number field in the ASCII product file
will be used to determine the link to the item for the [item_link] tag.
If set, this has the effect of creating a different HTML page link for
every part number.  If not set (the default), the [item_link] tag
uses the value of the last field in the ASCII product file as the link
value.  This option is largely deprecated by the on-the-fly page building
facility.
<p>
<XMP>
    UseCode             yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_usemodifier_0">
UseModifier</A>

</STRONG>
<DD>
Determines whether any attributes, the modifiers specified in the
directive, can be attached to the item. See <EM>Item Attributes</EM>.  The
default is no modifier. Don't use a value of 'quantity' -- it will not
do what you want.
<p>
<XMP>
    UseModifier         size,color

</XMP>
<p>
</DL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_administering_0">
ADMINISTERING MINIVEND</A>
</H1>
Many utilities are supplied in the VendRoot/bin directory:
<p>
<XMP>
  start        Symbolic link to start_unix or start_inet
  stop         Stops the server
  start_inet   Starts the server in INET mode
  start_unix   Starts the server in UNIX mode
  restart      Symbolic link to restart_unix or restart_inet
  restart_inet Re-starts the server in INET mode
  restart_unix Re-starts the server in UNIX mode
  dump         Dumps the session file for a particular catalog
  expire       Expires sessions for a particular catalog
  reconfig     User runtime reconfiguration of catalog
  submitter    Template script for Cybercash or other backends
  checkstat.sh Template script to monitor server upness
  htpasswd.pl  Program to create .htpasswd files
  offline      Does offline build of the database(s)
  buildtree    Builds static page trees from the database
  makecat      Make catalog (calls one of the below)
  make_isp     Make catalog as root user for multiple user names
  make_user    Make catalog as regular user
  make_virtual Make catalog on virtual domain

</XMP>
<p>Some thought should be given to where the databases, error logs,
and session files should be located, especially on an ISP that
might have multiple users sharing a MiniVend server.  In
particular, you might put all of the session files and logs
in a directory that is not writable by the user -- if the
directory or file is corrupted the server may go down.
<p>To test the format of user catalog configuration files before
restarting the server, you can do (from VendRoot):
<p>
<XMP>
    perl -w minivend.pl -test

</XMP>
<p>That will check all configuration files for syntax errors, which
might otherwise prevent a catalog from coming up.  Once a catalog
configures properly, user reconfiguration will not crash it, just
cause an error. But it must come up when the server is started.
<p>
<H2> 
<A NAME="minivend_starting_0">
Starting, Stopping, and Re-starting the Servers</A>
</H2>
The following commands assume that you made /home/minivend
your MiniVend base directory.
<p>To start the server:
<p>
<XMP>
    /home/minivend/bin/start

</XMP>
<p>Assuming the server starts correctly, you will see the names of
catalogs as they are configured, along with a message stating
the process ID it is running under.
<p>To re-start the server:
<p>
<XMP>
    /home/minivend/bin/restart

</XMP>
<p>This is typically done to force MiniVend to re-read its configuration.
You will see a message stating that a TERM signal has been sent to the
process ID the servers are running under -- that information is also
sent to /home/minivend/error.log.  Check the error.log file for
confirmation that the server has restarted properly.
<p>To stop the server:
<p>
<XMP>
    /home/minivend/bin/stop

</XMP>
<p>You will see a message stating that a TERM signal has been sent to
the process ID the server is running under -- that information is also sent
to /home/minivend/error.log.  
<p>Because processes waiting for selection on some operating systems block
signals, they may have to wait for 
<A HREF="minivend.html#minivend_housekeeping_0">HouseKeeping</A>
 seconds to stop. The
default is 60.
<p>
<H2> 
<A NAME="minivend_unix_0">
UNIX and INET modes</A>
</H2>
As of MiniVend 2.03, either UNIX-domain (the default) or INET-domain
sockets can be used for communication. INET domain sockets are useful
when more than one server, connected via a local-area network (LAN),
is used for accessing a MiniVend server.
<p><STRONG>IMPORTANT NOTE:</STRONG> When sending sensitive information like credit card
numbers over a network, always ensure that the data is secured by a firewall,
or that the MiniVend server runs on the same machine as any SSL-based
server used for encryption.
<p>To make the INET server the default, run the following commands
(again assuming /home/minivend is your MiniVend root directory):
<p>
<XMP>
    cd /home/minivend   # Change to MiniVend root
    cd bin
    rm start restart
    ln -s start_inet start
    ln -s restart_inet restart
    cd ..
    cp src/vlink src/vlink.real
    cp src/tlink src/vlink

</XMP>
<p>To make the UNIX server the default once again, run the following
commands to reverse the process:
<p>
<XMP>
    cd /home/minivend   # Change to MiniVend root
    cd bin
    rm start restart
    ln -s start_unix start
    ln -s restart_unix restart
    cd ..
    cp src/vlink.real src/vlink

</XMP>
<p>
<H2> 
<A NAME="minivend_user_0">
User reconfiguration</A>
</H2>
The individual catalogs can be reconfigured by the user by running
the reconfig command.  At least one check must be made to authenticate --
by coming from a particular host (see 
<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
), having validated
by HTTP basic authorization (see 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>
), or by password entry
(see 
<A HREF="minivend.html#minivend_password_0">Password</A>
).  The ideal way to use it is in combination with
HTTP basic authorization to allow remote reconfiguration by web
browser.  It is possible at that point to have a completely FTP-
and HTTP-configured catalog.
<p>A <EM>reconfig</EM> script is included with the demo catalogs, set up
with the 
<A HREF="minivend.html#minivend_password_0">Password</A>
 method of authentication and a blank password,
suitable for the user to reconfigure the catalog from a Unix shell.
To set it up as a CGI, use the 
<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
 or 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>

authentication methods.
<p>
<H2> 
<A NAME="minivend_static_1">
Static page trees</A>
</H2>
You can build a complete static page tree for a particular
catalog with this command:
<p>
<XMP>
    buildtree <catalog> [output-dir]

</XMP>
<p>You must specify a valid catalog to build. If you wish the page tree
to go to a specific directory, you specify it as the next and
optional parameter.
<p>The page build iterates through every page in the pages directory, and
every part number in the database (using the on-the-fly page build), and
builds a page in regular HTML.  All regular page references are converted
to HREFs, except for search, scan, and order references which are kept
relative to VendURL.  This allows you to build static page trees that,
in combination with cookies, can serve many pages via HTTP without parsing
from MiniVend.  It can also build page trees that are scannable by a search
engine spider.
<p>
<H2> 
<A NAME="minivend_making_0">
Making the Product Database</A>
</H2>
The DBM product databases can be built offline with the <EM>offline</EM>
command.  The directory to be used for output is specified either on
the command line with the -d option, or is taken from the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>

directive 
<A HREF="minivend.html#minivend_offlinedir_0">OfflineDir</A>
 -- <EM>offline</EM> in the catalog directory by default.
The directory must exist.  The source ASCII files should be present in
that directory, and the DBM files are created there.  Existing files
will be overwritten.
<p>
<XMP>
    offline -c catalog [-d offline_dir]

</XMP>
<p>
<H2> 
<A NAME="minivend_expiring_0">
Expiring Sessions</A>
</H2>
You should periodically expire old sessions to keep the session
database file from growing too large. 
<p>
<XMP>
    expire -c catalog

</XMP>
<p>You could add a crontab entry such as the following:
<p>
<XMP>
    # once a day at 4:40 am
    40 4 * * *    perl /home/minivend/bin/expire -c catalog

</XMP>
<p>MiniVend will wait until the current transaction is finished before
expiring, so you can do this at any time without disabling web access.
Any search paging files for the affected session (kept in 
<A HREF="minivend.html#minivend_scratchdir_0"><EM>ScratchDir</EM></A>
)
will be removed as well.
<p><p><hr>

<H1> 
<A NAME="minivend_manual_0">
MANUAL INSTALLATION OF CATALOGS</A>
</H1>
<STRONG>NOTE:</STRONG> The installation procedure is complex.  It is B<HIGHLY
RECOMMENDED&gt; that you use the supplied <EM>makecat</EM> scripts.
<p>The MiniVend installation is complex, and requires quite a few distinct
steps.  That is why there is an interactive configuration script that is
included with MiniVend -- it merely does automatically what is described
below. It makes the process much easier, and will install the demo
catalog. This configuration script has been tested on many UNIX systems.
Please report problems to &lt;<A HREF="MAILTO:mikeh@iac.net">mikeh@iac.net</A>&gt;.
<p>
<H2> 
<A NAME="minivend_needed_0">
Needed Directories</A>
</H2>
The MiniVend program, and its supporting libraries, should all
go into one directory.
<p>User catalog pages, user databases, and user configuration files should
all go into their private directories. Because the catalog pages are
served through the MiniVend cgi-bin program and contain nonstandard
elements, they should not be put into a public WWW directory, nor do
they need to have world-readable file permissions.
<p><STRONG>IMPORTANT NOTE</STRONG>: As of MiniVend 2.0, since catalogs are all run
under one server, permissions are complex and very important.
Please let the MiniVend configuration program do the work!
<p>You will want a public WWW directory for in-line image graphic files.
MiniVend does not serve the images, only the HTML tags calling them. A
useful convention is to place all buttonbars, backgrounds, and icons in
the /images directory, with the catalog items perhaps located in the
/images/catalog directory.  It is up to you, but remember that you must
use an <EM>absolute path</EM> -- relative paths will not do. MiniVend 2.0
supports the 
<A HREF="minivend.html#minivend_imagedir_0">ImageDir</A>
 directive, which places that as the
absolute path in front of all relative IMG and INPUT SRC specifications.
<p>You will need a cgi-bin directory in which to put the vlink or svend program.
<p>
<H2> 
<A NAME="minivend_the_9">
The Demo Systems</A>
</H2>
The products directory contains a sample product file and the file
report in the main directory is the sample order report.  Sample catalog
pages are in the directories sample/ and simple/. If you would like to
use them as a starting point for your own catalog, you can either have
the configure script install the demo for you, or you can copy the
sample files into the MiniVend directory and your HTML directory, which
for these examples is assumed to be /usr/local/etc/httpd/htdocs.
<p>To install the full-featured demo:
<p>
<XMP>
 bin/makecat sample

</XMP>
<p>Answer the prompts supplied by the program.  Note that there are
two types of paths asked for, URL paths like the /cgi-bin inside
<A HREF="http://www.machine.com/cgi-bin/sample">http://www.machine.com/cgi-bin/sample</A>, and file paths that are
complete fully-qualified Unix path names.
<p>To install the simple demo:
<p>
<XMP>
 bin/makecat sample

</XMP>
<p>
<H2> 
<A NAME="minivend_setting_4">
Setting up VLINK</A>
</H2>
The 
<A HREF="minivend.html#minivend_vlink_0">vlink</A>
 program, compiled from 
<A HREF="minivend.html#minivend_vlink_0">vlink.c</A>
, is a small C program
which is setuid to the user account which can access the catalog data
files, and contacts a running MiniVend daemon. It is normally not
necessary for the user to do anything -- it will be compiled by the
configuration program. If the MiniVend daemon is not running, it will
display a message indicating that the server is not available.
The following defines at the beginning of 
<A HREF="minivend.html#minivend_vlink_0">vlink.c</A>
 should be set:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_link_file_0">
LINK_FILE</A>

</STRONG>
<DD>
Set this to the name of the socket file that will be used for
configuration, usually ``/usr/local/lib/minivend/etc/socket'' or the
``etc/socket'' under the directory you chose for the VendRoot.
<p>
<DT><STRONG>

<A NAME="minivend_link_timeout_0">
LINK_TIMEOUT</A>

</STRONG>
<DD>
Set this to the number of seconds vlink should wait before announcing
that the MiniVend server is not running.  The default of 45 is probably
a reasonable value.
<p>
<H2> 
<A NAME="minivend_setting_5">
Setting up TLINK</A>
</H2>
The <EM>tlink</EM> program, compiled from <EM>tlink.c</EM>, is a small C program
which talks via a TCP/Internet-domain socket with a MiniVend server
running in INET mode.
<p><STRONG>IMPORTANT NOTE:</STRONG> The server must be started in INET mode (with
the <EM>start_inet</EM> script) to operate with <EM>tlink</EM>.
<p>It is normally not
necessary for the user to do anything -- it will be compiled by the
configuration program. The following defines at the beginning
of <EM>tlink.c</EM> should be set:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_link_port_0">
LINK_PORT</A>

</STRONG>
<DD>
Set this to the TCP port number that the MiniVend server will monitor.
The default is 7786 (the ASCII codes for 'M' and 'V') and does not
normally need to be changed. 
<p>
<DT><STRONG>

<A NAME="minivend_link_timeout_0">
LINK_TIMEOUT</A>

</STRONG>
<DD>
Set this to the number of seconds tlink should wait before announcing
that the MiniVend server is not running.  The default of 45 is probably
a reasonable value.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_compiling_0">
Compiling VLINK and TLINK</A>
</H2>
Change directories to the <EM>src</EM> directory, then run the GNU
configure script:
<p>
<XMP>
    cd src
    ./configure

</XMP>
<p>You will see some output as the configure script checks your system.
Then compile the programs:
<p>
<XMP>
    cc vlink.c -o vlink
    cc tlink.c -o tlink

</XMP>
<p>On some systems you can make the executable smaller with the strip
program. But don't worry about it if strip is not on your system.
<p>
<XMP>
    strip vlink

</XMP>
<p>If you want MiniVend to run under a different user account than your own,
make that user the owner of vlink. (You probably need to be root to do
this). Do not make vlink owned by root, because making vlink setuid
root is an unnecessary security risk.  It should also <STRONG>not</STRONG> normally
run as the default WWW user (often <STRONG>nobody</STRONG>)).
<p>
<XMP>
    chown vendacct vlink

</XMP>
<p>Make vlink setuid:
<p>
<XMP>
    chmod u+s vlink

</XMP>
<p>Move the vlink executable to your cgi-bin directory:
<p>
<XMP>
    mv vlink /the/cgi-bin/directory

</XMP>
<p>Some systems unset the SUID bit when moving the file -- re-set it
if necessary.
<p><p><hr>

<H1> 
<A NAME="minivend_authors_0">
AUTHORS</A>
</H1>
Original author of Vend is Andrew Wilcox, <EM><A HREF="MAILTO:awilcox@world.std.com">awilcox@world.std.com</A></EM>
MiniVend is based on Vend 0.2, with portions from Vend 0.3,
and is enhanced and modified extensively by Mike Heins, <EM><A HREF="MAILTO:mikeh@iac.net">mikeh@iac.net</A></EM>
<p>
</DL>

</BODY>
</HTML>
