<!-- $Id$ -->
<HTML><HEAD>
<CENTER><TITLE>minivend</TITLE>
</HEAD>
<BODY BGCOLOR=WHITE></CENTER><p><hr>

<CENTER> <H1> 
<A NAME="minivend_name_0">
MiniVend -- multi-catalog shopping cart and mall
</A>
</CENTER> </H1>
<p>
<H2> 
<A NAME="minivend_version_0">
Version</A>
</H2>
This document describes MiniVend 3.07, based on Andrew Wilcox's
original Vend, Version 0.2, with portions from Vend 0.3.
<p><p><hr>
<H1> 
<A NAME="minivend_overview_0">
OVERVIEW OF MINIVEND</A>
</H1>
If you want to get started, just jump to 
<A HREF="minivend.html#minivend_quick_0">QUICK START</A>
 below.
The following section describes how MiniVend works.
<p>
<H2> 
<A NAME="minivend_the_0">
The Vend Concept</A>
</H2>
MiniVend is a descendent of Vend, originally developed by Andrew Wilcox.
Though the original Vend was much simpler than MiniVend in implementation,
the basic concept remains unchanged. Quite simply, MiniVend maintains its
own set of pages, <EM>outside of regular HTML space</EM>, which contain special
tags that are interpreted by MiniVend.
<p>The tags, which are in [square brackets], are interpreted by MiniVend and
many different values can be substituted. Some examples are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_user_0">
User form input</A>

</STRONG>
<DD>
MiniVend remembers input by a user from form to form, and the value of any
form variable is ``remembered'' and inserted upon finding a <CODE>[value input_field]</CODE>
tag. The <CODE>input_field</CODE> is a normal HTML form field.
<p>
<DT><STRONG>

<A NAME="minivend_database_0">
Database contents</A>

</STRONG>
<DD>
MiniVend can have an unlimited number of attached databases, either in one of
its own internal formats or attached via SQL/ODBC.  The contents of a database
can be referenced with tags like <CODE>[data table=products field=name key=334-12]</CODE>.
<p>
<DT><STRONG>

<A NAME="minivend_session_0">
Session parameters</A>

</STRONG>
<DD>
Things like where the user originally found your catalog (<CODE>[data session source]</CODE>
and <CODE>[data session referer]</CODE>), domain they are from (<CODE>[data session host]</CODE>), 
the time of their last access (<CODE>[data session time]</CODE>), and many other parameters.
<p>
<DT><STRONG>

<A NAME="minivend_file_0">
File contents or program output</A>

</STRONG>
<DD>
You can insert the contents of an outboard file with <CODE>[file directory/file]</CODE>,
or the output from an arbitrary program (given proper permission from
your administrator!).
<p>
<DT><STRONG>

<A NAME="minivend_searches_0">
Searches of files</A>

</STRONG>
<DD>
MiniVend supports different search engines, including 
<A HREF="minivend.html#minivend_glimpse_0">Glimpse</A>
, or you can
call your own and have MiniVend process the output for you.
<p>
</DL>
There are over 80 different distinct tags supporting hundreds of functions..
<p>
<H2> 
<A NAME="minivend_a_0">
A typical user session</A>
</H2>
The user hears about your catalog via a search engine, link from another
page, or click-thru from a banner ad. They access the link, which is a
URL pointing to the MiniVend link program (called VLINK or TLINK, more
on that below).  The MiniVend server is already running on your system,
and your catalog has been designed and tested.
<p>The link program, which is a regular CGI program, calls the MiniVend
server.  The MiniVend server sees the path information which is appended
to the URL calling it, and brings up the corresponding page.  The page
contains a link to order items from your catalog. 
<p>The user clicks on the link and MiniVend looks in the a 
<A HREF="minivend.html#minivend_products_0">products</A>
 database,
finds the item, and places it in the user's shopping cart. (Each user has
a separate shopping cart, which is attached to their 
<A HREF="minivend.html#minivend_session_1">session</A>
.)
<p>Once the user decides to purchase, they check out by filling out a form
with their name, address, payment information, etc. In the process they
may make choices about how the product should be shipped, how they will
pay, and provide any other information you may ask for. They then place
(or ``submit'') the order.
<p>Their payment may be taken at that point via CyberCash and a soft-goods
product downloaded -- or their order information may be simply sent to
you, the store owner, via encrypted email or FAX.  The order is saved
to a file or database table as backup, or in the case of fully-automated
systems sent directly to an order entry program or database link.
<p>All of these operations are fully configurable by you.  The base MiniVend
distribution includes a sample store -- some users have simply customized
the text and images inside, changed the database entries, and opened
their store. You will probably want to fully customize for a distinctive
catalog look and feel.
<p>
<H2> 
<A NAME="minivend_how_0">
How MiniVend Manages Sessions</A>
</H2>
Normally, each request for a World Wide Web page which comes in to a
server stands on its own. While the server will probably know which
machine a request comes from, it may not know if the next request
comes from the same browser or even from the same user on that
machine.
<p>MiniVend keeps track of who is ordering what by including in the URL a

<A HREF="minivend.html#minivend_session_1">session id</A>
, which is a random piece of text which is different for each customer
browsing the catalog.
<p>This session ID is either tracked with cookies, or it can be passed
along through special URLs within catalog pages. Pages in the catalog
served by MiniVend running as a cgi-bin program generate a special URL
for every link. Here is an example of such a URL:
<p>
<XMP>
    http://machine.company.com/cgi-bin/simple/browse?WehUkATn;arg;1

</XMP>
<p>An explanation of each part:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_machine_company_com_0">
machine.company.com</A>

</STRONG>
<DD>
Internet address of the server hosting the MiniVend catalog.
<p>
<DT><STRONG>
<EM>cgi-bin</EM>
</STRONG>
<DD>
Informs server that the requested page will be generated by a
program.
<p>
<DT><STRONG>

<A NAME="minivend_simple_0">
simple</A>

</STRONG>
<DD>
Name of the program to run
<p>
<DT><STRONG>

<A NAME="minivend_browse_0">
browse</A>

</STRONG>
<DD>
Page of the catalog to display
<p>
<DT><STRONG>

<A NAME="minivend_wehukatn_0">
WehUkATn</A>

</STRONG>
<DD>
The session ID
<p>
<DT><STRONG>

<A NAME="minivend__0">
;</A>

</STRONG>
<DD>
Separates session ID from argument.
<p>
<DT><STRONG>

<A NAME="minivend_arg_0">
arg</A>

</STRONG>
<DD>
An argument which can be used by MiniVend to select page display options.
<p>
<DT><STRONG>

<A NAME="minivend__0">
;</A>

</STRONG>
<DD>
Separates argument from the unique integer.
<p>
<DT><STRONG>

<A NAME="minivend__1">
1</A>

</STRONG>
<DD>
A unique integer (or source code, if it contains a letter) which prevents
caching servers from caching the URL.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_page_0">
Page Delivery</A>
</H2>
MiniVend pages are written in regular HTML with extensions to
support catalog ordering. MiniVend extensions look like:
<p>
<XMP>
    [page specials]See our specials![/page]

</XMP>
<p>Pages are delivered through the following steps:
<p>
<UL>
<LI>The HTTPD server (Apache, Netscape, or NCSA are examples of HTTP
servers) receives a request for a MiniVend page.
<p>
<LI>The server is already running as a daemon, and the request calls a small
C program (source is vlink.c or tlink.c) that is 
<EM>named according to which catalog is being called.</EM> This program
communicates with the MiniVend program via
a UNIX- or INET-domain socket.
<p>
<LI>MiniVend reads the source page from the MiniVend pages directory, and
interprets the MiniVend tags in the file. If the page doesn't exist,
and corresponds to a part number in the database, it is built "on the
fly" using a template page. In the process, it may read or modify any
number of database tables. If the user's browser doesn't accept cookies,
then any links generated on the page will contain the 
<A HREF="minivend.html#minivend_session_1">session ID</A>
, which
is needed to ensure the user's session is retained.
<p>
<LI>The page, which is now entirely in regular HTML, is delivered to
the HTTP server, which returns it to the browser.
<p>
</UL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_distribution_0">
DISTRIBUTION AND SUPPORT INFORMATION</A>
</H1>
MiniVend is normally free of charge, and is distributed under a
modified GNU general public license.  This means that individuals and
organizations, both commercial and non-commercial, may generally use
MiniVend without charge.
<p>The only exception is that any individual or organization using uninvited
email solicitations (commonly known as SPAM) may not use MiniVend for a
period of one year from their last SPAM incident.  Upon sending of SPAM,
the user must immediately discontinue using MiniVend
<p>Once their Internet Service Provider (or network backbone provider)
is notified by the author, they must discontinue use of MiniVend. Use
of MiniVend after such a notification is subject to a US<STRONG>$1</STRONG>,000 per day
license fee payable to the author.
<p>If such an individual uses MiniVend, let the author know and an immediate
investigation will be started.
<p>MiniVend is not guaranteed to be supported other than by making
full source code available. If it breaks you get to keep both pieces.
However, the author is always looking to improve MiniVend and sometimes
answers questions.  The more concise and better-researched your question,
the more likely it is to get an answer. No tutorials will be provided,
though. You have to learn all of this stuff on your own.
<p>
<H2> 
<A NAME="minivend_where_0">
Where to Download MiniVend</A>
</H2>
The MiniVend version described in this document is available from:
<p>
<XMP>
    http://www.minivend.com/minivend/download.html

</XMP>
<p>You can also go to any CPAN archive and access the directory
<CODE>authors/id/MIKEH</CODE>.
<p>
<H2> 
<A NAME="minivend_perl_0">
Perl</A>
</H2>
You will need Perl version 5.004 or higher to run MiniVend 3.07. Many
sites are still running lower Perl versions. In addition, on systems
that do not have GDBM or DB_File installed, memory problems may occur.
Large catalogs will use large amounts of memory if the databases must
all reside there.
<p>You can download the latest Perl 5 from any CPAN (Comprehensive Perl
Archive Network) site. Here are some of the many:
<p>NORTH AMERICA
<p>
<XMP>
  Florida 
     ftp://ftp.cis.ufl.edu/pub/perl/CPAN/ 
  Illinois 
     ftp://uiarchive.cso.uiuc.edu/pub/lang/perl/CPAN/ 
  Massachusetts 
     ftp://ftp.delphi.com/pub/mirrors/packages/perl/CPAN/ 
  Oklahoma 
     ftp://ftp.uoknor.edu/mirrors/CPAN/ 
  Texas 
     ftp://ftp.metronet.com/pub/perl/
     ftp://ftp.sedl.org/pub/mirrors/CPAN/ 
     ftp://ftp.sterling.com/programming/languages/perl/ 

</XMP>
<p>EUROPE
<p>
<XMP>
  Czech Republic
     ftp://sunsite.mff.cuni.cz/Languages/Perl/CPAN/
  Finland 
     ftp://ftp.funet.fi/pub/languages/perl/CPAN/ 
  France 
     ftp://ftp.ibp.fr/pub/perl/CPAN/ 
     ftp://ftp.pasteur.fr/pub/computing/unix/perl/CPAN/ 
  Germany 
     ftp://ftp.leo.org/pub/comp/programming/languages/perl/CPAN/ 
     ftp://ftp.rz.ruhr-uni-bochum.de/pub/programming/languages/perl/CPAN/ 
  Great Britain 
     ftp://ftp.demon.co.uk/pub/mirrors/perl/CPAN/ 
     ftp://unix.hensa.ac.uk/mirrors/perl-CPAN/
  The Netherlands 
     ftp://ftp.cs.ruu.nl/pub/PERL/CPAN/ 
  Poland
     ftp://ftp.pk.edu.pl/pub/lang/perl/CPAN/
  Portugal 
     ftp://ftp.ci.uminho.pt/pub/lang/perl/ 
  Slovenia
     ftp://ftp.arnes.si/software/perl/CPAN/
  Sweden 
     ftp://ftp.sunet.se/pub/lang/perl/CPAN/ 
  Switzerland 
     ftp://ftp.switch.ch/mirror/CPAN/ 

</XMP>
<p>AUSTRALASIA
<p>
<XMP>
  Australia 
     ftp://coombs.anu.edu.au/pub/perl/CPAN/
     ftp://ftp.mame.mu.oz.au/pub/perl/CPAN/
  New Zealand 
     ftp://ftp.tekotago.ac.nz/pub/perl/CPAN/ 

</XMP>
<p>ASIA
<p>
<XMP>
  Japan 
     ftp://ftp.lab.kdd.co.jp/lang/perl/CPAN/ 
  Taiwan 
     ftp://dongpo.math.ncu.edu.tw/perl/CPAN/ 

</XMP>
<p>AFRICA
<p>
<XMP>
  South Africa 
     ftp://ftp.is.co.za/programming/perl/CPAN/ 

</XMP>
<p>
<H2> 
<A NAME="minivend_setup_0">
Setup for HTTP Servers</A>
</H2>
The most important issue with MiniVend is the permissions with
which the CGI program and the MiniVend server run.
<p>MiniVend uses a server running <EM>in the background</EM>, with a small
C program (generically called <CODE>vlink</CODE>) that communicates with MiniVend via
a UNIX-domain socket.
<p>To improve security, MiniVend normally runs with the socket file
having 0600 permissions (rw-------), which mandates that the CGI
program and the server run <EM>as the same user ID</EM>. This means
that the <CODE>vlink</CODE> program must be SUID to the same user ID as
the server executes under. (Or that CGIWRAP is used on a single
catalog system).
<p>With MiniVend 3.0 multiple catalog capability, the permissions
situation gets a bit tricky. MiniVend comes with a program,
<CODE>makecat</CODE>, which configures catalogs for a multiple catalog
system. It should properly set up ownership and permissions
for multiple users if run as the superuser.
<p><p><hr>

<H1> 
<A NAME="minivend_quick_0">
QUICK START</A>
</H1>
Obtain, decompress and untar the distribution:
<p>
<XMP>
    gzip -dc minivend-3.07.tar.gz | tar xvf -

</XMP>
<p>NOTE FOR WINDOWS: Windows users need to unzip the file with whatever
program they use, or obtain the self-extracting executable.
<p>Before installing, check the site where you obtained MiniVend for any
patches that might have been issued since the release.
<p>Change to the created directory, something like:
<p>
<XMP>
    cd minivend-3.07

</XMP>
<p>Run the configure script with:
<p>
<XMP>
    ./configure

</XMP>
<p>NOTE FOR WINDOWS:  Type <CODE>configure</CODE> instead. The ./ is needed for
UNIX users with a properly setup shell.
<p>If you have trouble with ./configure, try this:
<p>
<XMP>
    perl Makefile.PL
    make 
    make test
    make install

</XMP>
<p>Replace the <CODE>perl</CODE> with the proper path to your Perl 5.004
or higher binary.
<p>You will be asked for the directory where you want to install MiniVend --
any directory will do. You must of course have write permission there;
and you will eventually need to have write permission on your CGI-BIN
and HTML directories. This directory is referred to later in the
documentation as <STRONG>VendRoot</STRONG> or the <STRONG>MiniVend software directory</STRONG>.
<p>The process should be self-explanatory. If you have trouble answering
the questions asked, <STRONG>look closely</STRONG> at the examples provided. If you
still have trouble, you will need to find a tutorial about the World
Wide Web -- the WWW FAQ at www.boutell.com would be a good place to look.
<p>If you discover any problems, refer to the section I<If something goes
wrong&gt;. Otherwise, MiniVend should be installed at the completion of the
script. It is strongly suggested that you install the demo catalogs as
a starting point for your own catalog -- in fact you will not be able
to run MiniVend until you have created a catalog.
<p>You will want separate directories to hold the catalog pages and
databases. The <CODE>makecat</CODE> program supplied with MiniVend will make those
for you.
<p><STRONG>IMPORTANT NOTE:</STRONG> One point that is to be emphasized --
<EM>only your base html pages go in the document space of your http server.</EM>
Any pages with MiniVend elements/tags go in the directory set by the

<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
 directive (the default is <CODE>~/catalogs/catalog_name/pages</CODE>).
For the demos supplied with MiniVend, this means that only a few pages
will be copied to your HTML directory, with the remainder of the pages
staying in the directory defined as 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
.
<p>If you are on an ISP where <STRONG>all</STRONG> of your files are in HTML document
space, you should disable all access to your MiniVend catalog directory
with the proper HTTP access restrictions. Normally that is creating
a .htaccess file like this:
<p>
<XMP>
  <Limit GET POST>
  order allow,deny
  deny from all
  </Limit>

</XMP>
<p>If you are unable to do this, it is recommended that you do not run
MiniVend. If you can set file permissions such that files will not be
served, it may be OK, but security will be a problem. Please be careful
with your customers' personal information.
<p>
<H2> 
<A NAME="minivend_setting_0">
Setting up multiple catalogs</A>
</H2>
MiniVend has multiple catalog capability. It breaks the configuration
files into two pieces:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_minivend_cfg_0">
minivend.cfg</A>

</STRONG>
<DD>
This file is located in the main MiniVend directory, and
has only a few server-wide configuration parameters. The most
important is the 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directive, which sets up the
catalog configuration.
<p>The 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directive defines which catalogs will be
created at server startup.
<p>
<XMP>
 Catalog simple /home/catalogs/simple /cgi-bin/simple /secure-bin/simple

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_simple_0">
simple</A>

</STRONG>
<DD>
The 
<A HREF="minivend.html#minivend_catalog_1">catalog identifier</A>
, used as the name of the catalog on command
lines. In the supplied demo configuration this would be 
<A HREF="minivend.html#minivend_simple_0">simple</A>
.
The identifier can contain characters from the set [<STRONG>A-Za-z0-9_</STRONG>].
<p>
<DT><STRONG>

<A NAME="minivend_home_catalogs_simple_0">
/home/catalogs/simple</A>

</STRONG>
<DD>
The directory where the catalog.cfg file may be found, and usually
the directory where pages and databases are kept.
<p>
<DT><STRONG>
<EM>/cgi-bin/simple  /secure-bin/simple</EM>
</STRONG>
<DD>
The script names which, when containing a MiniVend link program, will
cause that catalog to be called. At least one must be supplied,
and the same name may not be used for more than one catalog
unless the <EM>FullURL</EM> directive is specified, in which case
the parameter may be specified as www.yourcompany.com/cgi-bin/simple
and www.theirs.com/cgi-bin/simple may call a different catalog.
<p>
</DL>
There may also be 
<A HREF="minivend.html#minivend_subcatalog_0">SubCatalog</A>
 directives:.
  SubCatalog easy simple /home/catalogs/simple /cgi-bin/easy
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_easy_0">
easy</A>

</STRONG>
<DD>
The name of the subcatalog, which also controls the name of
the subcatalog configuration file -- in this case 
<A HREF="minivend.html#minivend_easy_0">easy.cfg</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_simple_0">
simple</A>

</STRONG>
<DD>
The name of the base configuration, which will be the basis
for the catalog. Parameters in the easy.cfg file that are
different will override those in the catalog.cfg file for
the base configuration.
<p>
</DL>
The remaining parameters are as in the 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directive..
Additional minivend.cfg parameters set up administrative parameters
that are catalog wide -- see 
<A HREF="minivend.html#minivend_server_0">Server Configuration File</A>
 for details
on each of these.
<p>Each catalog can be completely independent, with different databases --
or catalogs can share any or all pages, databases, and session files. This
means that several catalogs can share the same information, allowing
``virtual malls''.
<p>
<H2> 
<A NAME="minivend_the_1">
The Catalog</A>
</H2>
MiniVend pages are NOT in normal HTML space. They are contained in the

<A HREF="minivend.html#minivend_catalog_1">catalog directory</A>
. Each individual catalog must have its own base
directory. The catalog directory has this structure by default:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_catalog_cfg_0">
catalog.cfg</A>

</STRONG>
<DD>
File containing configuration directives for this
catalog. (Subcatalogs have differing information in a file
named for the subcatalog.)
<p>
<DT><STRONG>
<EM>config </EM>
</STRONG>
<DD>
Directory that will be read when directives are set with the
<filename notation. For example, the file 
<A HREF="minivend.html#minivend_config_1">config/static.pages</A>

will be read when the directive
<p>
<XMP>
 StaticPage  <static.pages

</XMP>
<p>is encountered in the catalog.cfg file.
<p>
<DT><STRONG>

<A NAME="minivend_error_log_0">
error.log</A>

</STRONG>
<DD>
File which contains catalog-specific errors.
<EM>Check this file when something doesn't work right.</EM>
It is also where any syntax errors in embedded Perl code will be shown.
<p>
<DT><STRONG>

<A NAME="minivend_etc_0">
etc</A>

</STRONG>
<DD>
Directory that contains logs, scratch files, and cache files.
<p>
<DT><STRONG>

<A NAME="minivend_pages_0">
pages</A>

</STRONG>
<DD>
Directory that contains the pages of your catalog. This
can be considered to be the ``document root'' of the catalog.  Pages
contained therein are called with the path information after the
script name -- i.e. <CODE>/cgi-bin/simple/products/gold</CODE> will call the
page in the file 
<A HREF="minivend.html#minivend_pages_0">pages/products/gold.html</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_products_0">
products</A>

</STRONG>
<DD>
Directory containing database source files, including the special MiniVend
databases shipping.asc, accessories.asc, pricing.asc (and other shipping
database files)
<p>
<DT><STRONG>

<A NAME="minivend_reconfig_0">
reconfig</A>

</STRONG>
<DD>
A script file, which when executed, will cause the catalog.cfg file to be
re-read and the catalog configuration to change.  If errors occur, the catalog
will stay with its old/previous configuration. This script is set up by the
makecat program, but may require editing if you deviate from the standard
MiniVend configuration. It operates by executing the link program that is
contained in the CGI directory and passing the proper parameters through the
environment.
<p>
<DT><STRONG>

<A NAME="minivend_session_1">
session</A>

</STRONG>
<DD>
Directory which contains session files when DBM sessions are not in use.
<p>
<DT><STRONG>

<A NAME="minivend_session_gdbm_0">
session.gdbm (or session.db)</A>

</STRONG>
<DD>
The GDBM or DB_File session database file. This is a DBM database that contains
the user sessions.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_if_0">
If something goes wrong</A>
</H2>
MiniVend is a complex program, and needs the services of other complex
programs to work. When there is a problem, it is not always MiniVend. It
may have to do with Perl or your HTTP server. In fact, in the over two
years of MiniVend's existence more basic installation problems have to
do with those than with MiniVend itself.
<p>If you get a message about not being able to find libraries, or if you
get a core dump or segment fault message, it is always improperly built
or configured Perl and has nothing to do with MiniVend. Contact your
system administrator or install a new Perl yourself.
<p>The <CODE>makecat</CODE> program is intended to be used to create the
starting point for the catalog. If you don't get the demo to work
the first time, keep trying.  If you still can't get the demo
to work, try running in INET mode.  Finally, see the MiniVend FAQ at:
<p>
<XMP>
        http://www.minivend.com/minivend/faq/

</XMP>
<p>Check the two error log files -- 
<A HREF="minivend.html#minivend_error_log_0">error.log</A>
 in the MiniVend
home directory (where minivend.cfg resides) and 
<A HREF="minivend.html#minivend_error_log_0">error.log</A>
 in the 
catalog directory (where catalog.cfg resides; there can be many of
these). Many problems can be diagnosed quickly if these error logs
are consulted.
<p>Check the README file, the FAQ, and mail list archive at the official
MiniVend web site for information:
<p>
<XMP>
    http://www.minivend.com/minivend/

</XMP>
<p>You may subscribe to the MiniVend users mail list by sending the
<STRONG>message text</STRONG> <CODE>subscribe minivend-users</CODE> to:
<p>
<XMP>
    majordomo@minivend.com

</XMP>
<p>Double check that you have the following things:
<p>
<OL>
<LI>The <CODE>vlink</CODE> program is SUID, or you have made appropriate
changes in the 
<A HREF="minivend.html#minivend_readpermission_0">ReadPermission</A>
 and <EM>WritePermission</EM> directives.
Unless the files are world-writable, the vlink program and
the MiniVend server must run as the same user ID!
<p>If you have trouble with the vlink program (named 
<A HREF="minivend.html#minivend_simple_0">simple</A>
 in the demo
configuration), try re-running <CODE>makecat</CODE> and using INET mode instead.
(Or you can copy the <CODE>tlink</CODE> INET mode link program over <CODE>vlink</CODE>). This
should work unchanged for many systems, but if you are on an ISP or have
a non-standard network configuration you may have to make some changes
to 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
.  For <CODE>tlink</CODE> to work you must have the proper host
name(s) configured into the 
<A HREF="minivend.html#minivend_tcphost_0">TcpHost</A>
 directive in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
. The
program selects port 7786 by default (the ASCII codes for ``M'' and ``V'')
-- if you decide to use another port, you must set the same number in
both the tlink program (before compilation, or by editing tlink.pl)
and the 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file.
<p>The <CODE>tlink</CODE> program does <STRONG>not</STRONG> need to be SUID.
<p>
<LI>That you have proper file permissions.
<p><STRONG>IMPORTANT NOTE:</STRONG> The MiniVend server should not run as the user
<CODE>nobody</CODE>!
<p>The program files can be owned by anyone, but any databases, ASCII
database source files, error logs, and the directory that holds them
must be <STRONG>writable</STRONG> by the proper user ID, that is the one that is
executing the minivend program.  The best way to operate in
multi-user, multi-catalog setups is to create a special <CODE>minivend</CODE>
user, then put that user in the group that each catalog user is in. If
you can define a group for each individual user, that provides the best
security. Then all associated files can be in 664 or 775 mode, and you
should have no problems with permissions.
<p>
<LI>The <CODE>vlink</CODE> program is being executed on a machine that has the
socket file 
<A HREF="minivend.html#minivend_etc_0">etc/socket</A>
 on a directly attached disk. UNIX-domain
sockets will not work on NFS-mounted filesystems!  That means the
server <CODE>minivend</CODE> and the CGI program <CODE>vlink</CODE> must be executing
on the same machine.
<p>The <CODE>tlink</CODE> program does not have this problem, but it must have the
proper host name(s) and TCP ports set in the 
<A HREF="minivend.html#minivend_tcphost_0">TcpHost</A>
 and 
<A HREF="minivend.html#minivend_tcpport_0">TcpPort</A>

directives in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
. Also, you should be careful of security
if sensitive information like customer credit card numbers is being
placed on a network wire.
<p>
</OL>
MiniVend is an ambitious and complex program, and is not presented as.being 
<A HREF="minivend.html#minivend_easy_0">easy to use</A>
, 
<A HREF="minivend.html#minivend_easy_0">easy to install</A>
, or <EM>bug-free</EM>. The
configuration scripts were done to try and make a very painful process
only slightly painful. Some people install in one pass. Others never
make it, especially when they are running on an ISP with a restrictive
setup. Determined and thoughtful users almost always make MiniVend work.
<p><p><hr>

<H1> 
<A NAME="minivend_setting_1">
SETTING UP YOUR CATALOG</A>
</H1>
MiniVend uses its own tags to implement catalog functions -- they
are similar to normal HTML, but are in [square brackets]. They
will be referred to as either <EM>tags</EM> or <EM>elements</EM> in this document.
<p>In order to set up a custom catalog, there are a number of steps.
<p>You will need to become familiar with the MiniVend tags and
directives to make your own catalog. The demo catalogs are a good
starting point, but are not a finished product.
<p>
<H2> 
<A NAME="minivend_start_0">
Start with a database</A>
</H2>
The first thing you must do is develop your product database. This might
contain all of the information used to display pages about your
products -- or just the product code (SKU), short description, and
price. At the minimum, those three fields are required.
<p>Some other things you might put in:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_image_0">
image</A>

</STRONG>
<DD>
A database field giving the name of an image file to display the
product. Alternatively, you can keep images in files that are named
for the product code -- then display them if they exist (use the
[if file file.gif] TAG [/if] construct).
<p>
<DT><STRONG>

<A NAME="minivend_nontaxable_0">
nontaxable</A>

</STRONG>
<DD>
This field should be present if you have items that do not have
sales tax calculated for them.
<p>
<DT><STRONG>

<A NAME="minivend_size_0">
size</A>

</STRONG>
<DD>
A comma-separated string containing product size information,
for example:
 
  Small, Medium, Large, XL
<p>You can also define any other attribute information in a database
field.
<p>
<DT><STRONG>

<A NAME="minivend_weight_0">
weight</A>

</STRONG>
<DD>
The shipping weight of an item is useful for UPS lookup or
other weight-based shipping calculations.
<p>
<DT><STRONG>

<A NAME="minivend_category_0">
category</A>

</STRONG>
<DD>
If you wish to do one-click category searches to build product
directories, you might use this field to select on.
<p>
<DT><STRONG>

<A NAME="minivend_related_0">
related</A>

</STRONG>
<DD>
Items related to the item in the record. Using MiniVend's [loop item]
tag, you could build product subclasses and accessory sets.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_on_the_fly_0">
On-the-fly pages, static, or both?</A>
</H2>
The on-the-fly page capability of MiniVend makes it easy to build your
catalog without hard-coding a single page. To build category pages,
use the one-click search and a the search result page(s). To build
single-item pages, use the flypage.html template as an example and
build your own. You can also define a product database field (with the

<A HREF="minivend.html#minivend_pageselectfield_0">PageSelectField</A>
 directive) to hold the name of the base on-the-fly
page for that item. You might define it to be the same as the category
of product, for example.
<p>If you have a large catalog, you will almost certainly want to use
the on-the-fly page for most products. But if you want to mix in a
few extra-special pages, perhaps for your best sellers, you can do so.
Just build the pages and place them in files corresponding to the part
number (in the MiniVend pages directory, of course -- not your HTML
directory). They will take precedence over the on-the-fly page.
<p>If you have only a small number of products, hard coded pages are just
fine, though you would be surprised how much of a maintenance headache
they are compared to database definitions. Build them just about like
normal HTML pages, except for the MiniVend tags to order the item.
Place them wherever they can be reached -- if you are using searches,
you will want to name the file by the part number, or at least make a
link to it.
<p>Some other things you might put in:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_images_0">
Images</A>

</STRONG>
<DD>
You can easily place a thumbnail image (even with a link to
a blowup) only for those items that have them.
<p>
<DT><STRONG>

<A NAME="minivend_accessories_0">
Accessories</A>

</STRONG>
<DD>
The accessories database allows you to pre-define additional
products to offer with a main product.
<p>
<DT><STRONG>

<A NAME="minivend_reviews_testimonials_0">
Reviews/Testimonials</A>

</STRONG>
<DD>
You can key the placement on the existence of a file in
a certain directory.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_use_0">
Use the demo catalogs</A>
</H2>
The demo catalogs supplied with MiniVend are there to give you a starting
point for your own catalog. Play with them, change them, and rename them --
add your own icons, change flypage.html, change the results.html files,
etc. 
<p>
<H2> 
<A NAME="minivend_tree_0">
Tree design</A>
</H2>
Determine how users will enter and exit your catalog. There are quite
complex and intelligent conditional schemes possible, especially if you
use the 
<A HREF="minivend.html#minivend_cookies_0">Cookies</A>
 capability, but simplicity is often the easiest and
most reliable.
<p>
<H2> 
<A NAME="minivend_the_2">
The Essentials</A>
</H2>
The rest of this section describes the rest of the things you need to
know to make the most basic of MiniVend catalogs, one which displays
pages and uses the demo shopping basket and checkout sequence. If you
want to add custom features, like special shipping charges and 
sales tax, you will need to go much further. But this will get you
started.
<p>All of the mentioned features (and more) are demonstrated in the

<A HREF="minivend.html#minivend_simple_0">simple</A>
 demo catalog.
<p>
<H2> 
<A NAME="minivend_catalog_0">
Catalog Pages -- MiniVend tags</A>
</H2>
Pages in the catalog are written in regular HTML with extensions to
support catalog ordering. To distinguish them from regular HTML, these
extended elements use [square brackets] instead of angular brackets. We
will usually call them <STRONG>MiniVend tags</STRONG> or just <STRONG>tags</STRONG>.
<p>These tags perform various display and modification operations for
the user session. The tag names and their general function are:
<p>
<XMP>
  accessories    Access product accessory functions
  area           Insert a re-written MiniVend URL
  areatarget     Insert a re-written MiniVend URL with frame
  body           Insert a predefined <BODY ...> HTML tag
  buttonbar      Insert a predefined buttonbar
  calc           Perform Perl calculations (low overhead)
        /calc
  cart           Set the current shopping cart name
  checked        Conditionally check an HTML check/radio box
  comment        Insert comments in MiniVend pages
        /comment
  compat         Define regions to be interpreted with old syntax
        /compat
  col            Used with [row] -- rudimentary text tables for order reports
        /col
  condition      Sets a condition inside [if explicit] and others
        /condition
  currency       Formats a number like currency for current locale
        /currency
  data           Access a database or user session element
  default        Insert a variable but with a default response if blank
  description    Output a product description
  discount       Set a product discount coupon
        /discount
  discount-price Show the discounted price
  else           Defines else region for [if ...], [if-field ..] and others
        /else
  elsif          Defines elsif region for [if ...]
        /elsif
  field          Access a product database field
  file           Insert the contents of a file
  finish-order   DEPRECATED. Conditionally show a "check basket" link.
  fly-list       Show an item "on-the-fly" in an arbitrary page
        /fly-list
  framebase      DEPRECATED. Set a <BASE FRAME="..."> only if in frames mode.
  frames-off     Turn off MiniVend frames mode.
  frames-on      Turn on MiniVend frames mode.
  help           DEPRECATED. Show a help message only if help is enabled.
  if             Perform any of many conditional tests
        /if
  if-data        Display region only if database element non-empty
        /if-data
  if-field       Display region only if field non-empty
        /if-field
  if-loop-data   Display region only if database element non-empty
        /if-loop-data
  if-loop-field  Display region only if field non-empty
        /if-loop-field
  if-modifier    Display only if item attribute/modifier set
        /if-modifier
  if-sql-data   Display region only if database element non-empty
        /if-sql-data
  if-sql-field  Display region only if field non-empty
        /if-sql-field
  include       Include a file with complete MiniVend interpretation
  item-accessories  Product accessory functions (set select box)
  item-code     Insert current item SKU/code/part number
  item-data     Insert data entry corresponding to current SKU
  item-description     Insert description corresponding to current SKU
  item-discount Show amount of discount for current SKU
  item-field    Insert product database entry corresponding to current SKU
  item-increment       Count for list
  item-last     Stop displaying if condition is met
        /item-last
  item-link     DEPRECATED. Auto-HTML link to product page.
  item-next     Skip item if condition is met
        /item-next
  item-list     Iterate over a shopping cart
        /item-list
  item-modifier Show value of item attribute/modifier
  item-param    DEPRECATED. Show element from positional list.
  item-price    Display price of item with any discounts/price breaks/adjustments
  item-quantity Show quantity ordered on shopping cart line
  item-subtotal Subtotal for the item (item-quantity * item-price)
  last-page     DEPRECATED.
        /last-page
  lookup        Lookup an item in a database if not already set
  loop          Iterate over an arbitrary list
        /loop
  loop-accessories  Product accessory functions (set select box)
  loop-change   Grouping of items in list display
        /loop-change
  loop-code     Insert current item SKU/code/part number
  loop-data     Insert data entry corresponding to current SKU
  loop-description  Insert description corresponding to current SKU
  loop-field    Insert product database entry corresponding to current SKU
  loop-increment      Count for list
  loop-last     Stop displaying if condition is met
        /loop-last
  loop-link     DEPRECATED. Auto-HTML link to product page.
  loop-next     Skip item if condition is met
        /loop-next
  loop-price    Display price of item
  matches       Show number of matches from search
  modifier-name Place a variable name that corresponds to an attribute
  more          Show region of search list only if more matches
  more-list     Display more matches list with links to next series
        /more-list
  sql           Perform any of several types of SQL query
  sql-code      Insert current item SKU/code/part number
  sql-data      Insert data entry corresponding to current SKU
  sql-description  Insert description corresponding to current SKU
  sql-field     Insert product database entry corresponding to current SKU
  sql-increment      Count for list
  sql-link      DEPRECATED. Auto-HTML link to product page.
  sql-param     DEPRECATED. Show element from positional list.
  sql-price     Display price of item
  no-match      Define area of search results page displayed when no match
        /no-match
  new           Set new syntax for this page
  nitems        Show number of items for a shopping cart
  old           Set old syntax for this page
  order         Create HTML link to order an item
        /order
  on-change     Grouping of items in list display
        /on-change
  page          Create A HREF with re-written URL to call MiniVend page
        /page
  pagetarget    Create A HREF with re-written URL for frames MiniVend page
        /pagetarget
  perl          Embed output of arbitrary Perl in the page
        /perl
  post          DEPRECATED. Force region to be interpreted last.
        /post
  price         Show price of an item
  process-order Create URL for MiniVend form processing, retain security setting
  process-search Create URL to call MiniVend form-based search
  process-target Create URL to call MiniVend form processing
  quantity-name  Place a variable name that corresponds to item quantity
  random        Insert a random banner
  rotate        Insert a rotating banner
  row           Used with [col] -- rudimentary text tables for order reports
        /row
  salestax      Show amount of salestax for shopping cart
  scratch       Access a scratch variable
  search        Do a MiniVend search, output list of returned item codes
  search-list   Display output of a MiniVend search
        /search-list
  selected      Conditional selection of drop-down <SELECT ...>
  set           Set a scratch variable
        /set
  shipping      Calculate shipping
  shipping-desc Show shipping description
  sort          Set sort order for iterating lists
        /sort
  subtotal      Calculate subtotal without tax or shipping
  tag           Miscellaneous functions
        /tag
  then          Define THEN region for [if ...]
        /then
  total-cost    Calculate order total with tax, handling, and shipping
  uniq          Remove duplicate search returns
  value         Display form value

</XMP>
<p>The syntax for each tag is displayed in the documentation below.
<p>The first page displayed in the catalog, if no argument is supplied to
the <CODE>vlink</CODE> or <CODE>tlink</CODE> cgi-bin program, is ``catalog.html''. This page
will contain links to other catalog pages with the [page pagename] tag.
Individual products can be ordered by the [order &lt;item-code&gt;] element,
which brings up the shopping basket page. The shopping basket page
contains an [item-list], which builds information on each item ordered,
and optionally has input boxes for the customer to type in their
name and address. If desired, the customer can be ``stepped through''
the order process (as is demonstrated in the supplied demos). Once the
order has been sent the receipt page is displayed.
<p>Unless you are using the HTTP cookie support, you will normally not want
to include regular hypertext links to pages outside of the catalog. Such
links will not include the session id, which means that if the customer
follows an external link back to the catalog the list of products ordered
so far will have been lost.
<p>Inline images, on the other hand, are served in the normal fashion.
You should include a regular &lt;IMG SRC=``URL''&gt; element, where the URL
refers to a graphic image. You cannot use relative image names as
you would in an HTML document!  MiniVend has the capability of defining
an image directory (with the 
<A HREF="minivend.html#minivend_imagedir_0">ImageDir</A>
 directive) that automatically
adjusts your image path to a set base directory.
<p>MiniVend has a powerful static page-building capability. This allows you
to pre-build catalog pages that don't contain dynamic elements (such
as order/shopping basket status) into HTML, then automatically point
the browser to those pages when appropriate. This reduces the number
of pages that MiniVend must parse in real time, and can increase server
capacity by orders of magnitude. See 
<A HREF="minivend.html#minivend_static_0">STATIC PAGE BUILDING</A>
.
<p>
<H2> 
<A NAME="minivend_cookies_0">
Cookies</A>
</H2>
All you need to do to have users with cookie-capable browsers retain
session context is enable the 
<A HREF="minivend.html#minivend_cookies_0">Cookies</A>
 directive. You can then
intermix standard HREF and MiniVend page links without fear of losing
the shopping basket. Cookie capability is also required to use search
caching, page caching, and statically generated pages. If the browser
does not support cookies, the cache will be ignored.
<p>If you plan to use more than one host name <EM>within the same domain</EM> for
naming purposes (perhaps a secure server and non-secure server) then
you can set the domain with the 
<A HREF="minivend.html#minivend_cookiedomain_0">CookieDomain</A>
 directive. This must
contain at least two periods (.) as per the cookie specification, and
you cannot set a domain that your server is not located within.
<p>
<H2> 
<A NAME="minivend_basic_0">
Basic MiniVend Tags</A>
</H2>
<STRONG>NOTE:</STRONG> In the descriptions, parameters marked with an asterisk* are
optional.
<p>When a tag is separated by an underscore, as in <EM>item_list</EM>, a dash
is just as appropriate (i.e. <CODE>item-list</CODE>). They are interchangeable,
except that the ending tag and beginning tag should match (don't
use [item-list] list [/item_list]).
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_value_0">
[value field flag*]</A>

</STRONG>
<DD>
Expands into the current value of the customer/form input field named
by field. If 
<A HREF="minivend.html#minivend_flag_0">flag</A>
 is present, single quotes will be escaped with a
backslash; this allows reliable SQL inserts.
<p>
<DT><STRONG>

<A NAME="minivend_page_1">
[page pg arg*]</A>

</STRONG>
<DD>
(new syntax [page href=``dir/page'' target=``frame'' arg=``argument''])
<p>Insert a hyperlink to the specified catalog page pg. For
example, [page shirts] will expand into &lt;
a <A HREF="href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''>">href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''></A>. The
catalog page displayed will come from ``shirts.html'' in the
pages directory.
<p>The additional argument will be passed to MiniVend and placed in
the {arg} session parameter. This allows programming of a conditional
page display based on where the link came from. The argument is then
available with the tag [data session arg], or the embedded Perl session
variable <STRONG>$Safe</STRONG>{'session'}-&gt;{arg}. If you set the catalog configuration
option 
<A HREF="minivend.html#minivend_newescape_0">NewEscape</A>
, then spaces and some other characters will be escaped
with the <STRONG>%NN</STRONG> HTTP-style notation and unescaped when the argument is read
back into the session.
<p>A bit of magic occurs if MiniVend has built a static page for the
target page. Instead of generating a normal MiniVend-parsed page
reference, a static page reference will be inserted if the user has
accepted and sent back a cookie with the session ID. 
<p>
<DT><STRONG>

<A NAME="minivend_area_0">
[area pg arg*]</A>

</STRONG>
<DD>
(new syntax [area href=``dir/page'' target=``frame'' arg=``argument''])
<p>Like the <EM>areatarget</EM> element, except it will never yield
a frame target.
<p>The optional 
<A HREF="minivend.html#minivend_arg_0">arg</A>
 is used just as in the <EM>page</EM> tag.
<p>
<DT><STRONG>

<A NAME="minivend_page_2">
[/page]</A>

</STRONG>
<DD>
Expands into &lt;/a&gt;. Used with the page element, such as:
<p>
<XMP>
  [page shirts]Our shirt collection[/page]. 

</XMP>
<p>TIP: A small efficiency boost in large pages is to just use the &lt;/A>
tag.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_how_1">
How to order an item</A>
</H2>
MiniVend can either use a form-based order or a link-based order to
place an item in the shopping cart. The link-based order uses the
special <CODE>[order item-code]</CODE> tag:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_order_0">
[order code cart/page* database*]</A>

</STRONG>
<DD>
(new syntax [order code=``code'' href=``cart/page'' base=``database''])
<p>Expands into a hypertext link which will include the specified
code in the list of products to order and display the order page. 
<A HREF="minivend.html#minivend_code_0">code</A>

should be a product code listed in one of the ``products'' databases. The
optional argument <STRONG>cart/page</STRONG> selects the shopping cart the item will be
placed in (begin with / to use the default cart <CODE>main</CODE>) and the order page
that will display the order. The optional argument 
<A HREF="minivend.html#minivend_database_1">database</A>
 constrains
the order to a particular products file -- if not specified, all databases
defined as products files will be searched in sequence for the item.
<p>Example: 
<p>
<XMP>
  Order a [order TK112]Toaster[/order] today.

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_order_1">
[/order]</A>

</STRONG>
<DD>
Expands into &lt;/a&gt;. Used with the order element, such as: Buy a
[order TK112]Toaster[/order] today.
<p>
</DL>
To order with a form, you set the form variable <CODE>mv_order_item</CODE> to.the item-code/SKU and use the 
<A HREF="minivend.html#minivend_refresh_0">refresh</A>
 action:
<p>
<XMP>
  <FORM ACTION="[process-target]" METHOD=POST>
  <INPUT TYPE=hidden  NAME="mv_todo"        VALUE="refresh">
  <INPUT TYPE=hidden  NAME="mv_order_item"  VALUE="TK112">
 
  Order <INPUT NAME="mv_order_quantity" SIZE=3 VALUE=1> toaster
 
  <INPUT TYPE=submit VALUE="Order!">
  </FORM>

</XMP>
<p>You may also specify attributes like size or color at time of order,
and may batch select whole groups of items. Read further to see how,
or order the T-shirt from the more details page of the 
<A HREF="minivend.html#minivend_simple_0">simple</A>
 demo 
to see how it is done.
<p>
<H2> 
<A NAME="minivend_where_1">
Where do I go from here?</A>
</H2>
MiniVend is very complicated but very powerful. If you have read and
understood the documentation so far, you have a good start on building a
catalog.  There are many, many, more features than are shown in the demo,
and mastering the ones you need will take time. Thousands of people have
built MiniVend catalogs -- you can too. If you feel it is beyond you,
then we would suggest engaging a competent consultant. Good luck!
<p><p><hr>

<H1> 
<A NAME="minivend_databases_0">
DATABASES</A>
</H1>
MiniVend, as with most powerful shopping cart programs, is all about
databases.
<p>This version of MiniVend implements the database in GDBM, DB_File, SQL,
or in-memory format. If you have DBM, large catalogs can be used without
using too much memory. The DBM files are built automatically when they
change, from the the ASCII source file. If you don't have either GDBM
or DB_File, or you set the environment variable MINIVEND_NODBM before
starting the server, an in-memory product database will be used. Catalogs
of more than, say, 1,000 items will use large amounts of memory.
<p>Support for SQL databases is included. Form-based updates and inserts
allow user input and remote maintenance. No other database besides
MiniVend's internal one is needed -- but you may find that keeping your
database in an SQL manager makes it easier to integrate MiniVend with
other tools.
<p>NOTE: In the following descriptions, we will use the following
terms interchangeably:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_key_0">
key, code</A>

</STRONG>
<DD>
Either one is a reference to the <STRONG>key</STRONG> for the database. In MiniVend
this is often the product 
<A HREF="minivend.html#minivend_code_0">code</A>
 or <STRONG>sku</STRONG>, which is the part number
for the product.  Other key values may be used to generate relationships
to other database tables.
<p>It is required that the key be the first column of an ASCII source file
for GDBM, Berkeley DB, or in-memory built-in database formats. It is also
strongly suggested that you keep that practice for SQL databases, since
MiniVend's import, export, and search facilities will work much better
with that practice.
<p>
<DT><STRONG>

<A NAME="minivend_field_0">
field, column</A>

</STRONG>
<DD>
This is a column of the database. One of the columns is always the key --
MiniVend prefers that the key be the first column. Field is an interchangeable
reference.
<p>
<DT><STRONG>

<A NAME="minivend_table_0">
table, database</A>

</STRONG>
<DD>
A table in the database. Because of the evolution of MiniVend from a
single-table database to an access method for an unlimited number of
tables (and databases, for that matter), we will sometimes refer to a
table as a database.  The only time 
<A HREF="minivend.html#minivend_database_1">database</A>
 refers to something
different is when describing that concept as it relates to SQL --
where a database contains a series of tables.  MiniVend cannot create
SQL databases, but given the proper permissions it may drop and create
tables within that database.
<p>
</DL>
If necessary, MiniVend reads the data to place in tables from standard.ASCII-delimited files.  All of these ASCII source files are kept in the
products directory, normally 
<A HREF="minivend.html#minivend_products_0">products</A>
 in the catalog directory (where
catalog.cfg is).
<p><STRONG>NOTE:</STRONG> Microsoft Excel is a widely-used tool to maintain MiniVend databases,
but has several problems with its standard TAB-delimited export, like
encasing fields containing commas in quotes, generating extra carriage
returns embedded in records, and not including trailing blank fields.
To avoid problems, use a text-qualifier of <STRONG>none</STRONG>.
<p>The ASCII files can have ^M (carriage return) characters if desired, but must
have a newline character at the <STRONG>end</STRONG> of the line to work -- Mac users
uploading files must use ASCII mode, not binary mode!
<p>MiniVend sets the default ASCII delimiter scheme with the 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>

directive, which can have one of three settings, TAB, PIPE, or CSV.
<p><STRONG>IMPORTANT NOTE:</STRONG> The items must be separated by a <STRONG>single</STRONG> delimiter.
The items are lined up for your reading convenience.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_tab_0">
TAB</A>

</STRONG>
<DD>
Fields separated by ^I characters. No whitespace should be at the
beginning of the line.
<p>
<XMP>
    code    description             price   image
    SH543   Men's fine cotton shirt 14.95   shirts.jpg

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pipe_0">
PIPE</A>

</STRONG>
<DD>
Fields separated by <CODE>|</CODE> characters. No whitespace should be at the
beginning of the line.
<p>
<XMP>
    code|description|price|image
    SH543|Men's fine cotton shirt|14.95|shirts.jpg

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_csv_0">
CSV</A>

</STRONG>
<DD>
Fields enclosed in quotes, separated by commas. No whitespace should be at the
beginning of the line.
<p>
<XMP>
    "code","description","price","image"
    "SH543","Men's fine cotton shirt","14.95","shirts.jpg"

</XMP>
<p>
</DL>
<STRONG>NOTE:</STRONG> Using the default TAB delimiter is highly recommended if you.are planning on searching the ASCII source file of the database. PIPE
works fairly well, but CSV delimiter schemes cause problems with searching.
<p>The 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>
 directive sets the default scheme, and should be set
to one of those three values. TAB is the default scheme.
<p><STRONG>IMPORTANT NOTE:</STRONG> Field names are usually case-sensitive. Unless
you are consistent in the names, you will have problems. All lower
or all upper case names are recommended.
<p>MiniVend uses one mandatory database, the products database. It is by
default identified as 
<A HREF="minivend.html#minivend_products_0">products</A>
 and the ASCII source is kept in the
file 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 in the products directory.  This file is also the
default file for searching with the 
<A HREF="minivend.html#minivend_the_4">THE SEARCH ENGINE</A>
.
<p>MiniVend also has a number of standard but optional databases, some
of which are in fixed special formats:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_shipping_asc_0">
shipping.asc</A>

</STRONG>
<DD>
The database of shipping options if the 
<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>
 directive
is in use.  This is a fixed-format database, and must be created as specified.
See 
<A HREF="minivend.html#minivend_shipping_2">SHIPPING</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_salestax_asc_0">
salestax.asc</A>

</STRONG>
<DD>
The database of sales tax information if the [salestax] tag is to
be used. A default is supplied -- caution, these things change!
This is a fixed-format database, and must be created as specified.
See 
<A HREF="minivend.html#minivend_sales_0">Sales Tax</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_accessories_asc_0">
accessories.asc</A>

</STRONG>
<DD>
A simple auxiliary database keyed on the product code. It's value
is available via the [item_accessories] or [accessories code] tags.
This is a fixed-format database, and must be created as specified.
See 
<A HREF="minivend.html#minivend_accessories_0">Accessories</A>
. The big advantage of this database is speed --
it is always retained in memory. If you have a large number (many
thousands) of items, use an <EM>Arbitrary Database</EM> instead.
<p>
<DT><STRONG>

<A NAME="minivend_pricing_asc_0">
pricing.asc</A>

</STRONG>
<DD>
The database of quantity pricing information. It must be defined as
the regular MiniVend database <STRONG>pricing</STRONG>, with the product code as
the first field, and a field named <STRONG>price</STRONG> (all lower case) that holds
space-separated price information in the order defined by 
<A HREF="minivend.html#minivend_pricebreaks_0">PriceBreaks</A>
.
Also subject to 
<A HREF="minivend.html#minivend_mixmatch_0">MixMatch</A>
. In addition, this database <EM>may</EM> hold
information about price adjustments -- see 
<A HREF="minivend.html#minivend_priceadjustment_0">PriceAdjustment</A>
.  This is
a database that can be in any form, including SQL/DBI if desired.  The
only requirement is the presence of the <STRONG>price</STRONG> field in the proper
format, and an appropriate key.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_the_3">
The Product Database</A>
</H2>
Each product you are selling should be given a product code: A short
code that identifies the product on the ordering page and in the
catalog. You can use any combination of letters, digits, dashes,
periods, hash signs, or underscores for the product code. The

<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file is a ASCII-delimited list of all the product codes,
along with an arbitrary number of fields which must contain at least the
fields 
<A HREF="minivend.html#minivend_description_2">description</A>
 and <CODE>price</CODE> (or whatever you set the PriceField and
DescriptionField directives to). Any additional information you want in
the catalog can be placed in any arbitrary field.
See <EM>MiniVend Database Capability</EM>for details on the format.
<p>Field names are case-sensitive. Unless you have fields with the names
``description'' and ``price'' field, you will have to appropriately set the

<A HREF="minivend.html#minivend_pricefield_0">PriceField</A>
 and 
<A HREF="minivend.html#minivend_descriptionfield_0">DescriptionField</A>
 directives to use the [item-price]
and [item-description] tags.
<p>The product code must be the first field in the line, and must be
unique. Product codes can contain the characters <STRONG>A-Za-z0-9</STRONG>, along with
hyphen (<CODE>-</CODE>), underscore (<CODE>_</CODE>), pound sign/hash mark (<CODE>#</CODE>), slash (<CODE>/</CODE>),
and period (<CODE>.</CODE>).
<p>The words should be separated by one of the approved delimiting schemes
(TAB, PIPE, or CSV, set with the 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>
 directive), and are
case-sensitive. If you play with the case of the ``description'' or ``price''
field, you will have to appropriately set the 
<A HREF="minivend.html#minivend_pricefield_0">PriceField</A>
 and

<A HREF="minivend.html#minivend_descriptionfield_0">DescriptionField</A>
 directives.
<p><STRONG>NOTE:</STRONG> CSV is not recommended as the scheme for the products database.
It is much slower than TAB- or PIPE-delimited, and dramatically
reduces search engine functionality -- no field-specific searches are
possible. Don't use it unless you know <STRONG>exactly</STRONG> what you are doing --
you will be sorry if you do. Using CSV for any small database that
will not be searched is fine.
<p>
<H2> 
<A NAME="minivend_arbitrary_0">
Arbitrary Databases</A>
</H2>
MiniVend can manage an unlimited number of arbitrary database
tables.  They are in the same format as the products file by default,
but an unlimited number of addressable schemes are available. These are
defined by default:
<p>
<XMP>
    Type 1      DEFAULT - uses default delimiter set by Delimiter
    Type 2      LINE
                Each field on its own line, a blank line or lines
                separates the record. Watch those carriage
                returns!
    Type 3      %%
                Fields separated by a \n%%\n combination, records by
                \n%%%\n (where \n is a newline). Watch those carriage
                returns!
    Type 4      CSV
    Type 5      PIPE
    Type 6      TAB
    Type 7      mSQL
    Type 8      SQL

</XMP>
<p>The databases are specified in 
<A HREF="minivend.html#minivend_database_0">Database</A>
 directives, as:
<p>
<XMP>
    Database    Arbitrary arbitrary.csv CSV

</XMP>
<p>That specifies a type 4 database, the ASCII version of which is located in the
file arbitrary.csv, and the identifier it will be accessed under in MiniVend is
``Arbitrary''.  The DBM file, if any, will be created in the <STRONG>same directory</STRONG> if
the ASCII file is newer, or if the DBM file does not exist.  The files will be
created as arbitrary.db or arbitrary.gdbm, depending on DBM type.
<p>The 
<A HREF="minivend.html#minivend_identifier_0">identifier</A>
 is case sensitive, and can only contain characters
in the class [<STRONG>A-Za-z0-9_</STRONG>]. Fields are accessed with the
[item_data 
<A HREF="minivend.html#minivend_identifier_0">identifier</A>
 field] or [data 
<A HREF="minivend.html#minivend_identifier_0">identifier</A>
 field key] elements.
<p>
<H2> 
<A NAME="minivend_minivend_0">
MiniVend built-in database support</A>
</H2>
If you specify one of the first 6 types, the database will automatically
be built in the default MiniVend DB style. You cannot mix the styles -- all 
built-in databases on a single server will be the same style. They will
coexist just fine with an unlimited number of DBI databases of different
types.
<p>In addition to the database, the session files will be kept in the
default format, and are affected by the actions below.
<p>The order of preference is:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_gdbm_0">
GDBM</A>

</STRONG>
<DD>
This uses the Perl GDBM_File module to build a GDBM database. You can
see if GDBM is in your perl with the command:
<p>
<XMP>
    perl -e 'require GDBM_File and print "I have GDBM.\n"'

</XMP>
<p>Installing GDBM_File requires rebuilding Perl after obtaining the
GNU GDBM package, and is beyond the scope of this forum. Linux will 
typically have this by default -- most other operating systems will
need to specifically build this in.
<p>
<DT><STRONG>

<A NAME="minivend_db_file_0">
DB_File (Berkeley DB)</A>

</STRONG>
<DD>
This uses the DB_File module to build a Berkeley DB (hash) database. You can
see if DB_File is in your perl with the command:
<p>
<XMP>
    perl -e 'require DB_File and print "I have Berkeley DB.\n"'

</XMP>
<p>Installing DB_File requires rebuilding Perl after obtaining the
Berkeley DB package, and is beyond the scope of this document. BSDI,
FreeBSD, and Linux will typically have it by default -- most other
operating systems will need to specifically build this in.
<p>If you wish to use DB_File even though you have GDBM_File in your
Perl, you must set the environment variable MINIVEND_DBFILE to
a true (non-zero, non-blank) value:
<p>
<XMP>
    # csh or tcsh
    setenv MINIVEND_DBFILE 1
    # sh, bash, or ksh
    MINIVEND_DBFILE=1 ; export MINIVEND_DBFILE

</XMP>
<p>Then re-start the server.
<p>
<DT><STRONG>
<EM>In-memory</EM>
</STRONG>
<DD>
This uses Perl hashes to store the data directly in memory. Every time
you restart the MiniVend server, it will re-import all in-memory databases
for every catalog. 
<p>If you wish to use this despite the presence of GDBM_File or DB_File,
set the environment variable MINIVEND_NODBM as above, then re-start
the server.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_character_0">
Character usage restrictions</A>
</H2>
To review, database identifiers, field names, and product codes (database keys)
are restricted in the characters they may use. A short table showing
restrictions:
<p>
<XMP>
                                       Legal characters
                                       ---------------------
    Database identifiers               A-Z a-z 0-9 _
    Field names                        A-Z a-z 0-9 _ # - . /
    Database keys (product code/SKU)   A-Z a-z 0-9 _ # - . /
    Database values                    Any (subject to field/record delimiter)

</XMP>
<p>You probably should restrict the field names to the same set of characters
as database identifiers -- this will prevent conflict with external database
programs, noticeably SQL databases which use the period (.) as a table.field
separator.
<p>
<H2> 
<A NAME="minivend_import_0">
Import Attributes</A>
</H2>
Especially in SQL databases, there are certain things that can be set with
additional database attributes.  For text import, the CONTINUE extended
database import attribute allows additional control over the format of
imported text.
<p>NOTE: CONTINUE applies to all types except CSV.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_continue_0">
CONTINUE</A>

</STRONG>
<DD>
One of UNIX or DITTO. The default is to simply split the line/record
according to the delimiter, with no possible spanning of records. Setting
CONTINUE to UNIX appends the next line to the current when it encounters
a backslash (<CODE>\</CODE>) at the end of a record, just like many Unix commands
and shells.
<p>DITTO is invoked when the key field is blank -- it adds the contents of
following fields to the one above, separated by a newline character. This
allows additional text to be added to a field beyond the 255 characters
available with most spreadsheets and flat-file databaseses.
<p>Example in catalog.cfg:
<p>
<XMP>
  Database products products.asc  TAB
  Database products CONTINUE      DITTO

</XMP>
<p>Products.asc file:
<p>
<XMP>
  code     price     description
  00-0011  500000    The Mona Lisa, one of the worlds great masterpieces.
                     Now at a reduced price!

</XMP>
<p>The description for product 00-0011 will contain the contents of the

<A HREF="minivend.html#minivend_description_2">description</A>
 field on both lines, separated by a newline.
<p>NOTE: Fields are separated by tabs, formatted for reading convenience.
<p>This <EM>will</EM> work for multiple fields in the same record. If the field
contains any non-empty value, it will be appended.
<p>
</DL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_sql_0">
SQL SUPPORT</A>
</H1>
MiniVend can use any of a number of SQL databases through the powerful
Perl DBI/DBD access methods. No SQL database is included with MiniVend,
but there are a number widely available on the net, and many are free
for non-commercial use.  Some examples include mSQL, mySQL, Solid, and Qbase.
<p>It is beyond the scope of this document to describe SQL, mSQL,
or DBI/DBD, and we will not attempt to. Sufficient familiarity is assumed. 
<p>In most cases, MiniVend cannot perform administrative functions like
creating a database or setting access permissions.  This must be done
with the tools provided with your SQL distribution.  But if given a
blank database and the permission to read and write it, MiniVend can
import ASCII files and bootstrap you from there.
<p>
<H2> 
<A NAME="minivend_msql_0">
Msql support</A>
</H2>
The first minimal SQL support provided by MiniVend was for the Msql.pm module.
This is now deprecated in favor of the DBI support. In most cases, existing
Msql users should be able to install and test DBD::mSQL, then change the
database directive to the type of <CODE>dbi:mSQL:minivend</CODE> and go from there.  You
may have to set your directive to <CODE>dbi:mSQL:minivend:localhost:1114</CODE> or some
other value corresponding to host and TCP port.
<p>
<H2> 
<A NAME="minivend_sql_1">
SQL support via DBI</A>
</H2>
MiniVend now provides complete external SQL database support via the Perl
DBI and DBD modules. This allow transparent access to any database that
is supported by a DBD module.  The current list includes mSQL, mySQL,
Solid, Postgres, Oracle, Sybase, Informix, Ingres, Qbase, DB2, Fulcrum,
and others. Any ODBC (with appropriate driver) should also be supported.
<p>The configuration of the DBI database is done by setting attributes in
additional 
<A HREF="minivend.html#minivend_database_0">Database</A>
 directives <STRONG>after</STRONG> the initial defining line as
described above. For example, the following defines the database <STRONG>arbitrary</STRONG>
as a DBI database, sets the data source (DSN) to an appropriate value for an
mSQL database named <CODE>minivend</CODE> on port 1114 of the local machine:
<p>
<XMP>
    Database arbitrary arbitrary.asc SQL
    Database arbitrary DSN           dbi:mSQL:minivend:localhost:1114

</XMP>
<p>As a shorthand method, you can instead include the DSN as the type:
<p>
<XMP>
    Database arbitrary arbitrary.asc dbi:mSQL:minivend:localhost:1114

</XMP>
<p>Supported configuration attributes include (but are not limited to):
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_dsn_0">
DSN</A>

</STRONG>
<DD>
A specification of the DBI driver and its data source. To use the
DBD::mSQL driver for DBI, you would typically use:
<p>
<XMP>
    dbi:mSQL:minivend:othermachine.my.com:1112

</XMP>
<p>where mSQL selects the driver (case IS important), <CODE>minivend</CODE> selects the
database, <CODE>othermachine.my.com</CODE> selects the host, and 1112 is the port.
On many systems, <CODE>dbi:mSQL:minivend</CODE> will work just fine. (The <CODE>minivend</CODE>
database must already exist, of course.)
<p>This is the same as the <STRONG>DBI_DSN</STRONG> environment variable -- if you don't set
the DSN parameter, then the value of <STRONG>DBI_DSN</STRONG> will be used to
try and find the proper database to connect to.
<p>
<DT><STRONG>

<A NAME="minivend_user_1">
USER</A>

</STRONG>
<DD>
The user name you log into the database with -- same as the environment
variable <STRONG>DBI_USER</STRONG>. If you don't need a user name, just don't set
the USER directive.
<p>
<DT><STRONG>

<A NAME="minivend_pass_0">
PASS</A>

</STRONG>
<DD>
The password you log into the database with -- same as the environment
variable <STRONG>DBI_PASS</STRONG>. If you don't need a password, just don't set
the PASS directive.
<p>
<DT><STRONG>

<A NAME="minivend_column_def_0">
COLUMN_DEF</A>

</STRONG>
<DD>
A comma-separated set of lines in the form NAME=TYPE(N), where NAME
is the name of the field/column, TYPE is the SQL data type reference,
and N is the length (if needed).  Most MiniVend fields should be of the
fixed-length character type, something like char(128). In fact that is the
default if you do not choose a type for a column.  You can have as many
lines as needed. This is not a DBI parameter, it is specific to MiniVend.
<p>
<DT><STRONG>

<A NAME="minivend_name_0">
NAME</A>

</STRONG>
<DD>
A space-separated field of column names for a table.  Normally not used --
MiniVend should resolve the column names properly upon query.  Set this if
your catalog errors out with ``dbi: can't find field names'' or the like.
The first field should always be 
<A HREF="minivend.html#minivend_code_0">code</A>
. This is not a DBI parameter,
it is specific to MiniVend. All columns must be listed, in order of their
position in the table.
<p>
<DT><STRONG>

<A NAME="minivend_numeric_0">
NUMERIC</A>

</STRONG>
<DD>
Tells MiniVend to not quote values for this field; allows numeric data
types for SQL databases. Placed as a space-separated field of column names
for a table, in no particular order. This must be defined if you are to
use an numeric value, as DBI does not yet have standard type queries.
<p>
<DT><STRONG>

<A NAME="minivend_delimiter_0">
DELIMITER</A>

</STRONG>
<DD>
A MiniVend delimiter type - one of TAB,CSV,PIPE,%<STRONG>%,</STRONG>LINE or the corresponding
numeric type. It can also be a custom delimiter as specified with 
<A HREF="minivend.html#minivend_fielddelimiter_0">FieldDelimiter</A>

and 
<A HREF="minivend.html#minivend_recorddelimiter_0">RecordDelimiter</A>
. The default for SQL (and Msql) databases is TAB -- use 
DELIMITER if you wish to import another type. This is not a DBI parameter, it
is specific to MiniVend.
<p>
<DT><STRONG>

<A NAME="minivend_key_1">
KEY</A>

</STRONG>
<DD>
You can change the keying default of 
<A HREF="minivend.html#minivend_code_0">code</A>
 in the first column of the
database with the KEY directive. <STRONG>Don't use this unless you know exactly</STRONG>
<STRONG>what you are doing and are prepared to alter all searches, imports, and</STRONG>
<STRONG>exports accordingly.</STRONG>  It is best to just accept the default and 
make the first column the key for any MiniVend database.
<p>
<DT><STRONG>

<A NAME="minivend_chopblanks_longreadlen_longtruncok_raiseerror_0">
ChopBlanks,LongReadLen,LongTruncOK,RaiseError, etc.</A>

</STRONG>
<DD>
Sets the corresponding DBI attribute. Of particular interest is ChopBlanks,
which should be set on drivers which by default return space-padded fixed-length
character fields (Solid is an example).
<p>The supported list as of release of MiniVend 3.02 is:
<p>
<XMP>
  ChopBlanks
  CompatMode
  LongReadLen
  LongTruncOk
  PrintError
  RaiseError
  Warn

</XMP>
<p>Issue the shell command <CODE>perldoc DBI</CODE> for more information.
<p>
</DL>
Here is an example of a completely set up DBI database on mySQL, using.a comma-separated value input, setting the DBI attribute LongReadLen to
retrieve an entire field, and changing some field definitions from the
default char(128):
<p>
<XMP>
  Database   products  products.csv  dbi:mysql:minivend:localhost:3333
  Database   products  USER          mike
  Database   products  PASS          NeVairBE
  Database   products  DELIMITER     CSV
 
  # Set a DBI attribute
  Database   products  LongReadLen   128
 
  # change some fields from the default field type of char(128)
  # Only applies if Minivend is importing from ASCII file
  # If you set a field to a numeric type, you must set the
  # NUMERIC attribute
  Database   products  COLUMN_DEF    price=float, code=char(20)
  Database   products  COLUMN_DEF    author=char(40), title=char(64)
  Database   products  COLUMN_DEF    nontaxable=char(3)
  Database   products  NUMERIC       price

</XMP>
<p>You must have mySQL, DBI, and DBD::mysql completely installed and
tested, and have created the database <CODE>minivend</CODE> for this to work.
Permissions are difficult on mySQL -- if you have trouble, try starting
the mySQL daemon with <CODE>safe_mysqld --skip-grant-tables &amp;</CODE> for testing
purposes.
<p>To change to ODBC, the only changes required might
be:
<p>
<XMP>
    Database products  DSN         dbi:ODBC:TCP/IP localhost 1313
    Database products  ChopBlanks  1

</XMP>
<p>The DSN setting is specific to your ODBC setup.  The <STRONG>ChopBlanks</STRONG> setting takes
care of the space-padding in Solid and some other databases -- it is not
specific to ODBC.  Once again, DBI, DBD::ODBC, and the and appropriate ODBC
driver must be installed and tested.
<p>
<H2> 
<A NAME="minivend_sql_2">
SQL Access Methods</A>
</H2>
A MiniVend SQL database can be accessed with the same tags as any of
the other databases can. In addition to those standard methods, direct
SQL support is provided with the [sql function] TEXT [/sql identifier]
tag set.  The MiniVend database identifier only needs to be set if the
table resides in a different database than the main products database --
if you don't use SQL for the products database you will ALWAYS need to
set it.
<p>For any of these, you may pass arguments with the [arg]argument[/arg]
quoting method, which substitutes the contained value for successive values
of <CODE><STRONG>%s</STRONG></CODE> in the query. For example:
<p>
<XMP>
        [sql html]
        [arg][value passed_title][/arg]
        [arg][value passed_artist][/arg]
                select code, title, title from products
                        where artist = %s and title = %s
        [/sql]
  *    optional parameter
  SQL  Any valid SQL query (usually a select)

</XMP>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_sql_3">
[sql array] SQL [/sql identifier*]</A>

</STRONG>
<DD>
A complete array of arrays, suitable for <EM>eval</EM> by Perl, can be returned
by this query. This tag pair encloses any valid SQL query, and returns
the results (if any) as a string representing rows and columns, in Perl
array syntax. If placed in an embedded Perl area as:
<p>
<XMP>
 [perl]

</XMP>
<PRE>
    my <STRONG>$string</STRONG> =&lt;&lt;'EOF';
 [sql array]select * from arbitrary where code &lt;= '19'[/sql arbitrary]
 EOF
    my $ary = eval $string;
    my $out = '';
    my $i;
    foreach $i (@$ary) {
        $out .= $i->[0];
        $out .= "<BR>";
    }
    $out;
 [/perl]

</PRE>
<p>NOTE: The 'EOF' string terminator must START the line, and not
have trailing characters. DOS users, beware of carriage returns!
<p>
<DT><STRONG>

<A NAME="minivend_sql_4">
[sql hash] SQL [/sql identifier*]</A>

</STRONG>
<DD>
A complete hash of hashes, suitable for <EM>eval</EM> by Perl, can be returned
by this query. This tag pair encloses any valid SQL query, and returns
the results (if any) as a string representing rows and columns, in Perl
associative array, or hash, syntax. If placed in an embedded Perl area as:
<p>
<XMP>
 [perl]

</XMP>
<PRE>
    my <STRONG>$string</STRONG> =&lt;&lt;'EOF';
 [sql hash]select * from arbitrary where code &lt;= '19'[/sql]
 EOF
    my $hash = eval $string;
    my $out = '';
    my $key;
    foreach $key (keys %$hash) {
        $out .= $key->{field1};
        $out .= "<BR>";
    }
    $out;
 [/perl]

</PRE>
<p>
<DT><STRONG>

<A NAME="minivend_sql_5">
[sql set] SQL [/sql identifier*]</A>

</STRONG>
<DD>
Any arbitrary SQL query can be passed with this method. No return
text will be sent. This might be used for passing an order to an 
order database, perhaps on the order report or receipt page. An
example might be:
<p>
<XMP>
 [sql set]
     insert into orders
     values
      ('[value mv_order_number]',
       '[value name escape]',
       '[value address escape]',
       '[value city escape]',
       '[value state escape]',
       '[value zip escape]',
       '[value phone escape]',
       '[item-list]
         Item: [item-code] Quan: [item-quantity] Price: [item-price]
        [/item-list]'
      )
 [/sql orders]

</XMP>
<p>The values entered by the user are escaped, which prevents errors if
quote characters have slipped into their entry.
<p>
<DT><STRONG>

<A NAME="minivend_sql_6">
[sql param] SQL [/sql]</A>

</STRONG>
<DD>
A list of keys, or in fact any SQL fields, can be returned as a set of
parameters suitable for passing to a program or list primitive. This tag pair
encloses any valid SQL query, and returns the results (if any) as a series of
space separated fields, enclosed in quotes. This folds the entire return
into a single row, so it may be used as a list of keys.
<p>
<DT><STRONG>

<A NAME="minivend_sql_7">
[sql html] SQL [/sql]</A>

</STRONG>
<DD>
This tag returns a set of HTML table rows with <STRONG>bold</STRONG> field names at
the top, followed by each row in a set of table cells. The &lt;TABLE&gt;
and &lt;/TABLE&gt; tags are not supplied, so you can set your own border
and shading options. Example:
<p>
<XMP>
  <TABLE BORDER=2>
  [sql html]select * from arbitrary where code > '19' order by field2[/sql]
  </TABLE>

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sql_8">
[sql list SQL] list [/sql]</A>

</STRONG>
<DD>
This tag differs from the rest in that it passes the query enclosed
inside the tag itself. The enclosed text is then evaluated with the
same method as with a loop list, with data items (in columns) iterated
over for the contents of a list. The following snippet will place
a three-column list in an HTML table:
<p>
<XMP>
  <TABLE BORDER=2>
  <TR><TH><B>SKU</B></TH><TH><B>Description</B></TH><TH><B>Price</B></TH>
  [sql list
    select * from arbitrary where code > '19' order by field2 ]
  <TR>
    <TD>[page [sql-code]][sql-code]</A></TD>
    <TD>[sql-param 1]</TD>
    <TD>[sql-param 2]</TD>
  </TR>
  [/sql]
  </TABLE>

</XMP>
<p>It uses the same tags as in the [loop_list], except prefixed
with <CODE>sql</CODE>. Available are the following, in order of interpolation:
<p>
<XMP>
  [sql_param n]        Field n of the returned query (in the row)
  [if_sql_field fld]   Returns enclosed text only product field not empty
  [/if_sql_field]      Terminator for above
  [if_sql_data db fld] Returns enclosed text only if data field not empty
  [/if_sql_field]      Terminator for above
  [sql_increment]      Returns integer count of row
  [sql_code]           The first field of each row returned
  [sql_data db fld]    Database field for [sql_code]
  [sql_description]    Product description for [sql_code]
  [sql_field fld]      Product field for [sql_code]
  [sql_link]           Same as item-link
  [sql_price q*]       Price for [sql_code], optional quantity q

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_importing_0">
Importing from an ASCII file</A>
</H2>
When importing a file for SQL, MiniVend by default uses the
first column of the ASCII file as the primary key, with a <CODE>char(16)</CODE>
type, and assigns all other columns a <CODE>char (128)</CODE> definition. These
definitions can be changed by placing the proper definitions in COLUMN_DEF

<A HREF="minivend.html#minivend_database_0">Database</A>
 directive attribute:
<p>
<XMP>
  Database  products  COLUMN_DEF  price=char(20), nontaxable=char(3)

</XMP>
<p>You can set this as many times as desired if it will not fit on
the line nicely. 
<p>
<XMP>
  Database  products  COLUMN_DEF  price=char(20), nontaxable=char(3)
  Database  products  COLUMN_DEF  description=char(254)

</XMP>
<p>To create an index automatically, you can append information when
the value is in quotes:
<p>
<XMP>
  Database  products  COLUMN_DEF  "code=char(14) primary key"

</XMP>
<p>The field delimiter to use is TAB by default, but can be changed 
with the Database DELIMITER directive:
<p>
<XMP>
  Database  products products.csv dbi:mSQL:minivend:localhost:1114
  Database  products DELIMITER  CSV

</XMP>
<p>If you wish to create other secondary keys to speed sorts and
searches, you can either use MiniVend tags in an admin menu
page
<p>
<XMP>
  [sql set]CREATE INDEX CATEGORY_IDX on products (category)[/sql]

</XMP>
<p>or use external database tools. Careful! Not all SQL databases use
the same index commands. For example, with MySQL you would do instead:
<p>
<XMP>
  [sql set]ALTER TABLE products CHANGE category category char(128) key[/set]

</XMP>
<p>If you wish to use an existing SQL database instead of importing, set the

<A HREF="minivend.html#minivend_noimport_0">NoImport</A>
 directive in catalog.cfg to include any database identifiers you
never wish to import:
<p>
<XMP>
    NoImport  products inventory

</XMP>
<p><STRONG>WARNING:</STRONG> If MiniVend has write permission on the products database,
you <STRONG>must</STRONG> be careful to set the 
<A HREF="minivend.html#minivend_noimport_0">NoImport</A>
 directive or create the
proper .sql file. If that is not done, and the database source file
is changed, the SQL database could be overwritten. In any case,
always back up your database before enabling it for use by MiniVend.
<p>
<H2> 
<A NAME="minivend_exporting_0">
Exporting from a database</A>
</H2>
To export your existing database to a file suitable for searching by
MiniVend, you can create an 
<A HREF="minivend.html#minivend_adminpage_0">AdminPage</A>
 (or any page, for that matter)
that contains a [tag export ...][/tag] element. For example, the following
UNIX shell script will create a page only accessible to the <EM>AdminUser</EM>
which will export the products database to the MiniVend default search
file 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
:
<p>
<XMP>
    #!/bin/sh
    # Set the catalog directory.  If you put this file in a
    # catalog template (like simple or sample), it should be set
    # up correctly.
    #
    # Example: 
    #  
    #  CATDIR=/home/me/catalogs/simple
    #
    CATDIR=__MVC_CATROOT__
    cd $CATDIR
    # make a directory
    mkdir pages/admin
    # protect it. If you have trouble with "VIOLATION", you can
    # remove the file temporarily.
    echo "protected" > pages/admin/.access

</XMP>
<PRE>
    # create the page.
    cat &lt;&lt;EOF &gt; pages/admin/export.html
    &lt;HTML&gt;&lt;HEAD&gt;
    &lt;TITLE&gt;Export products.asc&lt;/TITLE&gt;
    &lt;/HEAD&gt;
    &lt;BODY>
    [if explicit ``[tag export products products.asc TAB][/tag]'']
    Exported OK!
    [else]
    &lt;FONT COLOR=RED&gt;Error on export:&lt;/FONT&gt; [data session last_error]
    [/else]
    [/if]
    &lt;/BODY>&lt;/HTML&gt;
    EOF
    # Voila! Access with something like:
    #
    #     http://yourcatalog.com/cgi-bin/simple/admin/export

</PRE>
<p>Perhaps a better method is to define the same sort of tags in an

<A HREF="minivend.html#minivend_orderprofile_0">OrderProfile</A>
, and then use forms and buttons to access the 
profile.
<p><p><hr>

<H1> 
<A NAME="minivend_minivend_1">
MINIVEND TAG REFERENCE</A>
</H1>
To build complex order forms and reports, MiniVend has a complete
tag language with over 80 different functions.
<p>There is conditional capability with the [if ...] text [else] else-text
[/else][/if] construct. It allows for testing for a condition within the
Vend session, and if true, inserting text and/or HTML. If the condition
is not true, no text (or the optional [else] text) will be inserted.
<p>This facility cannot be considered a language, for constructs cannot be
nested in a linear fashion, and operations cannot be performed (except
as side effects to the [if] tag).
<p>Most of the tests use Perl code, but MiniVend uses the Safe module with
its default restrictions to help ensure that improper code will not
crash the server or modify the wrong data. There is nothing to be done
if your code enters an endless loop, though, and you have to use this
capability with caution.
<p>
<H2> 
<A NAME="minivend_new_0">
New and Old syntax</A>
</H2>
Starting with MiniVend 3.0, a new tag syntax becomes operational.
It overcomes some of the limitations of MiniVend conditional HTML, and
has sequential evaluation.
<p>To use the new more regular syntax by default, set the 
<A HREF="minivend.html#minivend_newtags_0">NewTags</A>

directive to <CODE>Yes</CODE>. The demo catalog is distributed with 
<A HREF="minivend.html#minivend_newtags_0">NewTags Yes</A>

starting at MiniVend 3.07.
<p>In most cases, tags specified in the old fashion will work the same
in the new syntax. The only time you will need to modify them is when
there is some ambiguity as to which parameter is which, or when you need
to use the output of a tag as the attribute parameter for another tag.
<p>With some exceptions ([if ....] [/if], [include] and [buttonbar ..] among
them) the output of a tag will not be re-interpreted for MiniVend tag
constructs. All tags accept the INTERPOLATE=1 tag modifier, which causes
the interpretation to take place. It is frequent that you will <STRONG>not</STRONG>
want to interpret the contents of a [set variable] TAGS [/set] pair,
as that might contain tags which should only be upon evaluating an
order profile, search profile, or <EM>mv_click</EM> operation. If you wish
to perform the evaluation at the time a variable is set, you would use
[set name=variable interpolate=1] TAGS [/set].
<p>To use the new syntax only on a particular page, place <STRONG>one</STRONG> <CODE>[new]</CODE>
tag in your page. Likewise, to use old syntax when new is the default,
place <STRONG>one</STRONG> <CODE>[old]</CODE> tag in the page.
<p>If you have regions of the page which work under the old syntax,
you can surround them with [compat] [/compat] tag pair. This will
evaluate that region only according to the old syntax.
<p><STRONG>NOTE WHEN USING OLD SYNTAX:</STRONG> MiniVend interpolates tags in a highly
ordered fashion, with each tag having a precedence. The order of the
tag interpolation can be changed by enclosing the tag in a set of
double square brackets, bringing it forward in the process. The order
of interpolation is:
<p>
<XMP>
  tag [[ANY TAG]] cart item-list loop default value scratch calc if lookup
  set data msql|sql file finish_order frames_on frames_off 
  framebase body help buttonbar random rotate checked selected
  accessories field pagetarget area areatarget page last_page
  perl order nitems discount subtotal shipping shipping_description
  salestax total_cost price currency description row process_order
  process_search process_target

</XMP>
<p>
<H2> 
<A NAME="minivend_data_0">
DATA and FIELD</A>
</H2>
The [data ...] and [field ...] tags access elements of MiniVend databases.
They are the form used outside of the iterating lists, and can be effecfively
used to do lookups when the table, column/field or key/row is conditional based
on a previous operation.
<p>The following are equivalent for attribute names:
<p>
<XMP>
        base  ---> table --> database
        name  ---> field --> column --> col
        code  ---> key   --> row

</XMP>
<p>
<DL COMPACT>
<DT><STRONG>
<EM>[data area field key ``value''* increment*]</EM>
</STRONG>
<DD>
(new syntax:
    [data base=``database'' field=``field'' key=``key''
        value=``value'' op="increment] )
<p>Returns the value of the field in any of the arbitrary databases,
or from the variable namespaces. If the optional 
<A HREF="minivend.html#minivend_value_1">value</A>
 is supplied,
the database value will be changed to it -- no ] characters may be
present in the value unless using the new tag style. If the option
increment* is present, the field will be atomically incremented with
the value in 
<A HREF="minivend.html#minivend_value_1">value</A>
.
<p>If a DBM-based database is to be modified, it must be flagged writable
on the page calling the write tag. Use [tag flag write]products[/tag]
to mark the 
<A HREF="minivend.html#minivend_products_0">products</A>
 database writable, for example.
<p>In addition, the <CODE>[data ...]</CODE> tag can access a number of elements in
the MiniVend session database:
<p>
<XMP>
    accesses      Accesses within the last 30 seconds
    arg           The argument passed in a [page ...] or [area ...] tag
    browser       The user browser string
    host          MiniVend's idea of the host (modified by DomainTail)
    last_error    The last error from the error logging
    last_url      The current MiniVend path_info
    logged_in     Whether the user is logged in (addon UserDB feature)
    pageCount     Number of unique URLs generated
    prev_url      The previous path_info
    referer       HTTP_REFERER string
    ship_message  The last error messages from shipping
    source        Source of original entry to MiniVend
    time          Time (seconds since Jan 1, 1970) of last access
    user          The REMOTE_USER string
    username      User name logged in as (addon UserDB feature)

</XMP>
<p>Databases will hide variables, so don't name a database ``session'',
``scratch'', or any of the other reserved names or you won't be able
to use the [data ...] tag to read them. Case is sensitive, so in
a pinch you could call the database ``Session'', but it would be better
not to.
<p>
<DT><STRONG>

<A NAME="minivend_field_1">
[field name code]</A>

</STRONG>
<DD>
(new syntax [field code=``code'' name=``fieldname''])
<p>Expands into the value of the field <EM>name</EM> for the product
identified by 
<A HREF="minivend.html#minivend_code_0">code</A>
 as found by searching the products database.
It will return the first entry found in the series of <EM>Product Files</EM>.
the products database. If you want to constrain it to a particular
database, use the [data base name code] tag.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_set_0">
SET and SCRATCH</A>
</H2>
Scratch variables are maintained in the user session separate from the
form variable values set on HTML forms.
<p>Many things can be controlled with scratch variables, notable search and
order processing, the <EM>mv_click</EM> multiple variable setting facility, and
key MiniVend conditions like whether an item will be ordered on a separate
line.
<p>There are two tags which are used to access the space, [set name]value[/set]
and [scratch name].
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_set_1">
[set variable]value[/set]</A>

</STRONG>
<DD>
(new syntax [set name=``variable''] value [/set])
<p>Sets a scratchpad variable to 
<A HREF="minivend.html#minivend_value_1">value</A>
.
<p>Most of the mv_* variables that are used for search and order conditionals are
in another namespace -- they can be set by means of hidden fields in a
form.
<p>You can set an order profile with:
<p>
<XMP>
  [set checkout]
  name=required
  address=required
  [/set]
  <INPUT TYPE=hidden NAME=mv_order_profile VALUE="checkout">

</XMP>
<p>A search profile would be set with:
<p>
<XMP>
  [set substring_case]
  mv_substring_match=yes
  mv_case=yes
  [/set]
  <INPUT TYPE=hidden NAME=mv_profile VALUE="substring_case">

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_scratch_0">
[scratch name]</A>

</STRONG>
<DD>
Returns the contents of a scratch variable to the page.
<p>
<DT><STRONG>

<A NAME="minivend_if_1">
[if scratch name op* compare*] .... [/if]</A>

</STRONG>
<DD>
Tests a scratch variable (see 
<A HREF="minivend.html#minivend_if_2">IF</A>
).
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_loop_0">
LOOP and TAG EACH</A>
</H2>
Loop lists can be used to construct arbitrary lists based on the contents
of a database field or other value. The [tag each table] [/tag] construct
uses the same interior tags, but iterates over every key of a particular
database table.
<p>Both can be sorted with [sort table:field:mod -start +number] modifiers.
See 
<A HREF="minivend.html#minivend_sorting_0">SORTING</A>
.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_loop_1">
[loop item item item] LIST [/loop]</A>

</STRONG>
<DD>
(new syntax: [loop with=``-a''* arg=``item item item''])
<p>Returns a string consisting of the LIST, repeated for every item in a
comma-separated or space-separated list. Operates in the same fashion
as the [item-list] tag, except for order-item-specific values. Intended
to pull multiple attributes from an item modifier -- but can be useful
for other things, like building a pre-ordained product list on a page.
<p>Loop lists can be nested reliably in MiniVend 3.06 by using the 
with=``tag'' parameter. New syntax:
<p>
<XMP>
    [loop arg="A B C"]
        [loop with="-a" arg="[loop-code]1 [loop-code]2 [loop-code]3"]
            [loop with="-b" arg="X Y Z"]
                [loop-code-a]-[loop-code-b]
            [/loop]
        [/loop]
    [/loop]

</XMP>
<p>An example in the old syntax:
<p>
<XMP>
    [compat]
    [loop 1 2 3]   
        [loop-a 1 2 3 ]
        [loop-b 1 2 3]
            [loop-code].[loop-code-a].[loop-code-b]
        [/loop-b]
        [/loop-a]
    [/loop]
    [/compat]

</XMP>
<p>All loop items in the inner loop-a loop need to have the <CODE>with</CODE> value
appended, i.e. <CODE>[loop-field-a name]</CODE>, <CODE>[loop-price-a]</CODE>, etc. Nesting
is arbitrarily large, though it will be slow for many levels.
<p>
<DT><STRONG>

<A NAME="minivend_if_loop_data_0">
[if_loop_data table field] IF [else] ELSE [/else][/if_loop_field]</A>

</STRONG>
<DD>
Outputs the IF if the 
<A HREF="minivend.html#minivend_field_2">field</A>
 in <CODE>table</CODE> is non-empty, and the ELSE (if any)
otherwise.
<p>
<DT><STRONG>

<A NAME="minivend_if_loop_field_0">
[if_loop_field field] IF [else] ELSE [/else][/if_loop_field]</A>

</STRONG>
<DD>
Outputs the 
<A HREF="minivend.html#minivend_if_2">IF</A>
 if the 
<A HREF="minivend.html#minivend_field_2">field</A>
 in the 
<A HREF="minivend.html#minivend_products_0">products</A>
 table is non-empty,
and the <STRONG>ELSE</STRONG> (if any) otherwise.
<p>
<DT><STRONG>

<A NAME="minivend_loop_accessories_0">
[loop_accessories]</A>

</STRONG>
<DD>
Evaluates to the value of the Accessories database entry for
the item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_change_0">
[loop_change marker]</A>

</STRONG>
<DD>
Same as <EM>[on_change]</EM> but within loop lists.
<p>
<DT><STRONG>

<A NAME="minivend_loop_code_0">
[loop_code]</A>

</STRONG>
<DD>
Evaluates to the product code for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_data_0">
[loop_data database fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the arbitrary database
table 
<A HREF="minivend.html#minivend_database_1">database</A>
, for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_description_0">
[loop_description]</A>

</STRONG>
<DD>
Evaluates to the product description (from the products file)
for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_field_0">
[loop_field fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the database,  for
the current item.
<p>
<DT><STRONG>

<A NAME="minivend_loop_increment_0">
[loop_increment]</A>

</STRONG>
<DD>
Evaluates to the number of the item in the list. Used
for numbering items in the list.
<p>
<DT><STRONG>

<A NAME="minivend_loop_last_tags_loop_last_0">
[loop_last]tags[/loop_last]</A>

</STRONG>
<DD>
Evaluates the output of the MiniVend tags encased inside,
and if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1)
then the loop iteration will terminate. If the evaluated number is
<STRONG>negative</STRONG>, then the item itself will be skipped. If the evaluated
number is <STRONG>positive</STRONG>, then the item itself will be shown but will be
last on the list.
<p>
<XMP>
      [loop-last][calc]
                return -1 if '[loop-field weight]' eq '';
                return 1 if '[loop-field weight]' < 1;
                return 0;
                [/calc][/loop-last]

</XMP>
<p>If this is contained in your <CODE>[loop list]</CODE> and the weight field is empty,
then a numerical <CODE>-1</CODE> will be output from the [calc][/calc] tags; the
list will end and the item will <STRONG>not</STRONG> be shown. If the product's weight
field is less than 1, a numerical 1 is output.  The item will be shown,
but will be the last item shown.
<p>
<DT><STRONG>

<A NAME="minivend_loop_next_tags_loop_next_0">
[loop_next]tags[/loop_next]</A>

</STRONG>
<DD>
Evaluates the output of the MiniVend tags encased inside, and
if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1) then
the loop will be skipped with no output. Example:
<p>
<XMP>
      [loop-next][calc][loop-field weight] < 1[/calc][/loop-next]

</XMP>
<p>If this is contained in your <CODE>[loop list]</CODE> and the product's weight
field is less than 1, then a numerical 
<A HREF="minivend.html#minivend__1">1</A>
 will be output from the
[calc][/calc] operation. The item will not be shown.
<p>
<DT><STRONG>

<A NAME="minivend_loop_price_0">
[loop_price n*]</A>

</STRONG>
<DD>
Evaluates to the price for optional quantity n (from the products file)
of the current item.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_if_2">
IF</A>
</H2>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_if_3">
[if type field op* compare*]</A>

</STRONG>
<DD>
(new syntax [if type=``type'' term=``field'' op=``op'' compare=``compare''])
<p>
<DT><STRONG>

<A NAME="minivend_if_4">
[if !type field op* compare*]</A>

</STRONG>
<DD>
(new syntax [if type=``!type'' term=``field'' op=``op'' compare=``compare''])
<p>
</DL>
Allows conditional building of HTML based on the setting of various MiniVend.session and database values. The general form is:
<p>
<XMP>
    [if type term op compare]
    [then]
                                If true, this is printed on the document.
                                The [then] [/then] is optional in most
                                cases. If ! is prepended to the type
                                setting, the sense is reversed and
                                this will be output for a false condition.
    [/then]
    [elsif type term op compare]
                                Optional, tested when if fails
    [/elsif] 
    [else]
                                Optional, printed when all above fail
    [/else]
    [/if]

</XMP>
<p>The <CODE>[if]</CODE> tag can also have some variants:
<p>
<XMP>
    [if explicit][condition] CODE [/condition]
                Displayed if valid Perl CODE returns a true value.
    [/if]

</XMP>
<p>You can do some Perl-style regular expressions:
<p>
<XMP>
    [if value name =~ /^mike/]
                                This is the if with Mike.
    [elsif value name =~ /^sally/]
                                This is an elsif with Sally.
    [/elsif]
    [elsif value name =~ /^pat/]
                                This is an elsif with Pat.
    [/elsif]
    [else]
                                This is the else, no name I know.
    [/else]
    [/if]

</XMP>
<p>While the new tag syntax works for <CODE>[if ...]</CODE>, it is more convenient
to use the old in most cases.  It will work fine with both parsers.
The only exception is if you are planning on doing a test on the 
results of another tag sequence:
    
    [if value name =~ /[value b_name]/]
        Shipping name matches billing name.
    [/if]
<p>Oops!  This will not work with the new parser. You must do instead
<p>
<XMP>
    [compat]
    [if value name =~ /[value b_name]/]
        Shipping name matches billing name.
    [/if]
    [/compat]

</XMP>
<p>or
<p>
<XMP>
    [if type=value term=name op="=~" compare="/[value b_name]/"]
        Shipping name matches billing name.
    [/if]

</XMP>
<p>The latter has the advantage of working with any tag:
<p>
<XMP>
    [if type=value term=high_water op="<" compare="[shipping]"]
        Shipping cost is too high, charter a truck.
    [/if]

</XMP>
<p>If you wish to do AND and OR operations, you will have to use 
<CODE>[if explicit]</CODE>. This allows complex testing and parsing of
values.
<p>There are many test targets available:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_config_1">
config Directive</A>

</STRONG>
<DD>
The MiniVend configuration variables. These are set
by the directives in your MiniVend configuration file (or
the defaults).
<p>
<XMP>
    [if config CreditCardAuto]
    Auto credit card validation is enabled.
    [/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_data_2">
data  database::field::key</A>

</STRONG>
<DD>
The MiniVend databases. Retrieves a field in the database and
returns true or false based on the value.
<p>
<XMP>
    [if data products::size::99-102]
    There is size information.
    [else]
    No size information.
    [/else]
    [/if]
    [if data products::size::99-102 =~ /small/i]
    There is a small size available.
    [else]
    No small size available.
    [/else]
    [/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_discount_0">
discount</A>

</STRONG>
<DD>
Checks to see if a discount is present for an item.
<p>
<XMP>
    [if discount 99-102]
    Item is discounted.
    [/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_explicit_0">
explicit</A>

</STRONG>
<DD>
A test for an explicit value. If perl code is placed between
a [condition] [/condition] tag pair, it will be used to make
the comparison. Arguments can be passed to import data from
user space, just as with the [perl] tag.
<p>
<XMP>
    [if explicit]
    [condition]
        $country = '[value country]';
        return 1 if $country =~ /u\.?s\.?a?/i;
        return 0;
    [/condition]
    You have indicated a US address.
    [else]
    You have indicated a non-US address. 
    [/else]
    [/if]

</XMP>
<p>This example is a bit contrived, as the same thing could be
accomplished with [if value country =~ /u\.?s\.?a?/i], but
you will run into many situations where it is useful.
<p>This will work for 
<A HREF="minivend.html#minivend_variable_0">Variable</A>
 values:
<p>
<XMP>
    [if explicit "__MYVAR__"] .. [/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_file_1">
file</A>

</STRONG>
<DD>
Tests for existence of a file. Useful for placing image
tags only if the image is present.
<p>
<XMP>
    [if file /home/user/www/images/[item-code].gif]
    <IMG SRC="[item-code].gif">
    [/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_items_0">
items</A>

</STRONG>
<DD>
The MiniVend shopping carts. If not specified, the cart
used is the main cart. Usually used as a litmus test to
see if anything is in the cart, for example:
<p>
<XMP>
  [if items]You have items in your shopping cart.[/if]
  
  [if items layaway]You have items on layaway.[/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_ordered_0">
ordered</A>

</STRONG>
<DD>
Order status of individual items in the MiniVend shopping
carts. If not specified, the cart used is the main cart.
The following items refer to a part number of 99-102.
<p>
<XMP>
  [if ordered 99-102] ... [/if]
    Checks the status of an item on order, true if item
    99-102 is in the main cart.
  [if ordered 99-102 layaway] ... [/if]
    Checks the status of an item on order, true if item
    99-102 is in the layaway cart.
  [if ordered 99-102 main size] ... [/if]
    Checks the status of an item on order in the main cart,
    true if it has a size attribute.
  [if ordered 99-102 main size =~ /large/i] ... [/if]
    Checks the status of an item on order in the main cart,
    true if it has a size attribute containing 'large'.
    THE CART NAME IS REQUIRED IN THE OLD SYNTAX. The new
    syntax for that one would be:
    [if type=ordered term="99-102" compare="size =~ /large/i"]
    To make sure it is exactly large, you could use:
    [if ordered 99-102 main size eq 'large'] ... [/if]
  [if ordered 99-102 main lines] ... [/if]
      Special case -- counts the lines that the item code is
      present on. (Only useful, of course, when mv_separate_items
      or SeparateItems is defined.)

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_salestax_0">
salestax</A>

</STRONG>
<DD>
The salestax database.
<p>
<XMP>
    [if salestax [value state] > 0]
    There is salestax for your state.
    [else]
    No salestax for your state.
    [/else]
    [/if]

</XMP>
<p>Key matching is case-insensitive.
<p>
<DT><STRONG>

<A NAME="minivend_scratch_1">
scratch</A>

</STRONG>
<DD>
The MiniVend scratchpad variables, which can be set
with the [set name]value[/set] element. 
<p>
<XMP>
    [if scratch mv_separate_items]
    Ordered items will be placed on a separate line.
    [else]
    Ordered items will be placed on the same line.
    [/else]
    [/if]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_session_1">
session</A>

</STRONG>
<DD>
The MiniVend session variables. Of particular interest
are <EM>login</EM>, 
<A HREF="minivend.html#minivend_frames_0">frames</A>
, <EM>secure</EM>, and 
<A HREF="minivend.html#minivend_browser_0">browser</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_0">
shipping</A>

</STRONG>
<DD>
The shipping database.
<p>
<DT><STRONG>

<A NAME="minivend_validcc_0">
validcc</A>

</STRONG>
<DD>
A special case, takes the form [if validcc no type exp_date].
Evaluates to true if the supplied credit card number, type
of card, and expiration date pass a validity test. Does
a LUHN-10 calculation to weed out typos or phony 
card numbers.
<p>
<DT><STRONG>

<A NAME="minivend_value_1">
value</A>

</STRONG>
<DD>
The MiniVend user variables, typically set in search,
control, or order forms. Variables beginning with <CODE>mv_</CODE>
are MiniVend special values, and should be tested/used
with caution.
<p>
</DL>
The 
<A HREF="minivend.html#minivend_field_2">field</A>
 term is the specifier for that area. For example, [if session.frames] would return true if the 
<A HREF="minivend.html#minivend_frames_0">frames</A>
 session parameter was set.
<p>As an example, consider buttonbars for frame-based setups. It would be
nice to display a different buttonbar (with no frame targets) for sessions
that are not using frames:
<p>
<XMP>
    [if session frames]
        [buttonbar 1]
    [else]
        [buttonbar 2]
    [/else]
    [/if]

</XMP>
<p>Another example might be the when search matches are displayed. If
you use the string '[value mv_match_count] titles found', it will display
a plural for only one match. Use:
<p>
<XMP>
    [if value mv_match_count != 1]
        [value mv_match_count] matches found.
    [else]
        Only one match was found.
    [/else]
    [/if]

</XMP>
<p>The <EM>op</EM> term is the compare operation to be used. Compare operations are
as in Perl:
<p>
<XMP>
    ==  numeric equivalence
    eq  string equivalence
    >   numeric greater-than
    gt  string greater-than
    <   numeric less-than
    lt  string less-than
    !=  numeric non-equivalence
    ne  string equivalence

</XMP>
<p>Any simple perl test can be used, including some limited regex matching.
More complex tests are best done with <CODE>[if explicit]</CODE>.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_then_0">
[then] text [/then]</A>

</STRONG>
<DD>
This is optional if you are not nesting if conditions, as the text
immediately following the [if ..] tag is used as the conditionally
substituted text. If nesting [if ...] tags you should use a [then][/then]
on any outside conditions to ensure proper interoplation.
<p>
<DT><STRONG>

<A NAME="minivend_elsif_0">
[elsif type field op* compare*]</A>

</STRONG>
<DD>
(new syntax [elsif type=``type'' term=``field'' op=``op'' compare=``compare''])
<p>Additional conditions for test, applied if the initial <CODE>[if ..]</CODE> test
fails.
<p>
<DT><STRONG>

<A NAME="minivend_else_0">
[else] text [/else]</A>

</STRONG>
<DD>
The optional else-text for an if or if_field conditional.
<p>
<DT><STRONG>

<A NAME="minivend_condition_0">
[condition] text [/condition]</A>

</STRONG>
<DD>
Only used with the [if explicit] tag. Allows an arbitrary expression
<STRONG>in Perl</STRONG> to be placed inside, with its return value interpreted as
the result of the test. If arguments are added to [if explicit args],
those will be passed as arguments are in the <EM>[perl]</EM> construct.
<p>
<DT><STRONG>

<A NAME="minivend_if_5">
[/if]</A>

</STRONG>
<DD>
Terminates an if conditional.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_tag_0">
TAG -- the catchall</A>
</H2>
Many MiniVend functions can be controlled or specified with [tag ...][/tag]
pairs.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_tag_1">
[tag arg* arg*]text[/tag]</A>

</STRONG>
<DD>
Performs any of a number of operations, based on the presence of 
<A HREF="minivend.html#minivend_arg_0">arg</A>
.
The arguments that may be given are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_each_0">
each database</A>

</STRONG>
<DD>
Returns a loop-list with every key in 
<A HREF="minivend.html#minivend_database_1">database</A>
 evaluated
as the [loop-code]. This will return the key and field <CODE>name</CODE>
for every record in the 
<A HREF="minivend.html#minivend_products_0">products</A>
 database:
<p>
<XMP>
    [tag each products][loop-code]  [loop-field name]<BR>[/tag]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_export_0">
export database file* type*</A>

</STRONG>
<DD>
Exports a complete MiniVend database to its text source file (or any
specified file). The integer <CODE>n</CODE>, if specified, will select export in
one of the enumerated MiniVend export formats. The following tag will
export the products database to products.txt (or whatever you have
defined its source file as), in the format specified by the

<A HREF="minivend.html#minivend_database_0">Database</A>
 directive:
<p>
<XMP>
    [tag export products][/tag]

</XMP>
<p>Same thing, except to the file products/new_products.txt:
<p>
<XMP>
    [tag export products products/newproducts.txt][/tag]

</XMP>
<p>Same thing, except the export is done with a PIPE delimiter:
<p>
<XMP>
    [tag export products products/newproducts.txt 5][/tag]

</XMP>
<p>The file is relative to the catalog directory, and only may be
an absolute path name if 
<A HREF="minivend.html#minivend_noabsolute_0">NoAbsolute</A>
 is set to <CODE>No</CODE>.
<p>
<DT><STRONG>

<A NAME="minivend_flag_0">
flag arg</A>

</STRONG>
<DD>
Sets a MiniVend condition.
<p>The following enables writes on the 
<A HREF="minivend.html#minivend_products_0">products</A>
 and <CODE>sizes</CODE> databases
held in MiniVend internal DBM format:
<p>
<XMP>
    [tag flag write]products sizes[/tag]

</XMP>
<p>SQL databases are always writable if allowed by the SQL database itself --
in-memory databases will never be written.
<p>The [tag flag build][/tag] combination forces static build of a page, even
if dynamic elements are contained. Similarly, the [tag flag cache][/tag]
forces search or page caching (not usually wise).
<p>
<DT><STRONG>

<A NAME="minivend_log_0">
log dir/file</A>

</STRONG>
<DD>
Logs a message to a file, fully interpolated for MiniVend tags.
The following tag will send every item code and description in the user's
shopping cart to the file logs/transactions.txt:
<p>
<XMP>
    [tag log logs/transactions.txt]
    [item_list][item-code]  [item-description]
    [/item_list][/tag]

</XMP>
<p>The file is relative to the catalog directory, and only may be
an absolute path name if 
<A HREF="minivend.html#minivend_noabsolute_0">NoAbsolute</A>
 is set to <CODE>No</CODE>.
<p>
<DT><STRONG>

<A NAME="minivend_mime_0">
mime description_string</A>

</STRONG>
<DD>
Returns a MIME-encapsulated message with the boundary as employed
in the other mime tags, and the <CODE>description_string</CODE> used as the 
Content-Description. For example
<p>
<XMP>
   [tag mime My Plain Text]Your message here.[/tag]

</XMP>
<p>will return
<p>
<XMP>
  Content-Type: TEXT/PLAIN; CHARSET=US-ASCII
  Content-ID: [sequential, lead as in mime boundary]
  Content-Description: My Plain Text
  Your message here.

</XMP>
<p>When used in concert with [tag mime boundary], [tag mime header], and
[tag mime id], allows MIME attachments to be included -- typically with
PGP-encrypted credit card numbers. See the demo page ord/receipt.html
for an example.
<p>
<DT><STRONG>

<A NAME="minivend_mime_1">
mime boundary</A>

</STRONG>
<DD>
Returns a MIME message boundary with unique string keyed on
session ID, page count, and time.
<p>
<DT><STRONG>

<A NAME="minivend_mime_2">
mime header</A>

</STRONG>
<DD>
Returns a MIME message header with the proper boundary for that
session ID, page count, and time.
<p>
<DT><STRONG>

<A NAME="minivend_mime_3">
mime id</A>

</STRONG>
<DD>
Returns a MIME message id with the proper boundary for that
session ID, page count, and time.
<p>
<DT><STRONG>

<A NAME="minivend_tag_2">
[tag scan/options]encased text[/tag]</A>

</STRONG>
<DD>
Builds a one-click search based on the enclosed text. 
Properly translates whitespace and non-word characters to
be parseable by MiniVend. You can add the normal scan options,
just the se=searchtext parameter will be affected. These two
sequences evaluate the same:
<p>
<XMP>
    [tag scan/sf=category]Renaissance[/tag]
    [page scan/sf=category/se=Renaissance]Renaissance[/page]

</XMP>
<p>Where it is useful is in adding long strings that would otherwise
be difficult to encode, like
<p>
<XMP>
    [tag scan/sf=author/os=yes]John F. Kennedy[/tag]

</XMP>
<p>instead of:
<p>
<XMP>
    [page scan/sf=author/se=John%20F.%20Kennedy]John F. Kennedy[/page]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_show_tags_0">
show_tags</A>

</STRONG>
<DD>
The encased text will not be substituted for with MiniVend tags, 
with &lt; and [ characters changed to <CODE>&amp;</CODE>#lt; and <CODE>&amp;</CODE>#91; respectively.
<p>
<XMP>
    [tag show_tags][value whatever][/tag]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_time_0">
time</A>

</STRONG>
<DD>
Formats the current time according to POSIX strftime arguments.
The following is the string for Thursday, April 30, 1997.
<p>
<XMP>
    [tag time]%A, %B %d, %Y[/tag]

</XMP>
<p>
<DT><STRONG>
<EM>touch </EM>
</STRONG>
<DD>
Touches a database to allow use of the <EM>tag_data()</EM> routine in 
user-defined subroutines.  If this is not done, the routine
will error out if the database has not previously been accessed
on the page.
<p>
<XMP>
    [tag touch products][/tag]

</XMP>
<p>
</DL>
.
<p>
<DT><STRONG>

<A NAME="minivend_comment_0">
[comment] code [/comment]</A>

</STRONG>
<DD>
Comments out MiniVend tags (and anything else) from a page. The 
contents are not displayed unless DisplayComments is set in minivend.cfg.
Can be nested.
<p>
<DT><STRONG>

<A NAME="minivend_perl_1">
[perl args] code [/perl]</A>

</STRONG>
<DD>
See the section on 
<A HREF="minivend.html#minivend_embedded_0">Embedded Perl Code</A>
.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_user_defined_0">
User-defined Tags</A>
</H2>
MiniVend 3.04 allows the definition of user tags when using the new
parsed HTML syntax (a [new] tag is on the page).  They will not work
with the old syntax. 3.06 adds the tags on a server-wide basis.
<p>To define a tag that is catalog-specific, place <EM>UserTag</EM> directives in
your catalog.cfg file. For server-wide tags, define them in minivend.cfg.
Catalog-specific tags take precedence if both are defined. The directive
takes the form:
<p>
<XMP>
   UserTag  tagname  property  value

</XMP>
<p>where <CODE>tagname</CODE> is the name of the tag, <CODE>property</CODE> is the attribute
(described below), and 
<A HREF="minivend.html#minivend_value_1">value</A>
 is the value of the property for that
tagname.
<p>The user tags can either be based on Perl subroutines or just be
aliases for existing tags. Some quick examples are below.
<p>An alias:
<p>
<XMP>
    UserTag product_name Alias     data products title

</XMP>
<p>This will change [product_name 99-102] into [data products title 99-102],
which will output the <CODE>title</CODE> database field for product code <CODE>99-102</CODE>.
Don't use this with <CODE>[item-data ...]</CODE> and <CODE>[item-field ...]</CODE>, as they
are parsed separately.  You could do <CODE>[product-name [item-code]]</CODE>, though.
<p>A simple subroutine:
<p>
<XMP>
    UserTag company_name Routine   sub { "Your company name" }
 
When you place a [company-name] tag in a MiniVend page, the text 
C<Your company name> will be substituted.

</XMP>
<p>A subroutine with a passed text as an argument:
<p>
<XMP>
    UserTag caps   Routine   sub { return "\U@_" }
    UserTag caps   HasEndTag 

</XMP>
<p>The tag [caps]This text should be all upper case[/caps] will become
<CODE>THIS TEXT SHOULD BE ALL UPPER CASE</CODE>.
<p>Here is a useful one you might wish to use:
<p>
<PRE>
    UserTag quick_table HasEndTag
    UserTag quick_table Interpolate
    UserTag quick_table Order   border
    UserTag quick_table Routine &lt;&lt;EOF
    sub {
        my (<STRONG>$border</STRONG>,<STRONG>$input</STRONG>) = <STRONG>@_</STRONG>;
        <STRONG>$border</STRONG> = `` BORDER=<STRONG>$border</STRONG>'' if <STRONG>$border</STRONG>;
        my <STRONG>$out</STRONG> = ``&lt;TABLE ALIGN=LEFT<STRONG>$border</STRONG>&gt;'';
        my <STRONG>@rows</STRONG> = split /\n+/, <STRONG>$input</STRONG>;
        my (<STRONG>$left</STRONG>, <STRONG>$right</STRONG>);
        for(<STRONG>@rows</STRONG>) {
            <STRONG>$out</STRONG> .= '&lt;TR&gt;&lt;TD ALIGN=RIGHT VALIGN=TOP&gt;';
            (<STRONG>$left</STRONG>, <STRONG>$right</STRONG>) = split /\s*:\s*/, <STRONG>$_</STRONG>, 2;
            <STRONG>$out</STRONG> .= '&lt;B&gt;' unless <STRONG>$left</STRONG> =~ /&lt;/;
            <STRONG>$out</STRONG> .= <STRONG>$left</STRONG>;
            <STRONG>$out</STRONG> .= '&lt;/B&gt;' unless <STRONG>$left</STRONG> =~ /&lt;/;
            <STRONG>$out</STRONG> .= '&lt;/TD&gt;&lt;TD VALIGN=TOP&gt;';
            <STRONG>$out</STRONG> .= <STRONG>$right</STRONG>;
            <STRONG>$out</STRONG> .= '&lt;/TD&gt;&lt;/TR&gt;';
            <STRONG>$out</STRONG> .= ``\n'';
        }
        <STRONG>$out</STRONG> .= '&lt;/TABLE&gt;';
    }
    EOF

</PRE>
<p>Called with:
<p>
<XMP>
    [quick-table border=2]
    Name: [value name]
    City: [value city][if value state], [value state][/if] [value country]
    [/quick_table]

</XMP>
<p>The properties for UserTag are are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_alias_0">
Alias</A>

</STRONG>
<DD>
An alias for an existing (or other user-defined) tag. It takes the
form:
<p>
<XMP>
    UserTag tagname Alias    tag to insert

</XMP>
<p>An Alias is the only property that does not require a 
<A HREF="minivend.html#minivend_routine_0">Routine</A>

to process the tag.
<p>
<DT><STRONG>

<A NAME="minivend_cannest_0">
CanNest</A>

</STRONG>
<DD>
Notifies MiniVend that this tag must be checked for nesting.
Only applies to tags that have 
<A HREF="minivend.html#minivend_hasendtag_0">HasEndTag</A>
 defined, of course.
NOTE: Your routine must handle the subtleties of nesting, so
don't use this unless you are quite conversant with parsing
routines.  See the routines <CODE>tag_loop_list</CODE> and <CODE>tag_if</CODE> in 
lib/Vend/Interpolate.pm for an example of a nesting tag.
<p>
<XMP>
    UserTag tagname CanNest

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_hasendtag_0">
HasEndTag</A>

</STRONG>
<DD>
Defines an ending [/tag] to encapsulate your text -- the text in
between the beginning <CODE>[tagname]</CODE> and ending <CODE>[/tagname]</CODE> will
be the last argument sent to the defined subroutine.
<p>
<XMP>
    UserTag tagname HasEndTag

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_interpolate_0">
Interpolate</A>

</STRONG>
<DD>
If this is defined, the resulting HTML from this tag will be
re-parsed for more MiniVend tags.
<p>
<XMP>
    UserTag tagname Interpolate

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_invalidatecache_0">
InvalidateCache</A>

</STRONG>
<DD>
If this is defined, the presence of the tag on a page will prevent
search cache, page cache, and static builds from operating on the
page.
<p>
<XMP>
    UserTag tagname InvalidateCache

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_order_2">
Order</A>

</STRONG>
<DD>
The optional arguments that can be sent to the tag. This defines not only
the order in which they will be passed to 
<A HREF="minivend.html#minivend_routine_0">Routine</A>
, but the name of
the tags. If encapsulated text is appropriate (
<A HREF="minivend.html#minivend_hasendtag_0">HasEndTag</A>
 is set),
it will be the last argument.
<p>
<XMP>
    UserTag tagname Order param1 param2

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_posroutine_0">
PosRoutine</A>

</STRONG>
<DD>
Identical to the Routine argument -- a subroutine that will be called when
the new syntax is not used for the call, i.e. <CODE>[usertag argument]</CODE> instead
of <CODE>[usertag ARG=argument]</CODE>. If not defined, 
<A HREF="minivend.html#minivend_routine_0">Routine</A>
 is used, and MiniVend
will usually do the right thing.
<p>
<DT><STRONG>

<A NAME="minivend_routine_0">
Routine</A>

</STRONG>
<DD>
An inline subroutine that will be used to process the arguments of the tag. It
must not be named, and will be allowed to access unsafe elements only if
the 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 parameter 
<A HREF="minivend.html#minivend_allowglobal_0">AllowGlobal</A>
 is set for the catalog.
<p>
<XMP>
    UserTag tagname Routine  sub { "your perl code here!" }

</XMP>
<p>The routine may use a ``here'' document for readability:
<p>
<PRE>
    UserTag tagname Routine &lt;&lt;EOF
    sub {
        my (<STRONG>$param1</STRONG>, <STRONG>$param2</STRONG>, <STRONG>$text</STRONG>) = <STRONG>@_</STRONG>;
        return ``Parameter 1 is <STRONG>$param1</STRONG>, Parameter 2 is <STRONG>$param2</STRONG>'';
    }
    EOF

</PRE>
<p>The usual <EM>here documents</EM> caveats apply.
<p>Parameters defined with the 
<A HREF="minivend.html#minivend_order_2">Order</A>
 property will be sent to the routine
first, followed by any encapsulated text (
<A HREF="minivend.html#minivend_hasendtag_0">HasEndTag</A>
 is set).
<p>
</DL>
Note that the UserTag facility, combined with AllowGlobal, allows the.user to define tags just as powerful as the standard MiniVend tags.
This is not recommended for the novice, though -- keep it simple. 8-)
<p>
<H2> 
<A NAME="minivend_price_0">
PRICE, DESCRIPTION, ACCESSORIES</A>
</H2>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_price_1">
[price code quantity* database*]</A>

</STRONG>
<DD>
(new syntax [price code=``code'' quantity=``quantity'' base=``database''])
<p>Expands into the price of the product identified by code as found in
the products database. If there is more than one products file defined,
they will be searched in order unless constrained by the optional
argument <STRONG>base</STRONG>. The optional argument <STRONG>quantity</STRONG> selects an entry
from the quantity price list.
<p>
<DT><STRONG>

<A NAME="minivend_description_1">
[description code database*]</A>

</STRONG>
<DD>
(new syntax [description code=``code'' base=``database''])
<p>Expands into the description of the product identified by code as found in
the products database. If there is more than one products file defined,
they will be searched in order unless constrained by the optional
argument <STRONG>base</STRONG>.
<p>
<DT><STRONG>

<A NAME="minivend_accessories_1">
[accessories code attribute*, type*, field*, database*, name*]</A>

</STRONG>
<DD>
(new syntax [accessories code=``code''
arg="attribute*, type*, field*, database*, name*])
<p>If not given one of the optional arguments, expands into the value
of the accessories database entry for the product
identified by 
<A HREF="minivend.html#minivend_code_0">code</A>
 as found in the products database.
<p>If passed any of the optional arguments, initiates special processing
of item attributes based on entries in the product database.
<p>
<XMP>
   attribute     The item attribute as specified in the UseModifier
                 configuration directive. Typical are "size" or
                 "color". NOTE: You may not use the following 
                                 names for attributes:
                                                item group quantity code mv_ib mv_mi mv_si
   type          The action to be taken. The default is 'select', which
                 builds an HTML select form entry for the attribute.
                 Also recognized are 'multiple', which builds a multiple
                 select box, and 'list', which simply lists the possible
                 values.
   field         The database field name to be used to build the
                 entry (usually a select form field). Defaults to
                 a field named the same as the attribute.
   database      The database to find B<field> in, defaults to the
                 first products file where the item code is found.
   name          Name of the form variable to use if a form is being
                 built. Defaults to mv_order_B<attribute> -- i.e.
                 if the attribute is B<size>, the form variable will
                 be named B<mv_order_size>.

</XMP>
<p>When called with an attribute, the database is consulted and looks for
a comma-separated list of attribute options. They take the form:
<p>
<XMP>
    name=Label Text, name=Label Text*

</XMP>
<p>The label text is optional -- if none is given, the <STRONG>name</STRONG> will
be used.
<p>If an asterisk is the last character of the label text, the item is
the default selection. If no default is specified, the first will be
the default. An example:
<p>
<XMP>
    [accessories TK112 color]

</XMP>
<p>This will search the product database for a field named ``color''. If
an entry ``beige=Almond, gold=Harvest Gold, White*, green=Avocado'' is found,
a select box like this will be built:
<p>
<XMP>
    <SELECT NAME="mv_order_color">
    <OPTION VALUE="beige">Almond
    <OPTION VALUE="gold">Harvest Gold
    <OPTION SELECTED>White
    <OPTION VALUE="green">Avocado
    </SELECT>

</XMP>
<p>In combination with the <EM>mv_order_item</EM> and <EM>mv_order_quantity</EM> variables
this can be used to allow entry of an attribute at time of order.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_file_2">
FILE and INCLUDE</A>
</H2>
These elements read a file from the disk and insert the contents
in the location of the tag. [include ...] will allow insertion of
MiniVend variables.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_file_3">
[file name]</A>

</STRONG>
<DD>
(new syntax [file name=``name''])
<p>Inserts the contents of the named file. The file should normally
be relative to the catalog directory -- file names beginning with
/ or .. are only allowed if the MiniVend server administrator
has disabled 
<A HREF="minivend.html#minivend_noabsolute_0">NoAbsolute</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_include_0">
[include file]</A>

</STRONG>
<DD>
(new syntax [include file=``name''])
<p><STRONG>NOTE:</STRONG> New to MiniVend 3.04.
<p>Same as 
<A HREF="minivend.html#minivend_file_3">[file name]</A>
 except interpolates for all MiniVend tags
and variables.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_body_0">
BODY, BUTTONBAR, RANDOM, ROTATE</A>
</H2>
Tags to help manage page appearance and advertising links:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_body_1">
[body n]</A>

</STRONG>
<DD>
(new syntax [body type=``n''])
<p>Selects from the predefined color schemes and/or backgrounds, and
just becomes a &lt;BODY> tag if none are defined. See 
<EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_buttonbar_0">
[buttonbar n]</A>

</STRONG>
<DD>
(new syntax [buttonbar type=``n''])
<p>Selects from the predefined buttonbars, and is stripped if it
doesn't exist. See <EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_random_0">
[random]</A>

</STRONG>
<DD>
Selects from the predefined random messages, and is stripped if none
exist. See <EM>Controlling Page Appearance</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_rotate_0">
[rotate ceiling* floor*]</A>

</STRONG>
<DD>
(new syntax [rotate floor=``n'' ceiling=``n''])
<p>Selects from the predefined rotating banner messages, and is stripped if
none exist. The optional <CODE>ceiling</CODE> sets the highest number that will be
selected -- likewise <CODE>floor</CODE> sets the lowest. The default is to sequence
through all defined rotating banners. Each user has a separate rotation
pattern. See <EM>Controlling Page Appearance</EM>.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_tags_0">
Tags for summarizing shopping basket/cart</A>
</H2>
The following elements are used to access common items
which need to be displayed on baskets and checkout pages.
<p><STRONG>* marks an optional parameter</STRONG>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_item_list_0">
[item_list cart*]</A>

</STRONG>
<DD>
(new syntax [item_list name=``cart''])
<p>Places an iterative list of the items in the specified shopping cart,
the main cart by default. See 
<A HREF="minivend.html#minivend_item_0">Item Lists</A>
 for a description.
<p>
<DT><STRONG>

<A NAME="minivend_item_list_1">
[/item_list]</A>

</STRONG>
<DD>
Terminates the [item_list] tag.
<p>
<DT><STRONG>

<A NAME="minivend_value_0">
[value field flag*]</A>

</STRONG>
<DD>
Expands into the current value of the customer input field
named by field. If 
<A HREF="minivend.html#minivend_flag_0">flag</A>
 is present, single and double
quotes will be escaped with a backslash; this allows reliable
SQL inserts. See the section on input fields for more
information.
<p>
<DT><STRONG>

<A NAME="minivend_nitems_0">
[nitems cart*]</A>

</STRONG>
<DD>
Expands into the total number of items ordered so far. Takes an
optional cart name as a parameter.
<p>
<DT><STRONG>

<A NAME="minivend_subtotal_0">
[subtotal]</A>

</STRONG>
<DD>
Expands into the subtotal cost, exclusive of sales tax, of
all the items ordered so far.
<p>
<DT><STRONG>

<A NAME="minivend_salestax_1">
[salestax cart*]</A>

</STRONG>
<DD>
Expands into the sales tax on the subtotal of all the
items ordered so far. If there is no key field to derive the
proper percentage, such as state or zip code, it is set to 0.
See 
<A HREF="minivend.html#minivend_sales_0">Sales Tax</A>
 for more information.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_description_0">
[shipping_description mode*]</A>

</STRONG>
<DD>
(new syntax [shipping_description name=``mode''])
<p>The text description of <STRONG>mode</STRONG> -- the default is the 
shipping mode currently selected.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_1">
[shipping mode*]</A>

</STRONG>
<DD>
(new syntax [shipping name=``mode''])
<p>The shipping cost of the items in the basket via <CODE>mode</CODE> -- the default
mode is the shipping mode currently selected in the <CODE>mv_shipmode</CODE>
variable. See 
<A HREF="minivend.html#minivend_shipping_2">SHIPPING</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_total_cost_0">
[total_cost cart*]</A>

</STRONG>
<DD>
Expands into the total cost of all the items in the current shopping cart,
including sales tax (if any).
<p>
<DT><STRONG>

<A NAME="minivend_calc_0">
[calc]</A>

</STRONG>
<DD>
Starts a region where the arguments are calculated according to normal
arithmetic symbols. For instance:
<p>
<XMP>
    [calc] 2 + 2 [/calc]

</XMP>
<p>will display:
<p>
<XMP>
    4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_calc_1">
[/calc]</A>

</STRONG>
<DD>
Terminates the calculated region.
<p>TIP: The [calc] tag is really the same as the [perl] tag, except
that it doesn't accept arguments, is more efficient to parse, and
is interpolated at a higher precedence.
<p>
<DT><STRONG>

<A NAME="minivend_currency_0">
[currency]</A>

</STRONG>
<DD>
When passed a value of a single number, formats it according to the
currency specification. For instance:
<p>
<XMP>
    [currency]4[/currency]

</XMP>
<p>will display:
<p>
<XMP>
    4.00

</XMP>
<p>Uses the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
, 
<A HREF="minivend.html#minivend_pricedivide_0">PriceDivide</A>
, and 
<A HREF="minivend.html#minivend_pricecommas_0">PriceCommas</A>
 settings as
appropriate, and can contain a [calc] region. If Locale is set to <CODE>pt</CODE>,
and 
<A HREF="minivend.html#minivend_pricedivide_0">PriceDivide</A>
 to 100, the following
<p>
<XMP>
    [currency] [calc] 50000 + 100000 [/calc] [/currency]

</XMP>
<p>the number 1.500,00 will be displayed.
<p>
<DT><STRONG>

<A NAME="minivend_currency_1">
[/currency]</A>

</STRONG>
<DD>
Terminates the currency region.
<p>
<DT><STRONG>

<A NAME="minivend_cart_0">
[cart name]</A>

</STRONG>
<DD>
(new syntax [cart name=``name''])
<p>Sets the name of the current shopping cart for display of shipping, price,
total, subtotal, and nitems tags. If you wish to use a different price
for the cart, all of the above except [shipping] will reflect the normal
price field. You must emulate those operations with embedded Perl or the
[item-list], [calc], and [currency] tags, or use the 
<A HREF="minivend.html#minivend_priceadjustment_0">PriceAdjustment</A>

feature to set it.
<p>
<DT><STRONG>

<A NAME="minivend_row_0">
[row nn]</A>

</STRONG>
<DD>
(new syntax [row width=``nn''])
<p>Formats text in tables. Intended for use in emailed reports or &lt;PRE&gt;&lt;/PRE&gt; HTML
areas. The parameter <EM>nn</EM> gives the number of columns to use. Inside the
row tag, [col param=value ...] tags may be used. 
<p>
<DT><STRONG>

<A NAME="minivend_row_1">
[/row]</A>

</STRONG>
<DD>
Terminates a [row nn] element.
<p>
<DT><STRONG>

<A NAME="minivend_col_0">
[col width=nn wrap=yes|no gutter=n align=left|right|input spacing=n]</A>

</STRONG>
<DD>
Sets up a column for use in a [row]. This parameter can only be contained
inside a [row nn] [/row] tag pair. Any number of columns (that fit within
the size of the row) can be defined.
<p>The parameters are:
<p>
<XMP>
    width=nn        The column width, I<including the gutter>. Must be
                    supplied, there is no default. A shorthand method
                    is to just supply the number as the I<first> parameter,
                    as in [col 20].
        
    gutter=n        The number of spaces used to separate the column (on
                    the right-hand side) from the next. Default is 2.
        
    spacing=n       The line spacing used for wrapped text. Default is 1,
                    or single-spaced.
        
    wrap=(yes|no)   Determines whether text that is greater in length than
                    the column width will be wrapped to the next line. Default
                    is I<yes>.
        
    align=(L|R|I)   Determines whether text is aligned to the left (the default),
                    the right, or in a way that might display an HTML text
                    input field correctly.

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_col_1">
[/col]</A>

</STRONG>
<DD>
Terminates the column field.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_item_0">
Item Lists</A>
</H2>
Within any page, the [item_list cart*] element shows a list of all the
items ordered by the customer so far. It works by repeating the source
between [item_list] and [/item_list] once for each item ordered.
Between the item_list markers the following elements will return
information for the current item:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_if_data_0">
[if_data table column]</A>

</STRONG>
<DD>
If the database field <CODE>column</CODE> in table <EM>table</EM> is non-blank, the
following text up to the [/if_data] tag is substituted. This can be
used to substitute IMG or other tags only if the corresponding source
item is present. Also accepts a [else]else text[/else] pair for the
opposite condition.
<p>
<DT><STRONG>

<A NAME="minivend_if_data_1">
[if_data ! table column]</A>

</STRONG>
<DD>
Reverses sense for [if-data].
<p>
<DT><STRONG>

<A NAME="minivend_if_data_2">
[/if_data]</A>

</STRONG>
<DD>
Terminates an [if_data table column] element.
<p>
<DT><STRONG>

<A NAME="minivend_if_field_0">
[if_field fieldname]</A>

</STRONG>
<DD>
If the products database field <EM>fieldname</EM> is non-blank, the following
text up to the [/if_field] tag is substituted. If you have more than
one products database table (see <EM>ProductFiles</EM>), it will check
them in order until a matching key is found. This can be used to
substitute IMG or other tags only if the corresponding source
item is present. Also accepts a [else]else text[/else] pair
for the opposite condition.
<p>
<DT><STRONG>

<A NAME="minivend_if_field_1">
[if_field ! fieldname]</A>

</STRONG>
<DD>
Reverses sense for [if-field].
<p>
<DT><STRONG>

<A NAME="minivend_if_field_2">
[/if_field]</A>

</STRONG>
<DD>
Terminates an [if_field fieldname] element.
<p>
<DT><STRONG>

<A NAME="minivend_item_accessories_0">
[item_accessories attribute*, type*, field*, database*, name*]</A>

</STRONG>
<DD>
Evaluates to the value of the Accessories database entry for the item.
If passed any of the optional arguments, initiates special processing
of item attributes based on entries in the product database.
<p>
<DT><STRONG>

<A NAME="minivend_item_code_0">
[item_code]</A>

</STRONG>
<DD>
Evaluates to the product code for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_data_0">
[item_data database fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the arbitrary database
table 
<A HREF="minivend.html#minivend_database_1">database</A>
, for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_description_0">
[item_description]</A>

</STRONG>
<DD>
Evaluates to the product description (from the products file)
for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_field_0">
[item_field fieldname]</A>

</STRONG>
<DD>
Evaluates to the field name <EM>fieldname</EM> in the database,  for
the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_increment_0">
[item_increment]</A>

</STRONG>
<DD>
Evaluates to the number of the item in the match list. Used
for numbering search matches or order items in the list.
<p>
<DT><STRONG>

<A NAME="minivend_item_last_tags_item_last_0">
[item_last]tags[/item_last]</A>

</STRONG>
<DD>
Evaluates the output of the MiniVend tags encased inside the tags,
and if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1)
then the list iteration will terminate. If the evaluated number is
<STRONG>negative</STRONG>, then the item itself will be skipped. If the evaluated
number is <STRONG>positive</STRONG>, then the item itself will be shown but will be
last on the list.
<p>
<XMP>
      [item-last][calc]
                return -1 if '[item-field weight]' eq '';
                return 1 if '[item-field weight]' < 1;
                return 0;
                [/calc][/item-last]

</XMP>
<p>If this is contained in your <CODE>[item-list]</CODE> (or <CODE>[search-list]</CODE> or
flypage) and the weight field is empty, then a numerical <CODE>-1</CODE> will
be output from the [calc][/calc] tags; the list will end and the item
will <STRONG>not</STRONG> be shown. If the product's weight field is less than 1,
a numerical 1 is output.  The item will be shown, but will be the last
item shown. (If it is an <CODE>[item-list]</CODE>, any price for the item will
still be added to the subtotal.)
<p>
<DT><STRONG>

<A NAME="minivend_item_modifier_0">
[item_modifier attribute]</A>

</STRONG>
<DD>
Evaluates to the modifier value of <CODE>attribute</CODE> for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_next_tags_item_next_0">
[item_next]tags[/item_next]</A>

</STRONG>
<DD>
Evaluates the output of the MiniVend tags encased inside, and
if it evaluates to a numerical non-zero number (i.e. 1, 23, or -1) then
the item will be skipped with no output. Example:
<p>
<XMP>
      [item-next][calc][item-field weight] < 1[/calc][/item-next]

</XMP>
<p>If this is contained in your <CODE>[item-list]</CODE> (or <CODE>[search-list]</CODE> or flypage)
and the product's weight field is less than 1, then a numerical 
<A HREF="minivend.html#minivend__1">1</A>
 will
be output from the [calc][/calc] operation. The item will not be shown. (If
it is an <CODE>[item-list]</CODE>, any price for the item will still be added to the
subtotal.)
<p>
<DT><STRONG>

<A NAME="minivend_item_price_0">
[item_price n*]</A>

</STRONG>
<DD>
Evaluates to the price for quantity <CODE>n</CODE> (from the products file)
of the current item.
<p>
<DT><STRONG>

<A NAME="minivend_discount_price_0">
[discount_price n*]</A>

</STRONG>
<DD>
Evaluates to the discount price for quantity <CODE>n</CODE> (from the products file)
of the current item. Returns regular price if not discounted.
<p>
<DT><STRONG>

<A NAME="minivend_item_discount_0">
[item_discount]</A>

</STRONG>
<DD>
Returns the difference between the regular price and the discounted price.
<p>
<DT><STRONG>

<A NAME="minivend_item_quantity_0">
[item_quantity]</A>

</STRONG>
<DD>
Evaluates to the quantity ordered for the current item.
<p>
<DT><STRONG>

<A NAME="minivend_item_subtotal_0">
[item_subtotal]</A>

</STRONG>
<DD>
Evaluates to the subtotal (quantity * price) for the current item.
Quantity price breaks are taken into account.
<p>
<DT><STRONG>

<A NAME="minivend_modifier_name_0">
[modifier_name attribute]</A>

</STRONG>
<DD>
Evaluates to the name to give an input box in which the
customer can specify the modifier to the ordered item.
<p>
<DT><STRONG>

<A NAME="minivend_quantity_name_0">
[quantity_name]</A>

</STRONG>
<DD>
Evaluates to the name to give an input box in which the
customer can enter the quantity to order.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_embedded_0">
Embedded Perl Code</A>
</H2>
Perl code can be directly embedded in MiniVend pages. The code
is specified as [perl arguments*] any_legal_perl_code [/perl]. The
value returned by the code will be inserted on the page.
<p>(new syntax [perl arg=``arguments''* interpolate=1*])
<p>Using MiniVend variables with embedded Perl capability is not recommended
unless you are thoroughly familiar with Perl 5 references. You can insert
Minivend tags inside the Perl code, though when using the new syntax,
you will need to pass an INTERPOLATE=1 parameter to have tags inside
[perl] and [/perl] interpreted. (In the old syntax, most tags are evaluated
before [perl], though there are exceptions.)
<p>More often you will want to use the tag access routine <STRONG>&amp;safe_tag</STRONG>, which
takes the tag name and any arguments as parameters. This has the advantage
of only performing the operation when the code is executed. (A few tags can't
be used with safe_tag, notably ones accessing a database that has not
previously been accessed on the page.)
<p>Examples:
<p>
<XMP>
    # Simple example, old syntax
        [perl]
    $comments = '[value comments]';
        [/perl]
        # New syntax
    # If the item might contain a single quote
        [perl interpolate=1]
    $comments = '[value comments escaped]';
        [/perl]
    # Another method to avoid escape problems
    $comments = q{[value comments]};
        # Works with all, only executed if code is reached
    $comments = safe_tag('value', 'comments');

</XMP>
<p>This allows you to pass user-space variables for most needed
operations. You can pass whole lists of items with constructs
like:
<p>
<XMP>
    # Perl ignores the trailing comma
    my(%prices) = ( [item_list]
                    '[item_code]', '[item-price]',
                    [/item_list]);

</XMP>
<p>Even easier is the definition of a subroutine:
<p>
<XMP>
    [set Thanks]
    my($name, $number) = @_;
    "Thanks, $name, for your order! The order number is $number.\n";
    [/set]
        # New syntax
    [perl arg=sub interpolate=1]
        Thanks ('[value name escaped]', '[value mv_order_number escaped]')
    [/perl]
        # Old syntax, depends on [value ...] interpolated before [perl]
    [perl sub]
        Thanks ('[value name escaped]', '[value mv_order_number escaped]')
    [/perl]

</XMP>
<p>(The <CODE>escaped</CODE> causes any single quotes which might be contained in the
values to be escaped, preventing syntax errors in the case of a name like
``O'Reilly''.)
<p>The arguments that can be passed are any to all of:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_browser_0">
browser</A>

</STRONG>
<DD>
The browser string from the users browser, read-only. Referred
to in your code as <STRONG>$Safe</STRONG>{browser}.
<p>
<DT><STRONG>

<A NAME="minivend_carts_0">
carts</A>

</STRONG>
<DD>
Gives read-write access to all of the shopping carts. on order. This
is an array of hashes, and includes the product code, quantity, and any
modifiers you have specified.  Referred to in your code as a reference
to the array, <STRONG>$Safe</STRONG>{items} or @{<STRONG>$Safe</STRONG>{items}}.
<p>
<XMP>
    # Move contents of 'layaway' cart to main cart
    $Safe{carts}->{main} = $Safe{carts}->{layaway};
    $Safe{carts}->{main} = [];

</XMP>
<p>Careful with this -- you can lose the items on order with improper
code, though syntax errors will be caught before the code is run.
<p>
<DT><STRONG>

<A NAME="minivend_cgi_0">
cgi</A>

</STRONG>
<DD>
Gives read-only access to the actual variables that were passed
in the current CGI session. This is useful for testing what the
user actually placed on the form, not just what MiniVend placed
in the session. Called with
<p>
<XMP>
  # Set if the user had a value for name in the *current* form
  $name = $Safe{'cgi'}->{name};

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_config_1">
config</A>

</STRONG>
<DD>
Gives read-write access to the configuration of the catalog. USE WITH
EXTREME CAUTION -- many of the variables are references to anonymous
arrays and hashes. You can crash your catalog if you modify the wrong
thing. Referred to in your code as <STRONG>$Safe</STRONG>{config}, a reference to the
hash containing the configuration structure. If you use this, it
is recommended that you refer frequently to the MiniVend source code.
<p>
<DT><STRONG>

<A NAME="minivend_discount_0">
discount</A>

</STRONG>
<DD>
Gives read-write access to session discounts, an
anonymous hash. Referred to in your code as <STRONG>$Safe</STRONG>-&gt;{discounts}.
<p>
<DT><STRONG>

<A NAME="minivend_file_1">
file</A>

</STRONG>
<DD>
If specified, the anchor text is a file name to read the Perl code from.
This allows code to be maintained in separate files, though you need
to remember that any MiniVend tags contained will generally not be
interpolated (depending on interpolation order and use of the [[any]]
and [post] modifiers). The file name is relative to the MiniVend base
directory unless specified as an absolute path.
<p>
<DT><STRONG>

<A NAME="minivend_frames_0">
frames</A>

</STRONG>
<DD>
The true/false value determining whether frames processing is
enabled. Read-only -- you can set the value with [frames-off] or
[frames-on]. Referred to in your code as <STRONG>$Safe</STRONG>{frames}.
<p>
<DT><STRONG>

<A NAME="minivend_items_0">
items</A>

</STRONG>
<DD>
Gives read-only access to the items on order, <EM>for the current cart</EM>.
This is an array of hashes, and includes the product code, quantity,
and any modifiers you have specified. Referred to in your code as a
reference to the array, <STRONG>$Safe</STRONG>{items} or @{<STRONG>$Safe</STRONG>{items}}.
<p>
<XMP>
    # Product code of first item in cart
    $item_code = $Safe{items}->[0]->{code};  
    # Quantity for third item in cart
    $item_code = $Safe{items}->[2]->{quantity};  
    # Color of second item in cart
    $item_code = $Safe{items}->[2]->{color};  

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_scratch_1">
scratch</A>

</STRONG>
<DD>
Gives read-write access to the scratch variables, a reference to an
anonymous hash. Referred to in your code as <STRONG>$Safe</STRONG>{scratch}.
<p>
<DT><STRONG>

<A NAME="minivend_sub_0">
sub</A>

</STRONG>
<DD>
If specified, the anchor text is a subroutine name and optional
parameters to be passed. The subroutine can be defined in three
ways; as a global subroutine (works for entire server); as a
catalog-wide pre-defined subroutine; or in a scratchpad variable.
All are called with the same syntax -- the arguments are passed
in via the <STRONG>@_</STRONG> argument array.
<p><STRONG>IMPORTANT NOTE:</STRONG> Global subroutines are not subject to the stringent
security checking of the <EM>Safe</EM> module, so almost anything goes
there. The subroutine will be able to modify any variable in MiniVend,
and will be able to write to read and write any file that the MiniVend
daemon has permission to write. Though this gives great power, it should
be used with caution. Careful! They are defined in the main minivend.cfg
file, so should be safe from individual users in a multi-catalog system.
<p>Global subroutines are defined in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 with the

<A HREF="minivend.html#minivend_globalsub_0">GlobalSub</A>
 directive, or in user catalogs which have been
enabled via 
<A HREF="minivend.html#minivend_allowglobal_0">AllowGlobal</A>
. Global subroutines are much faster
than the others as they are precompiled. (Faster still are <EM>UserTag</EM>
definitions.)
<p>Catalog subroutines are defined in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
, with
the 
<A HREF="minivend.html#minivend_sub_1">Sub</A>
 directive. They are subject to the stringent <EM>Safe.pm</EM>
security restrictions that are controlled by 
<A HREF="minivend.html#minivend_safeuntrap_0">SafeUntrap</A>
. If you
wish to have default arguments supplied to them, use the 
<A HREF="minivend.html#minivend_subargs_0">SubArgs</A>

directive.
<p>Scratch subroutines are defined in the pages, and are also subject
to <EM>Safe.pm</EM> checking. See the beginning of this section for an
example of a subroutine definition. There is no ``sub name { }'' that
surrounds it -- the subroutine is named from the name of the 
scratch variable.
<p>
<DT><STRONG>

<A NAME="minivend_values_0">
values</A>

</STRONG>
<DD>
Gives read-write access to the user variables, including the MiniVend
special variables, an anonymous hash. Referred to in your code as
<STRONG>%{</STRONG>Safe{'values'}} or <STRONG>$Safe</STRONG>{'values'}-&gt;{variable}.
<p>
<XMP>
    # Read the user's selected shipping mode
    my $shipmode = $Safe{values}->{mv_shipmode};

</XMP>
<p>
</DL>
The code can be as complex as desired, but cannot use any operators.that modify the file system or use ``unsafe'' operations like ``system'',
``exec'', or backticks. These constraints are enforced with the default
permissions of the standard Perl module <EM>Safe</EM> -- operations may
be untrapped on a system-wide basis with the 
<A HREF="minivend.html#minivend_safeuntrap_0">SafeUntrap</A>
 directive.
<p>The result of the tag will be the result of the last expression
evaluated, just as in a subroutine. If there is a syntax error
or other problem with the code, there will be no output.
<p>Here is a simple one which does the equivalent of the classic
hello.pl program:
<p>
<XMP>
    [perl] my $tmp = "Hello, world!"; $tmp; [/perl]

</XMP>
<p>Of course you wouldn't need to set the variable -- it is just there
to show the capability.
<p>To echo the user's browser, but within some HTML tags:
<p>
<XMP>
    [perl browser]
    my $html = '<H5>';
    $html .= $Safe{'browser'};
    $html .= '</H5>';
    $html;
    [/perl]

</XMP>
<p>To show the user their name, and the current time:
<p>
<XMP>
    [perl values]
    my $string = "Hi, " . $Safe{values}->{'name'} ". The time is now ";
    $string .= localtime;
    $string;
    [/perl]

</XMP>
<p>
<H2> 
<A NAME="minivend_on_the_fly_1">
On-the-fly Catalog Pages</A>
</H2>
If an item is displayed on the search list (or order list) and there is
a link to a special page keyed on the item, MiniVend will attempt to
build the page ``on the fly''. It will look for the special page

<A HREF="minivend.html#minivend_flypage_0">flypage.html</A>
, which is used as a template for building the page. If

<A HREF="minivend.html#minivend_item_field_0">[item_field fieldname]</A>
, <EM>[item_price]</EM>, (etc.) elements are used on the page,
quite complex and information-packed pages can be built. The

<A HREF="minivend.html#minivend_if_field_0">[if_field fieldname]</A>
 HTML 
<A HREF="minivend.html#minivend_if_field_2">[/if_field]</A>
 pair can be used to insert
HTML only if there is a non-blank value in a particular field.
<p>Because the tags are the same, an [item_list] cannot be used on
an on-the-fly page. The [loop item, item] tag is still usable. 
<p>If the directive 
<A HREF="minivend.html#minivend_pageselectfield_0">PageSelectField</A>
 is set to a valid product database
field which contains a valid MiniVend page name (relative to the catalog
pages directory, without the .html suffix) it will be used to build the
on-the-fly page.
<p>Active tags in their order of interpolation:
<p>
<XMP>
 [if-field field]         Tests for a non-empty value in B<field>
 [if-data db field]       Tests for a non-empty B<field> in B<db>
 [item-code]              Product code of the displayed item
 [item-accessories args]  Accessory information (see I<accessories>)
 [item-description]       Description field information
 [item-price quantity*]   Product price (at B<quantity>)
 [item-field field]       Product database B<field>
 [item-data db field]     Database B<db> entry for B<field>

</XMP>
<p>
<H2> 
<A NAME="minivend_tags_1">
Tags for controlling old syntax interpolation order</A>
</H2>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_any_0">
[[any]]</A>

</STRONG>
<DD>
Forces early interpolation of any tag. Sometimes needed if the order
of interpolation does not achieve the desired result (meaning you see
MiniVend tags displayed on the page).
<p><STRONG>NOTE:</STRONG> This is ignored if using the new syntax.
<p>
<DT><STRONG>

<A NAME="minivend__2">
[ n [any] HTML n ]</A>

</STRONG>
<DD>
Where n is a single digit in the range 0-9. If present, it forces early
interpolation of that region of MiniVend tags, and is differentiated from
other early interpolation areas. The enclosed MiniVend tags will still
be interpolated in the normal order, but it can usually be combined
with the [post] [/post] pair to achieve the desired order.
<p><STRONG>NOTE:</STRONG> This is ignored if using the new syntax.
<p>
<DT><STRONG>

<A NAME="minivend_post_0">
[post]</A>

</STRONG>
<DD>
Selects an area that will not be interpolated until after the rest of
the page is interpolated. If followed by a number, will match a terminating
[/post] tag with the corresponding number.
<p><STRONG>NOTE:</STRONG> This is ignored if using the new syntax.
<p>
<DT><STRONG>

<A NAME="minivend_post_1">
[/post]</A>

</STRONG>
<DD>
Terminates a [post] region.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_required_0">
Required Pages</A>
</H2>
A number of HTML pages are required for MiniVend operation. Typically they
are used to transmit error messages, status of search or order operations, and
other out of boundary conditions.
<p><STRONG>NOTE:</STRONG> The distributed demo does not use these default values.
<p>The names of these pages can be set with the 
<A HREF="minivend.html#minivend_specialpage_0">SpecialPage</A>

directive. The standard pages and their default locations:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_badsearch_0">
badsearch (pages/badsearch.html)</A>

</STRONG>
<DD>
The error page displayed if there is a system or user error with the search
engine. Overridden by mv_failpage if set on current form.
<p>
<DT><STRONG>

<A NAME="minivend_canceled_0">
canceled (pages/canceled.html)</A>

</STRONG>
<DD>
The page displayed by MiniVend when an order has been canceled by
the user.
<p>
<DT><STRONG>

<A NAME="minivend_catalog_1">
catalog (pages/catalog.html)</A>

</STRONG>
<DD>
The main catalog page presented by MiniVend when another page is
not specified.
<p>
<DT><STRONG>

<A NAME="minivend_checkout_0">
checkout (pages/order.html)</A>

</STRONG>
<DD>
The page the customer is sent to when checking out (the
location pointed to by a <EM>[finish_order]</EM> tag.
<p>
<DT><STRONG>

<A NAME="minivend_confirmation_0">
confirmation (pages/confirmation.html)</A>

</STRONG>
<DD>
After the order is completed, the confirmation page is
displayed.
<p>
<DT><STRONG>

<A NAME="minivend_failed_0">
failed (pages/failed.html)</A>

</STRONG>
<DD>
If the sendmail program could not be invoked to email the
completed order, the failed.html page is displayed. (Sadly we
don't know if the email was successfully delivered).
<p>
<DT><STRONG>

<A NAME="minivend_flypage_0">
flypage (pages/flypage.html)</A>

</STRONG>
<DD>
If the catalog page for an item was not found when its [item_link]
is clicked, this page is used as a template to build an on-the-fly
page. See 
<A HREF="minivend.html#minivend_on_the_fly_1">On-the-fly Catalog Pages</A>
. If frames are in use, the special
order page can be overridden with the one configured with the directive

<A HREF="minivend.html#minivend_frameflypage_0">FrameFlyPage</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_interact_0">
interact (pages/interact.html)</A>

</STRONG>
<DD>
Displayed if an unexpected response was received from the
browser, such as not getting expected fields from submitting a
form. This would probably happen from typos in the html pages,
but could be a browser bug.
<p>
<DT><STRONG>

<A NAME="minivend_missing_0">
missing (pages/missing.html)</A>

</STRONG>
<DD>
This page is displayed if the URL from the browser specifies a
page that does not have a matching .html file in the pages
directory. This can happen if the customer saved a bookmark to
a page that was later removed from the database.
<p>
<DT><STRONG>

<A NAME="minivend_needfield_0">
needfield (pages/needfield.html)</A>

</STRONG>
<DD>
Displayed if the user did not fill in a required field in the
order form. See <EM>REQUIRED FIELDS</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_nomatch_0">
nomatch (pages/nomatch.html)</A>

</STRONG>
<DD>
This page is displayed if the search engine is used, but there
is no match for the search specification and no 
<A HREF="minivend.html#minivend_no_match_0">[no_match]</A>

region found on the search page.
<p>
<DT><STRONG>

<A NAME="minivend_noproduct_0">
noproduct (pages/noproduct.html)</A>

</STRONG>
<DD>
This page is displayed if the URL from the browser specifies
the ordering of a product code which is not in the products
file.
<p>
<DT><STRONG>

<A NAME="minivend_order_3">
order (pages/order.html)</A>

</STRONG>
<DD>
This page is displayed when the customer orders an item. It can contain
any or all of the customer-entered values, but is commonly used as a
status display (or ``shopping basket''). If frames are in use, the special
order page can be overridden with the one configured with the directive

<A HREF="minivend.html#minivend_frameorderpage_0">FrameOrderPage</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_search_0">
search (pages/search.html)</A>

</STRONG>
<DD>
Contains the default output page for the search engine results. Also
required is an input page, which can be the same as search.html or an
additional page.
<p>
<DT><STRONG>

<A NAME="minivend_violation_0">
violation (pages/violation.html)</A>

</STRONG>
<DD>
Displayed if a security violation is noted, such as an attempt to
submit a credit card number on a non-secured form when in ExtraSecure
mode.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_checking_0">
Checking Page HTML</A>
</H2>
MiniVend, as of release 3.02, allows you to debug your page HTML with
an external page checking program.  Because leaving this enabled on a
production system is potentially a very bad performance degradation, the
program is set in a the global configuration file with the <EM>CheckHTML</EM>
directive.
<p>To check a page for validity, set the global directive <EM>CheckHTML</EM> 
to the name of the program (don't do any output redirection). A good
choice is the freely available program <EM>weblint</EM> -- it would be
set in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 with:
<p>
<XMP>
    CheckHTML  /usr/local/bin/weblint -s -

</XMP>
<p>Of course you must restart the server for it to be recognized.
The full path to the program should be used -- if you have trouble,
check it from the command line (as you should with all external programs
called by MiniVend).
<p>Insert [tag flag checkhtml][/tag] at the top or bottom
of pages you want to check, and the output of your checker
should be appended to the browser output as a comment, visible
if you view the page or frame source.
<p>To do this only at times, use a 
<A HREF="minivend.html#minivend_variable_0">Variable</A>
 setting:
<p>
<XMP>
    Variable  CHECK_HTML    [tag flag checkhtml][/tag]

</XMP>
<p>and place __CHECK_HTML__ in your pages.  You can then set
the Variable to the empty string if you wish to disable it.
<p><p><hr>

<H1> 
<A NAME="minivend_forms_0">
FORMS AND MINIVEND</A>
</H1>
MiniVend uses HTML forms for order, search, and control operations. 
Order operations possibly include ordering an item, selecting item
size or other attributes, and reading user information for payment
and shipment. Search operations may also be triggered by a form.
In addition, the user can control certain aspects of the session,
such as order security, frames presentation, and background display
via a control form.
<p>
<H2> 
<A NAME="minivend_special_0">
Special Form Fields</A>
</H2>
MiniVend treats some form fields specially, to link to the search engine
and provide more control over user presentation.
It has a number of predefined variables, most of whose names are prefixed with
<EM>mv_</EM> to prevent name clashes. It also uses a few variables which are
postfixed with integer digits -- those are used to provide control in its
iterating lists.
<p>These special fields all begin with <EM>mv_</EM>, and include:
<p>(O = order, S = search, C = control, A = all, X in scratch space)
<p>
<XMP>
 Name               Type  Description
 mv_alinkcolor        C   Sets access link color
 mv_all_chars         S   Turns on punctuation matching
 mv_arg[0-9]+         A   Parameters for mv_subroutine (mv_arg0,mv_arg1,...)
 mv_background        C   Explained in Controlling Page Appearance
 mv_base_directory    S   Sets base directory for search file names
 mv_bgcolor           C   Sets background color
 mv_case              S   Turns on case sensitivity
 mv_cartname          O   Sets the shopping cart name
 mv_cache_params      S   Determines caching of searches
 mv_change_frame      A   Any form, changes frame target of form output
 mv_check             A   Any form, sets multiple user variables after update
 mv_checkout          O   Sets the checkout page
 mv_click             A   Any form, sets multiple form variables before update
 mv_click             XA  Default mv_click routin, click is mv_click_arg
 mv_click <name>      XA  Routine for a click <name>, sends click as arg
 mv_click_arg         XA  Argument name in scratch space
 mv_coordinate        S   Enables field/spec matching coordination
 mv_credit_card*      O   Discussed in order security (some are read-only)
 mv_customcolors      C   Enables user-custom colors
 mv_dict_end          S   Upper bound for binary search
 mv_dict_fold         S   Non-case sensitive binary search
 mv_dict_limit        S   Sets upper bound based on character position
 mv_dict_look         S   Search specification for binary search
 mv_dict_order        S   Sets dictionary order mode
 mv_doit              A   Common to all forms, sets default action
 mv_email             O   Reply-to address for orders
 mv_errorpage         O   Sets error page if order check fails
 mv_exact_match       S   Sets word-matching mode
 mv_failpage          O,S Sets page to display on failed order check/search
 mv_head_skip         S   Sets skipping of header line(s) in index
 mv_helpon            C   Turns on the help feature if defined
 mv_helpoff           C   Turns off the help feature if defined
 mv_linkcolor         C   Sets the link color
 mv_matchlimit        S   Sets match page size
 mv_max_matches       S   Sets maximum match return
 mv_min_string        S   Sets minimum search spec size
 mv_negate            S   Specifies that records NOT matching will be found
 mv_nextpage          A   Sets next page user will go to after submission
 mv_order_group       O   Allows grouping of master item/sub item
 mv_order_item        O   Causes the order of an item
 mv_order_number      O   Order number of the last order (read-only)
 mv_order_quantity    O   Sets the quantity of an ordered item
 mv_order_profile     O   Selects the order check profile 
 mv_order_receipt     O   Sets the receipt displayed
 mv_order_report      O   Sets the order report sent
 mv_order_subject     O   Sets the subject line of order email
 mv_orderpage         O   Sets the page to display on refresh
 mv_orsearch          S   Selects AND/OR of search words
 mv_profile           S   Selects search profile
 mv_range_alpha       S   Sets alphanumeric range searching
 mv_range_look        S   Sets the field to do a range check on
 mv_range_max         S   Upper bound of range check
 mv_range_min         S   Lower bound of range check
 mv_resetcolors       C   Causes reset of user color maps
 mv_record_delim      S   Search index record delimiter
 mv_return_all        S   Return all lines found (subject to range search)
 mv_return_delim      S   Return record delimiter
 mv_return_fields     S   Fields to return on a search
 mv_return_file_name  S   Set return of file name for searches
 mv_return_spec       S   Return the MiniVend page specified in search string
 mv_save_session      C   Set to non-zero to prevent expiration of user session
 mv_search_field      S   Sets the fields to be searched
 mv_search_file       S   Sets the file(s) to be searched
 mv_search_match_count S  Returns the number of matches found (read-only)
 mv_search_over_msg   S   Returns string indicating search overflow (read-only)
 mv_search_page       S   Sets the page for search display
 mv_searchspec        S   Search specification
 mv_searchtype        S   Sets search type (text or glimpse)
 mv_separate_items    O   Sets separate order lines (one per item ordered)
 mv_shipmode          O   Sets shipping mode for custom shipping
 mv_sort_command      S   Sets the command to use for sorting searches
 mv_sort_crippled     S   Sets crippled sort mode
 mv_sort_field        S   Field(s) to sort on
 mv_sort_option       S   Options for sort
 mv_spelling_errors   S   Number of spelling errors for Glimpse
 mv_substring_match   S   Turns off word-matching mode
 mv_subroutine        A   Subroutine to processing based on form 
 mv_successpage       O   Page to display on successful order check
 mv_textcolor         C   Sets text color
 mv_todo              A   Common to all forms, sets form action
 mv_todo.map          A   Contains form imagemap
 mv_todo.checkout.x   O   Causes checkout action on click of image
 mv_todo.return.x     O   Causes return action on click of image
 mv_todo.submit.x     O   Causes submit action on click of image
 mv_todo.x            A   Set by form imagemap
 mv_todo.y            A   Set by form imagemap
 mv_vlinkcolor        C   Sets visited link color

</XMP>
<p>
<H2> 
<A NAME="minivend_form_0">
Form Actions</A>
</H2>
Any MiniVend form can be used for any number of actions. The actions
are mapped by the 
<A HREF="minivend.html#minivend_actionmap_0">ActionMap</A>
 directive in the catalog configuration
file, and are selected on the form with either the <EM>mv_todo</EM> or 
<A HREF="minivend.html#minivend_mv_doit_0">mv_doit</A>

variables.
<p>Mapping of actions in the ActionMap directive means that the 
<A HREF="minivend.html#minivend_value_1">value</A>
 of 
the submit button is scanned to determine the action. To map the string
``Place Order'' to the action submit, you would put in the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file:
<p>
<XMP>
    ActionMap    submit place order

</XMP>
<p>And on the form you would make a submit button:
<p>
<XMP>
    <INPUT TYPE="submit" NAME="mv_todo" VALUE="Place Order">

</XMP>
<p>When the button is clicked by the user, the 
<A HREF="minivend.html#minivend_submit_0">submit</A>
 action will
be performed.
<p>To set a default action for a form, set the variable 
<A HREF="minivend.html#minivend_mv_doit_0">mv_doit</A>
 as
a hidden variable:
<p>
<XMP>
    <INPUT TYPE="hidden" NAME="mv_doit" VALUE="refresh">

</XMP>
<p>When any other submit button (for a meaningless variable, the MiniVend
demos use <EM>mv_submit</EM>) is pressed, the <EM>mv_todo</EM> value will not be
found, so the 
<A HREF="minivend.html#minivend_refresh_0">refresh</A>
 action defined in 
<A HREF="minivend.html#minivend_mv_doit_0">mv_doit</A>
 will be used.
<p>The defined actions are:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_cancel_0">
cancel</A>

</STRONG>
<DD>
All user information (with the exception of the frames and secure
variable settings) is erased, and the shopping cart is emptied. The
user is then mv_nextpage or mv_orderpage.
<p>
<DT><STRONG>

<A NAME="minivend_checkout_0">
checkout</A>

</STRONG>
<DD>
The shopping cart and user variables are updated, and the
user is sent to the page defined in the variable 
<A HREF="minivend.html#minivend_mv_checkout_0">mv_checkout</A>
 or
the CheckoutPage directive.
<p>
<DT><STRONG>

<A NAME="minivend_control_0">
control</A>

</STRONG>
<DD>
The user help, frames, security, and color/background information
is examined and settings changed if appropriate. The shopping cart
and user variables are also updated.
<p>
<DT><STRONG>

<A NAME="minivend_refresh_0">
refresh</A>

</STRONG>
<DD>
Simply updates the user variables and returns to the page defined
in mv_orderpage.
<p>
<DT><STRONG>

<A NAME="minivend_return_0">
return</A>

</STRONG>
<DD>
Updates the user variables and returns to the page defined
in mv_nextpage, or the user's last non-order/non-search page.
This is difficult to use, for it is hard to predict what that
page will be. Setting mv_nextpage with the value of a scratch
variable works well.
<p>
<DT><STRONG>

<A NAME="minivend_search_0">
search</A>

</STRONG>
<DD>
The shopping cart and user variables are updated, then the form
variables are interpreted and the search specification contained
therein is dispatched to the search engine -- results are returned
on the defined search page (set by 
<A HREF="minivend.html#minivend_mv_search_page_0">mv_search_page</A>
 or the search
page directives).
<p>
<DT><STRONG>

<A NAME="minivend_submit_0">
submit</A>

</STRONG>
<DD>
Submit the form for order processing. If no order profile is defined
with the 
<A HREF="minivend.html#minivend_mv_order_profile_0">mv_order_profile</A>
 variable, the order will be checked to see
if the current cart contains any items and be checked against the fields
defined in the 
<A HREF="minivend.html#minivend_requiredfields_0">RequiredFields</A>
 directive. Assuming those checks pass,
the order will be submitted.
<p>If there is an order profile defined, the form will be checked against
the definition in the order profile and submitted if the pragma &amp;final
is set to <STRONG>yes</STRONG>. If &amp;final is set to <STRONG>no</STRONG> (the default), and the check
succeeds, the user will be routed to the MiniVend page defined in mv_successpage,
mv_nextpage, or mv_orderpage. Finally, if the check fails, the user will be
routed to mv_failpage, mv_nextpage, or mv_orderpage in that order.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_one_click_0">
One-click Multiple Variables</A>
</H2>
MiniVend can set multiple variables with a single button or form
control. You first define the variable set (or profile, as in
search and order profiles) inside a scratch variable:
<p>
<XMP>
  [set Search by Category]
  mv_search_field=category
  mv_search_file=categories
  mv_todo=search
  [/set]

</XMP>
<p>The special variable <EM>mv_click</EM> sets variables just as if they
were put in on the form. It is controlled by a single button,
as in:
<p>
<XMP>
    <INPUT TYPE="submit" NAME="mv_click" VALUE="Search by Category">

</XMP>
<p>When the user clicks the submit button, all three variables will take
on the values defined in the ``Search by Category'' scratch variable. You
can set the scratch variable on the same form as the button is on -- in
fact that is recommended for clarity.
<p>The variable will not be carried from form to form, it must be set
on the form being submitted.
<p>The special variable <EM>mv_check</EM> sets variables for the form actions

<A HREF="minivend.html#minivend_checkout_0">checkout, control, refresh, return, search,</A>
 and 
<A HREF="minivend.html#minivend_submit_0">submit</A>
. 
This function operates after all of the values are set from the form,
including the ones set by <EM>mv_click</EM>, and can be used to condition
input to search routines or orders.
<p>The variable sets can contain and be generated by most MiniVend tags --
the profile is interpolated for MiniVend tags before being used. Careful
of interpolation order, and don't use the [post] tag -- it will not work.
Embedded Perl <STRONG>will</STRONG> work, and is recommended for most conditional
operations within the profile.
<p>Any setting of variables already containing a value will overwrite
the variable, so to build sets of fields (as in mv_search_field
and mv_return_fields) you must use comma separation or place the
null character with a <CODE>&amp;#0;</CODE> literal.
<p>Here is a small example which will set the value of 
<A HREF="minivend.html#minivend_mv_nextpage_0">mv_nextpage</A>
 to
route the user to a special page if their search inputs are invalid:
<p>
<XMP>
    <FORM ...
    <INPUT TYPE=hidden NAME=mv_check VALUE="Invalid Input">
    ...
    </FORM>
    [set Invalid Input]
    [perl cgi]
    my $type        = $Safe->{cgi}->{mv_searchtype};
    my $spell_check = $Safe->{cgi}->{mv_spelling_errors};
    my $out = '';
    if($spell_check and $type eq 'text') {
        $out .= "mv_todo=return\n";
        $out .= "mv_nextpage=special/cannot_spell_check\n";
    }
    return $out;
    [/perl]
    [/set]

</XMP>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_subroutine_0">
mv_subroutine</A>

</STRONG>
<DD>
The special variable mv_subroutine defines a named subroutine that
will be called if defined on the current form. (This variable can
have been set by mv_click.)
<p>It takes arguments based on the special form variables mv_arg<EM>N</EM>, where
<EM>N</EM> is an integer that corresponds to the argument number (starting
at zero). Arguments can be of four types:
<p>
<DT><STRONG>

<A NAME="minivend_identifier_0">
identifier</A>

</STRONG>
<DD>
Identifies a form variable (on the current form) the
value of which will be supplied as that argument.
 
<p>
<DT><STRONG>

<A NAME="minivend_hash_identifier_0">
HASH(identifier)</A>

</STRONG>
<DD>
Identifies a variable that will be parsed as a series of key-value pairs
and supplied as a hash *reference*.
 
<p>
<DT><STRONG>

<A NAME="minivend_array_identifier_0">
ARRAY(identifier)</A>

</STRONG>
<DD>
Identifies a variable that will be parsed as a series of values and
supplied as an array *reference*.
<p>
<DT><STRONG>

<A NAME="minivend_literal_string_0">
LITERAL(string)</A>

</STRONG>
<DD>
A string that will be passed unchanged.
 
<p>
<DT><STRONG>

<A NAME="minivend_code_routine_0">
CODE(routine)</A>

</STRONG>
<DD>
Identifies a named Perl subroutine that will be called to produce the
argument. The arguments are a null-separated list placed in a variable of
the same name, which will be parsed as above for HASH, ARRAY, LITERAL,
identifier, and CODE references. The return value (hash reference,
scalar, etc.) depends on the subroutine. This is recursive.
<p>
<DT><STRONG>

<A NAME="minivend_safe_list_0">
SAFE(list)</A>

</STRONG>
<DD>
Identifies additional arguments passed to the subroutine parser, as
in [perl sub values]. It will not be placed in the argument list,
so you should use mv_arg9999 or some such to pass it from the original
form. Never necessary or desirable when calling a GlobalSub.
<p>
</DL>
The return value for the subroutine is available in the fixed .session variable <EM>return_value</EM>, accessible as [data session return_value].
<p>An example would be a password-protected message. Here is a form:
<p>
<XMP>
  <FORM METHOD=POST ACTION="[process-target]">
  <INPUT TYPE=hidden NAME=mv_subroutine VALUE=disclose_secret>
  <INPUT TYPE=hidden NAME=mv_arg0     VALUE=message>
  <INPUT TYPE=hidden NAME=mv_arg1     VALUE=password>
  <INPUT TYPE=hidden NAME=mv_doit     VALUE=return>
  <INPUT TYPE=hidden NAME=mv_nextpage VALUE=secret>
  Select
  <SELECT NAME=message>
      <OPTION VALUE="secret"> Secret
      <OPTION VALUE="top_secret"> Top Secret
  </SELECT>
  Password <INPUT TYPE=password NAME=password VALUE="">
  <INPUT TYPE=submit VALUE="See a Secret">
  </FORM>

</XMP>
<p>And a subroutine:
<p>
<XMP>
  [set disclose_secret]
  my($message, $password) = @_;
  my $out = '';
  if($message =~ /^secret/) {
      return "Password is wrong."
          unless $password eq 'foo';
      $out = "Software documentation might as well be a secret sometimes.";
  }
  elsif($message =~ /top_secret/) {
      return "Password is wrong."
          unless $password eq 'bar';
      $out = "You can do a lot with software if you read the documentation!";
  }
  return $out || 'No message like that';
  [/set]

</XMP>
<p>And a results page secret.html (remember, set the destination for the 
<A HREF="minivend.html#minivend_return_0">return</A>

action with 
<A HREF="minivend.html#minivend_mv_nextpage_0">mv_nextpage</A>
):
<p>
<XMP>
    <HTML>
    <HEAD>
    <TITLE>Secret?</TITLE>
    </HEAD>
    [body 1]
    Secret: [data session return_value]
    </BODY>
    </HTML>

</XMP>
<p>
<H2> 
<A NAME="minivend_checks_0">
Checks and Selections</A>
</H2>
You can provide a ``memory'' for drop-down menus, radio buttons, and
checkboxes with the [checked] and [selected] tags.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_checked_0">
[checked var_name value]</A>

</STRONG>
<DD>
(new syntax [checked name=``var_name'' value=``value''])
<p>This will output CHECKED if the variable <CODE>var_name</CODE> is equal to

<A HREF="minivend.html#minivend_value_1">value</A>
. Not case sensitive.
<p>
<DT><STRONG>

<A NAME="minivend_selected_0">
[selected var_name value MULTIPLE*]</A>

</STRONG>
<DD>
(new syntax [selected name=``var_name'' value=``value'' multiple=``yes''])
<p>This will output SELECTED if the variable <CODE>var_name</CODE> is equal to

<A HREF="minivend.html#minivend_value_1">value</A>
. If the optional MULTIPLE argument is present, it will
look for any of a variety of values. Not case sensitive.
<p>Here is a drop-down menu that remembers an item-modifier
color selection:
<p>
<XMP>
    <SELECT NAME="color">
    <OPTION [selected color blue]> Blue
    <OPTION [selected color green]> Green
    <OPTION [selected color red]> Red
    </SELECT>

</XMP>
<p>Here is the same thing, but for a shopping-basket color
selection
<p>
<XMP>
    <SELECT NAME="[modifier-name color]">
    <OPTION [selected [modifier-name color] blue]> Blue
    <OPTION [selected [modifier-name color] green]> Green
    <OPTION [selected [modifier-name color] red]> Red
    </SELECT>

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_setting_2">
Setting Form Security</A>
</H2>
You can ensure that a form will be submitted securely (to the base
URL in the SecureURL directive, that is) by specifying your form
input to be ACTION=``[process-target frame secure]''. If you are not
using frames, just specify the special frame ``_self'' or ``none''.
<p>To submit a form to the regular non-secure server, just omit the
<CODE>secure</CODE> modifier.
<p>
<H2> 
<A NAME="minivend_stacking_0">
Stacking Variables on the Form</A>
</H2>
Many MiniVend variables can be ``stacked'', meaning they can have
multiple values for the same variable name. As an example -- to allow
the user to order multiple items with one click, you can set up
a form like this:
<p>
<XMP>
 <FORM METHOD=POST ACTION="[process-order]">
 <input type=checkbox name="mv_order_item" value="M3243"> Item M3243
 <input type=checkbox name="mv_order_item" value="M3244"> Item M3244
 <input type=checkbox name="mv_order_item" value="M3245"> Item M3245
 <input type=hidden name="mv_doit" value="refresh">
 <input type=submit name="mv_junk" value="Order Checked Items">
 </FORM>

</XMP>
<p>The stackable <EM>mv_order_item</EM> variable with be decoded with multiple
values, causing the order of any items that are checked.
<p>To place a ``delete'' checkbox on your shopping basket display:
<p>
<XMP>
 <FORM METHOD=POST ACTION="[process-order]">
 [item-list]
   <input type=checkbox name="[quantity-name]" value="0"> Delete
   Part number: [item-code]
   Quantity: <input type=text name="[quantity-name]" value="[item-quantity]">
   Description: [item-description]
 [/item-list]
 <input type=hidden name="mv_doit" value="refresh">
 <input type=submit name="mv_junk" value="Order Checked Items">
 </FORM>

</XMP>
<p>In this case, <STRONG>first</STRONG> instance of the variable name set by [quantity-name]
will be used as the order quantity, deleting the item from the form.
<p>Of course, not all variables are stackable. Check the documentation for
which ones can be stacked -- or experiment on your own.
<p>
<H2> 
<A NAME="minivend_setting_3">
Setting SQL tables with a form</A>
</H2>
Any MiniVend database can be updated with a form using the following method.
<p>NOTE: If you are updating a non-SQL database, you will have to perform a
[tag export database][/tag] operation if you wish to update the ASCII
source file with the results of your update.
<p>You of course may insert or update records in any <EM>SQL</EM> database with the
[sql set] tag, but you may also do form-based updates or inserts.
<p>In an update form, four special MiniVend variables are used to select
the database parameters:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_data_table_0">
mv_data_table</A>

</STRONG>
<DD>
The table to update.
<p>
<DT><STRONG>

<A NAME="minivend_mv_data_key_0">
mv_data_key</A>

</STRONG>
<DD>
The field that is the primary key in the table. Must match the existing
database definition.
<p>
<DT><STRONG>

<A NAME="minivend_mv_data_function_0">
mv_data_function</A>

</STRONG>
<DD>
UPDATE or INSERT.
<p>
<DT><STRONG>

<A NAME="minivend_mv_data_fields_0">
mv_data_fields</A>

</STRONG>
<DD>
Fields from the form which should be inserted or updated. Must be existing
columns in the table in question.
<p>
</DL>
The MiniVend action <STRONG>set</STRONG> (see 
<A HREF="minivend.html#minivend_actionmap_0">ActionMap</A>
), causes the update. Here.is an pair of example forms. One is used to set the key to access the
record (careful with the name, this one goes into the user session
values). The second actually performs the update. It uses the [loop]
tag with only one value to place default/existing values in the form
based on the input from the first form:
<p>
<XMP>
    <FORM METHOD=POST ACTION="[process-target]">
    <INPUT TYPE=HIDDEN name="mv_doit" value="return">
    <INPUT TYPE=HIDDEN name="mv_nextpage" value="update_proj">
    Sales Order Number <INPUT TYPE=TEXT SIZE=8
                            NAME="update_code"
                            VALUE="[value update_code]">
    <INPUT TYPE=SUBMIT name="mv_submit"  Value="Select">
    </FORM>
        [new]
    <FORM METHOD=POST ACTION="[process-target]">
    <INPUT TYPE=HIDDEN NAME="mv_data_table"    VALUE="ship_status">
    <INPUT TYPE=HIDDEN NAME="mv_data_key"      VALUE="code">
    <INPUT TYPE=HIDDEN NAME="mv_data_function" VALUE="update">
    <INPUT TYPE=HIDDEN NAME="mv_nextpage"      VALUE="updated">
    <INPUT TYPE=HIDDEN NAME="mv_data_fields"
                VALUE="code,custid,comments,status">
    <PRE>
    [loop arg="[value update_code]"]
    Sales Order <INPUT TYPE=TEXT NAME="code    SIZE=10 VALUE="[loop-code]">
   Customer No. <INPUT TYPE=TEXT NAME="custid" SIZE=30
                    VALUE="[loop-field custid]">
       Comments <INPUT TYPE=TEXT NAME="comments" 
                    SIZE=30 VALUE="[loop-field comments]">
         Status <INPUT TYPE=TEXT NAME="status"
                    SIZE=10 VALUE="[loop-field status]">
    [/loop]
    </PRE>
        <INPUT TYPE=SUBMIT name="mv_todo"  Value="Set">
    </FORM>

</XMP>
<p>The variables in the form do <STRONG>not</STRONG> update the user's session values,
so they can correspond to database field names without fear of corrupting
the user session.
<p><p><hr>

<H1> 
<A NAME="minivend_the_4">
THE SEARCH ENGINE</A>
</H1>
MiniVend implements a search engine which will search the product
database (or any other file) for items based on customer input. It uses
either forms or URL-based searches (called with the special page name
<CODE>scan</CODE>). The search engine uses many special MiniVend tags and variables.
<p>Examples of search forms and result pages are included in the supplied
demos.
<p>Two search engine interfaces are provided, and five types of searching
are available. The default is a text-based search of the

<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file. A binary search of a dictionary-ordered file can
be specified. An optional Glimpse search is enabled by placing
the command specification for Glimpse in the directive 
<A HREF="minivend.html#minivend_glimpse_0">Glimpse</A>
.
There is a range-based search, used in combination with
one of the above. And finally, there is an SQL search which 
translates the MiniVend search interface to SQL queries.
<p>The default, a text based search, sequentially scans the lines in
the target file. By default it returns the first field (delineated by
the standard 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>
), for every line matching the search
specification. This corresponds to the product code, which is then
used to key specific accesses to the database.
<p>The text-based search is capable of sophisticated field-specific
searches with fully-independent case-sensitivity, substring, and negated
matching. (There is not yet a full search language except for SQL queries,
so AND/OR matching is not supported across multiple fields. Stay tuned
for this in MiniVend 3.1 or later.)
<p>
<H2> 
<A NAME="minivend_the_5">
The Search Form</A>
</H2>
A number of variables can be set on search forms to determine which search
will be used, what fields in the database it will search, and what search
behavior will be.
<p>Here is a simple search form:
<p>
<XMP>
  <FORM ACTION="[process-search]" METHOD=POST>
  <INPUT TYPE="text" SIZE="30" NAME="mv_searchspec">
  <INPUT TYPE="submit" NAME="mv_todo" VALUE="Search">
  </FORM>

</XMP>
<p>When the ``Search'' submit button is pressed (or &lt;ENTER&gt; is pressed)
MiniVend will search the 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file for the string entered
into the text field 
<A HREF="minivend.html#minivend_mv_searchspec_0">mv_searchspec</A>
, and return the product
code pertaining to that line.
<p>The same search for a fixed string, say ``shirt'', could be performed with
the use of a hot link, using the special <EM>scan</EM> URL:
<p>
<XMP>
  [page scan/se=shirt]See our shirt collection![/page]

</XMP>
<p>The default is to search every field on the line.
If you only wished to match on the string shirt in the product
database field ``description'', you could modify the search:
<p>
<XMP>
  <INPUT TYPE="hidden" NAME="mv_search_field" VALUE="description">

</XMP>
<p>In the hot-linked URL search:
<p>
<XMP>
  [page scan/se=shirt/sf=description]See our shirt collection![/page]

</XMP>
<p>If you want to let the user decide on the search parameters, you can
use checkboxes or radiobox fields to set the fields:
<p>
<XMP>
    Search by author
       <INPUT TYPE="checkbox" NAME="mv_search_field" VALUE="author">
    Search by title
        <INPUT TYPE="checkbox" NAME="mv_search_field" VALUE="title">

</XMP>
<p>Fields can be stacked -- if more than one is checked, all checked fields
will be searched. (This doesn't work for Glimpse in the return_file_name
mode, though).
<p>
<H2> 
<A NAME="minivend_glimpse_0">
Glimpse</A>
</H2>
<STRONG>To use the Glimpse search</STRONG>, you must build the Glimpse index based on
files in your 
<A HREF="minivend.html#minivend_productdir_0">ProductDir</A>
, or wherever the files to be searched will
be located. If you installed MiniVend in the default
<CODE>/usr/local/lib/minivend</CODE>, the command line to build the index for the
products file would be:
<p>
<XMP>
    glimpseindex -b -H /usr/local/lib/minivend/products products.asc

</XMP>
<p>There are several ways to improve search speed for large catalogs.
<p>One method that works well for large 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 files is to split
the 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file into small index files (in the example, 100
lines) with the split(1) UNIX/POSIX command, then index it with glimpse:
<p>
<XMP>
    split -100 products.asc index.asc.
    glimpseindex -H /usr/local/lib/minivend/products index.asc.*

</XMP>
<p>This will dramatically increase search speeds for large catalogs, at
least if the search term is relatively unique. If it is a common string,
as you might have in a category search, you will be better off to use
the text-based search.
<p>If you are intending to search for numbers, add the -n option to
the Glimpse command line.
<p>(A large catalog is one of more than several thousand items -- smaller
ones have acceptable speed in any of the search modes.)
<p>If the Glimpse executable is not found at MiniVend startup, the Glimpse
search will be disabled and the regular text-based search used instead.
<p>There are several things you have to watch for while using <STRONG>glimpse</STRONG>,
and a liberal dose of the Glimpse documentation is suggested. In particular,
the spelling error capability will not work in combination with the
field-specific search -- Glimpse selects the line, but MiniVend's
text-based search routines disqualify it when checking to see if the
search string is within one of the specified fields.
<p>
<H2> 
<A NAME="minivend_fast_0">
Fast Binary Search</A>
</H2>
<STRONG>Fast binary searching</STRONG> is useful for scanning large databases for
strings that match the beginning of a line. They use the standard
Perl module Search::Dict, and are enabled through use of the 
<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
,

<A HREF="minivend.html#minivend_mv_dict_end_0">mv_dict_end</A>
, 
<A HREF="minivend.html#minivend_mv_dict_limit_0">mv_dict_limit</A>
, 
<A HREF="minivend.html#minivend_mv_dict_fold_0">mv_dict_fold</A>
, and 
<A HREF="minivend.html#minivend_mv_dict_order_0">mv_dict_order</A>

variables.
<p>The search must be done on a <STRONG>dictionary-ordered</STRONG> pre-built index, 
production of which is left as an exercise for the user.
<p><STRONG>Hint:</STRONG> the field to search is the first field in the file, then the
product code should be in the second field, delimited by 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>
.
You will also have to set mv_return_fields=1 to return the product code
in the search.
<p>
<H2> 
<A NAME="minivend_range_0">
Range Searching</A>
</H2>
Range searching allows you to qualify your search returns with a field
that must be within a certain numeric or alphanumeric range. To use it,
set the mv_range_look variable to the products database field, or a
column/field number for another file. Then set the corresponding

<A HREF="minivend.html#minivend_mv_range_min_0">mv_range_min</A>
 and 
<A HREF="minivend.html#minivend_mv_range_max_0">mv_range_max</A>
 variables with a selectable field.
<p>
<XMP>
    <INPUT TYPE="hidden" NAME="mv_range_look" VALUE="price">
        Search on Price
    Min <SELECT NAME="mv_range_min">
             <OPTION value=0 SELECTED> Free
             <OPTION value=1000000> $1,000,000
             <OPTION value=10000000> $10,000,000
             <OPTION value=20000000> $20,000,000
             <OPTION value=40000000> $40,000,000
        </SELECT><BR>
    Max <SELECT NAME="mv_range_max">
            <OPTION value=0 SELECTED> no object
            <OPTION value=1000000> $1,000,000
            <OPTION value=10000000> $10,000,000
            <OPTION value=20000000> $20,000,000
            <OPTION value=40000000> $40,000,000
        </SELECT>

</XMP>
<p>The value of 0 for mv_range_max is equivalent to infinity if doing a
numeric search. (This makes it impossible to search for a ceiling of 0
with a negative mv_range_min, just in case you were planning on trying
that.)
<p>The fields are stackable, so you can set more than one range to
check. The order is significant, in the sense that the array
of field names and minimum/maximum values must be kept in order
to achieve correspondence.
<p>The optional 
<A HREF="minivend.html#minivend_mv_range_alpha_0">mv_range_alpha</A>
 specification allows alphanumeric range
matching for the corresponding field -- if it is set, and you have
stacked the fields, they must all be set. The 
<A HREF="minivend.html#minivend_mv_case_0">mv_case</A>
 field does
apply if it is set -- otherwise the comparison is without regard to
case.
<p>If you wish to do ONLY a range search, you must select all lines
with <EM>mv_return_all</EM>=yes in order to make the search operate. Range-only
searches will be quite slow for large databases, since every line
must be scanned. It should be quite usable for catalogs of less than
10,000 items in size, given a fast machine. Using it in combination
with another search technique (in the same query) will yield faster search
returns.
<p>
<H2> 
<A NAME="minivend_sql_9">
SQL searches</A>
</H2>
MiniVend can formulate and execute SQL searches in much the same way as it does
text or Glimpse searches. Because of the SQL language and the limitations a
common subset places on the operation, not all parameters are supported.
<p>The following variables are in effect for SQL searches:
<p>
<XMP>
 mv_matchlimit        S   Sets match page size
 mv_numeric           S   Determines numeric status of column for ? bind
 mv_orsearch          S   Selects AND/OR of search terms
 mv_range_look        S   Sets the column to do a range check on
 mv_range_max         S   Upper bound of range check
 mv_range_min         S   Lower bound of range check
 mv_return_fields     S   Columns to return from query
 mv_search_field      S   Sets the column(s) to be searched
 mv_search_file       S   Sets the table to be searched
 mv_search_page       S   Sets the page for search display
 mv_searchspec        S   Search specification(s)
 mv_searchtype        S   Sets search type (text, glimpse, or sql)
 mv_sort_field        S   Column(s) to sort on
 mv_sort_option       S   Options for sort (only global reverse)
 mv_sql_query         S   SQL query text for simple query
 mv_substring_match   S   Turns off word-matching mode

</XMP>
<p>Their two-letter abbreviations are in effect (as below), so you may
easily do a one-click SQL search.
<p>If you are using SQL for the products database, and the table
you are searching is in the same SQL database, you don't need to
specify the table other than in the query.  If you are not using
SQL for products, or it resides in a different database, then
you must specify a MiniVend database identifier located in the
same SQL database as the table you are querying.  Use the
mv_search_file variable:
<p>
<XMP>
   <INPUT TYPE=hidden NAME=mv_search_file VALUE="inventory">

</XMP>
<p>Once you have selected the database, you may query any table that
is located within the same SQL data source.
<p>There are two modes for SQL search:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_simple_1">
Simple query substitution</A>

</STRONG>
<DD>
To do a simple query, define the variable mv_sql_query to be a valid
SQL query. In its simplest form:
<p>
<XMP>
    <FORM METHOD=POST ACTION="[process-search]">
    <INPUT TYPE=hidden NAME=mv_searchtype VALUE="sql"> 
    <INPUT TYPE=hidden NAME=mv_sql_query
        VALUE="select code from products where category = 'Americana'">
    <INPUT TYPE=SUBMIT VALUE="Americana">
    </FORM>

</XMP>
<p>When the user clicks the button, the query will be done and the 
results returned using the default search return page.  You may
set the return page with mv_search_page as in the other searches, 
but most other variables have no effect.
<p>Another exception is the mv_searchspec variable, which when set with
either user-entered text or by another method, will be inserted
in place of a single question mark in the query:
<p>
<XMP>
    <FORM METHOD=POST ACTION="[process-search]">
    <INPUT TYPE=hidden NAME=mv_searchtype VALUE="sql"> 
    <INPUT TYPE=hidden NAME=mv_sql_query
        VALUE="select code from products where category = ? ">
    <SELECT NAME=mv_searchspec>
        <OPTION> Americana
        <OPTION> Contemporary
        <OPTION> Impressionists
        <OPTION> Renaissance
        <OPTION> Surreallists
    </SELECT>
    <INPUT TYPE=SUBMIT VALUE="Go">
    </FORM>

</XMP>
<p>When the user selects one of the search categories, the value of
mv_searchspec will be substituted for the question mark, and quoted
if the field is not numeric in nature.
<p>The spaces necessary in SQL queries make hand generation of one-click
URLs pretty tedious.  You may generate one-click searches easily using
[tag sql] SQL [/tag].  For example, the query
<p>
<XMP>
    <A HREF="[tag sql]SELECT code from products where category = 'Americana'[/tag]">
        Americana
    </A>

</XMP>
<p>generates HTML that starts out:
<p>
<XMP>
    <A HREF="http://your.com/cgi-bin/simple/scan/sq=SELECT%20code%20from%20...">
       Americana
    </A>

</XMP>
<p>The actual URL is a bit too long to show. The same result would be generated
by:
<p>
<XMP>
    [page scan/sf=category/se=Americana/st=sql]
      Americana
    [/page]

</XMP>
<p>The first example may be more intuitive for some; it is marginally faster.
<p>
<DT><STRONG>
<EM>Complex form-based query</EM>
</STRONG>
<DD>
Within the confines of the variables in use for SQL searches, you 
may generate some pretty complex queries.  The principles are much
the same as for the other searches, but the implementation differs
a bit.
<p>For example, if you don't specify a field or fields in the table to
search, MiniVend will search all fields as is the default for the
text and Glimpse searches.  This can be quite inefficient, as the
resulting query looks something like:
<p>
<XMP>
    select code from products
        WHERE title  = 'Van Gogh'
        OR    artist = 'Van Gogh'
        OR    description = 'Van Gogh'
        OR    price = 'Van Gogh'
        etc.

</XMP>
<p>You get the picture. Each field is checked in turn. Much better is
to set the mv_search_field variable to the field(s) you wish searched,
skipping the ones that make no sense:
<p>
<XMP>
    <INPUT TYPE=hidden NAME=mv_search_field VALUE=artist>
    <INPUT TYPE=hidden NAME=mv_search_field VALUE=title>

</XMP>
<p>This generates a much more limited query.
<p>If there are more mv_searchspec values than fields, then only the
first search field is used.  The below query will fail, as the
second and subsequent search fields are ignored.
<p>
<XMP>
    <INPUT NAME=mv_searchspec VALUE="Van Gogh">
    <INPUT NAME=mv_searchspec VALUE="Dali">
    <INPUT TYPE=hidden NAME=mv_search_field VALUE="title">
    <INPUT TYPE=hidden NAME=mv_search_field VALUE="artist">

</XMP>
<p>If there are more mv_search_field values than mv_searchspec values,
then only the first search specification will be used:
<p>
<XMP>
    <INPUT NAME=mv_searchspec VALUE="Van Gogh">
    <INPUT NAME=mv_searchspec VALUE="Dali">
    <INPUT TYPE=hidden NAME=mv_search_field VALUE="title">
    <INPUT TYPE=hidden NAME=mv_search_field VALUE="artist">
    <INPUT TYPE=hidden NAME=mv_search_field VALUE="museum">

</XMP>
<p>The string 'Dali' will never be looked for.
<p>If the number of search fields and search specs are the same, a coordinated
AND search is done, and only rows matching all searchspecs will be
found.
<p>The mv_range_look facility is in use for the complex form query as well,
and operates in exactly the same way.
<p>The following search will find all Van Gogh paintings that are between
<STRONG>$1</STRONG>,000,000 and <STRONG>$20</STRONG>,000,000, providing the price field is a numeric data
type.  It also illustrates the use of some other MiniVend variables that
are usable for SQL searches.
<p>
<XMP>
    <FORM METHOD=POST ACTION="[process-search]">
    <INPUT TYPE=hidden NAME=mv_searchtype VALUE="sql"> 
    <INPUT NAME=mv_searchspec               VALUE="Van Gogh">
    <INPUT TYPE=hidden NAME=mv_search_field VALUE="artist">
    <INPUT TYPE=hidden NAME=mv_range_look   VALUE="price">
    <INPUT TYPE=hidden NAME=mv_range_min    VALUE="1000000">
    <INPUT TYPE=hidden NAME=mv_range_max    VALUE="20000000">
    <INPUT TYPE=hidden NAME=mv_return_fields VALUE="code,description">
    <INPUT TYPE=hidden NAME=mv_sort_field    VALUE="price">
    <INPUT TYPE=hidden NAME=mv_sort_option   VALUE="r">
    </FORM>

</XMP>
<p>It will generate the query:
<p>
<XMP>
    SELECT code, description FROM products WHERE artist = 'Van Gogh'
          AND price >= 1000000 AND price <= 20000000
          ORDER BY price DESC

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_one_click_1">
One-click searches</A>
</H2>
MiniVend allows you to pass a search in a URL. Just specify the
search with the special page reference <CODE>scan</CODE>. Here is an
example:
<p>
<XMP>
     [page scan/se=Impressionists/sf=category]
        Impressionist Paintings
     [/page]

</XMP>
<p>Here is the same thing from a home page (assuming /cgi-bin/vlink is
the CGI path for MiniVend's vlink):
<p>
<XMP>
     <A HREF="/cgi-bin/vlink/scan/se=Impressionists/sf=category">
        Impressionist Paintings
     </A>

</XMP>
<p>The two-letter abbreviations are mapped with these letters:
<p>
<XMP>
  DL  mv_raw_dict_look         ms  mv_min_string 
  SE  mv_raw_searchspec        ne  mv_negate         
  ac  mv_all_chars             nu  mv_numeric            
  bd  mv_base_directory        os  mv_orsearch       
  co  mv_coordinate            ra  mv_return_all     
  cs  mv_case                  rd  mv_return_delim   
  de  mv_dict_end              rf  mv_return_fields  
  df  mv_dict_fold             rg  mv_range_alpha    
  di  mv_dict_limit            rl  mv_range_look     
  dl  mv_dict_look             rm  mv_range_min      
  do  mv_dict_order            rn  mv_return_file_name
  dr  mv_record_delim          rs  mv_return_spec    
  em  mv_exact_match           rx  mv_range_max      
  er  mv_spelling_errors       se  mv_searchspec     
  fi  mv_search_file           sf  mv_search_field   
  fn  mv_field_names           sp  mv_search_page    
  hs  mv_head_skip             st  mv_searchtype     
  id  mv_index_delim           su  mv_substring_match
  ml  mv_matchlimit            tc  mv_sort_command   
  mm  mv_max_matches           tf  mv_sort_field     
  mp  mv_profile               to  mv_sort_option      
  ms  mv_min_string            ty  mv_sort_crippled   

</XMP>
<p>They can be treated just the same as form variables on the
page, except that they can't contain spaces, '/' in a file
name, or quote marks. These characters can be used
in URL hex encoding, i.e. <STRONG>%20</STRONG> is a space, <STRONG>%2F</STRONG> is a
<CODE>/</CODE>, etc. -- <CODE>&amp;sp;</CODE> or <CODE>&amp;#32;</CODE> will not be recognized.
<p>To replace a / (slash) in a file name (for the sp, bd, or fi parameter)
you must use the shorthand of ::, i.e. sp=results::standard. (This may
not work for some browsers, so you should probably either put the page
in the main pages directory or define the page in a search profile.)
<p>So if you wish to do an OR search on the fields category and artist
for the strings ``Surreal'' and ``Gogh'', while matching substrings,
you would do:
<p>
<XMP>
 [page scan/se=Surreal/se=Gogh/os=yes/su=yes/sf=artist/sf=category]
    Van Gogh -- compare to surrealists
 [/page]

</XMP>
<p>
<H2> 
<A NAME="minivend_in_page_0">
In-page searches</A>
</H2>
<STRONG>NOTE:</STRONG> New to MiniVend 3.03.
<p>You may specify a search inside a page with the [search se=searchstring]
tag. The parameters are the same as the the one-click search, and the
output is always a newline-separated list of the return objects -- by
default a series of item codes. The output of a [search ...] tag should
almost always be passed to a [loop LIST] [/loop] tag pair for iteration.
<p>Here is an example which will search for and show a series of products
that match the categories <CODE>Americana</CODE> and <CODE>Contemporary</CODE> within the 
products database field 
<A HREF="minivend.html#minivend_category_0">category</A>
.
<p>
<XMP>
    [loop [search se=Americana/se=Contemporary/os=yes/sf=category]]
    Artist: [loop-field artist]<BR>
    Title: [loop-field title]<P>
    [/loop]

</XMP>
<p>The advantage of the in-page search is that you can embed searches within
searches, and you can have straight unchanging links from static HTML pages.
<p>
<H2> 
<A NAME="minivend_search_1">
Search Profiles</A>
</H2>
You can predefine an unlimited number of search profiles that reside
in a file or files. To use this, make up a series of lines like:
<p>
<XMP>
 mv_searchfield=artist
 mv_searchfield=category
 mv_orsearch=yes

</XMP>
<p>These correspond to the MiniVend search variables that can
be set on a form. You can set it right on the page that contains
the search.
<p>
<XMP>
        [set artist_profile]
        mv_searchfield=artist
        mv_searchfield=category
        mv_orsearch=yes
        [/set]

</XMP>
<p>Then in the search form, set a variable with the name of the profile:
<p>
<XMP>
        <INPUT TYPE=hidden NAME=mv_profile VALUE=artist_profile>

</XMP>
<p>In a one-click search, you use the <CODE>mp</CODE> modifier:
<p>
<XMP>
        [page scan/se=Leonardo/mp=artist_profile]A left-handed artist[/page]

</XMP>
<p>You can also place them in a file. Define the file name in the

<A HREF="minivend.html#minivend_searchprofile_0">SearchProfile</A>
 directive. (You must reconfig the catalog for MiniVend
to read it.)  The profile is named by placing a name following a __NAME__
pragma:
<p>
<XMP>
  __NAME__ title_search

</XMP>
<p>The __NAME__ must begin the line, and be followed by whitespace
and then the name.
<p>The special variable <EM>mv_last</EM> stops interpretation of search
variables. The following variables are always interpreted:
<p>
<XMP>
    mv_dict_look
    mv_searchspec
    mv_range_look
    mv_range_min
    mv_range_max

</XMP>
<p>Other than that, if you set mv_last in a search profile, and there
are other variables on the search form, they will not be interpreted.
<p>If you want to place multiple search profiles in the same file,
separate them with __END__, which must be on a line by itself.
<p>
<H2> 
<A NAME="minivend_search_2">
Search Reference</A>
</H2>
The supplied 
<A HREF="minivend.html#minivend_simple_0">simple/srchform.html</A>
 and 
<A HREF="minivend.html#minivend_simple_0">simple/results.html</A>
 pages
show example search forms. You can modify them to present the search
in any way you like -- just be careful to use the proper variable names
for passing to MiniVend. It is also necessary that you copy the hidden
variables as-is -- they are required to interpret the request as a
search.
<p><STRONG>NOTE:</STRONG> The following definitions frequently refer to 
<A HREF="minivend.html#minivend_field_2">field name</A>

and <EM>column</EM> and <EM>column number</EM> -- all are the references to the
columns of a searched text file as separated by delimiter characters.
<p>The field names can be specified in several ways.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_products_asc_0">
products.asc</A>

</STRONG>
<DD>
If the file to be searched is left empty in the search form or definition
(set with 
<A HREF="minivend.html#minivend_mv_search_file_0">mv_search_file</A>
), then the 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
 file will be
searched, and field names are already available as named in the first
line of 
<A HREF="minivend.html#minivend_products_asc_0">products.asc</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_other_0">
other database files</A>

</STRONG>
<DD>
If the file or files to be searched are ASCII delimited files, and
have field names specified on the first line of the file, MiniVend
will read the first line (of the first file) and determine the field
names.
<p>
<DT><STRONG>

<A NAME="minivend_other_1">
other files</A>

</STRONG>
<DD>
If the file or files to be searched are ASCII delimited files, but
<STRONG>don't</STRONG> have field names specified on the first line of the file,
you can set the variable 
<A HREF="minivend.html#minivend_mv_field_names_0">mv_field_names</A>
 to a comma-separated list
of field names as they will be referenced.
<p>
</DL>
Fields can also always be specified by an integer column number, with 0.as the first column. This may reduce system processing somewhat, since
the field names don't have to be indexed every time they are referenced,
and won't have to be read from disk.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_all_chars_0">
mv_all_chars</A>

</STRONG>
<DD>
Set this if you anticipate searching for lots of punctuation characters
that might be special characters for Perl -- the characters ()[]\$^ are
included.
<p>
<DT><STRONG>

<A NAME="minivend_mv_base_directory_0">
mv_base_directory</A>

</STRONG>
<DD>
In the text search, set to the directory from which to base file
searches. File names without leading / characters will be based from
there. In the Glimpse search, passed to Glimpse with the <CODE>-H</CODE> option,
and Glimpse will look for its indices there. Default is ProductDir.
<p>
<DT><STRONG>

<A NAME="minivend_mv_case_0">
mv_case</A>

</STRONG>
<DD>
If this item is set to <EM>yes</EM>, the search will return items without regard
to upper or lower case. This is the default -- set to <EM>yes</EM> if case
should be matched. Implement with a checkbox &lt;INPUT TYPE=CHECKBOX&gt; field.
<p>If stacked to match the mv_search_field and mv_searchspec variables,
and 
<A HREF="minivend.html#minivend_mv_coordinate_0">mv_coordinate</A>
 is set, it will operate only for the corresponding
field.
<p>
<DT><STRONG>

<A NAME="minivend_mv_coordinate_0">
mv_coordinate</A>

</STRONG>
<DD>
If this item is set to <EM>yes</EM>, and the number of search fields equals
the number of search specs, the search will return only items that
match field to spec. (The search specifications are set by stacked

<A HREF="minivend.html#minivend_mv_searchspec_0">mv_searchspec</A>
 and 
<A HREF="minivend.html#minivend_mv_search_field_0">mv_search_field</A>
 variables.)
<p>Case sensitivity, substring matching, and negation all work on a field-by
field basis according to the following:
<p>
<UL>
<LI>If only one instance of the option is set, then it will
affect all fields.
<p>
<LI>If the number of instances of the option is greater than or equal
to the number of search specs, all will be used independently. Trailing
instances will be ignored.
<p>
<LI>If more than one instance of the options are set, but fewer than the
number of search specifications, the default setting will be used for
the trailing unset options.
<p>If a search specification is blank, it will be removed and all 
case-sensitivity/negation/substring options will be adjusted accordingly.
<p>
</UL>
.
<p>
<LI>
<A NAME="minivend_mv_dict_end_0">
mv_dict_end</A>

If the string at the beginning of a line lexically exceeds this value,
matching will stop. Ignored without mv_dict_look.
<p>
<LI>
<A NAME="minivend_mv_dict_fold_0">
mv_dict_fold</A>

Make dictionary matching case-insensitive. Ignored without mv_dict_look.
NOTE: This is the reverse sense from mv_case.
<p>
<LI>
<A NAME="minivend_mv_dict_limit_0">
mv_dict_limit</A>

Automatically set the limiting string (mv_dict_end) to be one character
greater than the mv_dict_look variable, at the character position
specified. A value of 1, for instance, will set the limiting string
to ``fprsythe'' if the value of 
<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
 is ``forsythe''. A useful
value is -1, which will increment the last character (setting the 
mv_dict_end to ``forsythf'' in our example). This prevents having
to scan the whole file once a unique match is found.
<p>The order of this and the 
<A HREF="minivend.html#minivend_mv_dict_end_0">mv_dict_end</A>
 variable is significant -- each
will overwrite the other.
<p>
<LI>
<A NAME="minivend_mv_dict_look_0">
mv_dict_look</A>

The string at which to begin matching at in a dictionary-based search. If
not set, the mv_dict_end, mv_dict_fold, and mv_dict_case variables will
be ignored. May be set in a search profile based on other form variables.
<p>
<LI>
<A NAME="minivend_mv_dict_order_0">
mv_dict_order</A>

Make dictionary matching follow dictionary order, where only word characters
and whitespace matter. Ignored without mv_dict_look.
<p>
<LI>
<A NAME="minivend_mv_doit_0">
mv_doit</A>

This must be set to 
<A HREF="minivend.html#minivend_search_0">search</A>
 to make this a search page.
<p>
<LI>
<A NAME="minivend_mv_exact_match_0">
mv_exact_match</A>

Normally MiniVend searches match words, as opposed to sentences.
This behavior can be overridden with mv_exact_match, which when
set will place quotes around any value in mv_searchspec or mv_dict_look.
<p>
<LI>
<A NAME="minivend_mv_field_names_0">
mv_field_names</A>

Deprecated in favor of in-list sorting.
<p>Defines the field names for the file being searched. This guarantees
that they will be available, and prevents a disk access if using named
fields on a search file (that is not the product database ASCII source,
where field names are already known). This <STRONG>must</STRONG> be exactly correct,
or it will result in anomalous search operation. Usually passed in a
hidden field or search profile as a comma-separated list.
<p>NOTE: You should use this on the product database only if you
plan on both pre-sorting with 
<A HREF="minivend.html#minivend_mv_sort_field_0">mv_sort_field</A>
 and then post-sorting
with [sort]field:opt[/sort].
<p>
<LI>
<A NAME="minivend_mv_head_skip_0">
mv_head_skip</A>

Normally MiniVend searches all lines of an index/product file but the
first. Set this to the number of lines to skip at the beginning of the
index. Default is 1 for the text search, which skips the header line
in the product file. Default is 0 for a Glimpse search.
<p>
<LI>
<A NAME="minivend_mv_index_delim_0">
mv_index_delim</A>

Sets the delimiter for counting fields in a search index. The default
is the same as the 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>
 directive.
<p>
<LI>
<A NAME="minivend_mv_matchlimit_0">
mv_matchlimit</A>

The page size for matches that are returned. If more matches than

<A HREF="minivend.html#minivend_mv_matchlimit_0">mv_matchlimit</A>
 are found, the search paging mechanism will be
employed if the proper <EM>[more_list]</EM> is present. Can be
implemented as a scrolling list (INPUT TYPE=SELECT) or radiobox 
(INPUT TYPE=RADIO) field.
<p>
<LI>
<A NAME="minivend_mv_max_matches_0">
mv_max_matches</A>

The maximum number of records that will be returned in a search.
Default is 2000.
<p>
<LI>
<A NAME="minivend_mv_min_string_0">
mv_min_string</A>

Sets the minimum size of a search string for a search operation.
Default is 4 for the Glimpse search, and 1 for the text search.
<p>
<LI>
<A NAME="minivend_mv_negate_0">
mv_negate</A>

Specifies that records NOT matching the search criteria will be returned.
Default is no. It is not operative for the Glimpse search.
<p>If stacked to match the mv_search_field and mv_searchspec variables,
and mv_coordinate is set, it will operate only for the corresponding
field.
<p>
<LI>
<A NAME="minivend_mv_orsearch_0">
mv_orsearch</A>

If this item is set to <EM>yes</EM>, the search will return items matching any
of the words in <EM>searchspec</EM>. The default is <EM>no</EM>.
<p>
<LI>
<A NAME="minivend_mv_profile_0">
mv_profile</A>

Selects one of the pre-defined search specifications set by the

<A HREF="minivend.html#minivend_searchprofile_0">SearchProfile</A>
 directive. If the special variable within that file,
<EM>mv_last</EM>, is defined, it will prevent the scanning of the form input
for further search modifications. The values of 
<A HREF="minivend.html#minivend_mv_searchspec_0">mv_searchspec</A>
 and

<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
 are always scanned, so you can specify this to do the
equivalent of setting multiple checkboxes or radioboxes with one click,
while still reading the search input text.
<p>
<LI>
<A NAME="minivend_mv_range_alpha_0">
mv_range_alpha</A>

Sets the type of match, numeric or alphanumeric,  for the range search
in its corresponding range field. The search will return true (assuming
it is greater than the mv_range_min specification) if the field searched
is less than or equal to mv_range_max, in an alphanumeric sense.
<p>
<LI>
<A NAME="minivend_mv_range_look_0">
mv_range_look</A>

This sets a field to scan for a range of numbers. It must be
accompanied with corresponding mv_range_min and mv_range_max variables.
It can be specified with either a field name or a column number.
<p>
<LI>
<A NAME="minivend_mv_range_max_0">
mv_range_max</A>

Sets the high bound for the range search in its corresponding 
range field. The search will return true (assuming it is greater than
the mv_range_min specification) if the field searched is less than or
equal to mv_range_max. To set the bound at infinity, or whatever your
integer limit is, set mv_range_min to 0.
<p>
<LI>
<A NAME="minivend_mv_range_min_0">
mv_range_min</A>

Sets the low bound for the range search in its corresponding 
range field. The search will return true (assuming it is less than
the mv_range_max specification) if the field searched is less than or
equal to mv_range_min.
<p>
<LI>
<A NAME="minivend_mv_record_delim_0">
mv_record_delim</A>

Sets the delimiter for counting records in a search index. The default
is newline, which works for the products and most line-based index files.
<p>
<LI>
<A NAME="minivend_mv_return_fields_0">
mv_return_fields</A>

The fields that should be returned by the match, specified either by
field name or by column number. You should almost always specify
0 as the first field to be returned if searching the products database,
since that is the key for accessing database fields.
<p>
<LI>
<A NAME="minivend_mv_search_field_0">
mv_search_field</A>

The field(s) to be searched, specified either by column name
or by column number.
<p>If the number of instances matches the number of fields specified in the
mv_searchspec variable, and mv_coordinate is set to true, each search
field (in order specified on the form) will be matched with each search
spec (again in that order).
<p>
<LI>
<A NAME="minivend_mv_search_file_0">
mv_search_file</A>

In the text search, set this variable to the file(s) to be scanned
for a match. The default, if not set, is to scan the products.asc
file. If set multiple times in a form (for a text search), will cause a
search all the files. One file name per instance.
<p>In the Glimpse search, follows the Glimpse wildcard-based file name
matching scheme. Use with caution and a liberal dose of the Glimpse
man page.
<p>
<LI>
<A NAME="minivend_mv_search_match_count_0">
mv_search_match_count</A>

Set by the search to indicate the total number of matches found.
<p>
<LI>
<A NAME="minivend_mv_search_over_msg_0">
mv_search_over_msg</A>

The message that should be displayed if there is an overflow
condition (max_matches is exceeded). Overrides the SearchOverMsg
directive -- it is cleared by MiniVend if there is no overflow.
Somewhat deprecated by match paging.
<p>
<LI>
<A NAME="minivend_mv_search_page_0">
mv_search_page</A>

The MiniVend-style name of the page that should display the search
results. Overrides the FrameSearchPage directive, and the default
value of 
<A HREF="minivend.html#minivend_search_0">search</A>
.
<p>
<LI>
<A NAME="minivend_mv_searchspec_0">
mv_searchspec</A>

The actual search string that is typed in by the customer. It is 
a text INPUT TYPE=TEXT field, or can be put in a select (drop-down)
list to enable category searches. If multiple instances are found,
they will be concatenated just as if multiple words had been 
placed in a text field.
<p>The user can place quotes around words to specify that they match
as a string. To enable this by default, use the 
<A HREF="minivend.html#minivend_mv_exact_match_0">mv_exact_match</A>

variable.
<p>If 
<A HREF="minivend.html#minivend_mv_dict_look_0">mv_dict_look</A>
 has a value, and mv_searchspec does <STRONG>not</STRONG>, then
mv_searchspec will be set to the value of mv_dict_look.
<p>If the number of instances matches the number of fields specified in the
mv_search_field variable, and mv_coordinate is set to true, each search
field (in order specified on the form) will be matched with each search
spec (again in that order).
<p>
<LI>
<A NAME="minivend_mv_searchtype_0">
mv_searchtype</A>

If set to <EM>glimpse</EM>, selects the Glimpse search (if Glimpse is defined).
<p>If set to <EM>sql</EM>, formulates an SQL select statement to return the
search list. 
<p>If set to <EM>text</EM>, selects the text-based search.
<p>Defaults to <EM>text</EM> if 
<A HREF="minivend.html#minivend_glimpse_0">Glimpse</A>
 is not defined, to Glimpse if it
is. This can allow use of both search types if that is desirable --
for instance, searching for very common strings is better done by the
text-based search. An example might be searching for categories of items
instead of individual items.
<p>
<LI>
<A NAME="minivend_mv_sort_command_0">
mv_sort_command</A>

Set to a path name that will access the standard UNIX sort command --
the default is of course <EM>sort</EM>. If the sort command does not
accept field-specific options, as more recent sorts like the GNU
sort command do, set mv_sort_crippled to <EM>yes</EM>.
<p>
<LI>
<A NAME="minivend_mv_sort_field_0">
mv_sort_field</A>

(Most new users should ignore and use in-list sorting.)
<p>The file field(s) the search is to be sorted on, specified in one of two
ways. If the file(s) to be searched have a header line (the first line)
that contains 
<A HREF="minivend.html#minivend_delimiter_1">Delimiter</A>
-separated field names, it can be specified
by field name. If can also be specified by column number (the code or key
is specified with a value of 0, for both types). These can be stacked,
if coming from a form, or placed in a single specification separated
by commas.
<p>NOTE FOR ADVANCED USERS: If specifying a sort for the product database,

<A HREF="minivend.html#minivend_mv_field_names_0">mv_field_names</A>
 must be specified if you will be doing a fieldname-addressed
post-sort.
<p>
<LI>
<A NAME="minivend_mv_sort_option_0">
mv_sort_option</A>

(Most new users should ignore and use in-list sorting.)
<p>The way that each field should be sorted. The flags are <CODE>r</CODE>, <CODE>n</CODE>, 
and <CODE>f</CODE> -- for reverse, numeric, and case-insensitive respectively.
These can be stacked, if coming from a form, or placed in a single
specification separated by commas. The stacked options will be 
applied to the sort fields as they are defined, presuming those
are stacked.
<p>
<LI>
<A NAME="minivend_mv_spelling_errors_0">
mv_spelling_errors</A>

The number of spelling errors that will be tolerated. Ignored unless
using Glimpse. If you have a large catalog, you might wish to limit this
to two.
<p>
<LI>
<A NAME="minivend_mv_substring_match_0">
mv_substring_match</A>

If mv_substring_match is  set to <EM>yes</EM>, matches on substrings as well
as whole words. You would typically want to set this for dictionary-based
searches.
<p>If stacked to match the mv_search_field and mv_searchspec variables,
and mv_coordinate is set, it will operate only for the corresponding
field.
<p>
</UL>
.
<p>
<H2> 
<A NAME="minivend_the_6">
The Results Page</A>
</H2>
Once a search has been done, there needs to be a way of presenting
the output. By default, the special page search.html is used -- but
any number of search pages can be specified by passing the value in
the search form, specified in the variable 
<A HREF="minivend.html#minivend_mv_search_page_0">mv_search_page</A>
.
<p>On the search page, some special MiniVend tags are used to format
the otherwise standard HTML. Each of the iterative tags is
applied to every code returned from the search -- this is normally
the product code, but could be a key to any of the arbitrary
databases. The value placed by the [item-code] tag is set to whatever
the first field (separated by whitespace) is, at least when the 
default of <STRONG>yes</STRONG> is in the UseCode directive. 
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_search_list_0">
[search_list]</A>

</STRONG>
<DD>
Starts the representation of a search list. MiniVend tags can be
embedded in the search list, yielding a table or formatted
list of items with part number, description, price, and  hyperlinks to
order or go to its catalog page. 
<p>In particular, all of the item tags described under order page
are active. The most useful one might be [item_link], which if
properly used, can allow the user to search the catalog for
an item, then click a link to go to detailed catalog page
for the item.
<p>In fact, any of the MiniVend database access tags can be used,
allowing you to pull data from any of the fields in any of
your predefined databases. Along with the MiniVend conditional
tags, very complex pages can be built for each individual item
returned in the search.
<p>
<DT><STRONG>

<A NAME="minivend_search_list_1">
[/search_list]</A>

</STRONG>
<DD>
Ends the search list. 
<p>
<DT><STRONG>

<A NAME="minivend_no_match_0">
[no_match]</A>

</STRONG>
<DD>
Starts the region of the search results page that should be returned
if there is no match (and no error) for the search. If this is not
on the page, the special page 
<A HREF="minivend.html#minivend_nomatch_0">nomatch</A>
 will be displayed instead.
<p>
<DT><STRONG>

<A NAME="minivend_no_match_1">
[/no_match]</A>

</STRONG>
<DD>
Ends the no match region.
<p>
<DT><STRONG>

<A NAME="minivend_sort_0">
[sort database:field:option* database:field:option*]</A>

</STRONG>
<DD>
Sorts the search list return based on database fields. If no
options are supplied, sorts according to the return code. See

<A HREF="minivend.html#minivend_sorting_0">SORTING</A>
.
<p>
<DT><STRONG>
<EM>[sort]&lt;options&gt;[/sort]</EM>
</STRONG>
<DD>
(This form of sort is deprecated, as it is difficult to use.
Use the above method.)
<p>Placed inside the search list. Causes sorting of the search return
based on the passed options. The fields that are there
to sort are set by 
<A HREF="minivend.html#minivend_mv_return_fields_0">mv_return_fields</A>
.
<p>The field options passed in either numeric or field name form. If
they are field numbers, they are numbered as sent to the search list
in the order specified by 
<A HREF="minivend.html#minivend_mv_return_fields_0">mv_return_fields</A>
,
starting from 0 and proceeding upwards. If column names, they are
as found in the first record of the searched file (by default the
ASCII source for the product database), <EM>except for the key or first field</EM>.
followed by a 
<A HREF="minivend.html#minivend_required_1">required</A>
 colon (:) and the options, if any.
<p>Accepts none, any, or combinations of the flags:
<p>
<XMP>
  f   case-insensitive sort (folded) (mutually exclusive of n)
  n   numeric order (mutually exclusive of f)
  r   reverse sort

</XMP>
<p>The &lt;options&gt; are a field number and an optional flag or flags, in a
similar fashion to the Unix sort command, and are interpolated for form
values before being used. As an example, if you set up the following
fields on your search form:
<p>
<XMP>
  <INPUT TYPE="hidden" NAME="mv_return_fields" VALUE="0,title,artist,price">
  <INPUT TYPE="radio" NAME="the_sort_field" VALUE="title"> Sort by Title
  <INPUT TYPE="radio" NAME="the_sort_field" VALUE="artist"> Sort by Artist
  <INPUT TYPE="radio" NAME="the_sort_option" VALUE=""> Forward sort
  <INPUT TYPE="radio" NAME="the_sort_option" VALUE="r"> Reverse sort
  
  NOTE: The 0 refers to the database code/key used for [item-code]

</XMP>
<p>This would combine with the following search result page fragment
to sort by either title or artist.
<p>[search-list]
  [sort]
    [value the_sort_field]:[value the_sort_option]
  [/sort]
<B&gt;[item-field title]&lt;/B&gt;, by [item-field artist]&lt;BR&gt;
[/search-list]
<p>The [value...] lines will end up looking like <CODE>artist:r</CODE> or <CODE>title:</CODE>. This
could also be specified with <CODE>2r</CODE> or 
<A HREF="minivend.html#minivend__1">1</A>
.
<p>PERFORMANCE TIP: on heavily trafficked systems, it will pay to use only
column numbers rather than named fields, as it reduces processing and may
obviate an access to the searched file to find the field names.
<p>
<DT><STRONG>

<A NAME="minivend_uniq_0">
[uniq]</A>

</STRONG>
<DD>
Placed <STRONG>immediately</STRONG> after the <CODE>[sort]</CODE> tag (after <CODE>[search-list]</CODE>
if doing sorts via mv_sort_field). If specified on a sorted return list,
causes only the first line containing an [item-code] to be returned --
all subsequent lines will not be interpreted on the list. Note that

<A HREF="minivend.html#minivend_matches_0">[matches]</A>
 and <CODE>[more-list]</CODE> may not operate as you wish in this case.
<STRONG>Note</STRONG> that <CODE>[on-change]</CODE> is more likely useful.
<p>
<DT><STRONG>

<A NAME="minivend_on_change_0">
[on_change marker]</A>

</STRONG>
<DD>
Active only within [search-list][/search-list].
<p>Along with the companion 
<A HREF="minivend.html#minivend_on_change_1">[/on_change marker]</A>
, surrounds a region which
should only be output when a field (or other repeating value) changes its
value. This allows indented lists similar to database reports to be easily
formatted.  The repeating value must be a tag interpolated in the search
process, such as <CODE>[item-field field]</CODE> or <CODE>[item-data database field]</CODE>.
<p>Of course, this will only work as you expect when the search results
are properly sorted.
<p>The <CODE>marker</CODE> field is mandatory, and is also arbitrary, meaning that
you can select any marker you wish as long as it matches the marker
associated with 
<A HREF="minivend.html#minivend_on_change_1">[/on_change marker]</A>
. The value to be tested is contained
within a [condition]value[/condition] tag pair. The 
<A HREF="minivend.html#minivend_on_change_0">[on_change marker]</A>
 tag
also processes an [else] [/else] pair for output when the value does
not change. The tags may be nested as long as the markers are different.
<p>Here is a simple example for a search list that has a field 
<A HREF="minivend.html#minivend_category_0">category</A>
 and
<CODE>subcategory</CODE> associated with each item:
<p>
<XMP>
 <TABLE>
 <TR><TH>Category</TH><TH>Subcategory</TH><TH>Product</TH></TR>
 [search-list]
 <TR>
    <TD>
         [on-change cat]
 
         [condition][item-field category][/condition]
 
                 [item-field category]
         [else]
                 &nbsp;
         [/else]
         [/on-change cat]
    </TD>
    <TD>
         [on-change subcat]
 
         [condition][item-field subcategory][/condition]
 
                 [item-field subcategory]
         [else]
                 &nbsp;
         [/else]
         [/on-change subcat]
    </TD>
    <TD> [item-field name] </TD>
 [/search-list]
 </TABLE>

</XMP>
<p>The above should put out a table that only shows the category and
subcategory once, while showing the name for every product. (The <CODE>&amp;nbsp;</CODE>
will prevent blanked table cells if you use a border.)
<p>
<DT><STRONG>

<A NAME="minivend_on_change_1">
[/on_change marker]</A>

</STRONG>
<DD>
Companion to 
<A HREF="minivend.html#minivend_on_change_0">[on_change marker]</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_matches_0">
[matches]</A>

</STRONG>
<DD>
Replaced with the range of match numbers displayed by the
search page. Looks something like ``1-50''. Make sure
you insert this item between a [more_list] and [/more_list]
element pair.
<p>
<DT><STRONG>

<A NAME="minivend_more_list_0">
[more_list next_img* prev_img* page_img* border* border_current*]</A>

</STRONG>
<DD>
Starts the section of the search page which is only displayed
if there are more matches than specified in 
<A HREF="minivend.html#minivend_mv_matchlimit_0">mv_matchlimit</A>
.
If there are less matches than the number in mv_matchlimit, all
text/html between the [more_list] and [/more_list] elements is
stripped.
<p>Use in conjunction with the [more] element to place pointers to
additional pages of matches.
<p>If the optional arguments <CODE>next_img</CODE>, <CODE>prev_img</CODE>, and/or <CODE>page_img</CODE>
are present, they represent image files that will be inserted instead
of the standard 'Next', 'Previous', and page number. If <CODE>prev_img</CODE>
is <CODE>none</CODE>, then no previous link will be output. If <CODE>page_img</CODE> is
<CODE>none</CODE>, then no links to pages of matches will be output. These are
URLs, are substituted for with 
<A HREF="minivend.html#minivend_imagedir_0">ImageDir</A>
, and will be encased in
IMG tags. Lastly, <CODE>border</CODE> is the border number to put.
<p>In addition, if <CODE>page_img</CODE> is used, it will be passed an argument of
the digit that is to be represented. This would allow an image generator
program to be used, generating page numbers on the fly.  The <CODE>border</CODE>
and <CODE>border_selected</CODE> values are integers indicating the border that
should be put around images in the <CODE>page_img</CODE> selection. The &lt;border_selected&gt;
is used for the current page if set.
<p>As an example, if you use [more-list next.gif prev.gif page_num.cgi], the
following will be the anchors:
<p>
<XMP>
  Previous   <IMG SRC="prev.gif">
  Page 1     <IMG SRC="/cgi-bin/page_num.cgi?1">
  Page 2     <IMG SRC="/cgi-bin/page_num.cgi?2">
  Next       <IMG SRC="next.gif">

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_more_list_1">
[/more_list]</A>

</STRONG>
<DD>
Companion to [more_list]. 
<p>
<DT><STRONG>

<A NAME="minivend_more_0">
[more]</A>

</STRONG>
<DD>
Inserts a series of hyperlinks that will call up the next matches
in a series. They look like this:
<p>
<XMP>
    Previous 1 2 3 4 5 6 Next

</XMP>
<p>The current page will not be a hyperlink. Every time the new
link is pressed, the list is re-built to correspond to the current
page. If there is no <CODE>Next</CODE> or <CODE>Previous</CODE> page, that link
will not be shown.
<p>See the <CODE>fr_resul.html</CODE> or 
<A HREF="minivend.html#minivend_search_0">search.html</A>
 files for examples. Make sure
you insert this item between a [more_list] and [/more_list] element pair.
<p>
<DT><STRONG>

<A NAME="minivend_item_link_0">
[item_link code]</A>

</STRONG>
<DD>
Expands into a hyperlink which will jump the user to a page
under the 
<A HREF="minivend.html#minivend_itemlinkdir_0">ItemLinkDir</A>
 (default is the pages directory),
with anchor text as set in 
<A HREF="minivend.html#minivend_itemlinkvalue_0">ItemLinkValue</A>
 (default is ``More Details'').
If the page is not present, then 
<A HREF="minivend.html#minivend_flypage_0">flypage.html</A>
 will be used to build
a page from the entry in the database. If that doesn't work (perhaps
due to a missing flypage.html) then the error page <EM>notfound.html</EM> will
be displayed. Only active in the search list.
<p>
<DT><STRONG>

<A NAME="minivend_process_search_0">
[process_search]</A>

</STRONG>
<DD>
Calls the search with the proper URL, including MiniVend session tags. Used
as the ACTION value for the search form.
<p>
<DT><STRONG>

<A NAME="minivend_process_target_0">
[process_target frame]</A>

</STRONG>
<DD>
Calls the search with the proper URL, including MiniVend session tags.
Used as the ACTION value for the search form if the results are to be
targeted to a different window than the one set by SearchFrame (which is
``_self'' by default).
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_updating_0">
Updating session variables after a search</A>
</H2>
You may notice that if you set a scratch variable or reference a
variable set in a search routine on the results page, the change does
not stay in the user session.
<p>To change this, set the 
<A HREF="minivend.html#minivend_scratch_1">scratch</A>
 variable <EM>mv_put_session</EM> on the page
in question:
<p>
<XMP>
    [set mv_put_session]Yes[/set]

</XMP>
<p>This setting is persistent, so it is recommended that you
do it once at the beginning of the user session if you wish it to be the
default. If you don't want it to be the default, reset it to the
empty value (or zero) on another page:
<p>
<XMP>
    [set mv_put_session][/set]

</XMP>
<p>
<H2> 
<A NAME="minivend_using_0">
Using a Search Cache</A>
</H2>
Each catalog may maintain a search cache, which is enabled by
specifying a file name (the name of the search cache DBM) in
the 
<A HREF="minivend.html#minivend_searchcache_0">SearchCache</A>
 directive in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
. It operates by
developing a 32-bit checksum of the combined parameters of a 
one-click scan search, or by combining the variable names/values
specified in <EM>mv_cache_params</EM> on a form-based search.
<p>If your catalog frequently specifies category searches in a
large catalog, speed of search return can be increased by a
large factor.
<p>You needn't do more than just enable the cache for one-click
searches. To make them operate on a form-based search, specify
the form variable names, separated by a spaces and/or a comma,
that will generate a unique cache key. Example:
<p>
<XMP>
  <INPUT TYPE=hidden NAME="mv_cache_params"
    VALUE="mv_searchspec,mv_substring_match,mv_search_field">

</XMP>
<p>If you have the MD5 module installed on Perl, it will be used
to generate the cache keys. This will guarantee a unique
cache ID. 
<p>If you don't have MD5 installed, a 32-bit checksum will be used to create
the cache key. It is conceivable, but unlikely, that two separate
searches could generate the same 32-bit checksum and return the same
cached search.
<p>IMPORTANT NOTE:  The search cache is only invalidated by a
catalog reconfiguration. If you change your product database
or any other files you search, you should reconfigure or the
search returns may be wrong.
<p>Search caching is disabled on a client-by-client basis if the
client browser does not have cookie capability, for the generated
session numbers would be incorrect otherwise.
<p><p><hr>

<H1> 
<A NAME="minivend_the_7">
THE ORDER PROCESS</A>
</H1>
MiniVend has a completely flexible order basket and checkout
scheme. The 
<A HREF="minivend.html#minivend_simple_0">simple</A>
 demo presents a common use of this process,
in the directory pages/ord -- the files are:
<p>
<XMP>
    basket.html      The order basket displayed by default
    checkout.html    The form where the customer enters their billing
                     and shipping info
    receipt.html     The receipt displayed to the customer
    report.html      The order report mailed to you

</XMP>
<p>It is not strictly necessary to display an order basket when
an item is ordered. If you specify a different page to be
displayed that is fine, but most customers will be confused if
you don't give them an indication that the order operation has
succeeded.
<p>Any order basket is an HTML <CODE>FORM</CODE>. It will have a number of
variables on it. At the minimum it must have an [item-list] to
loop through the items, and the <CODE>quantity</CODE> of each item must be
set in some place on that form. Any valid MiniVend tags may be
used on the page, and you may use multiple item lists if necessary.
<p>
<H2> 
<A NAME="minivend_how_2">
How to set up an order link</A>
</H2>
On a product display page, use:
<p>
<XMP>
    [order 00-0011]Order the Mona Lisa[/order]

</XMP>
<p>If coming from a search results or on-the-fly page, you may use the generated
[item-code] thusly:
<p>
<XMP>
    [order [item-code]]Order [item-field name][/order]

</XMP>
<p>Bear in mind that if you have not reached the page via a search or
on-the-fly operation, [item-code] means nothing and will cause an error.
<p>
<H2> 
<A NAME="minivend_how_3">
How to set up an order button</A>
</H2>
MiniVend can order via form submission as well. This allows you
to order a product (or group of products) via a form button. In its
simplest form, it is:
<p>
<XMP>
    <FORM ACTION="[process-target]" METHOD=POST>
    <INPUT TYPE=hidden NAME=mv_todo ACTION=refresh>
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011">
    <INPUT TYPE=submit VALUE="Order the Mona Lisa">
    </FORM>

</XMP>
<p>The default quantity is one.  An initial quantity may be set by the user
by adding an mv_order_quantity variable:
<p>
<XMP>
     Number to order:<INPUT TYPE=text NAME=mv_order_quantity VALUE="1">

</XMP>
<p>You can order multiple items by stacking the variables:
<p>
<XMP>
    <FORM ACTION="[process-target]" METHOD=POST>
    <INPUT TYPE=hidden NAME=mv_todo ACTION=refresh>
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011a">
    <INPUT TYPE=submit VALUE="Order the Mona Lisa with frame">
    </FORM>

</XMP>
<p>Initial size or color may be set as well, provided 
<A HREF="minivend.html#minivend_usemodifier_0">UseModifier</A>
 is
set up properly:
<p>
<XMP>
    <INPUT TYPE=hidden NAME=mv_order_size VALUE="L">

</XMP>
<p>If the order is coming from a generated flypage, loop list, or search
results page, you can get a canned select box from the 
<CODE>[item-accessories size]</CODE> or <CODE>[item-accessories size]</CODE> tag. See

<A HREF="minivend.html#minivend_item_1">Item Attributes</A>
.
<p>
<H2> 
<A NAME="minivend_order_4">
Order Groups</A>
</H2>
MiniVend 3.06 allows you to group items together, making a master item
and sub-items. This can be used to delete accessories or options when
the master item is deleted. In its simplest form, you order just one
master item and all subsequent items are sub-items.
<p>
<XMP>
    <FORM ACTION="[process-target]" METHOD=POST>
    <INPUT TYPE=hidden NAME=mv_todo ACTION=refresh>
    <INPUT TYPE=hidden NAME=mv_order_group VALUE="1">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011a">
    <INPUT TYPE=submit VALUE="Order the Mona Lisa with frame">
    </FORM>

</XMP>
<p>If you wish to stack more than one master item, then you must define
mv_order_group for <STRONG>all</STRONG> items, with either a 1 value (master) or 0 value
(sub-item). A master owns all subsequent sub-items until the next master
is defined.
<p>
<XMP>
    <FORM ACTION="[process-target]" METHOD=POST>
    <INPUT TYPE=hidden NAME=mv_todo ACTION=refresh>
    <INPUT TYPE=hidden NAME=mv_order_group VALUE="1">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011">
    <INPUT TYPE=hidden NAME=mv_order_group VALUE="0">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="00-0011a">
    <INPUT TYPE=hidden NAME=mv_order_group VALUE="1">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="19-202">
    <INPUT TYPE=hidden NAME=mv_order_group VALUE="0">
    <INPUT TYPE=hidden NAME=mv_order_item VALUE="99-102">
    <INPUT TYPE=submit VALUE="Order items">
    </FORM>

</XMP>
<p>When the master item <CODE>00-0011</CODE> is deleted from the basket,
<CODE>00-0011a</CODE> will be deleted as well. And when 19-202 is deleted,
then 99-102 will be deleted from the basket.
<p>NOTE: You cannot use checkboxes for this type of thing, for they
do not pass a value when unchecked.  Use radio groups or select/drop-down
buttons.
<p>The attributes <CODE>mv_mi</CODE> and <CODE>mv_si</CODE> are set to the group and subitem status
of each item.  The group, contained in the attribute <CODE>mv_mi</CODE>, is a
meaningless yet unique integer. All items in a group will have the same
value of <CODE>mv_mi</CODE>. The attribute <CODE>mv_si</CODE> is set to 0 if the item is
a master item, and 1 if it is a sub-item.
if the item is a master item, and 
<p>
<H2> 
<A NAME="minivend_basket_0">
Basket display</A>
</H2>
The basket page(s) are where the items are tracked and adjusted by the
customer. It is possible to have an unlimited number of basket pages.
It is also possible to have multiple shopping carts, as in buy or
sell. This allows a basket/checkout type of ordering scheme, with custom
order pages for items which have many accessories.
<p>The name of the page to display can be configured in several
ways:
<p>
<OL>
<LI>Set the SpecialPage 
<A HREF="minivend.html#minivend_order_3">order</A>
 to the page to display
when an item is ordered.
<p>
<LI>Set the FrameOrderPage directive to the page to use
when frames are enabled. This overrides option 1.
<p>
<LI>Use the [order item cart/page] Order it! [/order] form of
order tag to specify an arbitrary order page for an item.
<p>
<LI>If already on an order page, set the mv_checkout, mv_orderpage,
mv_nextpage, mv_successpage, or mv_failpage variables.
<p>
</OL>
The variables mentioned above modify the page display in the.following ways:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_mv_cartname_0">
mv_cartname</A>

</STRONG>
<DD>
The shopping cart (default is main) to be used for this order
operation.
<p>
<DT><STRONG>

<A NAME="minivend_mv_checkout_0">
mv_checkout</A>

</STRONG>
<DD>
Page to be displayed when checkout is called from the form
<p>
<DT><STRONG>

<A NAME="minivend_mv_failpage_0">
mv_failpage</A>

</STRONG>
<DD>
Page to be displayed on a failed order
check (see 
<A HREF="minivend.html#minivend_advanced_0">Advanced Multi-level Order Pages</A>
)
<p>
<DT><STRONG>

<A NAME="minivend_mv_nextpage_0">
mv_nextpage</A>

</STRONG>
<DD>
Page to display on a return operation.
<p>
<DT><STRONG>

<A NAME="minivend_mv_orderpage_0">
mv_orderpage</A>

</STRONG>
<DD>
Page to be displayed on a refresh.
<p>
<DT><STRONG>

<A NAME="minivend_mv_successpage_0">
mv_successpage</A>

</STRONG>
<DD>
Page to be displayed on a successful order
check (see 
<A HREF="minivend.html#minivend_advanced_0">Advanced Multi-level Order Pages</A>
).
<p>
<DT><STRONG>

<A NAME="minivend_mv_order_profile_0">
mv_order_profile</A>

</STRONG>
<DD>
Order profile to be used if the form action is 
<A HREF="minivend.html#minivend_submit_0">submit</A>

(see 
<A HREF="minivend.html#minivend_advanced_0">Advanced Multi-level Order Pages</A>
).
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_multiple_0">
Multiple Shopping Carts</A>
</H2>
You can maintain multiple shopping carts with MiniVend (2.02 and above).
One shopping cart -- main, by name -- is defined when the user session
starts. If the user orders item M1212 with the following tag:
<p>
<XMP>
    [order M1212 layaway] Order this item! [/order]

</XMP>
<p>the order will be placed in the cart named <EM>layaway</EM>. However, by default
you won't see what you want!  That is because the default shopping basket
page won't display the cart you are thinking it will -- it will show
the main cart. So copy the default cart (pages/ord/basket.html in the demos)
to a new file, insert a [cart layaway] tag, and submit it as a MiniVend
page name addendum to the cart name:
<p>
<XMP>
    [order M1212 layaway/lay_basket] Order this item! [/order]

</XMP>
<p>Now the contents of the <EM>layaway</EM> cart will be displayed. If you need
to display a different price, you will have to emulate the [subtotal],
[item-price], [item-subtotal], etc. fields with [item-list], [calc], 
and [currency] tags. This snippet emulates the item-price tag for
a different price field <EM>layaway-price</EM>:
<p>
<XMP>
    [currency] [item-field layaway-price] [/currency]

</XMP>
<p>An item subtotal:
<p>
<XMP>
    [currency]
        [calc]
            [item-field layaway-price] * [item-quantity]
        [/calc]
    [/currency]

</XMP>
<p>A cart subtotal, using the item-list tag:
<p>
<XMP>
    [currency]
        [calc]
            [item-list layaway]
            ([item-field layaway-price] * [item-quantity]) +
            [/item-list]
            0
        [/calc]
    [/currency]

</XMP>
<p>The zero is needed because of the trailing plus sign left by the
iterative [item-list] tag.
<p>Even sales tax can be emulated if you use something like a
[data salestax [value state]] tag, and do some similar calculation.
That is left as an exercise for the user.
<p>Shipping and the [nitems] tag will still work properly with a
different price.
<p>You can also order items from a form, using the <EM>mv_order_item</EM>,

<A HREF="minivend.html#minivend_mv_cartname_0">mv_cartname</A>
, and optional <EM>mv_order_quantity</EM> variables.
<p>
<XMP>
 <FORM METHOD=POST ACTION="[process-order]">
 <input type=checkbox name="mv_order_item" value="M3243"> Item M3243
 <input name="mv_order_quantity" value="1"> Quantity
 <input type=hidden name="mv_cartname" value="layaway">
 <input type=hidden name="mv_doit" value="refresh">
 <input type=submit name="mv_junk" value="Place on Layaway Now!">
 </FORM>

</XMP>
<p>
<H2> 
<A NAME="minivend_advanced_0">
Advanced Multi-level Order Pages</A>
</H2>
An unlimited number of order checking profiles can be defined with the

<A HREF="minivend.html#minivend_orderprofile_0">OrderProfile</A>
 directive, or by defining order profiles in scratch
variables. This allows a multi-level ordering process, with checking
for format and validity at every stage.
<p>Specifications take the form of an order page variable (like name
or address), followed by an equals sign and one of five check types:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_required_1">
required</A>

</STRONG>
<DD>
A non-blank value is required
<p>
<DT><STRONG>

<A NAME="minivend_mandatory_0">
mandatory</A>

</STRONG>
<DD>
Must be non-blank, and must have been specified on this
form, not a saved value from a previous form
<p>
<DT><STRONG>

<A NAME="minivend_phone_0">
phone</A>

</STRONG>
<DD>
The field must look like a phone number, by a very
loose specification allowing numbers from all countries
<p>
<DT><STRONG>

<A NAME="minivend_phone_us_0">
phone_us</A>

</STRONG>
<DD>
Must have US phone number formatting, with area code
<p>
<DT><STRONG>

<A NAME="minivend_true_0">
true</A>

</STRONG>
<DD>
Field begins with <STRONG>y</STRONG>, 
<A HREF="minivend.html#minivend__1">1</A>
, or <STRONG>t</STRONG> (Yes, 1, or True) - not case sensitive
<p>
<DT><STRONG>

<A NAME="minivend_false_0">
false</A>

</STRONG>
<DD>
Field begins with <STRONG>n</STRONG>, <STRONG>0</STRONG>, or <STRONG>f</STRONG> (No, 0, or False) - not case sensitive
<p>
<DT><STRONG>

<A NAME="minivend_email_0">
email</A>

</STRONG>
<DD>
Rudimentary email address check, must have an '@' sign,
a name, and a minimal domain
<p>
</DL>
Also, there are three pragmas that can be used to change behavior:.
<p>
<DL COMPACT>
<DT><STRONG>
<EM>&amp;fatal</EM>
</STRONG>
<DD>
Set to '&amp;fatal=yes' if an error should generate
the error page.
<p>
<DT><STRONG>
<EM>&amp;final</EM>
</STRONG>
<DD>
Set to '&amp;final=yes' if a successful check should
cause the order to be placed.
<p>
<DT><STRONG>
<EM>&amp;set</EM>
</STRONG>
<DD>
Set a user session variable to a value, i.e. &amp;set=mv_email [value email].
This is usually placed at the end after a &amp;fatal pragma would have
caused the process to stop if there was an error -- can also be used
to determine pass/fail based on a derived value, as it will cause
failure if it evaluates to zero or a blank value.
<p>
</DL>
As an added measure of control, the specification is evaluated for the.special MiniVend tags to provide conditional setting of order
parameters. With the new [perl] [/perl] capability, quite complex checks
can be done. Also, the name of the page to be displayed on an error can
be set in the 
<A HREF="minivend.html#minivend_mv_failpage_0">mv_failpage</A>
 variable.
<p>The following file specifies a simple check of formatted parameters:
<p>
<XMP>
 name=required
 address=required
 city=required
 state=required
 zip=required
 email=required
 phone_day=phone_us
 &fatal=yes
 email=email
 &set=mv_email [value email]
 &set=mv_successpage ord/shipping

</XMP>
<p>The profile above only performs the &amp;set directives if all of the
previous checks have passed -- the &amp;fatal=yes will stop processing after
the check of the email address if any of the previous checks failed.
<p>If you want to place multiple order profiles in the same file,
separate them with __END__, which must be on a line by itself.
<p>
<H2> 
<A NAME="minivend_simple_2">
Simple Order Report File</A>
</H2>
The simple order report file, ``report'', defines the layout of the order
report which gets mailed on the completion of the order. For example,
<p>
<XMP>
              Order Date: $date
                    Name: $name
           Email address: $email
        Shipping address: $addr
        Town, State, Zip: $town, $state $zip
                 Country: $country

</XMP>
<p>Any input field from the order page can be included using the dollar
sign notation.
<p>To prevent a value from being included in the order report, just add it
to the 
<A HREF="minivend.html#minivend_reportignore_0">ReportIgnore</A>
 configuration directive. 
<p>MiniVend defines some values for use in the search form -- they begin
with <CODE>mv_</CODE> and are automatically ignored.
<p>
<H2> 
<A NAME="minivend_fully_configurable_0">
Fully-configurable Order Reports</A>
</H2>
You can specify a fully-configurable order report by setting the hidden
field ``mv_order_report'' to a legal MiniVend page. This page will be
interpolated with all MiniVend tags before sending by email. The order
number as set by backend ordering is in the variable mv_order_number,
and available for your use.
<p>You could if you wish include HTML in the file, which will be interpreted
by many mailers, but you can choose to use standard ASCII format.
An example report is provided in the demo file &lt;pages/ord/report.html&gt;.
<p>
<H2> 
<A NAME="minivend_order_5">
Order Receipts</A>
</H2>
If you specify a legal MiniVend page name in the ReceiptPage directive,
the user will be sent this page instead of the default ``confirmation''
file. The file can of course be configured with all MiniVend tags, and
will be interpolated for the ordered items before they are deleted from
the user record. If you want to have a different receipt for different
carts, set the <EM>mv_order_receipt</EM> variable in the form.
<p>
<H2> 
<A NAME="minivend_the_8">
The Order Counter</A>
</H2>
An order counter can be enabled if the 
<A HREF="minivend.html#minivend_ordercounter_0">OrderCounter</A>
 directive
is set to a file name. An incrementing count of all orders will be
kept and assigned as orders are placed. By default, the number
starts at 0, but you can edit the file and change the default
starting number at any time.
<p>This capability is made possible by the File::CounterFile module,
available (as a part of the fine libwww modules) at the same place you
got MiniVend. It is included with the distribution.
<p>
<H2> 
<A NAME="minivend_customer_0">
Customer Input Fields</A>
</H2>
On the order (or shopping basket) page, by default order.html, you will
have a number of input fields allowing the customer to enter information
such as their name and address. You can add more fields simply by
putting more input elements on the order.html page, and the information
will automatically be included in the order report. Input elements
should be written in this way:
<p>
<XMP>
    <input type="text" name="town" value="[value town]" size=30>

</XMP>
<p>Choose a name for this input field such as ``email'' for an email
address. Set the name attribute to the name you have chosen.
<p>The value attribute specifies the default value to give the field when
the page is displayed. Because the customer may enter information on
the order page, return to browsing, and come back to the order page,
you want the default value to be what was entered the first time. This
is done with the [value] element, which returns the last value of an
input field. Thus,
<p>
<XMP>
    value="[value name]"

</XMP>
<p>will evaluate to the name entered on the previous order screen, such
as:
<p>
<XMP>
       value="Jane Smith"

</XMP>
<p>which will be displayed by the browser.
<p>The size attributes specifies how many characters wide the input field
should be on the browser. You do not need to set this to fit the
longest possible value since the browser will scroll the field, but
you should set it large enough to be comfortable for the customer.
<p>
<H2> 
<A NAME="minivend_product_0">
Product Pricing</A>
</H2>
MiniVend maintains a price in its database for every product. The price
field is the one required field in the product database -- it is necessary
to build the price routines.
<p>For speed, MiniVend builds the code that is used to determine a product's
price at catalog configuration time. If you choose to change a directive
that affects product pricing you must reconfigure the catalog.
<p>There are several ways that MiniVend can modify the price of a product during 
normal catalog operation. Several of them require that the 
<A HREF="minivend.html#minivend_pricing_asc_0">pricing.asc</A>

file be present, and that you define a pricing database. You do that by
placing the following directive in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
:
<p>
<XMP>
  Database  pricing pricing.asc 1

</XMP>
<p>Configurable directives and tags with regard to pricing:
<p>
<UL>
<LI>Quantity price breaks are configured by means of the 
<A HREF="minivend.html#minivend_pricebreaks_0">PriceBreaks</A>
 and

<A HREF="minivend.html#minivend_mixmatch_0">MixMatch</A>
 directives. They require a field named specifically <CODE>price</CODE>
in the pricing database. The <STRONG>price</STRONG> field contains a space-separated
list of prices that correspond to the quantity levels defined in the

<A HREF="minivend.html#minivend_pricebreaks_0">PriceBreaks</A>
 directive. If quantity is to be applied to all items in
the shopping cart (as opposed to quantity of just that item) then the

<A HREF="minivend.html#minivend_mixmatch_0">MixMatch</A>
 directive should be set to <STRONG>Yes</STRONG>.
<p>
<LI>Individual line-item prices can be adjusted according to the value of
their attributes. See 
<A HREF="minivend.html#minivend_priceadjustment_0">PriceAdjustment</A>
 and 
<A HREF="minivend.html#minivend_commonadjust_0">CommonAdjust</A>
. The
pricing database <STRONG>must</STRONG> be defined unless you define the 
<A HREF="minivend.html#minivend_commonadjust_0">CommonAdjust</A>

behavior.
<p>
<LI>Product discounts for specific products, all products, or the entire
order can be configured with the [discount ...] tag. Discounts are applied
on a per-user basis -- you can gate the discount based on membership in a
club or other arbitrary means. See 
<A HREF="minivend.html#minivend_product_1">Product Discounts</A>
.
<p>
</UL>
For example, if you decided to adjust the price of T-shirt part number.99-102 up 1.00 when the size is extra large and down 1.00 when the size is small,
you would have the following directives defined in &lt;catalog.cfg&gt;:
<p>
<XMP>
  Database          pricing pricing.asc 1
  UseModifier       size
  PriceAdjustment   size

</XMP>
<p>To enable the automatic modifier handling of MiniVend 3.0, you would
define a size field in products.asc:
<p>
<XMP>
  code    description   price    size
  99-102  T-Shirt       10.00    S=Small, M=Medium, L=Large*, XL=Extra Large

</XMP>
<p>You would place the proper tag within your [item-list] on the shopping-basket
or order page:
<p>
<XMP>
    [item-accessories size]

</XMP>
<p>In the pricing.asc database source, you would need:
<p>
<XMP>
  code      S       XL
  99-102    -1.00   1.00

</XMP>
<p>As of MiniVend 3.06, if you want to assign a price based on the option,
precede the number with an equals sign:
<p>
<XMP>
  code    S       M       L       XL
  99-102  =9.00   =10     =10     =11

</XMP>
<p>IMPORTANT NOTE: Price adjustments occur AFTER quantity price breaks, so
the above would negate anything set with the 
<A HREF="minivend.html#minivend_pricebreaks_0">PriceBreaks</A>
 directive/option.
<p>
<H2> 
<A NAME="minivend_item_1">
Item Attributes</A>
</H2>
MiniVend allows item attributes to be set for each ordered item. This
allows a size, color, or other modifier to be attached to a common
part number. If multiple attributes are set, then they should be
separated by commas. Previous attribute values can be saved by means
of a hidden field on a form, and multiple attributes for each item
can be <EM>stacked</EM> on top of each other.
<p>The configuration file directive 
<A HREF="minivend.html#minivend_usemodifier_0">UseModifier</A>
 is used to set
the name of the modifier or modifiers. For example
<p>
<XMP>
    UseModifier        size,color

</XMP>
<p>will attach both a size and color attribute to each item code that
is order
<p><STRONG>IMPORTANT NOTE:</STRONG> You may not use the following names for attributes:
<p>
<XMP>
    item  group  quantity  code  mv_ib  mv_mi  mv_si

</XMP>
<p>As of MiniVend 2.02, setting the <EM>mv_separate_items</EM> or global
directive 
<A HREF="minivend.html#minivend_separateitems_0">SeparateItems</A>
 places each ordered item on a separate
line, simplifying attribute handling.
<p>The modifier value is accessed in the [item-list] loop with the
[item-modifier attribute] tag, and form input fields are placed with the
[modifier-name attribute] tag. This is similar to the way that quantity
is handled, except that attributes can be ``stacked'' by setting multiple
values in an input form.
<p>You cannot define a modifier name of 
<A HREF="minivend.html#minivend_code_0">code</A>
 or <EM>quantity</EM>, as they
are already used. You must be sure that no fields in your forms
have digits appended to their names if the variable is the same name
as the attribute name you select, as the [modifier-name size] variables
will be placed in the user session as the form variables size0, size1,
size2, etc. 
<p>You can use the [loop item,item,item] list to reference multiple display
or selection fields for modifiers (in MiniVend 3.0, you can have it
automatically generated --see below). The modifier value can then be
used to select data from an arbitrary database for attribute selection
and display.
<p>Below is a fragment from a shopping basket display form which 
shows a selectable size with ``sticky'' setting. Note that this
would always be contained within the [item_list] [/item-list]
pair.
<p>
<XMP>
    <SELECT NAME="[modifier-name size]">
    <OPTION  [selected [modifier-name size] S]> S
    <OPTION  [selected [modifier-name size] M]> M
    <OPTION  [selected [modifier-name size] L]> L
    <OPTION [selected [modifier-name size] XL]> XL
    </SELECT>

</XMP>
<p>It could just as easily be done with a radio button group combined
with the [checked ...] tag.
<p>MiniVend 3.0 will automatically generate the above select box
when the [accessories size &lt;code&gt;] or [item-accessories size]
tags are called. They have the syntax:
<p>
<XMP>
   [item_accessories attribute*, type*, field*, database*, name*]
 
   [accessories code attribute*, type*, field*, database*, name*]
 
   code          Not needed for item-accessories, this is the
                 product code of the item to reference.
 
   attribute     The item attribute as specified in the UseModifier
                 configuration directive. Typical are "size" or
                 "color".
 
   type          The action to be taken. The default is 'select', which
                 builds an HTML select form entry for the attribute.
                 Also recognized is 'multiple', which generates a
                 multiple-selection drop down list, and 'show', which
                 just shows the list of possible attributes.
 
   field         The database field name to be used to build the
                 entry (usually a field in the products database).
                 Defaults to a field named the same as the attribute.
 
   database      The database to find B<field> in, defaults to the
                 first products file where the item code is found.
 
   name          Name of the form variable to use if a form is being
                 built. Defaults to mv_order_B<attribute> -- i.e.
                 if the attribute is B<size>, the form variable will
                 be named B<mv_order_size>.

</XMP>
<p>When called with an attribute, the database is consulted and looks for
a comma-separated list of attribute options. They take the form:
<p>
<XMP>
    name=Label Text, name=Label Text*

</XMP>
<p>The label text is optional -- if none is given, the <STRONG>name</STRONG> will
be used.
<p>If an asterisk is the last character of the label text, the item is
the default selection. If no default is specified, the first will be
the default. An example:
<p>
<XMP>
    [item_accessories color]

</XMP>
<p>This will search the product database for a field named ``color''. If
an entry ``beige=Almond, gold=Harvest Gold, White*, green=Avocado'' is found,
a select box like this will be built:
<p>
<XMP>
    <SELECT NAME="mv_order_color">
    <OPTION VALUE="beige">Almond
    <OPTION VALUE="gold">Harvest Gold
    <OPTION SELECTED>White
    <OPTION VALUE="green">Avocado
    </SELECT>

</XMP>
<p>In combination with the <EM>mv_order_item</EM> and <EM>mv_order_quantity</EM> variables
this can be used to allow entry of an attribute at time of order.
<p>If used in an item list, and the user has changed the value, the generated
select box will automatically retain the current value the user has selected.
<p>The value can then be displayed with [item-modifier size] on the
order report, order receipt, or any other page containing an
[item_list]. 
<p>
<H2> 
<A NAME="minivend_product_1">
Product Discounts</A>
</H2>
Product discounts can be set upon display of any page. The discounts
apply only to the customer receiving them, and are of one of three types:
<p>
<XMP>
    1. A discount for one particular item code (key is the item-code)
    2. A discount applying to all item codes (key is ALL_ITEMS)
    3. A discount applied after all items are totaled
       (key is ENTIRE_ORDER)

</XMP>
<p>The discounts are specified via a formula. The formula is scanned for
the variables <STRONG>$q</STRONG> and <STRONG>$s</STRONG>, which are substituted for with the item
<EM>quantity</EM> and <EM>subtotal</EM> respectively. In the case of the item and
all items discount, the formula must evaluate to a new subtotal for all
items <EM>of that code</EM> that are ordered. The discount for the entire
order is applied to the entire order, and would normally be a monetary
amount to subtract or a flat percentage discount.
<p>Discounts are applied to the effective price of the product, including
any quantity discounts.
<p>To apply a straight 20<STRONG>% </STRONG>discount to all items:
<p>
<XMP>
    [discount ALL_ITEMS] $s * .8 [/discount]

</XMP>
<p>To take 25<STRONG>% </STRONG>off of only item 00-342:
<p>
<XMP>
    [discount 00-342] $s * .75 [/discount]

</XMP>
<p>To subtract <STRONG>$5</STRONG>.00 from the customer's order:
<p>
<XMP>
    [discount ENTIRE_ORDER] $s - 5 [/discount]

</XMP>
<p>Perl code can be used to apply the discounts. Here is an example of a
discount for item code 00-343 which prices the <EM>second</EM> one ordered at
1 cent:
<p>
<XMP>
    [discount 00-343]
    return $s if $q == 1;
    my $p = $s/$q;
    my $t = ($q - 1) * $p;
    $t .= 0.01;
    return $t;
    [/discount]

</XMP>
<p>If you want to display the discount amount, use the [calc] capability.
This example calculates the amount of the discount for all items in
the current shopping cart:
<p>
<XMP>
    [item_list]
    Discount for [item-code]: $[currency]
                                [calc][item-field price] - [item-price 1]
                                [/calc][/currency]
    [/item_list]

</XMP>
<p>
<H2> 
<A NAME="minivend_sales_0">
Sales Tax</A>
</H2>
MiniVend allows calculation of sales tax on a straight percentage basis,
with certain items allowed to be tax-exempt. To enable this feature,
the directive 
<A HREF="minivend.html#minivend_salestax_2">SalesTax</A>
 is initialized with the name of a field (or
fields) on the order form. Commonly, this is zipcode and/or state:
<p>
<XMP>
    SalesTax    zip,state

</XMP>
<p>This being done, MiniVend assumes the presence of a file 
<A HREF="minivend.html#minivend_salestax_asc_0">salestax.asc</A>
,
which contains a database with the percentages. Each line of 

<A HREF="minivend.html#minivend_salestax_asc_0">salestax.asc</A>
 should be a code (again, usually a five-digit zip or
a two letter state) followed by a tab, then a percentage. Example:
<p>
<XMP>
    45056   .0525
    61821   .0725
    61801   .075
    IL      .0625
    OH      .0525
    VAT     .15
    WA      .08

</XMP>
<p>Based on the user's entry of information in the order form, MiniVend
will look up (for our example SalesTax directive) first the zip, then
the state, and apply the percentage to the SUBTOTAL of the order. The
subtotal will include any taxable items, and will also include the
shipping cost if the state/zip is included in the 
<A HREF="minivend.html#minivend_taxshipping_0">TaxShipping</A>
 directive.
It will add the percentage, then make that available with the [salestax]
tag for display on the order form. If no match is found, the entry
'default' is applied -- that is normally 0, but can be anything.
<p>If business is being done on a national basis, it is now common to have
to collect sales tax for multiple states. If you are doing so, it is possible
to subscribe to a service which issues regular updates of the sales tax
percentages -- usually by quarterly or monthly subscription. Such a
database should be easily converted to MiniVend format -- but some systems
are rather convoluted, and it will be well to check and see if the
program can export to a flat ASCII file format based on zip code.
<p>If some items are not taxable, then you must set up a field in your
database which indicates that. You then place the <STRONG>name</STRONG> of that field
in the 
<A HREF="minivend.html#minivend_nontaxablefield_0">NonTaxableField</A>
 directive. If the field for that item
evaluates true on a yes-no basis (i.e. is set to <CODE>yes</CODE>, <CODE>y</CODE>, 1, or the
like), sales tax will not be applied to the item. If it evaluates false,
it will be taxed.
<p>If your state taxes shipping, use the 
<A HREF="minivend.html#minivend_taxshipping_0">TaxShipping</A>
 directive.
Utah and Nevada are known to tax shipping -- there may be others.
<p>If you want to set a fixed tax for all orders, as might occur for VAT
in some countries, just set the 
<A HREF="minivend.html#minivend_salestax_2">SalesTax</A>
 directive to a value like
<CODE>tax_code</CODE>, and define a variable in the user session to reflect the
proper entry in the 
<A HREF="minivend.html#minivend_salestax_asc_0">salestax.asc</A>
 file.  To set it to 15<STRONG>% </STRONG>with the
above 
<A HREF="minivend.html#minivend_salestax_asc_0">salestax.asc</A>
 file, you would put in a form:
<p>
<XMP>
        <INPUT TYPE=hidden NAME=tax_code VALUE="VAT">

</XMP>
<p>or to do it without submitting a form:
<p>
<XMP>
        [perl values] $Safe{'values'}{tax_code} = 'VAT'; return ''[/perl]

</XMP>
<p>
<H2> 
<A NAME="minivend_using_1">
Using CyberCash</A>
</H2>
MiniVend will directly interface with the Perl CCLib provided by
CyberCash, Inc. This allows direct card billing at the time the order is
placed. The CCLib.pm version should be 1.3 or greater.  If the library is
found at startup, the message ``CyberCash module found'' will be displayed.
<p>To use CyberCash, you must first have a CyberCash Secure Merchant Payment
Server (SMPS) running on your system.  It must be fully enabled, and
should be tested OK with the CyberCash test suite.  This capability has
been tested to work with SMPS-2.1.x in <CODE>mauthcapture</CODE> and <CODE>mauthonly</CODE>
modes. Any modes supported by CyberCash should work.
<p>The special mode <CODE>minivend_test</CODE> will cause the transaction to complete
successfully and the information that would have been sent to the
CyberCash server to be logged in the catalog 
<A HREF="minivend.html#minivend_error_log_0">error.log</A>
 file.
<p>The CCLib.pm file must be available to MiniVend -- if you cannot
install it in the main Perl library then the Minivend software
directory <EM>lib/</EM> will suffice.  If it is found at MiniVend startup,
a message will be displayed.
<p>MiniVend only will charge CyberCash in the final phase of the order
process, i.e. at the time the receipt and order report are generated.
The full amount as shown by the [total-cost] tag will be billed --
if you need to do partial charges you will have to manage multiple
shopping carts.
<p>The process of enabling CyberCash processing is something like this:
<p>
<OL>
<LI>Turn off CreditCardAuto by setting the catalog directive to No. This
would normally be done right in catalog.cfg, but it also can be done in a
mv_click subroutine if you wish to mix transaction types:
<p>
<XMP>
    <INPUT TYPE=checkbox NAME=mv_click VALUE=CyberCash> Use CyberCash
    [set CyberCash]
        [perl config]
            $Safe{config}->{CreditCardAuto} = 0;
            $Safe{config}->{CyberCash} = 1;
            return '';
        [/perl]
    mv_cyber_mode=mauthcapture
    [/set]

</XMP>
<p>
<LI>Enable the CyberCash directive in catalog.cfg (or with the technique
above). Also set the catalog 
<A HREF="minivend.html#minivend_variable_0">Variable</A>
 value <STRONG>CYBER_SECRET</STRONG> to the
``secret'' for your payment server.  If you are not using the default
values of <STRONG>localhost</STRONG> and <STRONG>8000</STRONG> for your server and port, set
the Variables <STRONG>CYBER_HOST</STRONG> and <STRONG>CYBER_PORT</STRONG> as well.  In the catalog.cfg
file it would look like:
<p>
<XMP>
    CreditCardAuto   No
    CyberCash        Yes
    Variable         CYBER_SECRET  first-natl
    Variable         CYBER_PORT    8000
    Variable         CYBER_HOST    localhost

</XMP>
<p>
<LI>Set your final order screen to accept the user form fields
<EM>mv_credit_card_number</EM> (contains the actual card number),
<EM>mv_credit_card_exp_month</EM> and <EM>mv_credit_card_exp_year</EM> (the
expiration date month and year), and the fields containing name,
address, city, state, and country. And <STRONG>you must</STRONG> define the form
field <EM>mv_cyber_mode</EM> <STRONG>on the submitting form</STRONG> to enable the
processing.
<p>The order mode must be final, either by omitting an order profile
entirely or by defining an order profile that contains &amp;final=yes.
<p>
</OL>
The fields containing name and address information should be.the same as on the standard MiniVend demo order pages:
<p>
<XMP>
    b_name       Billing name      takes priority
    name         Shipping name     used if b_name empty
    b_address    Billing address   takes priority
    address      Shipping address  used if b_address empty
    b_city       Billing city      takes priority
    city         Shipping city     used if b_city empty
    b_state      Billing state     takes priority
    state        Shipping state    used if b_state empty
    b_country    Billing country   takes priority
    country      Shipping country  used if b_country empty

</XMP>
<p>If you must use other values, they can be redefined in catalog.cfg
with the 
<A HREF="minivend.html#minivend_variable_0">Variable</A>
 <STRONG>CYBER_REMAP</STRONG> like so:
<p>
<XMP>
    Variable CYBER_REMAP  name=my_name address=my_address

</XMP>
<p>or like so:
<p>
<PRE>
    Variable &lt;&lt;EOF
    CYBER_REMAP
    b_name   my_bname
    name     my_name
    address  processed_address
    city     parsed_city
    EOF

</PRE>
<p><STRONG>NOTE:</STRONG> As always when using the &lt;&lt;EOF (here document) capability, the
EOF must be on a line by itself, with no leading or trailing white space.
That includes carriage returns, Windows devotees. Upload in ASCII mode!
<p>If you have defined the directive 
<A HREF="minivend.html#minivend_encryptprogram_0">EncryptProgram</A>
 to be something
containing the value <EM>pgp</EM>, then the 
<A HREF="minivend.html#minivend_creditcardauto_0">CreditCardAuto</A>
 method will be
used to encrypt the mv_credit_card_number value before it is wiped
from memory. (Errors in that process will be silently ignored.) It
will never be written to the user session, at least by MiniVend
itself, so attempts to recall it on future forms will be in vain.
<p>If the authorization fails, the special page 
<A HREF="minivend.html#minivend_failed_0">failed</A>
 will be
displayed, and passed the CyberCash error message for display with
the [subject] tag.  The order will not complete, i.e. the cart will
still be intact and no receipt or order report will be generated.
The error itself is always available as [data session cybercash_error].
<p>If successful, the receipt page will be displayed, the order report
emailed, and the cart will be emptied.  If you wish to display the
order-id returned from CyberCash on the receipt, it is available in
[data session cybercash_id]. If the order is successful, but is
detected as a ``success-duplicate'', [data session cybercash_error]
will contain the message returned from CyberCash.
<p><p><hr>

<H1> 
<A NAME="minivend_sorting_0">
SORTING</A>
</H1>
MiniVend 3.03 regularizes the sorting options for sorting the search
lists, loop lists, and item lists based on the contents of database
fields. In addition, MiniVend 3.07 adds list slices, or limiting the
displayed entries based on a start value and chunk size (or start and
end value, from which a chunk size is determined). All accept a standard
format sort tag which must be directly after the list call:
<p>
<XMP>
    [loop 4 3 2 1]
    [sort -2 +2]
        [loop-code]
    [/loop]
 
    [search-list]
    [sort products:category:f]
        [item-price] [item-description]<BR>
    [/search-list]
 
    [item-list]
    [sort products:price:rn]
        [item-price] [item-code]<BR>
    [/item-list]
 
    [tag each products]
    [sort products:category products:title]
    [loop-field category] [loop-field title] <BR>
    [/tag]

</XMP>
<p>All sort situations -- <CODE>[search list]</CODE> , <CODE>[loop list]</CODE> , <CODE>[tag each table]</CODE>, and
<CODE>[item-list]</CODE>, take options of the form:
<p>
<XMP>
  [sort database:field:option* -n +n =n-n ... ]

</XMP>
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_database_1">
database</A>

</STRONG>
<DD>
The MiniVend database identifier.  This must be supplied, and should
normally be 'products' if you are using the default name for the database.
<p>
<DT><STRONG>

<A NAME="minivend_field_2">
field</A>

</STRONG>
<DD>
The field (column) of the database to be sorted on.
<p>
<DT><STRONG>

<A NAME="minivend_option_0">
option</A>

</STRONG>
<DD>
None, any, or combinations of the options:
<p>
<XMP>
  f   case-insensitive sort (folded) (mutually exclusive of n)
  n   numeric order (mutually exclusive of f)
  r   reverse sort

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_n_0">
-n</A>

</STRONG>
<DD>
The starting point of the list to be displayed, beginning at 1 for
the first entry.
<p>
<DT><STRONG>

<A NAME="minivend_n_1">
+n</A>

</STRONG>
<DD>
The number of entries to display in this list segment.
<p>
<DT><STRONG>

<A NAME="minivend_n_n_0">
=n-n</A>

</STRONG>
<DD>
The starting and ending point of the list display -- this is an
alternative to -n and +n. You should specify in only one form -- if
both are specified the last one will take effect.
<p>
<DT><STRONG>

<A NAME="minivend__3">
...</A>

</STRONG>
<DD>
Don't really put 
<A HREF="minivend.html#minivend__3">...</A>
 in. This just means that you may specify as
many sort levels as you wish. Lots of sort levels with large databases
will be quite slow.
<p>
</DL>
Multiple levels of sort are supported, and you can cross database.boundaries on different sort levels. Cross-database sorts on the same
level are not supported, so if you use multiple product databases you
will have to sort with embedded Perl. This is actually a feature in
some cases, since you can then display all items in a <CODE>used</CODE> database
before or after your new ones in 
<A HREF="minivend.html#minivend_products_0">products</A>
.
<p>Examples, all based on the 
<A HREF="minivend.html#minivend_simple_0">simple</A>
 demo:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_loop_2">
Loop list</A>

</STRONG>
<DD>

<XMP>
    [loop 00-0011 19-202 34-101 99-102]
    [sort products:title]
        [loop-code] [loop-field title]<BR>
    [/loop]
 
Will display:
    34-101 Family Portrait
    00-0011 Mona Lisa
    19-202 Vertigo, Magic Staircase
    99-102 The Art Store T-Shirt

</XMP>
<p>If you instead do:
<p>
<XMP>
    [loop 00-0011 19-202 34-101 99-102]
    [sort products:title -3 +2]
        [loop-code] [loop-field title]<BR>
    [/loop]
 
you will see:
    19-202 Vertigo, Magic Staircase
    99-102 The Art Store T-Shirt

</XMP>
<p>The tag <CODE>[sort products:title =3-4]</CODE> is equivalent to the
above.
<p>
<DT><STRONG>

<A NAME="minivend_search_3">
Search list</A>

</STRONG>
<DD>
A search of all products (i.e. <A HREF="http://yoursystem.com/cgi-bin/simple/scan/ra=yes):">http://yoursystem.com/cgi-bin/simple/scan/ra=yes):</A>
<p>
<XMP>
    [search-list]
    [sort products:artist products:title:rf]
        [item-field artist] [item-field title]<BR>
    [/search-list]
 
will display:
    Gilded Frame
    Grant Wood American Gothic
    Jean Langan Family Portrait
    Leonardo Da Vinci Mona Lisa
    Salvador Dali Persistence of Memory
    Leon Spilliaert Vertigo, Magic Staircase
    The Art Store The Art Store T-Shirt
    Vincent Van Gogh The Starry Night
    Vincent Van Gogh Sunflowers

</XMP>
<p>Note the reversed order of the title for <EM>Van Gogh</EM>, and the presence of
the accessory item <EM>Gilded Frame</EM> at the front of the list (it has no
artist field, and as such sorts first).
<p>Adding a slice option:
<p>
<XMP>
    [search-list]
    [sort products:artist products:title:rf =6-10]
        [item-field artist] [item-field title]<BR>
    [/search-list]
 
will display:
    Leon Spilliaert Vertigo, Magic Staircase
    The Art Store The Art Store T-Shirt
    Vincent Van Gogh The Starry Night
    Vincent Van Gogh Sunflowers

</XMP>
<p>If the end value/chunk size exceeds the size of the list, only the
elements that exist will be displayed, starting from the start value.
<p>
<DT><STRONG>

<A NAME="minivend_shopping_0">
Shopping cart</A>

</STRONG>
<DD>

<XMP>
    [item-list]
    [sort products:price:rn]
        [item-price] [item-code]<BR>
    [/item-list]
 
will display the items in your shopping cart sorted on their price, with
the most expensive shown first. (Note that this is based on the database field,
and doesn't take quantity price breaks or discounts into effect.) B<NOTE:> You 
cannot sort on modifier values or quantities.

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_complete_0">
Complete database contents</A>

</STRONG>
<DD>

<XMP>
    [tag each products]
    [sort products:category products:title]
    [loop-field category] [loop-field title] <BR>
    [/tag]

</XMP>
<p>A two level sort, that will sort products based first on their category
then on their title within the category.
<p>
</DL>
Note that large lists may take some time to sort -- if you have a product.database with many thousands of items, it is not recommended that you
use the [tag each products] sort unless you are planning on caching or
statically building your pages.
<p><p><hr>

<H1> 
<A NAME="minivend_shipping_2">
SHIPPING</A>
</H1>
MiniVend allows the addition of a flat shipping charge with
the 
<A HREF="minivend.html#minivend_shipping_4">Shipping</A>
 directive. Most catalogs have more elaborate
requirements, requiring use of the 
<A HREF="minivend.html#minivend_shipping_2">SHIPPING</A>
 capability
of MiniVend.
<p>To enable custom shipping, enter the default field to use in the

<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>
 directive:
<p>
<XMP>
    CustomShipping  weight

</XMP>
<p><STRONG>IMPORTANT NOTE:</STRONG> Before MiniVend 2.0, there could only be one field used
to set the criteria. As of MiniVend 2.0, the entry in the shipping file
which is <EM>exactly the same</EM> as the value of the mv_shipmode variable
will be used to determine the field criteria for the shipping method.
This allows 
<A HREF="minivend.html#minivend_weight_0">weight</A>
 to be used for one mode, while <EM>price</EM> or
<EM>quantity</EM> is used for another. The CustomShipping directive only
sets the <STRONG>default</STRONG> field to be used if none is present in the 
mode specification.
<p>
<H2> 
<A NAME="minivend_default_0">
Default Shipping Mode</A>
</H2>
If a default shipping mode other than <CODE>default</CODE> is desired, enter
it into the 
<A HREF="minivend.html#minivend_defaultshipping_0">DefaultShipping</A>
 directive:
<p>
<XMP>
    DefaultShipping     UPSG

</XMP>
<p>This will make the  entry on the order form checked by default when the
user starts the order process, if it is put in the form:
<p>
<XMP>
  <INPUT TYPE=RADIO NAME=mv_shipmode VALUE=upsg [checked mv_shipmode upsg]> 

</XMP>
<p>To force a choice by the user, you can make mv_shipmode a required form
variable (with 
<A HREF="minivend.html#minivend_requiredfields_0">RequiredFields</A>
 or in an order profile) and set 
<A HREF="minivend.html#minivend_defaultshipping_0">DefaultShipping</A>

to zero.
<p>
<H2> 
<A NAME="minivend_shipping_3">
Shipping Cost Database</A>
</H2>
The shipping cost database (located in ProductDir/shipping.asc) is a
tab-separated ASCII file with six fields -- code, text description,
criteria (quantity or weight, for example), minimum number, maximum
number, and cost. None of the fields are case-sensitive. It always
needs to be present if 
<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>
 is to be used.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_code_0">
code</A>

</STRONG>
<DD>
The unique identifier for that shipping method and criteria
range. 
<p>
<DT><STRONG>

<A NAME="minivend_description_2">
description</A>

</STRONG>
<DD>
Text to describe the method (can be accessed on a page
with the <EM>[shipping_description]</EM> element).
<p>
<DT><STRONG>

<A NAME="minivend_criteria_0">
criteria</A>

</STRONG>
<DD>
Whether shipping is based on weight, quantity, price, etc. Valid MiniVend
tags can be placed in the field to do a dynamic lookup -- if a number
is returned, that is used as the <EM>accumulated criteria</EM> -- that is,
the total of weight, quantity, or price as applied to all items in the
shopping cart.
<p>The criteria field varies according to whether it is the first field in
the shipping file exactly matching the mode identifier.  In that case, it
is called the <STRONG>main criterion</STRONG>.  If it is in subsidiary shipping lines
matching the mode (with optional appended digits) then it is called a
<STRONG>qualifying criterion</STRONG>.  The difference is that the main criterion returns
the basis for the calculation (i.e. weight or quantity) while the qualifying
criterion determines whether the individual line may match the conditions.
<p>The return must be one of:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_o_0">
o quantity</A>

</STRONG>
<DD>
quantity -- The literal value <STRONG>quantity</STRONG> as the main criterion will
simply count the number of items in the shopping cart and return it as
the <EM>accumulated criteria</EM>.
<p>
<DT><STRONG>
<EM>o &lt;field name&gt;</EM>
</STRONG>
<DD>
A valid product database field (column) name as main criterion will
cause the number of items in the shopping cart to be multiplied by the

<A HREF="minivend.html#minivend_value_1">value of the field for each item</A>
 to obtain the <EM>accumulated criteria</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_o_2">
o n.nn</A>

</STRONG>
<DD>
where <STRONG>n.nn</STRONG> is any number.  It will be directly used as the
<EM>accumulated criteria</EM>.  This can be effectively returned from a
Perl subroutine or MiniVend [calc][item-list] ... [/item-list][/calc]
to create custom shipping routines.
<p>
</DL>
<STRONG>IMPORTANT NOTE:</STRONG> The above only applies to the <STRONG>first</STRONG> field that.matches the shipping mode exactly.  Following 
<A HREF="minivend.html#minivend_criteria_0">criteria</A>
 fields contain
qualifier matching strings.
<p>
<DT><STRONG>

<A NAME="minivend_minimum_0">
minimum</A>

</STRONG>
<DD>
The low bound of quantity/weight/criteria this entry applies to.
<p>
<DT><STRONG>

<A NAME="minivend_maximum_0">
maximum</A>

</STRONG>
<DD>
The high bound of quantity/weight/criteria this entry applies to.
The first found entry is used in case of ties.
<p>
<DT><STRONG>

<A NAME="minivend_cost_0">
cost</A>

</STRONG>
<DD>
The total cost, determined by formula if it begins with <CODE>f</CODE>,
by multiplier if it begins with <CODE>x</CODE>, by UPS-style lookup if 
it begins with <CODE>u</CODE>, by named subroutine if it begins with an <CODE>s</CODE>, and
a straight cost otherwise. If it begins with an <CODE>e</CODE>, a zero cost
is returned with the following string as the error message.
<p>
</DL>
The cost is calculated like this:.
<p>
<OL>
<LI>The base code is selected by reading the value of mv_shipmode
in the user session. If it has not been explicitly set, either
by means of the 
<A HREF="minivend.html#minivend_defaultshipping_0">DefaultShipping</A>
 directive or by setting the
variable on a form (or in an order profile), it will be <CODE>default</CODE>.
<p>
<LI>The criterion field is found -- if it is quantity, then it is the total
quantity of items on the order form. If it is any other name, then the
criterion is calculated by multiplying the return value from the product
database field for each item in the shopping cart, multiplied by its quantity.
(If the lookup fails due to the column or row not existing, a zero cost will be
returned, and an error is sent to the catalog error log.) If a number is
returned from a MiniVend tag, then that number is used directly.
<p>
<LI>Entries in the shipping database that begin with the same
string as the shipping mode are examined. If none is found,
a zero cost is returned and an error is sent to the catalog error log.
<p><STRONG>NOTE:</STRONG> You may use the same mode name for all lines in the same group,
but the <EM>first</EM> one will contain the main criteria.
<p>
<LI>The value of the accumulated criteria is examined, and if it falls with in the
minimum and maximum, the cost is then applied.
<p>
<LI>If the cost is fixed, it is simply added.
<p>
<LI>If the cost field begins with an <CODE>x</CODE>, the cost is multiplied
by the accumulated criterion -- price, weight, etc.
<p>
<LI>If the cost field begins with <CODE>f</CODE>, the formula following
is applied. Use <STRONG>@@</STRONG>TOTAL@<STRONG>@ </STRONG>as the value of the accumulated criterion.
<p>
<LI>If the cost field begins with <CODE>u</CODE>, a UPS lookup is done.
<p>
<LI>If the cost field begins with <CODE>s</CODE>, a Perl subroutine call is made.
<p>
<LI>If the cost field begins with <CODE>e</CODE>, zero cost is returned and an 
error placed in the session <STRONG>ship_message</STRONG> field, available as
[data session ship_message].  (If using the standard tag syntax,
you should surround it with [post] [/post] to ensure you get the
messages from the current page.)
<p>
</OL>
Here is an example shipping file using all of the methods of.determining shipping cost.
<p>NOTE: The columns are lined up for your reading convenience, the actual
entries should have ONE tab between fields.
<p>
<XMP>
 rpsg   RPS      quantity            0   0      0
 rpsg   RPS      quantity            1   5      7.00
 rpsg   RPS      quantity            6   10     10.00
 rpsg   RPS      quantity            11  150    x .95
 
 usps   US Post  price               0   0      0
 usps   US Post  price               1   50     f 7 + (1 * @@TOTAL@@ / 10)
 usps   US Post  price               50  100    f 12 + (.90 * @@TOTAL@@ / 10)
 usps   US Post  price               100 99999  f @@TOTAL@@ * .05
 
 upsg   UPS      weight [value state]  0   0      e Nothing to ship.
 upsg   UPS      AK HI               0.1 150    u upsg [value zip] 12.00 round
 upsg   UPS                          0.1 150    u upsg [value zip] 2.00 round
 upsg   UPS                          150 9999   e @@TOTAL@@ lb too heavy for UPS
 fedex  FedEx    quantity            1   9999   s fedex_cost ;[value country]

</XMP>
<p>
<UL>
<LI>If the user selected RPS, (code rpsg), and the quantity on the order
was 3, the cost of 7.00 from <EM>rpsg1</EM> would be applied. If the
quantity were 7, the next entry from <EM>rpsg2</EM> would be selected, for a
cost of 10.00. If the quantity were 15, <EM>rpsg3</EM> would be selected, and
the quantity of 15 multiplied by 0.95, for a total cost of 14.25.
<p>
<LI>The second one, <CODE>usps</CODE>, is a more complicated formula -- using price as the
criteria. If the total price of all items in the shopping cart (same as
[subtotal] without quantity price breaks in place) is from 1 to 50, the
cost will be 7.00 plus 10<STRONG>% </STRONG>of the order. If the total is from 50.01
to 100, the cost will be 12.00 plus 9<STRONG>% </STRONG>of the order total. If the
cost is 100.01 or greater, then 5<STRONG>% </STRONG>of the order total will be used
as the shipping cost.
<p>
<LI>The third, <CODE>upsg</CODE>, is a special case. It specifies a UPS lookup based on your
UPS zone and two required values (and two optional arguments):
<p>
<XMP>
    1. Weight (careful, always use weight for this one!)
    2. The zip/postal code of the recipient, of which only
       the first three digits are used.
    3. A fixed amount to add to the cost found in the UPS
       tables (use 0 as a placeholder if specifying roundup)
    4. If set to 'round', will round the cost up to the next
       integer monetary unit.

</XMP>
<p>If the cost returned is zero, the reason will be placed as an error
message in the session variable ship_message (available as [data session
ship_message]).
<p>UPS weights are always rounded up if any fraction is present. 
<p>The routines use standard UPS lookup tables. First, the UPS Zone
file must be present. That is a standard UPS document,
<EM>specific to your area</EM>, that you must obtain from UPS and enter into and make
available to MiniVend in TAB-delimited format. (As of March 1997, you
can use the standard .csv file distributed by UPS on their web site at
www.ups.com.) You specify it with the 
<A HREF="minivend.html#minivend_upszonefile_0">UpsZoneFile</A>
 directive -- it is
usually named something like <CODE>NNN.csv</CODE>, where NNN is the first three
digits of the originating zip code.
<p>Second, you must obtain the cost tables from UPS (again, you can get them from
www.ups.com) and place them into a MiniVend database. That database, its
identifier specified with the first argument (upsg in the example) of the cost
specification, is consulted to determine the UPS cost for that weight and
rate schedule.
<p>You can append a simple shipping cost qualification to a UPS lookup. If
any additional parameters are present after the five usual ones used for
UPS lookup, they will be interpreted as a Perl subroutine call. The
syntax is the same as if it was encased in the tag [perl sub] [/perl],
but the following substitutions are made prior to the call:
<p>
<XMP>
    @@COST@@  is replaced with whatever the UPS lookup returned
    @@GEO@@   is replaced with the zip (or other geo code)
    @@ADDER@@ is replaced with the defined adder
    @@TYPE@@  is replaced with the UPS shipping type
    @@TOTAL@@ is replaced with the total weight

</XMP>
<p>The example above also illustrates geographic qualification.  If the value of
the form variable <STRONG>state</STRONG> on the checkout form is AK or HI, the U.S. states
Alaska and Hawaii, a <STRONG>$10</STRONG>.00 additional charge (over and above the normal 2.00
handling charge) is made.  This can also be used to select on country, product
type, or any other qualification that can be encoded in the file.
<p>
<LI>The last entry, <CODE>fedex</CODE>, uses a named subroutine. The example is
designed to work with this subroutine defined in catalog.cfg:
<p>
<PRE>
    Sub &lt;&lt;EOF
    sub fedex_cost {
        my(<STRONG>$country</STRONG>) = <STRONG>@_</STRONG>;
        my <STRONG>$cost</STRONG>;
        if(<STRONG>$country</STRONG> =~ /^usa?<STRONG>$/</STRONG>i) {
            <STRONG>$cost</STRONG> = 20;
        }
        else {
            <STRONG>$cost</STRONG> = 50;
        }
        return <STRONG>$cost</STRONG>;
    }
    EOF

</PRE>
<p><STRONG>NOTE:</STRONG> The text above appears indented, but in the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file
it must begin at the beginning of the line. Also, make sure you upload
in ASCII mode -- carriage returns are not tolerated.
<p>It will simply return a cost of 20 if the country the user has entered is
US or USA -- and return 50 otherwise. Obviously much more complicated
routines can be defined. Read the following only if you know Perl well
and/or are not of faint heart.
<p>You can call named subroutines with any of the methods, defined with
[set name] your_perl_code_here [/set], 
<A HREF="minivend.html#minivend_sub_1">Sub</A>
, or 
<A HREF="minivend.html#minivend_globalsub_0">GlobalSub</A>
.
<p>If parameters are specified, separated by commas, they will be taken as
either fixed values or as database fields to be sent to the subroutine
in an anonymous hash keyed on the item code (for each item in the
*current* shopping cart).
<p>If a database other than the products database is to be used, the database
name should be prepended with a colon (<CODE>:</CODE>) separator. If a key other
than the item code is to be used, it should be appended with a semi-colon
separator.
<p>To send fixed value to the subroutine (appended to the call reference
as an array of fixed scalar parameters), begin the parameter with a
semicolon. <STRONG>They will be appended globally after the hash reference</STRONG>.
<p>Examples
<p>
<XMP>
  # Sends the weight of each item from the products database
  
  weight 
  
  
  # Sends the value of the handling field from the
  # special database for each item
  
  special:handling 
  
   
  # Sends the value of the 'adder' field from the special
  # database, for the value the user has entered for 'country'
  # The spaces around the separators are OK
 
  special : adder ; [value country] 
  
 
  # Sends a fixed parameter of 20 to the subroutine
  
  ;20

</XMP>
<p>The parameters are interpreted for MiniVend tags before being parsed.
Here is a complete example:
<p>
<XMP>
   s item_cost weight,modes:[value mv_shipmode];[value country], ;20, ;25
  
  items in the shopping cart:  00-0011 19=202
  
  ------- product database  ----
  
  code    weight   description      price
  00-0011   8      The Mona Lisa    1000
  19-202    12     American Gothic  800
  
  
  ------- modes database  ----
  
  code    upsg  upsb  upsr  postal_air postal_surface  `
  UK        0    0     0       1            1 

</XMP>
<p>will call the subroutine <CODE>item_cost</CODE>, and will send the weight of each
item, along with the value of the modes database column corresponding to
the shipping mode the user has selected, keyed with the value of <CODE>country</CODE>
on their order form. If the user has selected mode postal_air, and is
in the country coded as <CODE>UK</CODE>, the subroutine will be called as if it
was:
<p>
<XMP>
      item_cost( {
                    '00-0011' => {postal_air => '1', weight => '8'}, 
                    '19-202' => {postal_air => '1', weight => '12'},
                 }, 20, 25 )

</XMP>
<p>If the undefined value is returned by the routine, the next shipping mode
will be tried. If a non-numeric string value is returned, its value
will be placed as an error message in the session variable ship_message
(available as [data session ship_message]) and a zero cost will be returned.
If any number or the empty string is returned, it will be used as the
shipping cost (even 0).
<p>
</UL>
.
<p>
<H2> 
<A NAME="minivend_determining_0">
Determining shipping modes</A>
</H2>
MiniVend 3.07 and above uses the 
<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>
 and 
<A HREF="minivend.html#minivend_shipping_4">Shipping</A>

directives to determine the shipping characteristics based on geography
or other session qualifier.
<p>You can specify user variables to examine for geographic offering
of shipping modes with the 
<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>
 directive, and you can
specify which qualifications they must meet with the 
<A HREF="minivend.html#minivend_shipping_4">Shipping</A>

directive. Example:
<p>
<XMP>
        CustomShipping  state country
        Shipping        _us_a    modes    "upsb upsr usps"
        Shipping        _us_a    state    "AK HI"
        Shipping        _us_b    modes    "upsg upsb upsr usps"
        Shipping        _us_b    country  "upsg upsb upsr usps"
        Shipping        euro_b   modes    "surfint_b surfair_b"
        Shipping        euro_b   country  "surfint_b surfair_b"
        Shipping        euro_b   modes    "surfint_b surfair_b"

</XMP>
<p>This means the MiniVend will first examine the 
<p>
<H2> 
<A NAME="minivend_geographic_0">
Geographic qualification</A>
</H2>
If the return value in the main criterion includes whitespace, the
remaining information in the field is used as a qualifier for the
subsidiary shipping modes. This can be used to create geographic
qualifications for shipping, as in:
<p>
<XMP>
 upsg   UPS Ground   weight [value state]   0     0     e No items selected
 upsg   UPS Ground   AK HI                  0.1   150   u Ground [value zip] 12.00
 upsg   UPS Ground                          0.1   150   u Ground [value zip] 3.00

</XMP>
<p>
<H2> 
<A NAME="minivend_handling_0">
Handling charges</A>
</H2>
Additional handling charges can be defined in the shipping file by setting
the form variable <EM>mv_handling</EM> to a space, comma, or null-separated set
of valid shipping modes.  The lookup and charges are done in the same fashion,
and the additional charges are added to the order.  (The user is responsible for
displaying the charge on the order report or receipt with a [shipping handling]
tag or the like.)  All of the shipping modes found in mv_handling will be
applied -- if multiple instances are found on a form, the accordingly null-separated 
values will all be applied.  Careful! This should not be done in an item-list
unless you take care to account for multiple setting of the variables.
<p>If you wished only to process a handling charge once, you could do safely:
<p>
<XMP>
    [item-list]
    [if-field very_heavy]
    [perl values]
        return '' if $Safe->{'values'}->{mv_handling} =~ /very_heavy/;
        return "<INPUT TYPE=hidden NAME=mv_handling VALUE=very_heavy>";
    [/perl]
    [/if-field]
    [/item-list]

</XMP>
<p>A non-blank/non-zero value in the database field <STRONG>very_heavy</STRONG> will then
trigger Perl code which will only set mv_handling once.
<p><p><hr>

<H1> 
<A NAME="minivend_tracking_0">
TRACKING AND BACKEND ORDER ENTRY</A>
</H1>
MiniVend allows the entry of orders into a system via one of several
methods. The 
<A HREF="minivend.html#minivend_asciibackend_0">AsciiBackend</A>
 capability allows submittal of
parameters to an external order entry script. Support for SQL
allows entry of orders directly into an SQL database. Orders
can be written to an ASCII file. They can be formatted precisely
for email-based systems. The orders can be placed in a DBM file.
Finally, embedded Perl allows completely flexible order entry, 
including real-time credit-card verification and settlement.
<p>
<H2> 
<A NAME="minivend_easy_1">
Easy ASCII Tracking</A>
</H2>
If you set AsciiTrack to a legal file name (based in VendRoot unless
it has a leading ``/''), a copy of the order will be saved there as well
as being emailed.
<p>If you set AsciiBackend to a legal file name (based in VendRoot unless
it has a leading ``/''), it will save the backend fields defined in 

<A HREF="minivend.html#minivend_backendorder_0">BackendOrder</A>
 along with the item-code and quantity of items being
ordered. The fields are separated by TAB characters. 
<p>For either directive, if the file name string begins with a pipe ``|'', 
a program will be run and the output ``piped'' to that program. This
allows easy backend entry of orders with an external program.
<p>
<H2> 
<A NAME="minivend_sql_10">
SQL Tracking</A>
</H2>
See the <EM>[sql set]</EM> tag for an example of entering orders in
an SQL database.
<p><p><hr>

<H1> 
<A NAME="minivend_ssl_0">
SSL SECURITY</A>
</H1>
MiniVend has several features that enable secure ordering via SSL
(Secure Sockets Layer). Despite their mystique, SSL servers are actually
quite easy to operate. The difference between the standard HTTP server
and the SSL HTTPS server, from the standpoint of the user, is only in
the encryption and the specification of the URL -- https: is used for the
URL protocol specification instead of the usual http: designation.
<p><STRONG>IMPORTANT NOTE:</STRONG>  MiniVend attempts to perform operations securely,
but no guarantees or warranties of any kind are made! Since MiniVend
comes with Perl source, it is possible to modify the program to create
bad security problems. One way to minimize this possibility is to record
digital signatures, using MD5 or PGP, of <CODE>minivend</CODE>, 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
,
and all modules included in minivend. Check them on a regular basis to
ensure they have not been changed.
<p>MiniVend uses the 
<A HREF="minivend.html#minivend_secureurl_0">SecureURL</A>
 directive to set the base URL for secure
transactions, and the 
<A HREF="minivend.html#minivend_vendurl_0">VendURL</A>
 directive for normal non-secure transactions.
Secure URLs can be enabled for forms through the [process_target action secure]
element.
<p>MiniVend incorporates additional security for credit card numbers. Any field
on the order form which has <STRONG>credit_card</STRONG> in its name will not be written
to disk unless it is encrypted. An external encryption program, such
as pgp(1) or des(1) can be used.
<p><STRONG>NOTE:</STRONG> The internal Des encryption mode is no longer supported in
MiniVend 2.02 and higher. Try PGP instead -- it is more secure and
easier to use.
<p>To accept credit_card fields, you need to define the directive

<A HREF="minivend.html#minivend_creditcardauto_0">CreditCardAuto</A>
 to <EM>yes</EM>. 
<A HREF="minivend.html#minivend_encryptprogram_0">EncryptProgram</A>
 also needs
to be defined with some value, one which will, with hope,
encrypt the number. PGP is now recommended above all other
encryption program. The entries should look something like:
<p>
<XMP>
  CreditCardAuto   Yes
  EncryptProgram   /usr/local/bin/pgp -feat sales@company.com

</XMP>
<p>See 
<A HREF="minivend.html#minivend_creditcardauto_0">CreditCardAuto</A>
 for more information on how to set the form variables.
<p>
<H2> 
<A NAME="minivend_administrative_0">
Administrative Pages</A>
</H2>
With MiniVend's 
<A HREF="minivend.html#minivend_globalsub_0">GlobalSub</A>
 capability, very complex add-on schemes
can be implemented with Perl subroutines. And with the new
writable database, pages that modify the catalog data can be
made. If you mark a page as an 
<A HREF="minivend.html#minivend_adminpage_0">AdminPage</A>
, only the catalog
administrator may use it.
<p>In addition, you can create a file in any MiniVend page subdirectory
called .access. If that file is present and non-zero in size,
any pages in that directory are only available to users who have the
REMOTE_USER CGI variable set (which means they have given a user name and
password, ala normal HTTP Basic Authorization). This is a way to provide
``subscription-only'' pages that are only available to logged-in users.
<p><p><hr>

<H1> 
<A NAME="minivend_controlling_0">
CONTROLLING PAGE APPEARANCE</A>
</H1>
<p>
<H2> 
<A NAME="minivend_using_2">
Using Frames</A>
</H2>
MiniVend fully supports frames, the proposed extension to HTML 3.0. (Currently
only Netscape 2.0 and above browsers support frames.) Frames significantly
enhance the electronic catalog experience, since the user can maintain
a context -- with a search frame, a product details frame, a table-of-contents
frame, etc. The demo included with MiniVend is based on frames, though if
you access it with a non-frame browser it will operate perfectly well.
<p>Frames are accessed by adding a TARGET element to a HREF, naming
the frame that the referenced URL should be placed in. MiniVend
produces targets with the pagetarget and areatarget elements, which
send target tags if frames are enabled (by a [frames_on] element.
Any frame name can be used, including the special frames of _top, _blank,
_parent, and _self.
<p>As shown in the demo pages, the best way to accommodate both types of
browsers is by having an <CODE>index.html</CODE> page that sets the beginning
frame set. The &lt;FRAMESET&gt; and &lt;FRAME&gt; tags will be ignored by standard
browsers, which will read the HTML between the &lt;NOFRAMES&gt; and &lt;/NOFRAMES&gt;
tags below.
<p>The format of the first set of URLs passed to the frames is important - only
ONE MiniVend link must be called. That sets the session ID for the user. If
two URLs were called, MiniVend would assign two session IDs to the user,
scrambling the context of their navigation. From this single access,
all further references to MiniVend are made, though after the first access
multiple frame targets can be referenced.
<p>This first MiniVend page that is accessed (with a frame browser) should
contain a [frames_on] element. It is the only page that need (or should)
contain a [frames_on], which is persistent throughout the session. This
page should never be seen by a non-frame browser.
<p>Subsequent accesses to MiniVend URLs will now contain the proper session
information, and as long as pagetarget or page elements are used to
pass the URLs, context will be maintained.
<p>Here are the frames-specific tags:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_frames_on_0">
[frames_on]</A>

</STRONG>
<DD>
Turns on the frames processing option, which is disabled by default.
The proper way to use this is to put it ONLY in the first page which
is loaded by frame-based browsers, as part of the initial frame load.
It is persistent for the entire session, or until counteracted with a
[frames_off] tag.
<p>
<DT><STRONG>

<A NAME="minivend_frames_off_0">
[frames_off]</A>

</STRONG>
<DD>
Turns off the frames processing option. This can be used to disable
frames, perhaps as a clickable option for users. It is persistent for
the entire session, or until counteracted with a [frames_on] tag.
<p>IMPORTANT NOTE:  This doesn't turn of frames in your browser! If
you let a TARGET tag escape, it will probably cause a new window
to be opened, or other types of anomalous operation.
<p>
<DT><STRONG>

<A NAME="minivend_pagetarget_0">
[pagetarget pg frame arg*]</A>

</STRONG>
<DD>
(new syntax [page href=``dir/page'' target=``frame'' arg=``argument''])
<p>Same as the page element above, except it specifies an output frame to
target if frames are turned on. The name <STRONG>is</STRONG> case-sensitive, and if
it doesn't exist a new window will be popped up. This is the same as
the [page ...] tag if frames are not activated.
For example, [pagetarget shirts main] will expand into a link like &lt;a
<A HREF="href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''">href=``http://machine.company.com/cgi-bin/vlink/shirts?WehUkATn;;1''</A> TARGET=``main''&gt;. The
catalog page displayed will come from <CODE>shirts.html</CODE> in the
pages directory, and be output to the <CODE>main</CODE> frame. Be careful,
frame names are case-sensitive.
<p>The optional 
<A HREF="minivend.html#minivend_arg_0">arg</A>
 is used just as in the <EM>page</EM> tag.
<p>
<DT><STRONG>

<A NAME="minivend_areatarget_0">
[areatarget pg frame arg*]</A>

</STRONG>
<DD>
(new syntax [area href=``dir/page'' target=``frame'' arg=``argument'']
<p>Inserts a Vend URL in a format to provide a targeted reference for a
client-side imagemap. You set up the &lt;AREA> tag with:
<p>
<XMP>
      <AREA COORDS="220,0,270,20" HREF="[areatarget page frame]">

</XMP>
<p>If frames are enabled, this will expand to:
<p>
<XMP>
      <AREA COORDS="220,0,270,20"
         HREF="http://machine.company.com/vlink/page?ErTxVV8l;;38" TARGET="frame">

</XMP>
<p>If frames are <EM>not</EM> enabled, this will expand to:
<p>
<XMP>
      <AREA COORDS="220,0,270,20"
         HREF="http://machine.company.com/vlink/page?ErTxVV8l;;38">

</XMP>
<p>The optional 
<A HREF="minivend.html#minivend_arg_0">arg</A>
 is used just as in the <EM>page</EM> tag.
<p>
<DT><STRONG>

<A NAME="minivend_framebase_0">
[framebase name]</A>

</STRONG>
<DD>
Outputs a &lt;BASE FRAME=``name''&gt; tag only if MiniVend is in frames mode.
It should be used within the HTML &lt;HEAD&gt; section.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_changing_0">
Changing output frame in a form</A>
</H2>
If you want to send output to different frames based on input
from the user, you can set the <EM>mv_change_frame</EM> variable. If found
<EM>in the current form</EM>, a <EM>Window-Target:</EM> header will be sent
to route the HTML output to the frame named in <EM>mv_change_frame</EM>.
<p>You can use 
<A HREF="minivend.html#minivend_one_click_0">One-click Multiple Variables</A>
 to set the target if you
wish.
<p>
<XMP>
  <INPUT TYPE="submit" name="mv_todo" value="Search">
  <INPUT TYPE="submit" name="mv_click" value="Continue Shopping">
  [set Continue Shopping]
  mv_todo=return
  mv_nextpage=browse
  mv_change_frame=_top
  [/set]

</XMP>
<p>The above snippet will, when placed in a MiniVend form, send the output
of a 
<A HREF="minivend.html#minivend_search_3">Search</A>
 submission to the current default frame, but when
<STRONG>Continue Shopping</STRONG> is selected the output will will go to the page

<A HREF="minivend.html#minivend_browse_0">browse.html</A>
 with the page routed to the top level frame for the
current browser window.
<p>If you are setting a target with the <EM>[process_target target]</EM> tag, you
will either have to make that target <EM>none</EM> or set the 
<A HREF="minivend.html#minivend_scratch_1">scratch</A>
 variable
<EM>mv_ignore_frame</EM> on the page at time of display. Either will prevent
conflicting window targets from being sent.
<p>
<H2> 
<A NAME="minivend_body_2">
Body and Buttonbar Control</A>
</H2>
MiniVend provides centralized page color and imagemap control through
use of the [body n] and [buttonbar n] elements. It also can place a random
message from a series of messages with the [random] element, and embed
help messages with the [help item] element.
<p>The [body n] element selects a color scheme -- numbered from 1 to 15 --
that is set by the Mv_Background, Mv_TextColor, Mv_BgColor,
Mv_LinkColor, and Mv_VlinkColor directives. Each can contain up to 15
parameters, after an opening BEGIN. Here is an example:
<p>
<XMP>
    Mv_Background  BEGIN /images/blue_pap.gif
    Mv_BgColor     BEGIN none steelblue white
    Mv_LinkColor   BEGIN none white black
    Mv_TextColor   BEGIN none ltgreen blue
    Mv_VlinkColor  BEGIN none orange purple

</XMP>
<p>The above sequence set in the catalog.cfg file, defines three color
schemes, accessed with [body 1], [body 2], and [body 3] elements in
MiniVend pages. The first scheme uses the file <CODE>/images/blue_pap.gif</CODE>
as the background pattern, and keeps the user's default colors for
everything else. It is called by a [body 1] element, which when
expanded becomes &lt;BODY BACKGROUND="/images/blue_pap.gif&gt;.
<p>The second scheme defines no background pattern (there is only one file
in the Mv_Background directive), but defines a background color of <CODE>steelblue</CODE>,
with a text color of white, a link color of light green, and a visited link
color of orange. It is accessed by the [body 2] element, which when expanded
becomes &lt;BODY BGCOLOR=``steelblue'' TEXT=``white'' LINK=``ltgreen'' VLINK=``orange''&gt;.
<p>The third color scheme is similar to the second, except defines
white-black-blue-purple for the four colors. It is accessed with
a [body 3] element.
<p>If there is no defined scheme for a body element (as there wouldn't be if
you put [body 4] in a page with the above schemes defined) MiniVend
simply outputs a standard &lt;BODY> tag.
<p>The user can also define their own colors if the Mv_customcolors
variable is set (upon a form submission). See the supplied

<A HREF="minivend.html#minivend_control_0">control.html</A>
 page for an example of how to set custom colors.
<p>Image maps can be supplied and similarly controlled with the [buttonbar n]
series of tags. They are defined with the ButtonBars directive 
in catalog.cfg, and take the form of a series of
file names in MiniVend format -- i.e., relative to the PageDir and
without a .html extension. To use the buttonbars, create a file 
with an IMG directive set with the USEMAP element and an associated
client-side image map (defined with &lt;MAP&gt; &lt;/MAP&gt;. The [areatarget]
or [area] tags are used to set the URLs. An example:
<p>
<XMP>
    <IMG SRC="/sample/images/artbar0.gif" USEMAP="#ARTBAR0">
    <MAP NAME=ARTBAR0>
    <AREA COORDS="198,0,278,20" HREF="[areatarget fr_sel search]">
    <AREA COORDS="303,0,363,20" HREF="[areatarget fr_search search]">
    <AREA COORDS="388,0,442,20" HREF="[areatarget fr_greet main]">
    <AREA COORDS="473,0,537,20" HREF="[areatarget control main]">
    <AREA COORDS="0,0,560,20" NOHREF>
    </MAP>

</XMP>
<p>If the above were saved in the file PageDir/bars/artbar0.html (where PageDir
is your MiniVend pages directory), you would be able to access this
imagemap in your pages with a [buttonbar 0] tag, at least after MiniVend
read this line in the configuration file:
<p>
<XMP>
    ButtonBars  bars/artbar0 bars/artbar1 bars/artbar2

</XMP>
<p>The above entry allows you to define three imagemaps and access them in
your pages simply as [buttonbar 0], [buttonbar 1], and [buttonbar 2]. The
advantage of this scheme is central definition of a series of button bars
with only a few tags -- if you change your page colors or mapping, you
need only change one file and the change will roll over to all of your
catalog pages. Since some installations can number in the thousands
of catalog pages, using the pre-defined buttonbars can save a lot of
editing. (Server-side includes cannot be used to achieve the same thing
with MiniVend, since they wouldn't have the proper URLs.)
<p>
<H2> 
<A NAME="minivend_integrated_0">
Integrated Image Maps</A>
</H2>
Imagemaps can also be defined on forms, with the special form variable
<EM>mv_todo.map</EM>. A series of map actions can be defined --
the action specified in the <EM>default</EM> entry will be applied if none
of the other coordinates match. The image is specified with a standard
HTML 2.0 form field of type <EM>IMAGE</EM>. Here is an example:
<p>
<XMP>
 <INPUT TYPE="HIDDEN" NAME="mv_todo.map" VALUE="rect submit 0,0 100,20">
 <INPUT TYPE="HIDDEN" NAME="mv_todo.map" VALUE="rect cancel 290,2 342,18">
 <INPUT TYPE="HIDDEN" NAME="mv_todo.map" VALUE="default refresh">
 <INPUT TYPE="IMAGE" NAME="mv_todo" SRC="url_of_image">

</XMP>
<p>All of the actions will be combined together into one image map with
NCSA-style functionality -- see the NCSA imagemap documentation for
details -- except that MiniVend form actions are defined instead
of URLs. The standard actions are:
<p>
<XMP>
 submit   Submit order
 refresh  Refresh order page (update quantities, etc.)
 cancel   Cancel order and wipe credit card numbers
 return   Go to previous page (or page defined in mv_nextpage variable)
 control  Control help, colors, etc.
 search   Search for an item in the catalog

</XMP>
<p>
<H2> 
<A NAME="minivend_random_1">
Random Banners</A>
</H2>
The [random] element, in conjunction with the 
<A HREF="minivend.html#minivend_random_2">Random</A>
 directive in the
catalog.cfg file, is similar to the buttonbar tag, except it displays
random messages or images. It can be used to place a random tip, hint,
ad, or message, and can be any legal HTML construct. 
<p>
<H2> 
<A NAME="minivend_rotating_0">
Rotating Banners</A>
</H2>
The [rotate] element, in conjunction with the 
<A HREF="minivend.html#minivend_rotate_1">Rotate</A>
 directive in the
minivend.cfg file, is similar to the random tag, except it displays
messages or images guaranteed to be presented to the user in a specific
order. It can be used to place a tip, hint, ad, or message, and can be any
legal HTML construct.
<p>
<H2> 
<A NAME="minivend_in_line_0">
In-line Help</A>
</H2>
The [help tag] element, in conjunction with the Help directive in the
minivend.cfg file, is similar to the buttonbar tag, except it displays
help messages or images, and is keyed by item name. The help can be
contained in any of a series of files defined in the Help directive. It
can contain most MiniVend elements. The user can turn off help through
a form -- see the 
<A HREF="minivend.html#minivend_control_0">control.html</A>
 file for an example.
<p><p><hr>

<H1> 
<A NAME="minivend_static_0">
STATIC PAGE BUILDING</A>
</H1>
MiniVend now has a complete implementation of a static page building
facility. It allows you to build a parallel page tree <EM>completely in HTML</EM>,
and most importantly, keeps track of all of the URLs for you. It means
that MiniVend, whether the page on the browser was called dynamically
or statically, will call the appropriate page for you. This can mean
huge performance gains in catalogs with lots of pages in the browsing
structure, for any statically built pages never have to call MiniVend.
This improves performance and decreases server load.
<p>You can also use it to build page trees that are scannable by a search
engine spider.
<p>As of MiniVend 3.03, to make static page building active, you must set
the 
<A HREF="minivend.html#minivend_static_1">Static</A>
 directive to <CODE>Yes</CODE>. This allows you to turn it on or off
with a single directive, and is a change from MiniVend 3.02 and below.
<p>It is invoked when starting the MiniVend server by passing the extra parameters
<CODE>-build shop</CODE> to the minivend program. MiniVend will scan
the entire page structure, testing each page to see if it has any
<EM>dynamic elements</EM>. Dynamic elements are those MiniVend tags which
depend on user session status, like the contents of the shopping cart,
conditional tests on user variables, or databases marked as dynamic
with the 
<A HREF="minivend.html#minivend_dynamicdata_0">DynamicData</A>
 directive. If a page has dynamic elements,
it will not be built statically.
<p>Some tags which cause static building to fail are:
<p>
<XMP>
  [cart ...]           [if session ...]       [perl]
  [checked ...]        [if validcc ...]       [salestax]
  [data ...]*          [if value ...]         [scratch ...]
  [default ...]        [item_list]            [selected ...]
  [discount]           [last_page]            [shipping]
  [finish-order]       [lookup ..]            [shipping_desc]
  [frames_on|off]      [loop-data ...]*       [sql set]
  [if data ...]*       [loop-field ...]*      [subtotal]
  [if discount ...]    [sql set]              [total_cost]
  [if items ...]       [nitems]               [value ...]
  [if scratch ...]     [perl]
  * Only if database referenced is dynamic

</XMP>
<p>In addition, if a [search_list] references dynamic items, it will
also prevent a search from being cached or built statically.
<p>Pages are also searched for static [page scan/...] searches, and
those searches are built statically if appropriate. They are placed
in the pages scan1.html on up, so don't name any of your pages scan
and then digits if you want to avoid clashing.  Search builds recurse
one level down, meaning that if you have a category search that yields
more category searches, they will also be built.  You can set the 
recursion with 
<A HREF="minivend.html#minivend_staticdepth_0">StaticDepth</A>
 -- the default is two.
<p>A page marked as an 
<A HREF="minivend.html#minivend_adminpage_0">AdminPage</A>
 or 
<A HREF="minivend.html#minivend_nocache_0">NoCache</A>
 will not be statically
built or cached.
<p>If you wish a page to build statically anyway, despite the presence
of dynamic elements, you can insert <CODE>[tag flag build][/tag]</CODE> at the top
of the page. This tells the builder to ignore dynamic elements and build
the page anyway -- it will not override NoCache or AdminPage.
<p>Additionally if you pass a name with <CODE>[tag flag build]</CODE><STRONG>name</STRONG><CODE>[/tag]</CODE>,
a symbolic link to <STRONG>name</STRONG> will be made in 
<A HREF="minivend.html#minivend_staticdir_0">StaticDir</A>
. This allows
named pages to be reliably found -- otherwise the name of the page varies
with the order the search is found. Commonly you would use
<CODE>[tag flag build][value mv_searchspec][/tag]</CODE> to build a link based on
the search string.
<p>Pages are marked for static build in one of three ways:
<p>
<UL>
<LI>If you want all pages to be statically built when possible, set the

<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 directive 
<A HREF="minivend.html#minivend_staticall_0">StaticAll</A>
 to yes. MiniVend will scan all
pages and see if they can be built. If you have pages and/or directories
which you don't want scanned, use the 
<A HREF="minivend.html#minivend_nocache_0">NoCache</A>
 directive to disable it.
<p>
<LI>If you want only certain pages to be statically built, you can either
individually mark each one with the 
<A HREF="minivend.html#minivend_staticpage_0">StaticPage</A>
 directive, or you may
set a 
<A HREF="minivend.html#minivend_staticpattern_0">StaticPattern</A>
 which encompasses pages to be built statically.
<p>
<LI>You can place a list of pages in the file <CODE>.build</CODE> in the root of the
pages directory. MiniVend will use that as the list of pages to be
built on this run.
<p>
</UL>
In addition, you can build all possible on-the-fly pages out of the.database if the 
<A HREF="minivend.html#minivend_staticfly_0">StaticFly</A>
 directive is set. This <STRONG>is</STRONG> subject to
the 
<A HREF="minivend.html#minivend_staticpattern_0">StaticPattern</A>
 as well, so you could build only a portion of the
database if you wished. Obviously catalogs that have many thousands of
items should be careful about use of 
<A HREF="minivend.html#minivend_staticfly_0">StaticFly</A>
.
<p>The names of pages that are statically built are maintained in the file
<CODE>.static</CODE>, located in the MiniVend 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
. This is how MiniVend
knows which pages should be referenced with static URLs.
<p>Any pages included in the list(s) that fail due to dynamic elements
have their names placed in the file <CODE>.unbuilt</CODE> after the build process.
<p>The 
<A HREF="minivend.html#minivend_staticdir_0">StaticDir</A>
 directive defines the 
<A HREF="minivend.html#minivend_file_1">file path</A>
 to the root
of the page structure that will be built. If blank, it will use
the directory <CODE>static</CODE> in the catalog root, which can then be copied
to the appropriate place in HTML document space.
<p><STRONG>WARNING:</STRONG> Any existing files that are present may be removed
from this directory! Do not place normal pages there!
<p>The 
<A HREF="minivend.html#minivend_staticpath_0">StaticPath</A>
 directive defines the <STRONG>URL path</STRONG> to the root
of the page structure that will be built. It is relative to
HTTP document root, and must obviously be the URL path to 
<A HREF="minivend.html#minivend_staticdir_0">StaticDir</A>
.
Default is /, or DocumentRoot.
<p>The 
<A HREF="minivend.html#minivend_staticsuffix_0">StaticSuffix</A>
 directive defines the suffix of the files that
will be built. The default is <CODE>.html</CODE>. DOSites might want to make
it <CODE>.htm</CODE>, and if you wished to have the files parsed for server
side includes you might use <CODE>.shtml</CODE>.
<p>If you wish to build the catalog pages offline (recommended on servers
that are used by multiple catalogs), you can use the command:
<p>
<XMP>
   start -test -build shop

</XMP>
<p>where <CODE>shop</CODE> is the name of the catalog to be built. (Multiple <CODE>-build name</CODE>
directives can be used to build more than one catalog.)
<p><p><hr>

<H1> 
<A NAME="minivend_internationalization_0">
INTERNATIONALIZATION</A>
</H1>
MiniVend 3.07 adds a rich set of I18N features to allow conditional message
display, differing price formats, different currency definitions, price
factoring, sorting, and other settings.
<p>The definitions are maintained in the catalog.cfg file through the use
of built in POSIX support and MiniVend's 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 directive.
<p>All settings are independent for each catalog and each user of that
catalog -- you can have customers accessing the same catalog in any
of an unlimited number of languages and currencies.
<p>
<H2> 
<A NAME="minivend_setting_4">
Setting the locale</A>
</H2>
The locale could be set to <CODE>fr_FR</CODE> (French for France) in one of two ways:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_set_3">
[set mv_locale]fr_FR[/set]</A>

</STRONG>
<DD>
Set the locale by placing a 
<A HREF="minivend.html#minivend_set_3">[set mv_locale]fr_FR[/set]</A>
 in the first
page which introduces the locale settings.  Every page AFTER that page
will have the settings in effect.
<p>
<DT><STRONG>

<A NAME="minivend_page_3">
[page /process/locale/fr_FR/page/catalog]</A>

</STRONG>
<DD>
This is the same as [page catalog], except when the link is followed it
will set the locale to <CODE>fr_FR</CODE> <EM>before</EM> displaying the page.
<p>
</DL>
Once the locale is set for that user, it is in effect for the duration.of their session.
<p>
<H2> 
<A NAME="minivend_minivend_2">
MiniVend Locale Settings</A>
</H2>
The 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 directive has many possible settings, allowing
complete internationalization of page sets and currencies. The

<A HREF="minivend.html#minivend_locale_0">Locale</A>
 directive is defined in a series of key/value pairs,
with a key (which contains word characters only) followed by 
a value.  The value should be surrounded with double quotes if
it contains whitespace. In this example, the key is <CODE>Value setting</CODE>.
<p>
<XMP>
        Locale fr_FR "Value setting" "Configuration de valeur"
        Locale de_DE "Value setting" Werteinstellung

</XMP>
<p>When accessed via the special tag [L]Value Setting[/L],
the value <CODE>Configuration de valeur</CODE> will be displayed <STRONG>only</STRONG> if the
locale is set to <CODE>fr_FR</CODE>. If the locale is set to <CODE>de_DE</CODE>,
the string <CODE>Werteinstellung</CODE> will be dislayed. If it is neither,
the default value of <CODE>Value Setting</CODE> will be displayed.
<p>The L and /L must be capitalized -- this is done for speed of processing
as well as easy differentiation in text.
<p>For longer series of strings, the configuration file recognizes:
<p>
<PRE>
    Locale fr_FR &lt;&lt;EOF
        {
                ``Value setting'',
                ``Configuration de valeur'',
                "Search",
                "Recherche"
        }
        EOF

</PRE>
<p>The above sets two string substitutions.  As long as this is valid Perl
syntax describing a series of settings, the text will be matched. It can
contain any arbitrary set of characters that don't contain <CODE>[L]</CODE> and <CODE>[/L]</CODE>.
If using double quotes, string literals like \n and \t are recoginzed.
<p>The [L]default text[/L] is set before any other page processing. It is
equivalent to the characters ``default text'' or the appropriate Locale
translation for all intents and purposes. Minivend tags and Variable
values can be embedded.
<p>You will need to be quite careful in editing pages with localization
information. Changing even one character of the message will change the
key value and invalidate the message for other languages. To prevent this,
you can instead use:
<p>
<XMP>
        [L key]The default.[/L]

</XMP>
<p>The key <CODE>msg_key</CODE> will then be used to index the message.  This may be
preferable for many applications.
<p>A <CODE>localize</CODE> script is included with minivend. It will parse files
included on the command line and produce output that can be easily edited
to produce localized information. Given an existing file, it will merge
new information where appropriate.
<p>
<H2> 
<A NAME="minivend_special_1">
Special Locale keys for price representation</A>
</H2>
MiniVend honors the standard POSIX keys:
<p>
<XMP>
        mon_decimal_point decimal_point 
        mon_thousands_sep thousands_sep 
        currency_symbol   int_currency_symbol
        frac_digits       p_cs_precedes

</XMP>
<p>See the POSIX setlocale(3) man page for more information.
<p>These will be used for formatting prices and will approximate the number
format used in most countries. To set the price format to something that
is exactly how you want it, you can use the special keys:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_price_picture_0">
price_picture</A>

</STRONG>
<DD>
MiniVend will format a currency number based on a ``picture'' given to it. The
basic form is:
<p>
<XMP>
        Locale en_US price_picture "$ ###,###,###.##"

</XMP>
<p>This is the presumably for locale <CODE>en_US</CODE>, the United States, and it would
display <CODE>4452.3</CODE> as <CODE><STRONG>$ </STRONG>4,445.30</CODE>.
<p>The same display can be achieved with:
<p>
<XMP>
     Locale en_US mon_thousands_sep ,
     Locale en_US mon_decimal_point .
     Locale en_US p_cs_precedes     1
         Locale en_US currency_symbol   $

</XMP>
<p>A common price_picture for European countries would be <CODE>###.###.###,##</CODE>,
which would display the same number as <CODE>4.452,30</CODE>. To add a franc
notation at the end for the locale <CODE>fr_FR</CODE>, you would use the setting:
<p>
<XMP>
        Locale fr_FR price_picture "##.###,## fr"

</XMP>
<p>IMPORTANT NOTE: The decimal point in use, set by <CODE>mon_decimal_point</CODE>, and
the thousands separator <CODE>mon_thousands_sep</CODE> <STRONG>must</STRONG> match the settings in
the picture. The <CODE>frac_digits</CODE> setting is not used in this case -- it is
derived from the location of the decimal (if any).
<p>The same setting for fr_FR above can be achieved with:
<p>
<XMP>
     Locale fr_FR mon_thousands_sep .
     Locale fr_FR mon_decimal_point ,
     Locale fr_FR p_cs_precedes     0
         Locale fr_FR currency_symbol   fr

</XMP>
<p>If the number of digits is greater than the # locations in the picture,
the digits will be changed to asterisks. An overflow number above would
show as <CODE>**.***,** fr</CODE>.
<p>
<DT><STRONG>

<A NAME="minivend_picture_0">
picture</A>

</STRONG>
<DD>
Same as 
<A HREF="minivend.html#minivend_price_picture_0">price_picture</A>
, but sets the value returned if the [currency]
tag is not used.
<p>If the number of digits is greater than the # locations in the picture,
the digits will be changed to asterisks, displaying something like
<CODE>**,***.**</CODE>.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_dynamic_0">
Dynamic locale directive changes</A>
</H2>
If you set Locale keys corresponding to some MiniVend 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 directives,
those values will be set when setting the locale.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_pagedir_0">
PageDir</A>

</STRONG>
<DD>
To use a different page directory for different locales, set the PageDir
key. To have two separate language page sets, French and English, you would
set:
<p>
<XMP>
        # Establish the default at startup
        PageDir   english
        Locale fr_FR  PageDir  francais
        Locale en_US  PageDir  english

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_imagedir_0">
ImageDir</A>

</STRONG>
<DD>
To use a different image directory for different locales, set the ImageDir
key. To have two separate language button sets, French and English, you would
set:
<p>
<XMP>
        # Establish the default at startup
        ImageDir   /images/english/
        Locale fr_FR  ImageDir   /images/francais/
        Locale en_US  ImageDir   /images/english/

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pricefield_0">
PriceField</A>

</STRONG>
<DD>
To use a different field in the products database for pricing based on locale,
set the PriceField locale setting.
<p>
<XMP>
        # Establish the default at startup
        PriceField    price
        Locale fr_FR  PriceField  prix

</XMP>
<p>The default will always be <CODE>price</CODE>, but if the locale <CODE>fr_FR</CODE> is set, the
PriceField directive will change to <CODE>prix</CODE> to give prices in francs instead
of dollars.
<p>If 
<A HREF="minivend.html#minivend_pricebreaks_0">PriceBreaks</A>
 is enabled, then the field <CODE>prix</CODE> from the <CODE>pricing</CODE> database
will be used to develop the quantity pricing. NOTE: If no Locale settings are
present, it will always be <CODE>price</CODE>, irrespective of the 
<A HREF="minivend.html#minivend_pricefield_0">PriceField</A>
 setting.
Otherwise it will always match 
<A HREF="minivend.html#minivend_pricefield_0">PriceField</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_pricedivide_0">
PriceDivide</A>

</STRONG>
<DD>
Normally used to enable penny pricing with a setting of 100, this can be
used to do an automatic conversion factor based on locale.
<p>
<XMP>
        # Default at startup is 1 if not set
        # Franc is strong these days!
        Locale fr_FR  PriceDivide  .20

</XMP>
<p>The price will now be divided by <CODE>.20</CODE>, yielding franc prices five times
that of the dollar.
<p>
<DT><STRONG>

<A NAME="minivend_pricecommas_0">
PriceCommas</A>

</STRONG>
<DD>
Perhaps this isn't a good name anymore, but it controls whether the
<CODE>mon_thousands_sep</CODE> will be used for standard currency formatting.
Ignored if using 
<A HREF="minivend.html#minivend_price_picture_0">price_picture</A>
. Set to 1 or 0, to enable and disable
respectively. DO NOT USE Yes and No.
<p>
<XMP>
        # Default at startup is Yes if not set
        PriceCommas  Yes
        Locale fr_FR  PriceCommas  0
        Locale en_US  PriceCommas  1

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_usemodifier_0">
UseModifier</A>

</STRONG>
<DD>
Changes the fields from that set shopping cart options.
<p>
<XMP>
        # Default at startup is 1 if not set
        # Franc is strong these days!
        UseModifier format
        Locale fr_FR  UseModifier formats

</XMP>
<p>If a previous setting was made for an item based on another locale, it
will be maintained.
<p>
<DT><STRONG>

<A NAME="minivend_priceadjustment_0">
PriceAdjustment</A>

</STRONG>
<DD>
Changes the fields from UseModifier that will be used to adjust pricing.
used to do an automatic conversion factor based on locale.
<p>
<XMP>
        # Default at startup
        PriceAdjustment  format
        Locale fr_FR  PriceAdjustment  formats

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_taxshipping_salestax_0">
TaxShipping,SalesTax</A>

</STRONG>
<DD>
Same as the standard directives.
<p>
<DT><STRONG>

<A NAME="minivend_descriptionfield_0">
DescriptionField</A>

</STRONG>
<DD>
This changes the field accessed by default with the [item-description] and
[description code] tags.
<p>
<XMP>
        # Establish the default at startup
        DescriptionField    description
        Locale fr_FR  DescriptionField desc_fr

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_the_9">
The [locale] tag</A>

</STRONG>
<DD>
You can set standard error messages based on Locale settings. Make sure
you don't use any of the predefined keys -- it will be safe if you begin
the key with msg_ or such. The default message is set between the 
<CODE>[locale key]</CODE> and <CODE>[/locale]</CODE> tags. See the example above.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_sorting_1">
Sorting based on Locale</A>
</H2>
The MiniVend [sort database:field] keys will use the LC_COLLATE
setting for a locale provided that:
<p>
<UL>
<LI>Your operating system and C compiler have such support for POSIX, and
you have the locale definitions set.
<p>
<LI>You have Perl 5.004.
<p>
<LI>The locale setting matches one of your configured locales.
<p>
</UL>
It is beyond the scope of this document to discuss these issues,.and you should contact your system administrator or local wizard
to help you set up locales on your system. NOTE: Windows locales
are not supported for sorting.
<p>If you had this arbitrary database named <CODE>letters</CODE>:
<p>
<XMP>
    code        letter
    00-0011     f
    99-102      
    19-202      a

</XMP>
<p>and this loop:
<p>
<XMP>
    [loop 19-202 00-0011 99-102]
    [sort letters:letter]
    [loop-data letters letter]   [loop-code]
    [/loop]

</XMP>
<p>Using the default C setting for LC_COLLATE it would display:
<p>
<XMP>
    a  19-202
    f  00-0011
      99-102

</XMP>
<p>If the proper LC_COLLATE settings for locale <CODE>fr_FR</CODE> were in effect,
then it would become:
<p>
<XMP>
    a  19-202
      99-102
    f  00-0011

</XMP>
<p><p><hr>

<H1> 
<A NAME="minivend_minivend_3">
MINIVEND CONFIGURATION FILES</A>
</H1>
MiniVend can and usually does run multiple catalogs on the
same server. If no 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directives are present in the main

<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file, the server will read only a single catalog's
information from the one 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file, just as in
early versions of the program.
<p>You normally call configuration directives with the directive as the
first word on the line, with it's value or values following. Leading
whitespace is stripped from the value.
<p>You may call additional files with a rudimentary <EM>#include file</EM>
statement. The directives called with includes are always appended
at the end of the main configuration file. Though order is rarely
important in the configuration files, you must define any directory
settings in the main configuration file near the top if they are to
be used to base the file calls of subsequent directives. Files are
relative to the catalog directory (or MiniVend software directory, if
in the main minivend.cfg file).
<p>You can also use a type of ``here document'' to specify MiniVend directives,
with the usual &lt;&lt;MARKER syntax. No semicolon is used to terminate the
marker.
<p>
<H2> 
<A NAME="minivend_server_0">
Server Configuration File</A>
</H2>
The VendRoot directory, specified in the main program <CODE>minivend</CODE>, is
the default location of all of the MiniVend program, configuration,
special, and library files. Unless changed in <CODE>minivend</CODE>, the main
MiniVend server configuration file will be minivend.cfg in the VendRoot
directory.
<p>If no 
<A HREF="minivend.html#minivend_catalog_2">Catalog</A>
 directives are present, all of the directives
listed under 
<A HREF="minivend.html#minivend_catalog_3">Catalog Configuration File</A>
 are operative for the
single catalog that will be served by MiniVend.
<p>Otherwise, there are only a few directives that are defined in the 

<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_adminsub_0">
AdminSub</A>

</STRONG>
<DD>
Specifies subroutine names that may not be run unless the user
is the administrative user for the catalog. (See 
<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
, 

<A HREF="minivend.html#minivend_password_0">Password</A>
, and 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>
).
<p>
<XMP>
    AdminSub  export_database

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_allowglobal_0">
AllowGlobal</A>

</STRONG>
<DD>
Specifies catalog identifiers that may define subroutines and UserTag
entries that can operate with the full permissions of the
server. <STRONG>DON'T USE THIS UNLESS YOU TRUST THE CATALOG USER IMPLICITLY.</STRONG>
Default is blank.
<p>
<XMP>
    AllowGlobal  simple

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_catalog_2">
Catalog</A>

</STRONG>
<DD>
Specifies a catalog that can run using this MiniVend server.
There are three required parameters, separated by spaces and/or tabs.
<p>The first is the name of the catalog -- it will be referred
to as that name in error, warning, and informational messages.
It must contain only alphanumeric characters, hyphens, and underscores.
<p>The second is the base directory of the catalog. If the directory
does not contain a 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file, the server will report
an error and refuse to start.
<p>The third directive is very important to get right -- it is the
SCRIPT_NAME of the vlink program that runs the catalog. It must
be unique from other CGI program paths that run on this server --
that is how the catalog is selected for operation.
<p>
<XMP>
    Catalog    simple   /home/minivend/simple  /cgi-bin/simple

</XMP>
<p>As of MiniVend 3.0, you can specify any number of alias script names
as additional parameters. This allows the calling path to be different
while still calling the same catalog -- it is most probably useful
when calling an SSL server or a members-only executable that requires
a username/password via HTTP Basic authorization. All branched links
will be called using the aliased URL.
<p>In addition, if you set the global directive 
<A HREF="minivend.html#minivend_fullurl_0">FullUrl</A>
 to <EM>yes</EM>,
you can (and must in all catalogs) specify the server name that
will call the catalog. This allows you to have many virtual domains,
all of which use /cgi-bin/shop as the calling URL.
<p>
<DT><STRONG>

<A NAME="minivend_displayerrors_0">
DisplayErrors</A>

</STRONG>
<DD>
While all errors are reported in the error log file, you can also have
errors displayed by the browser. This is convenient while you are
testing your configuration. Unless this is set, the DisplayErrors
setting in the user catalogs will have no effect. Default is <EM>No</EM>.
<p>
<XMP>
    DisplayErrors       Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_domaintail_0">
DomainTail</A>

</STRONG>
<DD>
Implements the domain/IP session qualifiers so that only the
major domain is used to qualify the session ID.  This is a 
compromise on security, but it allows non-cookie-accepting browsers
like AOL's V2.0 to use multiple proxy servers.
 
Default is yes, since most everyone wants AOL to work.
 
    DomainTail No
<p>
<DT><STRONG>

<A NAME="minivend_environment_0">
Environment</A>

</STRONG>
<DD>
Environment variables to inherit from the calling CGI link program.
And example might be PGPPATH, used to set the directory which PGP
will use to find its key ring.
<p>
<XMP>
    Environment  MSQL_HOME MSQL_TCP_PORT MSQL_UNIX_PORT

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_fullurl_0">
FullUrl</A>

</STRONG>
<DD>
Normally MiniVend determines which catalog to call by determining the
SCRIPT_NAME from the CGI call. This means that different (and maybe
virtual) hosts cannot use the same SCRIPT_NAME to call different
catalogs. Set FullUrl to <STRONG>Yes</STRONG> to differentiate based on the calling
host.  You must then set the server name in the Catalog directive
accordingly, i.e. yourdomain.com/cgi-bin/simple. A yes/no directive,
the default is <STRONG>No</STRONG>.
<p>
<XMP>
    FullUrl  Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_globalsub_0">
GlobalSub</A>

</STRONG>
<DD>
Defines a <EM>global</EM> subroutine for use by the <STRONG>[perl sub] subname arg [/perl]</STRONG>
construct. Use the ``here document'' capability of MiniVend configuration
files to make it easy to define:
<p>
<PRE>
    GlobalSub &lt;&lt;EOF
    sub count_orders {
        my $counter = new File::CounterFile "/tmp/count_orders", '1';
        my $number = $counter->inc();
        return "There have been $number orders placed.\n";
    }
    EOF

</PRE>
<p>As with Perl ``here documents'', the EOF (or other end marker) must be the 
ONLY thing on the line, with no leading or trailing white space. Do not
append a semicolon to the marker. (The above appears indented -- it
should not be that way in the file!)
<p><STRONG>IMPORTANT NOTE:</STRONG> These global subroutines are <STRONG>not</STRONG> subject to
security checks -- they can do most anything!  For most purposes,
scratch subroutines or catalog subroutines (also 
<A HREF="minivend.html#minivend_sub_1">Sub</A>
) are better.
<p>GlobalSub routines are subject to full Perl <EM>use strict</EM> checking, so
you will get errors if you do not use lexical variables or complete
package qualifications for your variables.
<p>
<DT><STRONG>

<A NAME="minivend_hammerlock_0">
HammerLock</A>

</STRONG>
<DD>
The number of seconds after which a locked session could be
considered to be lost due to malfunction. This will kill the
lock on the session. Only here for monitoring of session
hand-off, if this error shows up in the error log the system
setup should be examined. Default is 30.
<p>
<XMP>
    HammerLock          60

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_housekeeping_0">
HouseKeeping</A>

</STRONG>
<DD>
How often, in seconds, the MiniVend server will ``wake up''
and look for user reconfiguration requests and hung search
processes. On some systems, this wakeup is the only time the
server will terminate in response to a stop command. Default
is 60.
<p>
<XMP>
    HouseKeeping    10

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_iphead_0">
IpHead</A>

</STRONG>
<DD>
Implements the domain/IP session qualifiers so that only the
first two dot-quads of the IP address are used to qualify the
session ID.  This is a compromise on security, but it allows
non-cookie-accepting browsers like AOL's V2.0 to use multiple
proxy servers. 
<p>DomainTail is preferable unless one of your HTTP servers does
not do host name lookups.
<p>Default is <CODE>No</CODE>, and DomainTail must be set to <CODE>No</CODE> for it to
operate.
<p>
<XMP>
    IpHead Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_lockoutcommand_0">
LockoutCommand</A>

</STRONG>
<DD>
The name of a command (as you would enter it from the shell)
that will lock out the host IP of an offending system. The 
IP address will be substituted for the first occurrence of the
string <STRONG>%s</STRONG>.
<p>This will be executed with the user ID that MiniVend runs
under, so any commands that require root access will have
to be wrapped with an SUID program.
<p>On Linux, you might lock out a host with:
<p>
<XMP>
    ipfwadm -I -i deny -S %s

</XMP>
<p>This would require root permissions, however, under normal 
circumstances.  You can use <CODE>sudo</CODE> or another method to 
wrap and allow the command.
<p>You can write a script which modifies an appropriate access
control file, such as .htaccess for your CGI directory, to
do another level of lockout.  A simple command line containing
<CODE>perl -0777 -npi -e 's/deny/deny from <STRONG>%s</STRONG>\ndeny/' /home/me/cgi-bin/.htaccess</CODE>
would work as well (remember, the <STRONG>%s</STRONG> will become the IP
address of the offending user).
<p>
<XMP>
    LockoutCommand   lockout %s

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_maxservers_0">
MaxServers</A>

</STRONG>
<DD>
The maximum number of servers that will be spawned to handle page
requests. If more than MaxServers requests are pending, they will
be queued (within the defined capability of the operating system,
usually 5 pending requests) until the number of active servers goes
below that value.
<p>
<XMP>
    MaxServers     4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_multiserver_0">
MultiServer</A>

</STRONG>
<DD>
If defined to be true, then multiple servers can share the
socket and serve users. Not usable on SGI systems. Default is <EM>no</EM>
<p>
<XMP>
    MultiServer     yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_noabsolute_0">
NoAbsolute</A>

</STRONG>
<DD>
Whether MiniVend [file ...] and other tags can read any file on the system
(that is readable by the user id running the MiniVend daemon).  The default is
<STRONG>No</STRONG>, which allows any file to be read -- this should be changed in a
multi-user environment to minimize security problems.
<p>
<XMP>
    NoAbsolute     Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_safesignals_0">
SafeSignals</A>

</STRONG>
<DD>
If your operating system does not have a re-entrant C library that
can guarantee that signal race conditions will not occur, then
set this to NO.
<p>BSDI and FreeBSD libraries are NOT safe, and SafeSignals will
automatically be disabled for those operating systems.
<p>In general, if MiniVend ever just ``hangs'', particularly if you
can see a perl.core file, disable this directive.
<p>
<XMP>
    SafeSignals  No

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_safeuntrap_0">
SafeUntrap</A>

</STRONG>
<DD>
Sets the codes that will be untrapped in the Safe.pm module, used
for embedded Perl and conditional operations. You can see the Safe.pm
documentation by typing <CODE>perldoc Safe</CODE> at the command prompt. The default
is <CODE>249 148</CODE> for Perl 5.003, and <CODE>ftfile sort</CODE> for Perl 5.003_20 and
above, which untraps the file existence test operator and the sort
operator. Define it as blank to not allow any besides the default
restrictive operators.
<p>
<XMP>
    SafeUntrap     ftfile sort ftewrite

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sendmailprogram_0">
SendMailProgram</A>

</STRONG>
<DD>
Specifies the program used to send email. Defaults to
'/usr/lib/sendmail'. If it is not found at startup, MiniVend
will complain and refuse to start.
<p>
<XMP>
    SendMailProgram     /bin/mailer

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_subcatalog_0">
SubCatalog</A>

</STRONG>
<DD>
Allows definition of a catalog which shares most of the characteristics of
another catalog.  Only the items that are changed from the base catalog
are added.  The parameters are 1) the catalog ID 2) the base catalog ID,
3) the directory to use (typically the same as the base catalog), and 4)
the SCRIPT_NAME that will trigger the catalog. Any additional parameters
are aliases for the SCRIPT_NAME.
<p>The main reason that this would be used would be to conserve memory in
a series of stores that share most of the same pages or databases.
<p>
<XMP>
    SubCatalog   sample2 sample /usr/catalogs/sample /cgi-bin/sample2

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tcphost_0">
TcpHost</A>

</STRONG>
<DD>
When running in INET mode, using <CODE>tlink</CODE>, specifies the hosts that are
allowed to send/receive transactions from any catalog on this MiniVend
server. Can be either an name or IP number, and multiple hosts can be
specified in a space-separated list. Default is localhost.
<p>
<XMP>
    TcpHost         localhost secure.domain.com

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tcpport_0">
TcpPort</A>

</STRONG>
<DD>
When running in INET mode, using <CODE>tlink</CODE>, specifies the port
that will be monitored by the MiniVend server. Default is 7786.
<p>
<XMP>
    TcpPort         7786

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tolerateget_0">
TolerateGet</A>

</STRONG>
<DD>
Sometimes proxy servers screw up and cache POST forms. This is
mainly a problem from forms that are identical, such as popular
items being placed in the basket and then the user pushing the
checkout button.
<p>Set TolerateGet to <CODE>Yes</CODE> to allow GET forms. You will be able
to use METHOD=GET on the form if necessary, subject to the normal
limits of query string length.  You will want to set the variable
<CODE>mv_session_id</CODE> to ensure that the session is not lost on browsers
that don't support cookies:
<p>
<XMP>
    <INPUT TYPE=hidden NAME=mv_session_id VALUE="[data session id]">

</XMP>
<p>It would be typical to employ this on your shopping cart page or
perhaps put it on the 
<A HREF="minivend.html#minivend_interact_0">interact</A>
 page that is shown when
the normal error is received.
<p>
<XMP>
    TolerateGet   Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_userbuild_0">
UserBuild</A>

</STRONG>
<DD>
A Yes/No directive.  Determines whether users are allowed to trigger
static builds of their MiniVend catalogs. Default is no, as you do
not typically want to allow rebuilds from the running server.
<p>
<DT><STRONG>

<A NAME="minivend_variable_0">
Variable</A>

</STRONG>
<DD>
Defines a global variable that will be available in <STRONG>all</STRONG> catalogs
with the notation <STRONG>@@</STRONG>Variable@@. Variable identifiers must begin with a
capital letter, and can contain only word characters (<STRONG>A-Z,a-z,0-9</STRONG> and
underscore) -- they are case-sensitive. If using the

<A HREF="minivend.html#minivend_parsevariables_0">ParseVariables</A>
 directive, only variables in ALL CAPS will be
parsed. These are substituted first in any MiniVend page, and can
contain any valid MiniVend tags including catalog variables.
<p>
<XMP>
    Variable   DOCUMENT_ROOT   /usr/local/etc/httpd/htdocs

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_catalog_3">
Catalog Configuration File</A>
</H2>
If multiple catalogs are to be run, each must have a 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>

file located in the catalog base directory. It contains most of
the configurable parameters for MiniVend -- each is independent
from catalog to catalog.
<p>
<H2> 
<A NAME="minivend_required_2">
Required Configuration Directives</A>
</H2>
In the catalog configuration file, these directives are 
<A HREF="minivend.html#minivend_required_1">required</A>
:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_vendurl_0">
VendURL</A>

</STRONG>
<DD>
Specifies the base URL that will run vlink as a cgi-bin program.
<p>
<XMP>
        VendURL  http://machine.company.com/cgi-bin/vlink

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mailorderto_0">
MailOrderTo</A>

</STRONG>
<DD>
Specifies the email address to mail completed orders to.
<p>
<XMP>
        MailOrderTo  orders@xyzcorp.com

</XMP>
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_optional_0">
Optional Configuration Directives</A>
</H2>
These directives all have default values and are optional.
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_actionmap_0">
ActionMap</A>

</STRONG>
<DD>
Allows setting of button actions for particular names. The predefined
names are:
<p>
<XMP>
 cancel   Cancel order and wipe credit card numbers
 control  Control help, colors, etc.
 checkout Call checkout form
 refresh  Refresh order page (update quantities, etc.)
 return   Go to previous page (or page defined in mv_nextpage variable)
 search   Search for an item in the catalog
 set      Update a database
 submit   Submit order or form

</XMP>
<p>Actions are overwritten, even the default ones, if re-defined. Default
is blank. Can be set as many times as necessary. Not case sensitive.
<p>
<XMP>
    ActionMap           refresh change
    ActionMap           refresh validate
    ActionMap           cancel erase
    ActionMap           submit next
    ActionMap           control color

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_admindatabase_0">
AdminDatabase</A>

</STRONG>
<DD>
When set to one or more MiniVend database identifiers, any pages using data
items from the specified database(s) will not be allowed for display unless
the user the catalog operator -- i.e. is authenticated by one of 
<A HREF="minivend.html#minivend_password_0">Password</A>
,

<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
, or 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>
. The special page 
<A HREF="minivend.html#minivend_violation_0">violation</A>
 will be displayed
if another user attempts to access a page containing elements from the
database(s).
<p>
<XMP>
    AdminDatabase   inventory

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_adminpage_0">
AdminPage</A>

</STRONG>
<DD>
When set to one or more MiniVend page names, pages with that name will
not be allowed for display unless the user the catalog operator -- i.e. is
authenticated by one of 
<A HREF="minivend.html#minivend_password_0">Password</A>
, 
<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
, or 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>
. The
special page 
<A HREF="minivend.html#minivend_violation_0">violation</A>
 will be displayed if another user attempts to
access the page(s).
<p>
<XMP>
    AdminPage       config/menu

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_alwayssecure_0">
AlwaysSecure</A>

</STRONG>
<DD>
Determines whether checkout page operations should always be
secure. Set it to the pages that should always be secure, separated
by spaces and/or tabs.
<p>
<XMP>
    AlwaysSecure    checkout

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_asciibackend_0">
AsciiBackend</A>

</STRONG>
<DD>
A file name to log order fields in (set by BackendOrder).
Unless preceded by a leading '/', will be placed relative to VendRoot.
If the first character is a '|', it is the name of a program to send the
fields to. Disabled by default.
<p>
<XMP>
    AsciiBackend  |/usr/order/scripts/place_order

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_asciitrack_0">
AsciiTrack</A>

</STRONG>
<DD>
A file name to log formatted orders in. Unless preceded by a leading '/',
will be placed relative to the catalog directory. Disabled by default.
<p>
<XMP>
    AsciiTrack     etc/orders.txt

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_backendorder_0">
BackendOrder</A>

</STRONG>
<DD>
Controls the fields that are prepended to the item codes and quantities
for the backend ordering capability. These are the values from the
user checkout forms. You can access any value in that hash. If blank,
no backend ordering is in force. Default is blank.
<p>
<XMP>
     BackendOrder    name,address,city,state,zip,mv_shipmode

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_buttonbars_0">
ButtonBars</A>

</STRONG>
<DD>
The ButtonBars directive allows you to define several preset button bars
that reside in files. The button bar file will usually contain an IMG
link, along with its associated client-side image map. This allows you
to insert a [buttonbar 1] or [buttonbar 2] directive instead of the
equivalent HTML, and is designed to make it easy to change the look of
your pages with the change of one file. If the file does not exist at
program configuration time, the tag is simply stripped. The line in the

<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file takes the form of the directive, followed by any
number of vend-style file names (relative to the PageDir, with no .html
suffix).
<p>
<XMP>
    ButtonBars  bars/button0 bars/button1 bars/button2 bars/button3

</XMP>
<p>The ButtonBars directive is deprecated in favor of 
<A HREF="minivend.html#minivend_variable_0">Variable</A>
 and
<EM>UserTag</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_checkoutframe_0">
CheckoutFrame</A>

</STRONG>
<DD>
The frame name where the checkout page will go, if frames are
enabled. Default is not set, or making it subject to the default
target.
<p>
<XMP>
    CheckoutFrame  _blank

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_checkoutpage_0">
CheckoutPage</A>

</STRONG>
<DD>
The name of the default page to send the user to when the [finish-order]
tag is used. Default is ``order''. This is overridden in any number of
ways from order forms.
<p>
<XMP>
    CheckoutPage  basket

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_clearcache_0">
ClearCache</A>

</STRONG>
<DD>
A yes/no directive. When set to yes, each time the catalog is reconfigured
or the MiniVend server is restarted the page and search caches will be cleared.
Default is <EM>No</EM>. The cache can always be cleared by removing all files in
the 
<A HREF="minivend.html#minivend_scratchdir_0">ScratchDir</A>
/PageCache and 
<A HREF="minivend.html#minivend_scratchdir_0">ScratchDir</A>
/SearchCache directories. In 
addition, if static page building is being used, the output directory will
be cleared before build if this directive is set.
<p>
<XMP>
    ClearCache  Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_collectdata_0">
CollectData</A>

</STRONG>
<DD>
The points at which to log various data items collected by MiniVend,
such as failed or successful searches. This allows you to find out what
your customers are searching for and NOT finding -- perhaps you want to
add it, or change your product description to match. Uses something
like the HTTP common log format.
<p>The choices to enter are:
<p>
<XMP>
  matched    Search strings that match
  nomatch    Search strings that fail to match
  page       Pages that are accessed
  nopage     Pages that are not found
  basket     Items placed in shopping carts
  cache      Pages/searches added to cache

</XMP>
<p>Enter as a space or comma-separated list, i.e.
<p>
<XMP>
    CollectData   matched,nomatch,page

</XMP>
<p>Orders are typically logged to other files via AsciiTrack, AsciiBackend,
or the [tag log ...]data[/tag] construct.
<p>
<DT><STRONG>

<A NAME="minivend_commonadjust_0">
CommonAdjust</A>

</STRONG>
<DD>
A MiniVend database identifier specifying a database that contains, keyed
on the item attribute value (not the product code!), any price adjustments
that are to be done based on item attributes.
<p>Care needs to be used. Each attribute specified in 
<A HREF="minivend.html#minivend_priceadjustment_0">PriceAdjustment</A>

must have a corresponding column with the same name (case-sensitive),
which when keyed by the item attribute value yields the price adjustment
(if any) to be made for <EM>any</EM> item having that attribute and containing
that value. Used in concert with 
<A HREF="minivend.html#minivend_priceadjustment_0">PriceAdjustment</A>
, and is not set by
default, disabling the common adjustment database feature.
<p>
<XMP>
    CommonAdjust   adjustments

</XMP>
<p>Can be set in the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 settings to allow different price
adjustment databases for different currencies (MV3.07 and up).
<p>
<DT><STRONG>

<A NAME="minivend_configdir_0">
ConfigDir</A>

</STRONG>
<DD>
The default directory where directive values will be read from
when using the &lt;file notation. Default is 
<A HREF="minivend.html#minivend_config_1">config</A>
. The name is
relative to the catalog directory unless preceded by a /.
<p>
<XMP>
    ConfigDir      variables

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_cookiedomain_0">
CookieDomain</A>

</STRONG>
<DD>
Allows you to set a domain so that two servers can handle traffic.
For example, if you wanted to use server addresses of <STRONG>secure.yourdomain.com</STRONG>
and <STRONG>www.yourdomain.com</STRONG> then you could set it to:
<p>
<XMP>
    CookieDomain    .yourdomain.com

</XMP>
<p>It <STRONG>must</STRONG> have at least two periods or browsers will ignore it.
<p>
<DT><STRONG>

<A NAME="minivend_cookies_0">
Cookies</A>

</STRONG>
<DD>
Determines whether we will send (and read back) a cookie to
get the session ID for links that go outside the catalog.
Allows arbitrary HREF links to be placed in MiniVend pages, while
still saving the contents of the session.  The default is <STRONG>Yes</STRONG>,
which is a change from MiniVend 2.x.
<p>
<XMP>
    Cookies         Yes

</XMP>
<p>If the 
<A HREF="minivend.html#minivend_cookies_0">Cookies</A>
 directive is enabled, and mv_save_session is set
upon submission of a user form (or in the CGI variables through a perl

<A HREF="minivend.html#minivend_globalsub_0">GlobalSub</A>
), the cookie will be persistent for the period defined
by 
<A HREF="minivend.html#minivend_saveexpire_0">SaveExpire</A>
.
<p>Caching and static page building will never be in effect unless
this directive is enabled.
<p>
<DT><STRONG>

<A NAME="minivend_creditcardauto_0">
CreditCardAuto</A>

</STRONG>
<DD>
If set to <EM>Yes</EM>, enables the encryption and saving of 
credit card information. In order for this to work properly, the
EncryptProgram directive must be set to properly encode the field. The
best way to set EncryptProgram is with PGP in the ASCII armor mode (the
option set '-feat' is used).
<p>This option uses the following standard fields on MiniVend order
processing forms:
<p>
<XMP>
    mv_credit_card_number      The actual credit card number, which
                               will be wiped from memory if it verifies
                               as a valid Amex, Visa, MC, or Discover
                               card number.
    mv_credit_card_exp_all     The expiration date, as a text field in
                               the form MM/YY (will take a four-digit
                               year as well). If it is not present,
                               the fields mv_credit_card_exp_month and
                               mv_credit_card_exp_year are looked at. 
                               It is set by MiniVend when the card
                               validation returns, if not previously
                               set.
    mv_credit_card_exp_month   The expiration date month, used if the
                               mv_credit_card_exp_all field is not present.
                               It is set by MiniVend when the card
                               validation returns, if not previously
                               set.
    mv_credit_card_exp_year    The expiration date year, used if the
                               mv_credit_card_exp_all field is not present.
                               It is set by MiniVend when the card
                               validation returns, if not previously
                               set.
    mv_credit_card_error       Set by MiniVend to indicate the error
                               if the card does not validate properly.
                               The error message is not too enlightening
                               if validation is the problem.
    mv_credit_card_force       Set this value to 1 to force MiniVend
                               to encrypt the card despite its idea
                               of validity. Will still set the flag
                               for validity to 0 if the number/date
                               does not validate. Still won't accept
                               badly formatted expiration dates.
    mv_credit_card_info        Set by MiniVend to the encrypted card
                               information if the card validates
                               properly. If PGP is used in ASCII armor
                               mode, this field can be placed on the
                               order report and embedded in the order
                               email, replete with markers. This allows
                               a secure order to be read for content,
                               without exposing the credit card number
                               to risk.
    mv_credit_card_valid       Set by Minivend to true, or 1, if the the
                               card validates properly. Set to 0 otherwise.

</XMP>
<p>PGP is recommended as the encryption program, though you should remember
that US commercial organizations may require a license for RSA.
<p>
<XMP>
    CreditCardAuto     Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_customshipping_0">
CustomShipping</A>

</STRONG>
<DD>
If not blank, enables the addition of shipping charges based on
quantity or weight of items ordered. See 
<A HREF="minivend.html#minivend_shipping_2">SHIPPING</A>
.
<p>
<XMP>
    CustomShipping      quantity

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_cybercash_0">
CyberCash</A>

</STRONG>
<DD>
A yes/no directive, default no. Enables CyberCash payment protocols --
see 
<A HREF="minivend.html#minivend_using_1">Using CyberCash</A>
.
<p>
<XMP>
    CyberCash           Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_datadir_0">
DataDir</A>

</STRONG>
<DD>
The location of the extra database files if no path
information is provided. Set to ``products'' as the default, and
is relative to VendRoot if there is no leading slash. May not be
set to an absolute directory unless NoAbsolute is defined as No.
<p>
<XMP>
    DataDir             /user/data

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_database_0">
Database</A>

</STRONG>
<DD>
Definition of an arbitrary database, in the form "Database database file
type``, where ''file" is the name of an ASCII file in the same format as
the products database. The file is relative to VendRoot, and is put in

<A HREF="minivend.html#minivend_datadir_0">DataDir</A>
 if no path is provided. Records can be accessed with the
[data database field key] tag.  Database names are restricted to the
alphanumeric characters (including the underscore). See 
<A HREF="minivend.html#minivend_databases_0">DATABASES</A>
.
<p>
<XMP>
    Database      BookReviews  reviews.txt   3

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_defaultshipping_0">
DefaultShipping</A>

</STRONG>
<DD>
This sets the default shipping mode by initializing the variable
<EM>mv_ship_mode</EM>. If not set in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
, it is <EM>default</EM>.
<p>
<XMP>
    DefaultShipping     UPS

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_delimiter_1">
Delimiter</A>

</STRONG>
<DD>
One of TAB, PIPE, CSV, or your own custom delimiter. (It is not
suggested that you use a custom delimiter). TAB means a tab-delimited
database (the default if not set), PIPE a pipe-delimited one, and CSV a
quote-comma format.
<p>
<XMP>
    Delimiter           CSV

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_descriptionfield_0">
DescriptionField</A>

</STRONG>
<DD>
The field that will be accessed with the [item-description] element.
<p>
<XMP>
    DescriptionField    ProductDescription

</XMP>
<p>Default is 
<A HREF="minivend.html#minivend_description_2">description</A>
.  It is no longer a fatal error if this field
does not exist.
<p>
<DT><STRONG>

<A NAME="minivend_displayerrors_0">
DisplayErrors</A>

</STRONG>
<DD>
If the administrator has enabled 
<A HREF="minivend.html#minivend_displayerrors_0">DisplayErrors</A>
 globally, then setting
this to ``Yes'' will display the error returned from MiniVend in case something
is wrong with embedded Perl programs, tags, or (horrors!) MiniVend itself.
Usually you will only want to use this during development or debugging --
default is <STRONG>no</STRONG>.
<p>
<XMP>
    DisplayErrors       Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_dynamicdata_0">
DynamicData</A>

</STRONG>
<DD>
When set to one or more MiniVend database identifiers, any pages using data
items from the specified database(s) will not be cached or built
statically. This allows dynamic updating of certain arbitrary (or
even product) databases while still allowing static/cached page performance
gains on pages not using those data items.
<p>
<XMP>
    DynamicData         inventory

</XMP>
<p>Overridden by [tag flag build][/tag] or [tag flag cache][/tag], depending
on context.
<p>
<DT><STRONG>

<A NAME="minivend_encryptprogram_0">
EncryptProgram</A>

</STRONG>
<DD>
Contains a program command line specification that indicates how an
external encryption program will work. Two placeholders, <CODE><STRONG>%p</STRONG></CODE> and
<CODE><STRONG>%f</STRONG></CODE>, are defined, which are replaced at encryption time with the
password and temporary file name respectively. See 
<A HREF="minivend.html#minivend_order_2">Order Security</A>
.
<p>This is separate from the 
<A HREF="minivend.html#minivend_pgp_0">PGP</A>
 directive, which enables PGP encryption
of the entire order.
<p>If PGP is the encryption program (MiniVend determines this by searching
for the string <CODE>pgp</CODE> in the command string), no password field or file
field need be used -- the field mv_credit_card_number will never be
written to disk in that case.
<p>
<XMP>
    EncryptProgram      /usr/local/bin/pgp -feat sales@company.com

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_errorfile_0">
ErrorFile</A>

</STRONG>
<DD>
This is where MiniVend will write its runtime errors for THIS CATALOG
ONLY. It can be shared with other catalogs or the main MiniVend error
log, but if you make it root-based, be careful that you have permission to
write the file, or bad things will happen.
<p>
<XMP>
    ErrorFile   /home/minivend/error.log

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_extrasecure_0">
ExtraSecure</A>

</STRONG>
<DD>
Disallows access to pages which are marked with AlwaysSecure unless
the browser is in HTTPS mode. A yes/no directive -- default is 'No'.
<p>
<XMP>
    ExtraSecure  Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_fielddelimiter_0">
FieldDelimiter</A>

</STRONG>
<DD>
In conjunction with 
<A HREF="minivend.html#minivend_recorddelimiter_0">RecordDelimiter</A>
, allows custom database formats to
be defined. The first string is the database type identifier, and the second
is the field delimiter with C/Perl style double-quoted string format, i.e. \n
is a newline.
<p>
<XMP>
    FieldDelimiter   Tilde   ~
    RecordDelimiter  Tilde   \n
    Database  mydata mydata.txt Tilde

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_finishorder_0">
FinishOrder</A>

</STRONG>
<DD>
A text string or image tag which is substituted
for the <EM>[finish_order]</EM> tag.
<p>
<XMP>
    FinishOrder <IMG SRC="/icons/fin_ord.gif" ALT="Check Basket">

</XMP>
<p>This is deprecated, and may be removed from future versions of MiniVend.
<p>
<DT><STRONG>

<A NAME="minivend_formignore_0">
FormIgnore</A>

</STRONG>
<DD>
Set to the name(s) of variables that should not be carried in the
user session values. Must match exactly and are case sensitive.
<p>
<XMP>
    FormIgnore    mv_searchtype

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_fractionalitems_0">
FractionalItems</A>

</STRONG>
<DD>
Whether items in the shopping cart should be allowed to be
fractional, i.e. 2.5 or 1.25. Default is no.
<p>
<XMP>
    FractionalItems     Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_frameflypage_0">
FrameFlyPage</A>

</STRONG>
<DD>
The MiniVend-style page name (i.e. no .html extension, relative
to 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
) which contains the special on-the-fly page for when frames
are in use. If not set (the default), the standard flypage
will be used.
<p>
<XMP>
    FrameFlyPage      fr_flypage

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_framelinkdir_0">
FrameLinkDir</A>

</STRONG>
<DD>
The relative directory where on-the-fly pages will be sent during
static page builds -- it is relative to 
<A HREF="minivend.html#minivend_staticdir_0">StaticDir</A>
. Default is
'framefly'.
<p>
<XMP>
    FrameLinkDir      fr_fly

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_frameorderpage_0">
FrameOrderPage</A>

</STRONG>
<DD>
The MiniVend-style page name (i.e. no .html extension, relative
to 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
) which contains the special order page for when frames
are in use. If not set (the default), the standard order page
will be used. Vaguely deprecated, as multiple order pages are better
set with the 
<A HREF="minivend.html#minivend_mv_orderpage_0">mv_orderpage</A>
 variable.
<p>
<XMP>
    FrameOrderPage      fr_order

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_framesearchpage_0">
FrameSearchPage</A>

</STRONG>
<DD>
The MiniVend-style page name (i.e. no .html extension, relative
to 
<A HREF="minivend.html#minivend_pagedir_0">PageDir</A>
) which contains the special search page for when frames
are in use. If not set (the default), the standard search page
will be used. Vaguely deprecated, as multiple search pages are better
set with the 
<A HREF="minivend.html#minivend_mv_search_page_0">mv_search_page</A>
 variable.
<p>
<XMP>
    FrameSearchPage     fr_resul

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_framesdefault_0">
FramesDefault</A>

</STRONG>
<DD>
Whether the first access by a user will place them in frames mode.
Default is <STRONG>no</STRONG>.
<p>
<XMP>
    FramesDefault       Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_glimpse_0">
Glimpse</A>

</STRONG>
<DD>
The pathname for the glimpse command, used if glimpse searches
are to be enabled. If you wish to use <CODE>glimpseserver</CODE>, you
must include the -C, -J,  and -K tags if they are needed.
<p>
<XMP>
    Glimpse  /usr/local/bin/glimpse -C -J srch_engine -K2345

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_help_0">
Help</A>

</STRONG>
<DD>
The Help directive allows you to define an unlimited number of help
messages or image specifications that reside in a file (or files).
It is called by the [help item] tag, where item is the first line
of a help file entry which looks like:
<p>
<XMP>
 help1
 This is help item one. It ends after a blank line, and
 is called by a [help help1] element embedded in a MiniVend page.
 
 help2
 This is help item two. It ends after a blank line, and
 is called by a [help help2] element embedded in a MiniVend page.

</XMP>
<p>If the file (or the entry) does not exist at program configuration time,
the tag is simply stripped. The line in the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file takes
the form of the directive, followed by any number of vend-style file
names (relative to the PageDir, with no .html suffix). See the demo
for an example of how it is used.
<p>
<XMP>
    Help  help/hintfile

</XMP>
<p>The Help directive is vaguely deprecated in favor of arbitrary databases
and 
<A HREF="minivend.html#minivend_variable_0">Variable</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_imagealias_0">
ImageAlias</A>

</STRONG>
<DD>
Aliases for images, ala Apache/NCSA ScriptAlias and Alias directives.
Relocates images based in a particular directory to another for MiniVend
use -- operates <EM>after</EM> ImageDir. Useful for editing MiniVend pages
with an HTML editor. Default is blank.
<p>
<XMP>
    ImageAlias  /images/  /thiscatalog/images/

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_imagedir_0">
ImageDir</A>

</STRONG>
<DD>
The directory where all <EM>relative</EM> IMG and INPUT source file
specifications are based. IT MUST HAVE A TRAILING / TO WORK. If the
images are to be in the DocumentRoot (of the HTTP server or virtual
server) subdirectory <EM>images</EM>, for example, you would use the ImageDir
specification '/images/'. This would change SRC=``order.gif'' to
SRC=``/images/order.gif'' in IMG and INPUT tags. It has no effect on
other SRC tags.
<p>
<XMP>
    ImageDir /images/

</XMP>
<p>Can be set in the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 settings to allow different image
sets for different locales (MV3.07 and up).
<p>
<DT><STRONG>

<A NAME="minivend_itemlinkdir_0">
ItemLinkDir</A>

</STRONG>
<DD>
The directory where the [item_link] tag will base all of its
hot links in, relative to the pages directory. The default is blank,
basing all links in the pages directory. If set, it needs
a trailing '/' to operate properly. This directive is deprecated,
and may disappear in future versions of MiniVend.
<p>
<XMP>
    ItemLinkDir     partno/

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_itemlinkvalue_0">
ItemLinkValue</A>

</STRONG>
<DD>
Specifies the text or image you want to use to provide a clickable
link to the catalog page when using the [item_link] tag (in the
search form, or other forms). This directive is deprecated,
and may disappear in future versions of MiniVend.
<p>
<XMP>
    ItemLinkValue   <IMG SRC="/images/gopage.gif" ALT="GO TO PAGE">

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_locale_0">
Locale</A>

</STRONG>
<DD>
Sets the special locale array. Tries to use POSIX setlocale based
on the value of itself, then tries to accept a custom setting with
the proper definitions of <CODE>mon_decimal_point</CODE>, <CODE>thousands_sep</CODE>, and <CODE>frac_digits</CODE>,
which are the the only international settings required. Default if not
set is to use US-English settings. 
<p>Example of the custom setting:
<p>
<XMP>
    Locale     custom mon_decimal_point , mon_thousands_sep . frac_digits 0

</XMP>
<p>Example of POSIX setlocale for France, if properly aliased:
<p>
<XMP>
    Locale     fr

</XMP>
<p>See setlocale(3) for more information. If embedded Perl code
is used to sort search returns, then the <EM>setlocale()</EM> will carry
through to string collation.
<p>MiniVend 3.07 extends the Locale array to accept many more settings.
See <EM>Internationalization</EM>.
<p>
<DT><STRONG>

<A NAME="minivend_logfile_0">
LogFile</A>

</STRONG>
<DD>
A file where user pages accesses and search specifications will
be logged if CollectData is set. Defaults to 
<A HREF="minivend.html#minivend_etc_0">etc/log</A>
.
<p>
<XMP>
    LogFile        etc/log

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_masterhost_0">
MasterHost</A>

</STRONG>
<DD>
The IP address that can reconfigure the catalog. Default is blank,
disabling remote check of IP address.
<p>
<XMP>
    MasterHost    10.10.10.1

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mixmatch_0">
MixMatch</A>

</STRONG>
<DD>
A yes/no directive. A setting of <STRONG>yes</STRONG> says that quantity price breaks
will be on TOTAL quantity, <STRONG>no</STRONG> says that quantity price breaks are on
a per-item quantity. Default is <STRONG>no</STRONG>.
<p>
<XMP>
    MixMatch        yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_msqldb_0">
MsqlDB</A>

</STRONG>
<DD>
Sets the name of the mSQL database (must be present on the default
server). Defaults to <EM>minivend</EM>.
<p>
<XMP>
    MsqlDB          catalog

</XMP>
<p>
<DT><STRONG>
<EM>Mv_AlinkColor </EM>
</STRONG>
<DD>
Sets the accessed link colors to be used in the color schemes. The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for visited link color. The specification can be in
#RRGGBB color format, or can be one of the colors that will be
recognized (steelblue, white, etc.) Each color should be separated by
one or more spaces. Set to <CODE>none</CODE> to disable a color (use the browser
default) for a particular scheme. Remember, the schemes are numbered in
the order that they occur.
<p>
<XMP>
    Mv_VlinkColor BEGIN  orange none blue

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_background_0">
Mv_Background</A>

</STRONG>
<DD>
Sets the background patterns to be used in the color schemes. The 
line must begin with 'BEGIN', then is followed by up to 15 pattern
URLs containing background patterns to be used with the color schemes.
Each pattern should be separated by one or more spaces.
set to 0 to disable a background pattern for a particular scheme.
Remember, the schemes are numbered in the order that they occur.
<p>
<XMP>
    Mv_Background BEGIN /images/blue_pap.gif 0 /images/temple.jpg

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_bgcolor_0">
Mv_BgColor</A>

</STRONG>
<DD>
Sets the background colors to be used in the color schemes. The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for background color. The specification can be in #RRGGBB
color format, or can be one of the colors that will be recognized
(steelblue, white, etc.) Each color should be separated by one or more
spaces. Set to <CODE>none</CODE> to disable a color (use the browser default) for
a particular scheme. Remember, the schemes are numbered in the order
that they occur.
<p>
<XMP>
    Mv_BgColor BEGIN  steelblue none white

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_linkcolor_0">
Mv_LinkColor</A>

</STRONG>
<DD>
Sets the link colors to be used in the color schemes. The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for link color. The specification can be in #RRGGBB
color format, or can be one of the colors that will be recognized
(steelblue, white, etc.) Each color should be separated by one or more
spaces. Set to <CODE>none</CODE> to disable a color (use the browser default) for
a particular scheme. Remember, the schemes are numbered in the order
that they occur.
<p>
<XMP>
    Mv_LinkColor BEGIN  ltgreen none red

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_mv_textcolor_0">
Mv_TextColor</A>

</STRONG>
<DD>
Sets the text colors to be used in the color schemes. The colors are
accessed with the [body n] tag, where n is the color scheme number. The
line must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for text color. The specification can be in #RRGGBB color
format, or can be one of the colors that will be recognized (steelblue,
white, etc.) Each color should be separated by one or more spaces. Set
to <CODE>none</CODE> to disable a color (use the browser default) for a particular
scheme. Remember, the schemes are numbered in the order that they
occur, beginning with 1.
<p>
<XMP>
    Mv_TextColor BEGIN  white none black

</XMP>
<p>
<DT><STRONG>
<EM>Mv_VlinkColor </EM>
</STRONG>
<DD>
Sets the visited link colors to be used in the color schemes. The line
must begin with 'BEGIN', then is followed by up to 15 RGB color
specifications for visited link color. The specification can be in
#RRGGBB color format, or can be one of the colors that will be
recognized (steelblue, white, etc.) Each color should be separated by
one or more spaces. Set to <CODE>none</CODE> to disable a color (use the browser
default) for a particular scheme. Remember, the schemes are numbered in
the order that they occur.
<p>
<XMP>
    Mv_VlinkColor BEGIN  orange none blue

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_newescape_0">
NewEscape</A>

</STRONG>
<DD>
A yes/no directive. When set to <STRONG>Yes</STRONG>, it disallows the old-style
period escaping of one-click search spec strings, and allows
HTTP-style escaping of passed arguments (the <CODE>[page name arg]</CODE>
tag, among others). 
<p>This should probably be set to <CODE>Yes</CODE> for new catalogs.
<p>
<XMP>
    NewEscape  Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_newreport_0">
NewReport</A>

</STRONG>
<DD>
A yes/no directive. When set to <STRONG>No</STRONG>, it allows the old-style
<STRONG>$variable</STRONG> interpolation on MiniVend order reports. Default is
<EM>Yes</EM>, where <STRONG>$variable</STRONG> values are not interpolated with user 
session values (you use the [value variable] tag instead).
<p>The default prevents clashes with embedded Perl code.
<p>
<XMP>
    NewReport  No

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_newtags_0">
NewTags</A>

</STRONG>
<DD>
A yes/no directive. When set to <STRONG>Yes</STRONG>, it defaults all pages to using
the new page syntax. This can be counteracted with an [old] tag at the
very top of the page, or by surrounding older sections of code with the
[compat][/compat] tag pair. Default is <STRONG>No</STRONG>.
<p>
<XMP>
    NewTags    No

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_nocache_0">
NoCache</A>

</STRONG>
<DD>
The names of MiniVend pages that are not to be cached (if <EM>Page Cache</EM>
is being used) or built statically (if 
<A HREF="minivend.html#minivend_static_0">STATIC PAGE BUILDING</A>
 is in use).
If the name is a directory, then no pages in that directory (or any below
it) be cached or built statically.
<p>
<XMP>
    NoCache    ord
    NoCache    special

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_noimport_0">
NoImport</A>

</STRONG>
<DD>
When set to one or more MiniVend database identifiers, 
those database(s) will never be subject to import. Useful for SQL
databases, or databases that will *never* change.
<p>
<XMP>
    NoImport   inventory

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_nontaxablefield_0">
NonTaxableField</A>

</STRONG>
<DD>
The name of the field in the products database that is set (to 1 or yes)
if an item is not to be taxed. Will log an error and tax it anyway
if the field doesn't exist in the database. Blank by default, disabling
the feature.
<p>
<XMP>
    NonTaxableField    wholesale

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_offlinedir_0">
OfflineDir</A>

</STRONG>
<DD>
The location of the offline database files for use with the MiniVend
offline database build command. Set to ``offline'' as the default, and
is relative to VendRoot if there is no leading slash.
<p>
<XMP>
    OfflineDir          /usr/data/minivend/offline

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_oldshipping_0">
OldShipping</A>

</STRONG>
<DD>
Defines compatibility with older MiniVend shipping files -- they will
break if using formulas where <CODE>x</CODE> is used as the substituted-for string
for the accumulated total. A yes/no directive -- default is No.
This will disappear soon.
<p>
<XMP>
    OldShipping  Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_ordercounter_0">
OrderCounter</A>

</STRONG>
<DD>
The name of the file (relative to catalog root if no leading /) that
maintains the order number counter. If not set, the order will be
assigned a string based on the time of the order and the user's
session number.
<p>
<XMP>
    OrderCounter       etc/order.number

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_orderframe_0">
OrderFrame</A>

</STRONG>
<DD>
The frame name where the order page will go, if frames are enabled.
If the frame doesn't exist, a new frame will be created. The default
is '_top', which fills the browser window with the page.
<p>
<XMP>
    OrderFrame          _blank

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_orderlinelimit_0">
OrderLineLimit</A>

</STRONG>
<DD>
The number of items that the user is allowed to place in the shopping
cart.  Some poorly-mannered robots may ``attack'' your site by following
all links one after another. Some even ignore any <CODE>robots.txt</CODE> file you
may have created.  If one of these bad robots orders several dozen or more
items, then the time required to save and restore the shopping cart from
the user session may become excessive.
<p>If the limit is exceeded, then the command defined in the Global directive

<A HREF="minivend.html#minivend_lockoutcommand_0">LockoutCommand</A>
 will be executed and the shopping cart will be emptied.
The default is 0, disabling the check.  Set it to a number greater than
the number of line items you ever expect a user to order.
<p>
<XMP>
    OrderLineLimit   50

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_orderprofile_0">
OrderProfile</A>

</STRONG>
<DD>
Allows an unlimited number of order profiles to be set up, specifying
complex checks to be performed at each of the steps in the checkout process.
The files specified can be located anywhere -- if relative paths
are used, they are relative to the catalog root directory.
<p>
<XMP>
    OrderProfile    prof/order0 prof/order1 prof/order2

</XMP>
<p>They are accessed by setting the 
<A HREF="minivend.html#minivend_mv_order_profile_0">mv_order_profile</A>
 variable to the
name of the order profile. Multiple profiles can
reside in the same file, if separated by __END__ tokens, which must be
on a line by themselves.
<p>The profile is named by placing a name following a __NAME__
pragma:
<p>
<XMP>
  __NAME__ billing

</XMP>
<p>The __NAME__ must begin the line, and be followed by whitespace
and then the name. The search profile can then be accessed by

<A HREF="minivend.html#minivend_mv_order_profile_0">mv_order_profile=``billing''</A>
. See 
<A HREF="minivend.html#minivend_advanced_0">Advanced Multi-level Order Pages</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_orderreport_0">
OrderReport</A>

</STRONG>
<DD>
The location of the simple order report file. Defaults
to 
<A HREF="minivend.html#minivend_etc_0">etc/report</A>
. Not used frequently in later MiniVends, as the
custom order report file is much more flexible.
<p>
<XMP>
    OrderReport          /data/order-form

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pagecache_0">
PageCache</A>

</STRONG>
<DD>
When set to <STRONG>Yes</STRONG>, it will enable the caching of pages if the client
browser has cookie capability. If the page has dynamic elements, it will
not be cached. This can improve performance especially on large pages,
since the page does not have to be parsed every time -- just the first. It
does not make sense to enable this while enabling 
<A HREF="minivend.html#minivend_staticfly_0">StaticFly</A>
 -- however
catalogs with large numbers of items may wish to enable this. A yes/no
directive -- default is No.
<p>
<XMP>
    PageCache  yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pagedir_0">
PageDir</A>

</STRONG>
<DD>
Location of catalog pages. Defaults to the pages subdirectory in the
VendRoot directory.
<p>
<XMP>
    PageDir    /data/catalog/pages

</XMP>
<p>Can be set in the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 settings to allow different page 
sets for different locales (MV3.07 and up).
<p>
<DT><STRONG>

<A NAME="minivend_pgp_0">
PGP</A>

</STRONG>
<DD>
If credit card information is to be accepted, and the emailed order will
go over an insecure network to reach its destination, PGP security should
be used. The key ring to be used must be for the user that is running the
MiniVend server, or defined by the environment variable PGPPATH, and the
key user specified must have a key on the public key ring of that user.
<p>
<XMP>
    PGP        /usr/local/bin/pgp -feat orders@company.com

</XMP>
<p>If this directive is non-null, the PGP command string as specified will be used
to encrypt the <EM>entire order</EM> -- in addition to any encryption done as a
result if 
<A HREF="minivend.html#minivend_creditcardauto_0">CreditCardAuto</A>
, If for some reason an error comes from PGP, the
customer will be given the special page 
<A HREF="minivend.html#minivend_failed_0">failed</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_pageselectfield_0">
PageSelectField</A>

</STRONG>
<DD>
Sets a products database column which can be used to select the
on-the-fly template page. This allows multiple on-the-fly pages to
be defined. If the field is empty (no spaces, either!) then the default
<flypage&gt; will be used.
<p>
<XMP>
    PageSelectField    display_page

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_parsevariables_0">
ParseVariables</A>

</STRONG>
<DD>
Determines whether global and catalog variables will be parsed in the
configuration file. Should be set to No until parsing is needed, 
turned on for the parsed directives, then set back to No.  Default
is No.
<p>
<XMP>
    Variable STORE_ID  topshop
    ParseVariables Yes
    StaticDir  /home/__STORE_ID__/www/cat
    ParseVariables No

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_password_0">
Password</A>

</STRONG>
<DD>
The encrypted password that, when entered and sent as
RECONFIGURE_MINIVEND by the reconfigure program, will be checked
against the user entry to enable reconfiguration.
<p>If you use MiniVend's htpasswd.pl (from 2.03 or higher) it will write
the catalog configuration file if given 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 as the file
name. The demo starts with an encrypted blank password, allowing you
to just hit enter.
<p>
<XMP>
    Password                bAWoVkuzphOX.

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_priceadjustment_0">
PriceAdjustment</A>

</STRONG>
<DD>
A MiniVend item attribute (see 
<A HREF="minivend.html#minivend_usemodifier_0">UseModifier</A>
) which contains a
value upon which a price adjustment to the item may be made.
<p>A common case would be size. For shirts that are size <EM>XXL</EM>, you
might wish to add a dollar to the price for an item. In that case, you
can define a column in the standard pricing database <CODE>pricing</CODE> which
is named ``XXL''. If a value is found in that column it will be added
to the price for the item. Negative numbers result in subtraction if
you wish to reduce the price based on an attribute.
<p>See 
<A HREF="minivend.html#minivend_commonadjust_0">CommonAdjust</A>
 for another scheme that makes the same adjustment
for any item having the attribute -- both schemes cannot be used at the
same time. (This is true even if you were to change the value of 
<STRONG>$Vend::Cfg</STRONG>-&gt;{CommonAdjust} in a subroutine -- the pricing algorithm
is built at catalog startup.)
<p>
<XMP>
    PriceAdjustment   size

</XMP>
<p>Can be set in the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 settings to allow different price
adjustment fields for different currencies (MV3.07 and up).
<p>
<DT><STRONG>

<A NAME="minivend_pricebreaks_0">
PriceBreaks</A>

</STRONG>
<DD>
The quantities where price breaks should be placed. Used to set
up the pricing.asc entries to match actual pricing. Unlimited number
of breaks -- only enter the lowest quantity it applies to.
<p>
<XMP>
    PriceBreaks         10 25 50 100 1000

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_pricecommas_0">
PriceCommas</A>

</STRONG>
<DD>
If you desire no commas in your price numbers (for the [item_price] tag)
set this to <CODE>no</CODE>. The default is to use commas (or whatever is
the thousands separator for your locale).
<p>
<XMP>
    PriceCommas         no

</XMP>
<p>This would be overridden if a 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 
<A HREF="minivend.html#minivend_price_picture_0">price_picture</A>
 is set.
<p>
<DT><STRONG>

<A NAME="minivend_pricedivide_0">
PriceDivide</A>

</STRONG>
<DD>
The number the price should be divided by to get the price
in units (dollars or such). The default is one -- if you use
penny pricing you can set it to 100.
<p>
<XMP>
    PriceDivide         100

</XMP>
<p>Can be set in the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 settings to allow a price
adjustment factor for different currencies (MV3.07 and up).
<p>
<DT><STRONG>

<A NAME="minivend_pricefield_0">
PriceField</A>

</STRONG>
<DD>
The field in the product database that will be accessed with
the [item-price] element. Default is ``price''.
<p>
<XMP>
    PriceField          ProductPrice

</XMP>
<p>Can be set in the 
<A HREF="minivend.html#minivend_locale_0">Locale</A>
 settings to allow different price
fields for different currencies (MV3.07 and up).
<p>
<DT><STRONG>

<A NAME="minivend_productdir_0">
ProductDir</A>

</STRONG>
<DD>
Location of the product files. Defaults to the products subdirectory of
the VendRoot directory. May not be set to an absolute directory unless
NoAbsolute is defined as No.
<p>
<XMP>
    ProductDir          /data/catalog/for-sale

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_random_2">
Random</A>

</STRONG>
<DD>
The Random directive allows you to define an unlimited number of random
messages or image specifications that reside in files. It is called by
the [random] tag. You don't know which one will show up! Even I don't,
it is random. If the file does not exist at program configuration time,
the tag is simply stripped. The line in the 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 file takes
the form of the directive, followed by any number of vend-style file
names (relative to the PageDir, with no .html suffix).
<p>
<XMP>
    Random  rand/message1 rand/message2 rand/message3 rand/message4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_readpermission_0">
ReadPermission and WritePermission</A>

</STRONG>
<DD>
By default, only the user account that MiniVend runs under (as set by the
setuid permission on vlink) can read and write files created by MiniVend.
WritePermission and ReadPermission can be set to <CODE>user</CODE>, <CODE>group</CODE>, or
'world'.
<p>
<XMP>
    ReadPermission      group
    WritePermission     group

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_receiptpage_0">
ReceiptPage</A>

</STRONG>
<DD>
The page to be displayed as a receipt after the user has submitted
an order. Replaces the standard 
<A HREF="minivend.html#minivend_confirmation_0">confirmation</A>
 page. Blank by
default, showing no receipt page to the user. Overridden by the
value of <EM>mv_order_receipt</EM>.
<p>
<XMP>
    ReceiptPage         receipt

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_recorddelimiter_0">
RecordDelimiter</A>

</STRONG>
<DD>
In conjunction with 
<A HREF="minivend.html#minivend_fielddelimiter_0">FieldDelimiter</A>
, allows custom database formats to
be defined. The first string is the database type identifier, and the second
is the record delimiter with C/Perl style double-quoted string format, i.e. \n
is a newline.
<p>
<XMP>
    FieldDelimiter   Tilde   ~
    RecordDelimiter  Tilde   \n
    Database  mydata mydata.txt Tilde

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_remoteuser_0">
RemoteUser</A>

</STRONG>
<DD>
The value of the HTTP environment variable REMOTE_USER that will
enable catalog reconfiguration. You need to enable HTTP basic
authentication for this to work. Default is blank, disabling this
check.
<p>
<XMP>
    RemoteUser   Billyboy

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_reportignore_0">
ReportIgnore</A>

</STRONG>
<DD>
A comma-separated list of items you don't want to have sent by email on
the default order report. Default is blank, or none. Fields beginning with
'mv_', the MiniVend special variables, are automatically ignored. No additional
fields will be used if you are relying on the newer HTML-style order report.
<p>
<XMP>
    ReportIgnore        credit_card_no

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_requiredfields_0">
RequiredFields</A>

</STRONG>
<DD>
A comma-separated list of items you want to make sure the customer fills
in before an order can be submitted. If an empty field is found when
the customer submits the order, the special page 
<A HREF="minivend.html#minivend_needfield_0">needfield.html</A>
 will
be displayed to request that they enter the information. No default. If
custom order profiles are used, this is only done upon the final
placement of the order.
<p>
<XMP>
    RequiredFields      name,company,email,address,city,state,zip

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_robotlimit_0">
RobotLimit</A>

</STRONG>
<DD>
The RobotLimit directive defines the number of consecutive pages a user
session may access without a 30 second pause.  If the limit is exceeded,
then the command defined in the Global directive 
<A HREF="minivend.html#minivend_lockoutcommand_0">LockoutCommand</A>

will be executed. The default is 0, disabling the check.
<p>
<XMP>
    RobotLimit  200

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_rotate_1">
Rotate</A>

</STRONG>
<DD>
The Rotate directive allows you to define an unlimited number of rotating
messages or image specifications that reside in files. It is called by
the [rotate] tag. If the file does not exist at program configuration time,
the tag is simply stripped. The line in the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
 file takes
the form of the directive, followed by any number of vend-style file
names (relative to the PageDir, with no .html suffix).
<p>
<XMP>
    Rotate  rotate/banner1 rotate/banner2 rotate/banner3 rotate/banner4

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_salestax_2">
SalesTax</A>

</STRONG>
<DD>
If non-blank, enables automatic addition of sales tax based on the order
form. The value is a comma-separated list of the field names (as placed
in order.html), in priority order, which should be used to look up sales
tax percentage in the salestax.asc database. This database is not
supplied with MiniVend -- it is typically received from a third party by
quarterly or monthly subscription.
<p>
<XMP>
    SalesTax            zip,state

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_saveexpire_0">
SaveExpire</A>

</STRONG>
<DD>
The length of time that saved sessions will persist before being
expired. See 
<A HREF="minivend.html#minivend_sessionexpire_0">SessionExpire</A>
 for the format. Default is 30 days.
<p>
<XMP>
    SaveExpire    8 weeks

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_scratchdir_0">
ScratchDir</A>

</STRONG>
<DD>
The directory where scratch files will be written, notably cached
searches. Defaults to VendRoot/etc.
<p>
<XMP>
    ScratchDir          /tmp

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchcache_0">
SearchCache</A>

</STRONG>
<DD>
Whether searches will be cached. Caching is disabled for browsers that
don't allow cookies to be set.  A yes/no directive -- default is No. The
cached pages are stored in the directory 
<A HREF="minivend.html#minivend_scratchdir_0">ScratchDir</A>
/SearchCache.
<p>
<XMP>
    SearchCache         Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchframe_0">
SearchFrame</A>

</STRONG>
<DD>
The frame name where search results will go, if frames are enabled.
If the frame doesn't exist, a new frame will be created. The default
is '_self'.
<p>
<XMP>
    SearchFrame         main

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_searchprofile_0">
SearchProfile</A>

</STRONG>
<DD>
Allows an unlimited number of search profiles to be set up, specifying
complex searches based on a single click. The directive accepts a file
name, based in the catalog directory if the path is relative:
<p>
<XMP>
    SearchProfile    etc/search.profiles

</XMP>
<p>As an added measure of control, the specification is evaluated with the
special MiniVend tag syntax to provide conditional setting of search
parameters.
<p>The following file specifies a dictionary-based search in the file
'dict.product':
<p>
<XMP>
  __NAME__ dict_search
  mv_search_file=dict.product
  mv_return_fields=1
  [if value fast_search]
    mv_dict_limit=-1
    mv_last=1
  [/if]
  __END__

</XMP>
<p>The __NAME__ is the value you will specify in the mv_profile variable
on the search form, as in
<p>
<XMP>
  <INPUT TYPE=hidden NAME=mv_profile VALUE="dict_search">

</XMP>
<p>or with mp=profile in the one-click search.
<p>
<XMP>
  [page scan/se=Renaissance/mp=dict_search]Renaissance Art[/page]

</XMP>
<p>Multiple profiles can reside in the same file, if separated by __END__
tokens. __NAME__ tokens should be left-aligned, and __END__ must be on
a line by itself with no leading or trailing whitespace.
<p>
<DT><STRONG>

<A NAME="minivend_secureurl_0">
SecureURL</A>

</STRONG>
<DD>
The base URL for secure forms/page transmissions. Normally it is
the same as 
<A HREF="minivend.html#minivend_vendurl_0">VendURL</A>
 except for the <CODE>https:</CODE> protocol definition.
Default is blank, disabling secure access.
<p>
<XMP>
    SecureURL   https://machine.com/xyzcorp/cgi-bin/vlink

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sendmailprogram_0">
SendMailProgram</A>

</STRONG>
<DD>
The location of the sendmail binary, needed for mailing orders.
Must be found at startup. This often needs to be set for FreeBSD
or BSDI.
<p>
<XMP>
   SendMailProgram    /usr/sbin/sendmail

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_separateitems_0">
SeparateItems</A>

</STRONG>
<DD>
Changes the default when ordering an item via MiniVend to allowing multiple
lines on the order form for each item. The default, <CODE>No</CODE>, puts all
orders with the same part number on the same line. 
<p>Setting SeparateItems to <CODE>Yes</CODE> allows the item attributes to be
easily set for different instances of the same part number, allowing
easy setting of things such as size or color.
<p>
<XMP>
    SeparateItems       Yes

</XMP>
<p>Can be overridden with the <EM>mv_separate_items</EM> variables (both
scratch and user).
<p>
<DT><STRONG>

<A NAME="minivend_sessiondatabase_0">
SessionDatabase</A>

</STRONG>
<DD>
When storing sessions in a DBM database, specify the base name of the
DBM file to use. The file extensions of .pag, .dir, .db, or .gdbm
(depending on the DBM implementation used) will be appended.
<p>
<XMP>
    SessionDatabase     session-data

</XMP>
<p>It is possible for multiple catalogs to share the same session file. This
allows a ``mall'' to be set up where many store fronts use a common ordering
point. It would be wise to share the order pages, salestax database,
and shipping database if that is the case. You will also need to set

<A HREF="minivend.html#minivend_sessionlockfile_0">SessionLockFile</A>
 appropriately if the database is to be shared. Defaults
to 
<A HREF="minivend.html#minivend_session_1">session</A>
, which is appropriate for separate session files (and
therefore standalone catalogs). Can be an absolute path name if desired.
<p>
<DT><STRONG>

<A NAME="minivend_sessionexpire_0">
SessionExpire</A>

</STRONG>
<DD>
A customer can exit their browser or leave the catalog pages at any time,
and no indication is given to the HTTPD server aside from the lack of
further requests that have the same session id. Old session information
needs to be periodically expired. The SessionExpire specifies the
minimum time to keep track of session information. Defaults to one day.
Format is an integer number, followed by s(econds), m(inutes), h(ours),
d(ays), or w(eeks).
<p>
<XMP>
    SessionExpire       4 hours

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sessionlockfile_0">
SessionLockFile</A>

</STRONG>
<DD>
The file to use for locking coordination of the sessions.
<p>
<XMP>
    SessionLockFile     session-data.lock

</XMP>
<p>It is possible for multiple catalogs to share the same session file.
You will also need to set 
<A HREF="minivend.html#minivend_sessiondatabase_0">SessionDatabase</A>
 appropriately if the
database is to be shared. Defaults to 
<A HREF="minivend.html#minivend_session_1">session.lock</A>
, which is
appropriate for separate session files (and therefore standalone
catalogs). Can be an absolute path name if desired.
<p>
<DT><STRONG>

<A NAME="minivend_shipping_4">
Shipping</A>

</STRONG>
<DD>
Specifies a shipping charge to add onto the total price for items
ordered. If you do not want to include a fixed shipping charge on the
order page, leave this 0 and do not include the [shipping] element in
the order page. Defaults to 0. Overridden by the 
<A HREF="minivend.html#minivend_customshipping_0">CustomShipping</A>

directive.
<p>
<XMP>
    Shipping            5.00

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_specialpage_0">
SpecialPage</A>

</STRONG>
<DD>
Sets a special page to other than its default value. Can be set as
many times as necessary -- will have no effect if not one of the
MiniVend 
<A HREF="minivend.html#minivend_required_0">Required Pages</A>
.
<p>
<XMP>
    SpecialPage         checkout ord/checkout
    SpecialPage         failed special/error_on_order
    SpecialPage         interact special/browser_problem
    SpecialPage         noproduct special/no_product_found
    SpecialPage         order  ord/basket
    SpecialPage         search srch/results

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_static_1">
Static</A>

</STRONG>
<DD>
A yes/no directive.
Enables static page building and display features. Default is <CODE>no</CODE>.
<p>
<XMP>
     Static   Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticall_0">
StaticAll</A>

</STRONG>
<DD>
A yes/no directive.
Tells MiniVend to try and build all pages in the catalog statically
when called with the static page build option. This is subject to the
settings of 
<A HREF="minivend.html#minivend_staticfly_0">StaticFly</A>
, 
<A HREF="minivend.html#minivend_staticpath_0">StaticPath</A>
, and 
<A HREF="minivend.html#minivend_nocache_0">NoCache</A>
. Default is No.
(Of course pages that have dynamic elements will not be built statically,
though that may be overridden with [tag flag build][/tag] on the page
in question.)
<p>
<XMP>
     StaticAll   Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticdepth_0">
StaticDepth</A>

</STRONG>
<DD>
The number of levels of static search building that will be done
if a search results page contains a search. Default is one -- beware
that it could be very long if you set it higher. Set to 0 to disable
re-scanning of search results pages.
<p>
<XMP>
     StaticDepth 2

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticdir_0">
StaticDir</A>

</STRONG>
<DD>
The absolute path of the directory which should be used as the root
for static pages. The user ID executing MiniVend must have write permission
on the directory (and all files within) if this is to work.
<p>
<XMP>
     StaticDir   /home/you/www/catalog

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticfly_0">
StaticFly</A>

</STRONG>
<DD>
A yes/no directive. If set to <CODE>Yes</CODE>, static builds will attempt to generate
a page for every part number in the database using the on-the-fly page build
capability. If pages are already present with those names, they will be 
overwritten. The default is <CODE>No</CODE>.
<p>
<XMP>
     StaticFly   Yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticpage_0">
StaticPage</A>

</STRONG>
<DD>
Tells MiniVend to build the named page (or pages, whitespace separated)
when employing the static page-building capability of MiniVend. Not necessary
if using StaticAll.
<p>
<XMP>
     StaticPage   info/about_us  info/terms_and_conditions

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticpath_0">
StaticPath</A>

</STRONG>
<DD>
The path (relative to HTTP document root) which should be used
in pages built with the static page-building capability of MiniVend.
<p>
<XMP>
     StaticPath    /catalog

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticpattern_0">
StaticPattern</A>

</STRONG>
<DD>
A perl regular expression which is used to qualify pages that are to
be built statically. The default is blank, which means all pages qualify.
<p>
<XMP>
     StaticPattern  ^info|^help

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_staticsuffix_0">
StaticSuffix</A>

</STRONG>
<DD>
The extension to be appended to a normal MiniVend page name when building
statically. Default is <CODE>.html</CODE>.  Also affects the name of pages in the
MiniVend page directory -- if set to .htm the pages must be named with that
extension.
<p>
<XMP>
     StaticSuffix   .htm

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_sub_1">
Sub</A>

</STRONG>
<DD>
Defines a catalog subroutine for use by the B<[perl sub] subname
arg [/perl]&gt; construct. Use the ``here document'' capability of MiniVend
configuration files to make it easy to define:
<p>
<PRE>
    Sub &lt;&lt;EOF
    sub sort_cart {
        my(%items) = @_;
        my($item,$name);
        my $out = '&ltTABLE BORDER=1>';
        foreach $name (sort keys %items) {
            $out .= '&lt;TR>&lt;TD>';
            $out .= $items{$name};
            $out .= '&lt;/TD>&lt;TD>';
            $out .= $name;
            $out .= '&lt;/TD>&lt;/TR>';
        }
        $out .= '&lt/TABLE>';
        return $out;
    }
    EOF

</PRE>
<p>As with Perl ``here documents'', the EOF (or other end marker) must be the
ONLY thing on the line, with no leading or trailing white space. Do not
append a semicolon to the marker.
<p>The above would be called with:
<p>
<XMP>
    [perl sub]
        sort_cart ( [item-list]
                        "[item-description]", "[item-code]",
                    [/item-list] )
    [/perl] 

</XMP>
<p>and will display an HTML table of the items in the current shopping cart,
sorted by the description. (Using an alternative form of quoting such
as q{ } will minimize problems with quotes in the passed parameters --
you may use any style you like, including here documents. Syntax errors
will be reported to 
<A HREF="minivend.html#minivend_error_log_0">error.log</A>
.)
<p>Catalog subroutines may not perform unsafe operations -- the <EM>Safe.pm</EM>
module enforces this.
<p>
<DT><STRONG>

<A NAME="minivend_subargs_0">
SubArgs</A>

</STRONG>
<DD>
Standard arguments that should be supplied to any routine with
a name as defined.
<p>Defining 
<p>
<XMP>
    SubArgs passwd values cgi

</XMP>
<p>and calling the routine with
<p>
<XMP>
    [perl sub]
        passwd ('[value username]', '[value password])
    [/perl]

</XMP>
<p>is the same as calling
<p>
<XMP>
    [perl sub values cgi]
        passwd ('[value username]', '[value password])
    [/perl]

</XMP>
<p>This can make calling routines more natural, and is especially
useful in combination with 
<A HREF="minivend.html#minivend_mv_subroutine_0">mv_subroutine</A>
.
<p>
<DT><STRONG>

<A NAME="minivend_taxshipping_0">
TaxShipping</A>

</STRONG>
<DD>
A comma or space separated list of states or jurisdictions that
tax shipping cost, i.e. UT. Blank by default, never taxing shipping.
<p>
<XMP>
    TaxShipping         UT,NV,94024

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_tracking_1">
Tracking</A>

</STRONG>
<DD>
This option is removed in MiniVend 3.0. It will provide a warning,
but will not stop the catalog from becoming operational.
<p>Most users now use the simpler and more flexible 
<A HREF="minivend.html#minivend_easy_1">Easy ASCII Tracking</A>

capability.
<p>
<DT><STRONG>

<A NAME="minivend_transparentitem_0">
TransparentItem</A>

</STRONG>
<DD>
When set to the name of a product attribute (which must be defined
in the directive 
<A HREF="minivend.html#minivend_usemodifier_0">UseModifier</A>
, and that attributes evaluates to 
true (yes, true, or 1, not case-sensitive), that item will not be
shown on 
<A HREF="minivend.html#minivend_item_0">Item Lists</A>
.
<p>
<XMP>
    TransparentItem          option

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_upszonefile_0">
UpsZoneFile</A>

</STRONG>
<DD>
The file containing the UPS zone information,  specified relative to
the catalog directory unless it begins with a /. It can be in the format
distributed by UPS (for 1997, at least) -- or can be in a tab-delimited
format, with the three-letter zip prefix of the customer used to determine
the zone. It interpolates based on the value in <EM>mv_shipmode</EM>. A user
database <STRONG>named the same as the mv_shipmode variable</STRONG> must be present
or the lookup will return zero.
<p><IMPORTANT NOTE:&gt; You must obtain the zone information and updated
pricing from UPS in order for this to work properly. The zone information
is specific to your region!
<p>
<XMP>
    UpsZoneFile         /usr/minivend/data/ups_zone.asc

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_usecode_0">
UseCode</A>

</STRONG>
<DD>
This determines whether the part number field in the ASCII product file
will be used to determine the link to the item for the [item_link] tag.
If set, this has the effect of creating a different HTML page link for
every part number. If not set (the default), the [item_link] tag
uses the value of the last field in the ASCII product file as the link
value. This option is largely deprecated by the on-the-fly page building
facility.
<p>
<XMP>
    UseCode             yes

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_usemodifier_0">
UseModifier</A>

</STRONG>
<DD>
Determines whether any attributes, the modifiers specified in the
directive, can be attached to the item. See 
<A HREF="minivend.html#minivend_item_1">Item Attributes</A>
. The
default is no modifier. Don't use a value of <CODE>quantity</CODE> -- it will not
do what you want.
<p>
<XMP>
    UseModifier         size,color

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_variable_0">
Variable</A>

</STRONG>
<DD>
Defines a catalog variable that will be available in the current catalog
with the notation __Variable__. Variable identifiers must begin with
a capital letter, and can contain only word characters (<STRONG>A-Z,a-z,0-9</STRONG> and
underscore).  These are substituted second (right after global Variables)
in any MiniVend page, and can contain any valid MiniVend tags except
global variables.
<p>
<XMP>
    Variable   DOCUMENT_ROOT   /usr/local/etc/httpd/htdocs

</XMP>
<p>
</DL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_administering_0">
ADMINISTERING MINIVEND</A>
</H1>
Many utilities are supplied in the VendRoot/bin directory:
<p>
<XMP>
  start        Symbolic link to start_unix or start_inet
  stop         Stops the server
  start_inet   Starts the server in INET mode
  start_unix   Starts the server in UNIX mode
  restart      Symbolic link to restart_unix or restart_inet
  restart_inet Re-starts the server in INET mode
  restart_unix Re-starts the server in UNIX mode
  dump         Dumps the session file for a particular catalog
  expire       Expires sessions for a particular catalog
  reconfig     Runtime reconfiguration of catalogs
  check        Template script to monitor server health
  checkstat.sh Template script to monitor server upness
  htpasswd.pl  Program to create .htpasswd files
  offline      Does offline build of the database(s)
  update       Does in-place update of the database(s)
  makecat      Make catalog
  localize     Help build a locale file from MiniVend pages

</XMP>
<p>Some thought should be given to where the databases, error logs,
and session files should be located, especially on an ISP that
might have multiple users sharing a MiniVend server. In
particular, you might put all of the session files and logs
in a directory that is not writable by the user -- if the
directory or file is corrupted the catalog may go down.
<p>To test the format of user catalog configuration files before
restarting the server, you can do (from VendRoot):
<p>
<XMP>
    minivend -test

</XMP>
<p>That will check all configuration files for syntax errors, which
might otherwise prevent a catalog from coming up. Once a catalog
configures properly, user reconfiguration will not crash it, just
cause an error. But it must come up when the server is started.
<p>
<H2> 
<A NAME="minivend_starting_0">
Starting, Stopping, and Re-starting the Servers</A>
</H2>
The following commands need to have VENDROOT changed to the
main directory where you installed MiniVend. If you made /home/minivend
your MiniVend base directory, the start command would be
/home/minivend/bin/start.
<p>To start the server:
<p>
<XMP>
    VENDROOT/bin/start
          or 
    VENDROOT/bin/minivend -serve

</XMP>
<p>Assuming the server starts correctly, you will see the names of
catalogs as they are configured, along with a message stating
the process ID it is running under.
<p>To re-start the server:
<p>
<XMP>
    VENDROOT/bin/restart
          or 
    VENDROOT/bin/stop; VENDROOT/bin/minivend -serve

</XMP>
<p>This is typically done to force MiniVend to re-read its configuration.
You will see a message stating that a TERM signal has been sent to the
process ID the servers are running under -- that information is also
sent to /home/minivend/error.log. Check the error.log file for
confirmation that the server has restarted properly.
<p>To stop the server:
<p>
<XMP>
    VENDROOT/bin/stop

</XMP>
<p>You will see a message stating that a TERM signal has been sent to
the process ID the server is running under -- that information is also sent
to /home/minivend/error.log. 
<p>Because processes waiting for selection on some operating systems block
signals, they may have to wait for 
<A HREF="minivend.html#minivend_housekeeping_0">HouseKeeping</A>
 seconds to stop. The
default is 60.
<p>
<H2> 
<A NAME="minivend_unix_0">
UNIX and INET modes</A>
</H2>
As of MiniVend 3.00, both UNIX-domain (the default) or INET-domain
sockets can be used for communication. INET domain sockets are useful
when more than one server, connected via a local-area network (LAN),
is used for accessing a MiniVend server.
<p><STRONG>IMPORTANT NOTE:</STRONG> When sending sensitive information like credit card
numbers over a network, always ensure that the data is secured by a firewall,
or that the MiniVend server runs on the same machine as any SSL-based
server used for encryption.
<p>If you only want to run with one method of communication, use the
<CODE>-</CODE>i and <CODE>-</CODE>u flags.
<p>
<XMP>
    # Start only in UNIX mode
    VENDROOT/bin/start -u
    # Start only in INET mode
    VENDROOT/bin/start -i

</XMP>
<p>
<H2> 
<A NAME="minivend_user_2">
User reconfiguration</A>
</H2>
The individual catalogs can be reconfigured by the user by running
the reconfig command. At least one check must be made to authenticate --
by coming from a particular host (see 
<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
), having validated
by HTTP basic authorization (see 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>
), or by password entry
(see 
<A HREF="minivend.html#minivend_password_0">Password</A>
). The ideal way to use it is in combination with
HTTP basic authorization to allow remote reconfiguration by web
browser. It is possible at that point to have a completely FTP-
and HTTP-configured catalog.
<p>A 
<A HREF="minivend.html#minivend_reconfig_0">reconfig</A>
 script is included with the demo catalogs, set up
with the 
<A HREF="minivend.html#minivend_password_0">Password</A>
 method of authentication and a blank password,
suitable for the user to reconfigure the catalog from a Unix shell.
To set it up as a CGI, use the 
<A HREF="minivend.html#minivend_masterhost_0">MasterHost</A>
 or 
<A HREF="minivend.html#minivend_remoteuser_0">RemoteUser</A>

authentication methods.
<p>
<H2> 
<A NAME="minivend_making_0">
Making the Product Database</A>
</H2>
The DBM product databases can be built offline with the <CODE>offline</CODE>
command. The directory to be used for output is specified either on
the command line with the -d option, or is taken from the 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>

directive 
<A HREF="minivend.html#minivend_offlinedir_0">OfflineDir</A>
 -- <CODE>offline</CODE> in the catalog directory by default.
The directory must exist. The source ASCII files should be present in
that directory, and the DBM files are created there. Existing files
will be overwritten.
<p>
<XMP>
    offline -c catalog [-d offline_dir]

</XMP>
<p>
<H2> 
<A NAME="minivend_updating_1">
Updating Individual Records</A>
</H2>
If you have a very large DBM database that takes a long time to build,
you may want to use the <CODE>bin/update</CODE> script to change just one field
in a record, or to add from a corrections list.
<p>The following updates the products database <CODE>price</CODE> field for
item 19-202 with the new value 25.00
<p>
<XMP>
    update -c catalog -f price 25.00

</XMP>
<p>More than one field can be updated on a single command line
<p>
<XMP>
    update -c catalog -f price -f comment 25.00 "That pitchfork couple"

</XMP>
<p>The following takes input from 
<A HREF="minivend.html#minivend_file_1">file</A>
, which must be
<STRONG>formatted exactly like the original database</STRONG>
and adds/corrects any records contained therein.
<p>
<XMP>
    update -c catalog -i file

</XMP>
<p>Invoke the command without any arguments for a usage message
describing the options.
<p>
<H2> 
<A NAME="minivend_expiring_0">
Expiring Sessions</A>
</H2>
You should periodically expire old sessions to keep the session
database file from growing too large. 
<p>
<XMP>
    expire -c catalog

</XMP>
<p>You could add a crontab entry such as the following:
<p>
<XMP>
    # once a day at 4:40 am
    40 4 * * *    perl /home/minivend/bin/expire -c catalog

</XMP>
<p>MiniVend will wait until the current transaction is finished before
expiring, so you can do this at any time without disabling web access.
Any search paging files for the affected session (kept in 
<A HREF="minivend.html#minivend_scratchdir_0">ScratchDir</A>
)
will be removed as well.
<p><p><hr>

<H1> 
<A NAME="minivend_debugging_0">
DEBUGGING</A>
</H1>
As of version 3.06, MiniVend allows you to see debugging information
based on the state of several controls.
<p>MiniVend comes with debugging output disabled by default -- this is
for speed and code compactness.  To enable debugging, change directory
to the MiniVend root (the software directory) and run:
<p>
<XMP>
    # Must change to MiniVend software directory first!
    bin/ifdef -y -t DEBUG

</XMP>
<p>This only works for MiniVend 3.06 and above. Earlier MiniVend versions
have only a crude debug available with the -D startup options.
<p>To disable, use the command
<p>
<XMP>
    # Must change to MiniVend software directory first!
    bin/ifdef -n -t DEBUG

</XMP>
<p>Note that some warnings may be generated by the debugging itself, typically
``use of unitialized variable'' warnings generated by undefined debug references.
You can safely ignore these if they occur pointing to lines where the
logDebug routine is called.
<p>
<DL COMPACT>
<DT><STRONG>
<EM>-Dnnnn</EM>
</STRONG>
<DD>
If you start MiniVend with the -D option, it will run in the foreground
and extensive debug information will be output on the terminal that started
the program.  If <CODE>nnnn</CODE>, a numeric option set, is present, that debug level
will be set. The default level is 4097, running in the foreground with only
a few debug outputs (normal mode) present. If you want to run in the foreground
with maximum information, use the level 4351.
<p>IMPORTANT NOTE: This may affect some program operations. If something new fails in
debug mode, try it again in normal background server mode. In particular, changes
to the configuration made on the fly in the page will stick since the process
is not forked.
<p>
<DT><STRONG>

<A NAME="minivend_tag_3">
[tag flag debug] level1 level2 ... [/tag]</A>

</STRONG>
<DD>
This sets the debug level in the page. If you want to see what is happening
with a particular type of operation, the debug levels are:
<p>
<XMP>
    DESCRIPTION           NUM  TEXT    DISABLE
    -----------           ---  -----   -----
    Disable all debug       0  off     N/A
    Normal operations       1  normal  !normal
    Tag interpretation      2  tag     !tag
    Database operations     4  data    !data
    Configuration info      8  config  !config
    Search operations      16  search  !search
    Session operations     32  session !session
    Server operations      64  server  !server
    Cache/benchmark       128  cache   !cache
    Show calling package  512  caller  !caller
    Show in page comment 1024  comment !comment
    Place in mvdebug     2048  N/A     N/A
    Run in foreground    4096  N/A     N/A
 
    Verbose in HTML      2047 
    Verbose foreground   5119

</XMP>
<p>NOTE: The text levels only operate in conjunction with [tag flag debug].
<p>If you want to output the debug information embedded in an HTML comment
at the end of the page you get from your browser, add level 1024. This
overrides the output to mvdebug temporarily, or to foreground output
indefinitely, if those are enabled.
<p>Use this to set verbose but no tag details, with output to HTML:
<p>
<XMP>
    [tag flag debug]comment verbose !tag[/tag]

</XMP>
<p>Use this to look at only database operations, with output to HTML:
<p>
<XMP>
    [tag flag debug]comment !verbose data[/tag]

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_minivend_debug_0">
MINIVEND_DEBUG environment variable</A>

</STRONG>
<DD>
Prior to starting the server, you can determine the level to run at by
setting the environment variable 
<A HREF="minivend.html#minivend_minivend_debug_0">MINIVEND_DEBUG</A>
. It is an ANDed set
of debug levels yielding a decimal number.  For example, to show debug
information in HTML comments with maximum verbosity, use one of the
following command prior to starting the MiniVend daemons:
<p>
<XMP>
   # UNIX C-shell types (tcsh, csh, etc.)
   setenv MINIVEND_DEBUG 1279
   # UNIX Bourn-shell types (bash, sh, ksh, etc.)
   MINIVEND_DEBUG=1279
   export MINIVEND_DEBUG
   # Windows/DOS command box
   set MINIVEND_DEBUG=1279

</XMP>
<p>
<DT><STRONG>

<A NAME="minivend_debugmode_0">
DebugMode directive</A>

</STRONG>
<DD>
The debug mode can be set both globally (in 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
) and for
each catalog (in 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
) with the DebugMode directive, with
levels as above.
<p>
<DT><STRONG>

<A NAME="minivend_displayerrors_0">
DisplayErrors</A>

</STRONG>
<DD>
To enable display of fatal errors (those things that would normally cause
a 500 server error) then the DisplayErrors directive must be set to <CODE>Yes</CODE>
in <STRONG>both</STRONG> 
<A HREF="minivend.html#minivend_minivend_cfg_0">minivend.cfg</A>
 and 
<A HREF="minivend.html#minivend_catalog_cfg_0">catalog.cfg</A>
. Debug information will be 
included if available and level 1024 is set.
<p>The debug mode of 8192 will enable DisplayErrors for every catalog.
<p>
</DL>
.
<p><p><hr>

<H1> 
<A NAME="minivend_manual_0">
MANUAL INSTALLATION OF CATALOGS</A>
</H1>
A MiniVend installation is complex, and requires quite a few distinct
steps. That is why there is an interactive configuration script that is
included with MiniVend -- it merely does automatically what is described
below. It makes the process much easier, and will install the demo
catalog. This configuration script has been tested on many UNIX systems.
<p>The installation program (makecat) can be used to install your own
custom catalog template.  See the supplied demo template

<A HREF="minivend.html#minivend_simple_0">simple</A>
 for examples.
<p>
<H2> 
<A NAME="minivend_needed_0">
Needed Directories</A>
</H2>
The MiniVend program, and its supporting libraries, should all
go into one directory as installed by the installation program.
<p>User catalog pages, user databases, and user configuration files should
all go into their private directories. Because the catalog pages are
served through the MiniVend cgi-bin program and contain nonstandard
elements, they should not be put into a public WWW directory, nor do
they need to have world-readable file permissions.
<p><STRONG>IMPORTANT NOTE</STRONG>: As of MiniVend 2.0, since catalogs are all run
under one server, permissions are complex and very important.
Please let the MiniVend configuration program do the work!
<p>You will want a public WWW directory for in-line image graphic files.
MiniVend does not serve the images, only the HTML tags calling them. A
useful convention is to place all buttonbars, backgrounds, and icons in
the /images directory, with the catalog items perhaps located in the
/images/catalog directory. It is up to you, but remember that you must
use an <EM>absolute path</EM> -- relative paths will not do. MiniVend 2.0
supports the 
<A HREF="minivend.html#minivend_imagedir_0">ImageDir</A>
 directive, which places that as the
absolute path in front of all relative IMG and INPUT SRC specifications.
<p>You will need a cgi-bin directory in which to put the vlink or tlink program.
<p>
<H2> 
<A NAME="minivend_the_10">
The Demo Systems</A>
</H2>
Sample catalog pages are in the directory simple/. If you would like to
use them as a starting point for your own catalog, you can either have
the configure script install the demo for you, or you can copy the files
into the MiniVend directory and your HTML directory.
<p>To install the demo:
<p>
<XMP>
 bin/makecat simple

</XMP>
<p>Answer the prompts supplied by the program. Note that there are
two types of paths asked for, URL paths like the /cgi-bin inside
<A HREF="http://www.machine.com/cgi-bin/simple">http://www.machine.com/cgi-bin/simple</A>, and file paths that are
complete fully-qualified file path names.
<p>
<H2> 
<A NAME="minivend_setting_5">
Setting up VLINK and TLINK</A>
</H2>
The <CODE>vlink</CODE> and <CODE>tlink</CODE> programs, compiled from <CODE>vlink.c</CODE> and
<CODE>tlink.c</CODE>, are small C programs which contact and interface to a running
MiniVend daemon. The vlink executable is normally made setuid to the
user account which runs MiniVend, so that the UNIX-domain socket file
can be set to secure permissions (user read-write only). It is normally
not necessary for the user to do anything -- they will be compiled by
the configuration program. If the MiniVend daemon is not running, either
will display a message indicating that the server is not available.
The following defines in the produced 
<A HREF="minivend.html#minivend_config_1">config.h</A>
 should be set:
<p>
<DL COMPACT>
<DT><STRONG>

<A NAME="minivend_link_file_0">
LINK_FILE</A>

</STRONG>
<DD>
Set this to the name of the socket file that will be used for
configuration, usually ``/usr/local/lib/minivend/etc/socket'' or the
``etc/socket'' under the directory you chose for the VendRoot.
<p>
<DT><STRONG>

<A NAME="minivend_link_host_0">
LINK_HOST</A>

</STRONG>
<DD>
Set this to the IP number of the host which should be contacted. 
The default of 127.0.0.1 (the local machine) is probably best for
most installations.
<p>
<DT><STRONG>

<A NAME="minivend_link_port_0">
LINK_PORT</A>

</STRONG>
<DD>
Set this to the TCP port number that the MiniVend server will monitor.
The default is 7786 (the ASCII codes for 'M' and 'V') and does not
normally need to be changed. 
<p>
<DT><STRONG>

<A NAME="minivend_link_timeout_0">
LINK_TIMEOUT</A>

</STRONG>
<DD>
Set this to the number of seconds vlink or tlink should wait before
announcing that the MiniVend server is not running. The default of 45
is probably a reasonable value.
<p>
</DL>
.
<p>
<H2> 
<A NAME="minivend_compiling_0">
Compiling VLINK and TLINK</A>
</H2>
Change directories to the <CODE>src</CODE> directory, then run the GNU
configure script:
<p>
<XMP>
    cd src
    ./configure

</XMP>
<p>You will see some output as the configure script checks your system.
Then compile the programs:
<p>
<XMP>
    cc vlink.c -o vlink
    cc tlink.c -o tlink

</XMP>
<p>You can ensure your C compiler will be invoked properly with this
little ditty:
<p>
<XMP>
    perl -e 'do "syscfg"; system("$CC $LIBS $CFLAGS $DEFS -o tlink tlink.c");'
    perl -e 'do "syscfg"; system("$CC $LIBS $CFLAGS $DEFS -o vlink vlink.c");'

</XMP>
<p>On some systems you can make the executable smaller with the strip
program. But don't worry about it if strip is not on your system.
<p>
<XMP>
    strip vlink
    strip tlink

</XMP>
<p>If you want MiniVend to run under a different user account than your own,
make that user the owner of vlink. (You probably need to be root to do
this). Do not make vlink owned by root, because making vlink setuid
root is an huge and unnecessary security risk. It should also <STRONG>not</STRONG>
normally run as the default WWW user (often <CODE>nobody</CODE> or <CODE>http</CODE>)).
<p>
<XMP>
    chown minivend vlink

</XMP>
<p>Move the vlink executable to your cgi-bin directory:
<p>
<XMP>
    mv vlink /the/cgi-bin/directory

</XMP>
<p>Make vlink setuid:
<p>
<XMP>
    chmod u+s /the/cgi-bin/directory/vlink

</XMP>
<p>Most systems unset the SUID bit when moving the file, so you should
change it after moving.
<p>The SCRIPT_NAME as produced by the HTTP server must match the name
of the program. (As usual, you should let the makecat program do
the work.)
<p><p><hr>

<H1> 
<A NAME="minivend_author_0">
AUTHOR</A>
</H1>
Mike Heins, <EM><A HREF="MAILTO:mike@minivend.com">mike@minivend.com</A></EM>.
<p><p><hr>

<H1> 
<A NAME="minivend_acknowledgements_0">
ACKNOWLEDGEMENTS</A>
</H1>
Original author of Vend was Andrew Wilcox. MiniVend was based on Vend 0.2,
with portions from Vend 0.3.
<p>
</BODY>
</HTML>
