mod_interchange
===============

$Id$

Version: 1.22

Description
-----------

mod_interchange is designed to replace the vlink and tlink programs
that comes with Interchange.  The Interchange link protocol has been
 implemented via an Apache module which saves us the (small) overhead
of the execution of a CGI program.

Building the module
-------------------

The included Makefile builds the module as a DSO object. So if
you're Apache has mod_dso.so configured you can do

    make
    make install

If not, you should be able to copy the file mod_interchange.c under
src/modules/extra and add the line when building Apache:

    --activate-module=src/modules/extra/mod_interchange.c


Installing the module as a DSO object
-------------------------------------

Copy mod_intercange.so into your Apache DSO library directory and
add the following lines to your httpd.conf:

    LoadModule interchange_module /wherever/lib/apache/mod_interchange.so
    AddModule mod_interchange.c


Documentation
-------------

The module understands directives which specify the way to contact the
primary, and possibly a secondary, Interchange server.  The InterchangeServer
directive takes either a pathname to the Interchange UNIX socket or a
host:port specification if you want to use INET mode.

The optional InterchangeServerBackup directive takes the same arguments,
but should obviously point to a different Interchange server than the
primary.  The InterchangeServerBackup directive is only of any use if
you have multiple Interchange servers configured in a clustered environment.

Note: The Apache <Location> path should not contain a dot (.) or any
other characters except A-Z, a-z, 0-9 or a hyphen (-), so:

	<Location /shop.name> is invalid, whereas:
	<Location /shop-name> is valid.


Examples
--------

UNIX mode local connection:

    <Location /shop>
	SetHandler interchange-handler
	InterchangeServer /opt/interchange/etc/socket
    </Location>

INET mode local connection:

    <Location /shop>
	SetHandler interchange-handler
	InterchangeServer localhost:7786
    </Location>

UNIX mode local primary connection and INET mode remote backup connection:

    <Location /shop>
	SetHandler interchange-handler
	InterchangeServer /opt/interchange/etc/socket
	InterchangeServerBackup another.server.com:7786
    </Location>

If the <Location> has more than one directory level in the URI path then the
URILevels parameter will need to be specified in order for full path to be
passed to Interchange.  URILevels defaults to 1, if not specified.
Here is an example:

    <Location /somepath/shop>
	SetHandler interchange-handler
	InterchangeServer localhost:7786
	URILevels 2
    </Location>

The ConnectTries parameter specifies the number of connection attempts to
make before giving up.  ConnectRetryDelay specifies the delay, in seconds,
between each retry attempt.

The ConnectTries default is 10 and the ConnectRetryDelay default is 2 seconds.
Here is an example:

    <Location /shop>
	SetHandler interchange-handler
	InterchangeServer localhost:7786
	ConnectTries 10
	ConnectRetryDelay 1
    </Location>

The DropRequestList allows a list of up to 10 space-separated URI components
to be specified.  If one of the list entries is found anywhere in the
requested URI, the request will be dropped with a 404 (not found) error,
without the request being passed to Interchange.  This parameter is useful
for blocking known Microsoft IIS attacks like "Code Red", so that we don't
waste any more time processing the (bogus) requests than we have to.

    <Location /shop>
	SetHandler interchange-handler
	InterchangeServer localhost:7786
	DropRequestList /default.ida /x.ida /cmd.exe /root.exe
    </Location>


Bugs
----

Send bug reports and suggestions to Kevin Walsh <kevin@cursor.biz>


Copyright and License
---------------------

Copyright (c) 1999 Francis J. Lacoste and iNsu Innovations Inc.
Copyright (c) 2000-2002 Cursor Software Limited.
All rights reserved.

This program is free software.  You can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation.  You may refer to either version 2 of the
License or (at your option) any later version.
