#
# position: 88
# description: Order routing information
# url: http://interchange.redhat.com/cgi-bin/ic/dev/icdatabase_57.html
#

ParseVariables Yes

# Default PGP/GPG key ID for encryption.
# Can be email address (if unique on keyring) or the key ID.
#
# Examples:
# 
# EncryptKey   milton@minivend.com
#   or
# EncryptKey   0x7862F42D
#EncryptKey   NOT_SET

# This prevents a user from setting this value, you may want to unset
# this if you have user-selectable handling charges like insurance.
FormIgnore   mv_handling

# Along these lines further, for better integrity and less chance of a 
# user screwing up your order routes:
# Note that __ORDER_ROUTES__ is empty by default, default Route "default"
# is used with cascades.
FormIgnore   mv_order_route 

# This is the default, but the real destination is usually set in the order
# route....
MailOrderTo  __ORDERS_TO__

# This route places the order entry in the database. If you don't
# have an inventory table (or a userdb table for that matter) make
# sure you remove it from the list of "transactions" tables.
Route log  <<EOF
	empty        1
	encrypt      0
	increment    0
	report       etc/log_transaction
	supplant     0
	track        logs/log
EOF

# This route places the order entry in the database when you are
# entering an order from the admin. See above.
Route log_entry  <<EOF
	empty        1
	encrypt      0
	report       etc/log_entry
	supplant     0
	track        logs/log
EOF

Variable TRANSACTION_TABLES userdb orderline transactions
ifdef TRANSACTION_TABLES
Route log       transactions '__TRANSACTION_TABLES__'
Route log_entry transactions '__TRANSACTION_TABLES__'
endif

# This route copies the user if they requested that. We don't
# care (much) if it fails, so error_ok is set and failure will
# not cause the order to fail.
Route copy_user  <<EOF
	empty        1
	error_ok     1
	encrypt      0
	increment    0
	report       etc/mail_receipt
	supplant     0
	track        logs/log
EOF

# This route emails the order to you unless email is set to "",
# and failsafe-logs the order report a couple of places.
Route main  <<EOF
	attach            0
	credit_card       1
	default           1
	email             '__ORDERS_TO__'
	encrypt           0
	errors_to         '__ORDERS_TO__'
	receipt           etc/receipt.html
	report            etc/report
	supplant          1
	individual_track  orders
	track             logs/tracking.asc
EOF

# Order routes can be maintained in a database
# CHANGES TO THIS WILL OVERRIDE THE ROUTES ABOVE.
RouteDatabase   route

# Default route is run if no routes set, this should be last Route
# always
Route   default   master          1
Route   default   cascade         "log main copy_user"
Route   default   empty           1
Route   default   supplant        1
Route   default   email           '__ORDERS_TO__'

## Uncomment this if you want Routes read dynamically from DB
#Route   default   dynamic_routes  1
## Uncomment this if you want ITL allowed in routes
#Route   default   expandable      1


# Determines default for cart placement, can be overridden by form param
SeparateItems   Yes

# Default counter file for order number
OrderCounter    etc/order.number


# Where order and login profiles go
OrderProfile    etc/profiles.order etc/profiles.login etc/profiles.misc
