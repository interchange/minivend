[comment]
ui_component: saved_carts_list_small
ui_type: component
ui_name: saved_carts_list_small
ui_class: vertical
ui_group: info
ui_label: Small saved cart list for left/right display
ui_source: templates/components/saved_carts_list_small


[/comment]
<!-- BEGIN COMPONENT [control component saved_carts_list_small] -->

[tmp myimagedir][image dir_only=1 ui=1][/tmp]

[if session logged_in]

  [if cgi delete_cart][delete_cart nickname="[cgi delete_cart]"][/if]
  [if cgi retrieve_cart][load_cart nickname="[cgi retrieve_cart]"][/if]

  [userdb function=get_cart_names hide=1]

[if value carts]

  [perl global=1]
  push(@Vend::TmpScratch,qw/saved_carts_carts saved_carts_recurring/);
  $Scratch->{saved_carts_carts} = '';
  $Scratch->{saved_carts_recurring} = '';

  foreach my $var (split("\n",$Tag->value('carts'))) {
    my($name,$last_update,$type) = split(':',$var);

    my($day,$month,$year) = (localtime($last_update))[3,4,5];
    $last_update = sprintf("%04d-%02d-%02d",$year+1900,$month+1,$day);
    my $delink = $Tag->page({
        href => "@@MV_PAGE@@",
        form => "
            delete_cart=$var
            mv_action=return
        ",
    });

    my $golink = $Tag->page({
        href => "@@MV_PAGE@@",
        form => "
            retrieve_cart=$var
            mv_action=return
        ",
    });


my $myimagedir = $Scratch->{myimagedir};
my $row = <<"END";

<tr class="">
  <td valign=top class="contentbar2">
    $delink<img src="${myimagedir}delsm.gif" border=0></a>&nbsp;&nbsp;
  </td>
  <td valign=top class="contentbar1">$golink$name</A></td>
  <td valign=top class="contentbar2" nowrap><small>$last_update</small></td>
</tr>
END

    if($type eq 'c') {
        $Scratch->{saved_carts_carts} .= $row;
    } elsif($type eq 'r') {
        $Scratch->{saved_carts_recurring} .= $row;
    }
  }
  return '';
 [/perl]

 [loop list="saved_carts_carts saved_carts_recurring"]
 [if scratch [loop-code]]

<tr> 
  <td valign="top">
    <table border="0" width="95%">
    <tr>
      <td align="center">
        <table border="0" cellspacing="0" cellpadding="2">
        <tr class="">
          <td colspan=3 align=center class="categorybar">
            [if explicit]
            [condition]'[loop-code]' eq 'saved_carts_carts'[/condition]
              Saved Carts
            [else]
              Recurring Orders
            [/else]
            [/if]
           </td>
        </tr>
        <tr class="menubar">
          <td class="menubar" align="left">&nbsp;X</td>
          <td align="center" class="menubar">&nbsp;Name</td>
	  <td align="right" class="menubar">Modified&nbsp;</td>
        </tr>

        [scratch [loop-code]]

        </table>
      </td>
    </tr>
    </table>
 
  </td>
</tr>

 [/if]
 [/loop]

[/if]
[/if]

<!-- END COMPONENT [control component saved_carts_list_small] -->
