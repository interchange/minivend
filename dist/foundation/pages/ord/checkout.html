[comment]
ui_template: Yes
ui_template_name: noleft
[/comment]

[tmp page_title]__COMPANY__ -- Check Out[/tmp]

@_NOLEFT_TOP_@

<!-- BEGIN CONTENT -->
[perl tables="country products"]
    my $db = $Db{country} or return;
 
    my $domestic = $Variable->{DOMESTIC_SHIPPING} || 'US CA';
    $domestic =~ s/\W+/ /g;
    my @dom = grep /\S/, split /\s+/, $domestic;
    my %dom;
    @dom{@dom} = @dom;
    my $modes;
    if($Values->{country}) {
	$modes = tag_data('country', 'shipmodes', $Values->{country});
	@modes = grep /\S/, split /[\s,\0]+/, $modes;
    }
    
    delete $Scratch->{only_download};
    my $hardgoods;
    for(@$Items) {
	next if tag_data('__ProductFiles_0__', 'download', $_->{code});
	$hardgoods = 1;
    }

    ! $hardgoods and $Scratch->{only_download} = 1;

    return unless @modes;
    my %modes;
    @modes{@modes} = @modes;

    if(! $modes{$Values->{mv_shipmode}}) {
    	$Values->{mv_shipmode} = shift @modes;
    }
    return;
[/perl]

<table width="95%">
<tr>
  <td align="left" width="100%">

    [if !session logged_in]
    <br>
    <p>If you have an account with us, please login using the fields below. It
    is not required, but you can also <a href="[area new_account]">create an
    account</a> with us.</p>
				  
    [if session failure]
      <P>
      <b>[calc]delete $Session->{failure}[/calc]</b>
      <P>
    [/if]

    <FORM ACTION="[process secure=1]" METHOD=POST>
    <INPUT TYPE=hidden NAME=mv_click VALUE=Login>
    <INPUT TYPE=hidden NAME=mv_todo  VALUE=return>
    <INPUT TYPE=hidden NAME=mv_nextpage VALUE="ord/checkout">

    [set Log In]
      mv_nextpage=@@MV_PAGE@@
    [/set]

    <table align="center">
    <tr>
      <td class="contentbar2">
        <table>
        <tr>
          <td align="right" class="contentbar1">
            Username:
          </td>
          <td align="left" class="contentbar1">
	    <INPUT NAME=mv_username VALUE="[read-cookie MV_USERNAME]">
          </td>
        </tr>
        <tr>
          <td align="right" class="contentbar1">
	    Password:
          </td>
          <td class="contentbar1" align="left">
	    <INPUT TYPE=password NAME=mv_password VALUE="">
	    <input type="hidden" NAME="mv_check" value="Log In">
          </td>
        </tr>
        <tr>
          <td>&nbsp;</td>
          <td>
	    <input type="submit" value="Log In">
          </td>
        </tr>
		[if config CookieLogin]
        <tr>
          <td align="right">
	    <INPUT TYPE=hidden NAME=mv_cookie_password VALUE=0><INPUT TYPE=checkbox NAME=mv_cookie_password VALUE=1>
          </td>
          <td>Log me in automatically (sets cookie)</td>
        </tr>
		[/if]
        </table>
      </td>
    </tr>
    </table>
                       
    </form>

    <p>&nbsp;</p>
					  
[/if]

    <SCRIPT>    // JavaScript Form Validation Demo    // by Paul Colton
    function check_tax(form) {
        // Make sure the email field is not blank
        var foundState = false;
        var ch = form.state.value;
        ch = ch.toUpperCase();
		[loop list="__TAXAREA__"]
        if(ch == "[loop-code]") {
            alert("You will be charged [currency][fly-tax [loop-code]][/currency] sales tax\nsince you are shipping to [loop-code]. Click Recalculate to see the amount in your total.");
            foundState = true;
        }
		[/loop]
        return foundState;
    }
    </SCRIPT>

    <FORM ACTION="[process secure=1]" METHOD="POST" name=checkout>
    <INPUT TYPE=hidden NAME=mv_session_id VALUE="[data session id]">

    [if type=explicit compare="[error all=1 show_var=1 keep=1]"]
    <P>
	<B>There were errors in your last submission:<br>
	<blockquote>
	<FONT color="__CONTRAST__">
		[error all=1 keep=1 show_error=1 show_label=1 joiner="<br>"]
	</font>
	</blockquote>
	</p>
	<p>
    The areas you need to correct are shown in 
    <FONT color="__CONTRAST__">this color</FONT> below.</B>
    </p>
    [/if]

    <INPUT TYPE=hidden NAME=mv_doit VALUE=refresh>
    <INPUT TYPE=hidden NAME=mv_nextpage VALUE="ord/checkout">

    [comment] Order routes in catalog.cfg [/comment]

    <INPUT TYPE=hidden NAME=mv_order_route   VALUE="[either]__ORDER_ROUTES__[or]log main copy_user[/either]">
    <INPUT TYPE=HIDDEN NAME=mv_check    VALUE="Save_database">

    [if session logged_in]
      [set Save_database]
      [if cgi mv_todo ne submit]
	  [calc] Log("Saving userdb in mv_check.")[/calc]
	  [userdb save]
	  [/if]
      [/set]
    [/if]
	
    <table align="center">
    <tr>
      <td align="center">
	Please verify the information below and click the <b>"Place
    	Order"</b> button to process your order.
      </td>
    </tr>
    <tr>
      <td align="center" width="100%">
        <br>
        <table cellspacing="0" cellpadding="5" border="0" width="100%">
        <TR class="contentbar2">
          <td class="contentbar2">&nbsp;<b>Remove</b></td>
          <td class="contentbar2" align="center"><b>SKU</b></td>
          <td class="contentbar2"><b>Description</b></td>
          <td class="contentbar2"><b>Quantity</b></td>
          <td class="contentbar2" align="center"><b>Price</b></td>
          <td class="contentbar2"><b>Extension&nbsp;</b></td>
        </TR>
        <TBODY>

        [if items]
        [then]
        [item-list modular=1]

	<TR class="[item-alternate 2]maincontent[else]contentbar1[/else][/item-alternate]">
	  <TD align=center valign=top>
	    <INPUT TYPE=checkbox NAME="[quantity-name]" onClick="this.form.action='[process]', this.form.submit()" VALUE=0>
 	  </TD>
	  <TD><b>[item-sku]</b></TD>
	  <TD>[page [item-sku]]<b>[item-description]</b></a>

	    [if scratch dealer]
	    [if-item-data pricing sku]
	      <BR>[page quantity [item-code]]
	      QUANTITY PRICING</A>
 	    [/if-item-data]
	    [/if]

        [if-item-data options o_enable]
            [if-item-data !options o_modular]
                [table-organize cols=4 table=' ' font="size=1" pretty=1]
                    [item-options td=1 label=1 bold=1 price=1]
                [/table-organize]
            [/if-item-data]
        [/if-item-data]

	    [if-item-field weight]
	    [seti weight][summary amount=`[item-quantity] * [item-field weight]`][/seti]
	    [/if-item-field]
	  </TD>
	  <TD ALIGN=CENTER valign=top>
	    <INPUT TYPE=text NAME="[quantity-name]" VALUE="[item-quantity]" SIZE=3>
 	  </TD>
	  <TD ALIGN=RIGHT>
	    [discount-price]
	    [if discount [item-code]]<BR>Item is discounted [item-discount][/if]
	  </TD>
	  <TD ALIGN=RIGHT>[item-subtotal]</TD>
        </TR>

	[if session logged_in]
        <TR class="[item-alternate 2]maincontent[else]contentbar1[/else][/item-alternate]">
          <TD ALIGN=CENTER COLSPAN=2 VALIGN=TOP>
	    [if value separate_addresses]
	    [page href="@@MV_PAGE@@" form="
	    	separate_addresses=0
		mv_action=return
	    "]Same shipping address</A><br>
	    [page href="ord/basket" form="edit_addresses=1"]Edit address</A><br>
	    [page href="ship_addresses" form="ui_return_to=@@MV_PAGE@@"]Add address</A>
	    [else]
	    [page href="@@MV_PAGE@@" form="
		separate_addresses=1
		mv_action=return
	    "]Separate shipping</A>
	    [/else]
	    [/if]
          </td>
          <TD COLSPAN=4 VALIGN=TOP>
	    [if value separate_addresses]
	    <PRE>[item-modifier mv_ad]</pre>
	    [/if]&nbsp;
          </td>
        </TR>
        [/if]

        [/item-list]
        [/then]
        [else]
        <TR>
	  <TD ALIGN=CENTER COLSPAN=6 class="contentbar2">
            No items at the moment.
          </TD>
        </TR>

	[/else]
	[/if]
        </table>

        <br>

        <table border="0" cellspacing="0" cellpadding="0" width="50%">
        <TR>
          <td align="left">
			[if items]
            <INPUT TYPE=image VALUE="Refresh" src="__THEME_IMG_DIR__recalculate_button.gif" border=0>
			[/if]
          </td>
          <td align="right">
            <table align="center" cellspacing="0" border="0">
            <tr>
              <TD ALIGN=left class="contentbar1">Subtotal: </TD>
              <TD ALIGN=RIGHT class="contentbar1">[subtotal]</TD>
            </TR>
            <TR>
              <TD ALIGN=left class="contentbar1">Sales Tax:</TD>
              <TD ALIGN=RIGHT class="contentbar1">[salestax]</TD>
            </TR>
            <TR>
              <TD ALIGN=left class="contentbar1">Shipping:</TD>
              <TD ALIGN=RIGHT class="contentbar1">[shipping]</TD>
            </TR>
			[if value mv_handling]
            <TR>
              <TD ALIGN=left class="contentbar1">Handling:</TD>
              <TD ALIGN=RIGHT class="contentbar1">[handling]</TD>
            </TR>
			[/if]
            <TR>
              <TD ALIGN=left class="contentbar2">TOTAL:</TD>
              <TD ALIGN=RIGHT class="contentbar2">[total-cost]</TD>
            </tr>
            </table>
          </td>
        </tr>
        </table>

      </td>
    </tr>

    <tr>
      <td>
	<br>
        <table cellspacing="0" cellpadding="0">
	<tr>
	  <td>
	    <table border="0" align="center" cellspacing="0">
	    <tr><td colspan="4">&nbsp;</td></tr>
	    <tr class="contentbar2">
	      <td class="contentbar2">
	        <b>&nbsp;Shipping Address<b>
	      </td>
	      <td class="contentbar2"><i>(primary)</i></td>
	      <td class="contentbar2">&nbsp;</td>
	      <td class="contentbar2">&nbsp;</td>
	    </tr>
	    <tr><td colspan="4" class="contentbar1">&nbsp;</td></tr>
	    <tr>
	      <td align=right class="contentbar1">
		[error name=fname std_label="First Name" required=1]
	      </td>
	      <td align=left class="contentbar1">
		<INPUT TYPE=text NAME=fname VALUE="[value fname]" size="20" maxlength="20">
	      </td>
	      <td align="right" class="contentbar1">[error name=lname std_label="Last Name" required=1]</td>
	      <td align="left" class="contentbar1"><INPUT TYPE=text NAME=lname VALUE="[value lname]" size="20"></td>
	    </tr>
	    <tr>
	      [if scratch dealer]
	      <td align="right" class="contentbar1">[error name=company std_label=Company required=1]
	      [else]
	      <td align="right" class="contentbar1">Company
	      [/else]
	      [/if]
	      </td>
	      <td align="left" class="contentbar1">
		<INPUT TYPE=text NAME=company VALUE="[value company]" size="20" maxlength="40">
	      </td>
	      <td class="contentbar1">&nbsp;</td>
	      <td class="contentbar1">&nbsp;</td>
	    </tr>
	    <tr>
	      <td align="right" class="contentbar1">[error name=address1 std_label=Address required=1]
	    </td>
	    <td align="left" colspan=3 class="contentbar1">
	      <INPUT TYPE=text NAME=address1 VALUE="[value address1]" size="40" maxlength="64">
   	    </td>
	  </tr>
	  <tr>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1" align="left" colspan=3>
	      <INPUT TYPE=text NAME=address2 VALUE="[value address2]" size="40" maxlength="64">
	    </td>
	  </tr>
	  <tr class="contentbar1">
	    <td align="right" class="contentbar1">
	      [error name=city std_label="City" required=1]
	    </td>
	    <td class="contentbar1">
	      <INPUT TYPE=text NAME=city VALUE="[value city]" size="20" maxlength="20">
	    </td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td class="contentbar1" align=right>[error name=state std_label="State/Province" required=1]</td>
	    <td align="left" class="contentbar1">
	      [loop search="
		fi=state.txt
		sf=country
		se=[default country US]
		rf=state,name,country
		tf=sorder,name
		ml=100
	      "
	      option=state]
	      [on-match]<SELECT onChange="check_tax(this.form)" NAME=state>[/on-match]
	      [list]
	      [loop-change 1][condition][loop-param country][/condition]
	      <OPTGROUP LABEL="[data table=country col=name key='[loop-param country]']">
	      [/loop-change 1]
	      <OPTION VALUE="[loop-code]">[loop-pos 1]
	      [/list]
	      [on-match]</SELECT>[/on-match]
	      [no-match]<INPUT NAME=state VALUE="[value state]" SIZE=20>[/no-match]
	      [/loop]
	    </td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      [error name=zip std_label="Zip/Postal Code" required=1] 
	    </td>
	    <td class="contentbar1">
	      <INPUT TYPE=text NAME=zip VALUE="[value name=zip filter=word]" size="10" maxlength="10">
	    </td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      [error name=email std_label="Email Address" required=1]
	    </td>
	    <td class="contentbar1">
	      <INPUT TYPE=text NAME=email VALUE="[value email]" size="30">
	    </td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      Country
	    </td>
	    <td colspan="3" class="contentbar1">
	      <SELECT NAME=country onChange="this.form.submit()">
	      [if value country =~ /(^$|US|CA)/]
	      <OPTION VALUE="US"> United States
	      <OPTION [selected country CA] VALUE="CA"> Canada
	      <OPTION VALUE="JP"> Other
	      [else]
	      [loop option=country search="
		ra=yes
		fi=country
		st=db
		rf=code,name
		ml=1000
		tf=name
	      "]
	      <OPTION VALUE="[loop-code]"> [loop-data country name] 
	      [/loop]
	      [/else]
	      [/if]
	      </SELECT>
	      <small>(will update display)</small>
	    </td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      [error name=phone_day std_label="Daytime Phone" required=1]
	    </td>
	    <td class="contentbar1">
	      <INPUT TYPE=text NAME=phone_day VALUE="[value phone_day]" size="12" maxlength="20">
	    </td>
	    <td align="right" class="contentbar1">
	      [error name=phone_night std_label="Evening Phone"]
	    </td>
	    <td align="left" class="contentbar1">
	      <INPUT TYPE=text NAME=phone_night VALUE="[value phone_night]" size="12" maxlength="20">
	    </td>
	  </tr>
	  [if session ship_message]							  
	  <tr>
	    <td class="contentbar1">&nbsp;</td>
	    <td colspan="3" class="contentbar1">
	      <B>Note:</B> [data session ship_message]
	    </td>
	  </tr>
	  [/if]							  
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>Shipping method</b>
	    </td>
	    <td colspan="3" class="contentbar1">
	      <SELECT NAME=mv_shipmode>
	      [shipping
	        label=1
        	mode=|[data table=country key='[default country US]' col=shipmodes]|
              ]
	      </SELECT>
	    </td>
	  </tr>
	  <tr>
	    <td class="contentbar1">&nbsp;</td>
	    <td colspan="3" class="contentbar1">
	      <i>We need the <b>bold fields</b> to process your order</i>
	    </td>
	  </tr>
	  <tr>
  	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
  	  <tr class="contentbar2">
	    <td class="contentbar2">Mailing Status</td>
	    <td colspan=3 class="contentbar2">&nbsp;</td>
  	  </tr>
  	  <tr>
	    <td align="center" valign="middle" class="contentbar1">
	      <SELECT NAME=email_copy>
	      <OPTION VALUE="1">Yes
	      <OPTION [selected name=email_copy value=0] VALUE="0">No
	      </SELECT>
	    </td>
	    <td class="contentbar1"><B>Send an email copy of my receipt</B></td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
          </tr>
          <tr>
	    <td align="center" valign="middle" class="contentbar1">
	      &nbsp;
	      [perl tables="__UI_META_TABLE__ mv_metadata"]
	      return;
              [/perl]
	      [input-filter name=mail_list op=null_to_space][/input-filter]
	      [display table=userdb type=multiple column=mail_list key="[data session username]"]
	    </td>
	    <td class="contentbar1"><B>Mail lists (if any)</B></td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  </table>
	</td>
      </tr>
      </table>

      <p>&nbsp;</p>

      <table cellspacing="0" cellpadding="0">
      <tr>
        <td>
  	  <table border="0" cellspacing="0" cellpadding="0" align="center">
	  <tr class="contentbar2">
	    <td colspan="2" class="contentbar2"><b>&nbsp;Billing Address</b> - <i>If different than above</i></td>
	    <td class="contentbar2">&nbsp;</td>
	    <td class="contentbar2">&nbsp;</td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>First Name</b>
	    </td>
	    <td align="left" class="contentbar1">
	      <INPUT TYPE=text NAME=b_fname VALUE="[value b_fname]" size="20" maxlength="20">
	    </td>
	    <td class="contentbar1"><b>Last Name</b></td>
	    <td align="left" class="contentbar1">
	      <INPUT TYPE=text NAME=b_lname VALUE="[value b_lname]" size="20">
	    </td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>Company</b>
	    </td>
	    <td align="left" class="contentbar1">
	      <INPUT TYPE=text NAME=b_company VALUE="[value b_company]" size="20" maxlength="44">
	    </td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>Address</b>
	    </td>
	    <td align="left" colspan=3 class="contentbar1">
	      <b>
	      <INPUT TYPE=text NAME=b_address1 VALUE="[value b_address1]" size="64" maxlength="64">
	      </b>
	    </td>
	  </tr>
	  <tr>
	    <td class="contentbar1">&nbsp;</td>
	    <td align="left" colspan=3 class="contentbar1">
	      <b>
	      <INPUT TYPE=text NAME=b_address2 VALUE="[value b_address2]" size="64" maxlength="64">
	      </b>
	    </td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>City</b>
	    </td>
	    <td class="contentbar1">
	      <b>
	      <INPUT TYPE=text NAME=b_city VALUE="[value b_city]" size="20">
	      </b>
	    </td>
	    <td align="right" class="contentbar1"><b>State/Province</b></td>
	    <td class="contentbar1">
	      <b>
	      <INPUT TYPE=text NAME=b_state VALUE="[value b_state]" size="5" maxlength="5">
	      </b>
	    </td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>Zip/Postal Code </b>
	    </td>
	    <td class="contentbar1">
	      <b>
	      <INPUT TYPE=text NAME=b_zip VALUE="[value b_zip]" size="10" maxlength="10">
	      </b>
	    </td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td align="right" class="contentbar1">
	      <b>Country</b>
	    </td>
	    <td class="contentbar1">
	      <INPUT TYPE=text NAME=b_country VALUE="[value b_country]" size="10" maxlength="10">
	    </td>
	    <td class="contentbar1">&nbsp; </td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">&nbsp;</td>
	  </tr>
	  <tr class="contentbar2">
	    <td class="contentbar2">Payment Method</td>
	    <td colspan=3 class="contentbar2">&nbsp;</td>
	  </tr>
	  <tr>
	    <td colspan=4 class="contentbar1">&nbsp;</td>
	  </tr>							  
	  <tr>
	    <td class="contentbar1">&nbsp;</td>
	    <td class="contentbar1">
	      <SELECT NAME="payment_method" onChange="this.form.submit()">
	      [if variable CREDIT_CARDS_ACCEPTED]
	      <option [selected payment_method credit] value="credit">Credit Card
	      [/if]
	      [if variable CHECK_ACCEPTED]
	      <option [selected payment_method check] value="check">Online Check
	      [/if]
	      [if variable PO_ACCEPTED]
	      <option [selected payment_method po] value="po">Company P.O.
	      [/if]
	      [if variable POSTAL_ACCEPTED]
	      <option [selected payment_method postal] value="postal">Postal Billing
	      [/if]
	      [if variable COD_ACCEPTED]
	      <option [selected payment_method cod] value="cod">C.O.D.
	      [/if]
	      </SELECT>
            </td>
	    <td colspan="2" class="contentbar1"> 
	      (will update display)
	    </td>                              
          </tr>
          <tr>
            <td class="contentbar1" colspan="4">&nbsp;</td>
          </tr>
          </table>
							
        </td>
      </tr>
      </table>						

      [if !value payment_method]
      [or value payment_method eq credit]
      [then]

      <input type=hidden name=mv_order_profile value=credit_card>
							
      <p>&nbsp;</p>

      <!--- credit card information --->
      <table cellspacing=0 cellpadding="0">
      <tr>
        <td>
	  <table border=0 cellspacing=0 cellpadding=4 align=center>
	  <tr>
	    <td colspan="2" class="contentbar2">
	      <b>
              [error std_label="Credit Card Information" name=mv_credit_card_valid]
	      [if variable MV_DEMO_MODE]
	      <BR>
	      (test number <A HREF="javascript:void 0" onclick="checkout.mv_credit_card_number.value='4111 1111 1111 1111'; return false;">4111 1111 1111 1111</A>)[/if]
	      </b>
	    </td>
	    <td class="contentbar2">
	      [calc]
		my $accepted = $Variable->{CREDIT_CARDS_ACCEPTED};
		my (@out);
		my (@cc);
		my $out;
		push @cc, 'visa' if $accepted =~ /visa/;
		push @cc, 'mc' if $accepted =~ /mc/;
		push @cc, 'disc' if $accepted =~ /discover/;
		push @cc, 'amex' if $accepted =~ /amex/;
		for (@cc) {
		  push @out, qq{<IMG SRC="small$_.png">};
		}
		return join '&nbsp;&nbsp;', @out;
	      [/calc]
	    </td>
          </tr>
          <tr>
            <td align=right class="contentbar1">
              <b>Card Number: </b>
            </td>
            <td align=right colspan=2 class="contentbar1">
              <b><INPUT TYPE=text NAME=mv_credit_card_number SIZE=22></b>
            </td>
	  </tr>
	  <tr>
            <td align=right class="contentbar1">
	      <b>Expiration: </b>
	    </td>
            <td align="right" colspan=2 class="contentbar1">

		<SELECT NAME=mv_credit_card_exp_month>
		[loop
			lr=1
		  	option=mv_credit_card_exp_month
			list="
1	01 - January
2	02 - February
3	03 - March
4	04 - April
5	05 - May
6	06 - June
7	07 - July
8	08 - August
9	09 - September
10	10 - October
11	11 - November
12	12 - December"]
		<OPTION VALUE="[loop-code]"> [loop-pos 1]
		[/loop]
		</SELECT>
	
		<SELECT NAME=mv_credit_card_exp_year>
		[comment]
		This should always return the current year as the first, then
		7 more years.
		[/comment]
		[loop option=mv_credit_card_exp_year lr=1 list=`
		my $year = $Tag->time( '', { format => '%Y' }, '%Y' );
		my $out = '';
		for ($year .. $year + 7) {
			/\d\d(\d\d)/;
			$last_two = $1;
			$out .= "$last_two\t$_\n";
		}
		return $out;
		`]

		<OPTION VALUE="[loop-code]"> [loop-pos 1]
		[/loop]
		</SELECT>
	      </td>
            </tr>
            </table>
						
	  </td>
	</tr>
	</table>

	[/then]
	[elsif value payment_method eq postal]
	
      <input type=hidden name=mv_order_profile value=mail_order>

	[/elsif]
	[elsif value payment_method eq cod]
	
      <input type=hidden name=mv_order_profile value=cod>

	[/elsif]
	[elsif value payment_method eq check]
					  
	<input type=hidden name=mv_order_profile value=mail_order>
                      
	<p>&nbsp;</p>
       
	<table border="0" cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <table border="0" cellspacing="0" cellpadding="0" align="center">
            <tr>
              <td class="contentbar2" colspan="2">
		<b>Check Information</b>
	      </td>
              <td class="contentbar2">&nbsp;</td>
              <td class="contentbar2">&nbsp;</td>
            </tr>
            <tr>
              <td align="right" class="contentbar1">
	 	<b> Account Number </b>
              </td>
              <td colspan="3 align="left" class="contentbar1">
		<b>
                <INPUT TYPE=text NAME=check_acct SIZE=22>
                </b>
              </td>
	    </tr>
	    <tr>
              <td align="right" class="contentbar1">
		<b>Routing Number</b>
	      </td>
              <td align="left" colspan="3" class="contentbar1">
                <b><INPUT TYPE=text NAME=check_route SIZE=22></b>
              </td>
            </tr>
	    <tr>
              <td align="right" class="contentbar1">
		<b>
		Check Number
		</b>
	      </td>
              <td align="left" colspan="3" class="contentbar1">
                <b>
                <INPUT TYPE=text NAME=check_num SIZE=22>
                </b>
              </td>
            </tr>
            </table>
	  </td>
	</tr>
	</table>
	
	[/elsif]
	[elsif value payment_method eq po]
					  
	<input type=hidden name=mv_order_profile value=purchase_order>
        <p>&nbsp;</p>
        
        <table cellspacing="0" cellpadding="0">
        <tr>
          <td>
            <table border="0" cellspacing="0" cellpadding="0" align="center">
            <tr class="contentbar2">
              <td class="contentbar2" colspan="2">
		<b> P.O. Information </b>
	      </td>
              <td colspan=2 class="contentbar2">&nbsp;</td>
            </tr>
	    <tr>
              <td align=right class="contentbar1">
	        <b>
	        [error name=credit_limit_ok std_label="PO Number" required=1]
	        </b>
	      </td>
              <td align=left colspan=3 class="contentbar1">
                <b>
		<INPUT NAME=project_id VALUE="[value project_id]" SIZE=14>
                </b>
              </td>
            </tr>
	
  	    [if type=data
		term="userdb::credit_limit::[data session username]"
		op=">"
		compare=0.01]
	
  	    <tr>
	      <td align=right valign=top>
	        <b> Available credit </b>
	      </td>
	      <td align=left colspan=3>
		<b>
		[currency]
		[data table=userdb col=credit_limit key="[data session username]"]
		[/currency]
		
		[if type=data
			term="userdb::credit_limit::[data session username]"
			op=<
			compare="[total-cost noformat=1]"
		]
		<BR>
		Order total [total-cost] exceeds credit limit, please call.
		[/if]
		<BR>
		</b>
	      </td>
	    </tr>
	
  	    [/if]
            </table>
						
	  </td>
	</tr>
	</table>

	[/elsif]
	[else]
	[/else]
	[/if]
			
      </td>
    </tr>
    <tr><td>
      <br>
      <table align="center" cellpadding="10" cellspacing="10"><tr>
	[if items]
      <td> 
	[button 
		name="mv_click" 
		src="__THEME__/placeorder.gif" 
		text="Place Order"
		hidetext=1
		form=checkout
	]
		mv_todo=submit
	[/button]
      </td>
      <td>
	    [button
			name="mv_click"
			src="__THEME_IMG_DIR__recalculate_button.gif"
			text="Recalculate"
			hidetext=1
			form=checkout
		]
			mv_todo=refresh
		[/button]
      </td>
	[else]
		<td><b>No items in your shopping cart!</b></td>
	[/else]
	[/if]
      </tr></table>
        
      </form>
      [seti clear_errors][error all=1 hide=1 comment="Clear errors"][/seti]

    </td></tr>
    </table>

    <p>			
			
    [include templates/components/specials]

  </td>
</tr>
</table>

<!-- END CONTENT -->

@_NOLEFT_BOTTOM_@
