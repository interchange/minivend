[set page_title]Order detail report[/set]
[include pages/config/header]
[include pages/config/mid_header]

<TR BGCOLOR="#f5f5fb">
<TD BGCOLOR="#528ebc" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Order Number</B>
</FONT>
</TD>
<TD BGCOLOR="#528ebc" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Store ID</B>
</FONT>
</TD>
<TD BGCOLOR="#528ebc" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Payment</B>
</FONT>
</TD>
<TD BGCOLOR="#528ebc" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Address</B>
</FONT>
</TD>
<TD BGCOLOR="#528ebc" ALIGN="right" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Date</B>
</FONT>
</TD>
<TD BGCOLOR="#528ebc" ALIGN="right" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Amount</B>
</FONT>
</TD>
<TD BGCOLOR="#528ebc" VALIGN="top">
<FONT FACE="arial" COLOR="#ffffff" SIZE="-1">
<B>Status</B>
</FONT>
</TD>
</TR>

[if !session arg]
<!-- default to current: [data base=session field=arg value="[tag time]%Y%m%d[/tag]"] -->
[/if]

[calc]
	$Scratch->{synd_limit} = '';
	return unless $CGI->{syndicate};
	$Scratch->{synd_limit} = "AND syndicate = '$CGI->{syndicate}'";
	$Scratch->{synd_limit} .= " AND campaign = '$CGI->{campaign}'"
		if $CGI->{campaign};
	return;
[/calc]

[query	hashref=main
	sql="
	select order_number, syndicate, campaign, total_cost, payment_method, state, city, status, order_date
		from  transactions
		where   order_date = '[data session arg]' [scratch synd_limit]
		order by order_number
	"][/query]

[perl tables="store"]
	foreach $line (@{$Tmp->{main}}) {
		$total_sales    += $line->{total_cost};
		$amount = sprintf '%.2f', $line->{total_cost};
		$url = $Tag->area('config/order_detail', $line->{order_number});
		$out .= <<EOF;
	<TR BGCOLOR=#f5f5fb>
	<TD VALIGN=top>
	<FONT FACE=arial SIZE=-1>
	<A HREF="$url">$line->{order_number}</A>
	</FONT>
	</TD>
	<TD VALIGN=top>
	<FONT FACE=arial SIZE=-1>
	$line->{syndicate}
	</FONT>
	</TD>
	<TD VALIGN=top>
	<FONT FACE="arial" SIZE="-1">
	$line->{campaign}
	</FONT>
	</TD>
	<TD VALIGN=top>
	<FONT FACE=arial SIZE=-1>
	$line->{city}, $line->{state}
	</FONT>
	</TD>
	<TD VALIGN=top>
	<FONT FACE=arial SIZE=-1>
	$line->{order_date}
	</FONT>
	</TD>
	<TD ALIGN=right VALIGN=top>
	<FONT FACE=arial SIZE=-1>
	$amount
	</FONT>
	</TD>
	<TD VALIGN=top>
	<FONT FACE=arial SIZE=-1>
	$line->{status}
	</FONT>
	</TD>
	</TR>
EOF
	}
		$total_sales  = sprintf '$%.2f', $total_sales;
		$out .= <<EOF;
	<TR BGCOLOR="#f5f5fb">
	<TD VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	GRAND TOTAL
	</FONT>
	</TD>
	<TD VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	&nbsp;
	</FONT>
	</TD>
	<TD VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	&nbsp;
	</FONT>
	</TD>
	<TD ALIGN="right" VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	&nbsp;
	</FONT>
	</TD>
	<TD ALIGN="right" VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	&nbsp;
	</FONT>
	</TD>
	<TD ALIGN="right" VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	$total_sales
	</FONT>
	</TD>
	<TD ALIGN="right" VALIGN="top">
	<FONT FACE="arial" SIZE="-1">
	&nbsp;
	</FONT>
	</TD>
	</TR>
EOF
[/perl]


[include pages/config/mid_footer]
[include pages/config/footer]
<!--
[perl global=1]
	$Tag->uneval({ ref => $master });
[/perl]
-->
