ParseVariables Yes
#ifdef @UI_BASE
Variable UI_BASE @@UI_BASE@@
#endif

#ifndef UI_BASE
Variable UI_BASE admin
#endif

Variable UI_ACCESS_TABLE access
Variable UI_META_TABLE   mv_metadata
Variable UI_OVERALL_WIDTH  750
Variable UI_MAIN_WIDTH     600
Variable UI_LEFT_WIDTH     150
Variable UI_RIGHT_WIDTH    450
Variable UI_BOTTOMIMG      poweredby.gif
Variable UI_T_BG           beige
Variable UI_C_BG           #FFFFFF
Variable UI_C_LINK         #000000
Variable UI_C_ALINK        #000000
Variable UI_C_VLINK        #000000
Variable UI_P_BG           #FFFFFF
Variable UI_P_LINK         #0000EE
Variable UI_P_ALINK        #EE0000
Variable UI_P_VLINK        #0000FF
Variable UI_C_TITLEBARBG   #336699
Variable UI_C_TITLEBARTXT  #CCCCCC
Variable UI_C_HEADERTXT    #333333
Variable UI_C_TOPBLOCKBAR  #336699
Variable UI_C_INTBLOCK     #CCCC99
Variable UI_C_INTBLOCKBAR  #999966
Variable UI_HELP_BASE_URL  http://www.akopia.com/help/4.5.0
Variable UI_T_PROPERTIES   cellpadding=3 cellspacing=0 width=90% border=0

Variable UI_SZ_LIST_CUSTOMER 50
Variable UI_SZ_LIST_ORDER    50
ParseVariables No

Sub <<EOR
sub bar_link {
	my $base = shift || 'cat';
	my $ref = shift;
	my $code = $ref->[0];
	my $record =  tag_data($base, 'n/a', $code, { hash => 1 });
	return $ref->[0] unless $record;

	my $url;
	my $anchor;
	my $first;

	LINK: {
		if($record->{link_type} eq 'external') {
			$first = $record->{url};
			$first =~ s/\s+$//;
			$first =~ s/^\s+//;
			$url = $first;
		}
		elsif	($record->{link_type} eq 'internal') {
			my ($page, $form) = split /\s+/, $record->{url}, 2;
			$url = $Tag->area( { href => $page, form => $form });
		}
		elsif	($record->{link_type} eq 'simple') {
			my (@items) = split /\s*[\n,]\s*/, $record->{selector};
			my @out;
			my $fi = $record->{tab};
			my $sp = $record->{page};
			my %options = (
				href => 'scan',
			);
			push @out, "fi=$fi" if $fi;
			push @out, "sp=$sp" if $sp;
			push @out, "st=db";
			if(! @items) {
				push @out, "ra=yes";
				$options{arg} = join "\n", @out;
				$url = $Tag->area(\%options);
				last LINK;
			}
			push @out, "co=yes";
			for(@items) {
				my ($col, $string) = split /\s*=\s*/;
				push @out, "sf=$col";
				push @out, "se=$string";
			}
			push @out, qq{va=link_image=$record->{banner_img}};
			push @out, qq{va=link_banner=$record->{banner_text}};
			push @out, qq{va=link_sub=$record->{subs}};
			$options{arg} = join "\n", @out;
			$url = $Tag->area(\%options);
		}
		elsif	($record->{link_type} eq 'complex') {
			$record->{search} =~ s/[\r\n+]/\n/g;
			$url = $Tag->area('scan', $record->{search});
		}
		else {
			$url = "";
		}
	}

	ANCHOR: {
		if($record->{display_type} eq 'url') {
			$anchor = "";
		}
		elsif ($record->{display_type} eq 'name') {
			$anchor = "$record->{name}</A>";
		}
		elsif ($record->{display_type} eq 'icon') {
			$anchor = qq{<img src="$record->{image}" alt="$record->{name}"};
			$anchor .= " $record->{image_prop}"
				if $record->{image_prop};
			$anchor .= '>';
			$anchor .= $record->{name};
			$anchor .= '</A>';
		}
		elsif ($record->{display_type} eq 'image') {
			$anchor = qq{<img src="$record->{image}" alt="$record->{name}"};
			$anchor .= " $record->{image_prop}"
				if $record->{image_prop};
			$anchor .= '>';
			$anchor .= '</A>';
		}
		else {
			$anchor = "$record->{name}</A>";
		}
	}

	return $url if ! $anchor;
	return $anchor if ! $url;
	return qq{<A HREF="$url" CLASS="barlink">$anchor};
}
EOR
