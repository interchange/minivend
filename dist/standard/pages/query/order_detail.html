[comment]
ui_template: Yes
ui_template_name: noleft
[/comment]

[tmp members_only]1[/tmp]
[tmp page_title]__COMPANY__ -- [L]Order History[/L][/tmp]

[control reset=1]

[control reset=1]

@_NOLEFT_TOP_@

[tmpn bounce_page]query/check_orders[/tmpn]
[perl transactions]
	my $on = $Session->{arg};
	my $un = $Tag->data('transactions', 'username', $on);
	if($un eq  $Session->{username}) {
		delete $Scratch->{bounce_page};
	}
	else {
		$Tag->warnings('Not your order!');
	}
	return;
[/perl]
[bounce page="[scratch bounce_page]" if="[scratch bounce_page]"]

<style type=text/css>

.block4 {
	background-color: #E6E6E6;
	vertical-align: top;
}

.block4bold,.mainbold {
	background-color: #E6E6E6;;
	color: #808080;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold
}

.cborder {
	background-color: #999999;
	padding: 0;
}

.cbreak {
	background-color: #EEEEEE;
	border-left: 1px solid #999999;
	font-size: 11px;;
	font-weight: bold
}

.cdata {
	border-bottom: 1px solid #CCCCCC;
	border-right: 1px solid #CCCCCC;
	border-top: 1px solid #CCCCCC;
	font-size: 11px;;
	margin-right: 4px;
	padding-right: 2px;
	vertical-align: top
}

.cerror {
	color: red;
	font-size: 11px;
}

.cheader {
	color: #663333;
	font-size: 11px;;
	font-weight: bold
}

.chelp,.rhint {
	background-color: #FFFFFF;
	color: #AFABA5;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	padding: 4px;
}

.clabel {
	border-bottom: 1px solid #CCCCCC;
	border-left: 1px solid #CCCCCC;
	border-top: 1px solid #CCCCCC;
	font-size: 11px;
	font-weight: medium;
	padding-left: 5px;;
	text-align: left
}

.cmessage {
	color: green;
	font-size: 11px;
}

A:link.ctitle,A:visited.ctitle {
	color: white;
	font-size: 11px;;
	font-weight: bold;
	text-decoration: none
}

A:hover.ctitle,A:active.ctitle {
	color: yellow;
	font-size: 11px;;
	font-weight: bold;
	text-decoration: underline
}

.ctitle {
	font-size: 11px;;
	font-weight: bold
}

.cwidget {
	font-size: 11px;;
	vertical-align: center
}

.lightshade,.workarea,.rbreak {
	background-color: #FFFFFF;
}

.rborder {
	background-color: #CCCCCC;
	margin: 0;;
	padding: 2
}

.rhead {
	background-color: #E6E6E6;;
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px
}

A.rhead:active,A.rhead:hover {
	color: #000000;
	font-size: 12px;
	text-decoration: underline;
}

A.rhead:link,A.rhead:visited {
	color: #000000;
	font-size: 12px;
	text-decoration:none;
}

.rheadBold {
	background-color: #E6E6E6;
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;;
	padding: 4px
}

.rheader {
	background-color: #999999;
	color: #663333;
}

.rmarq {
	background-color: #999999;;
	color: #FFFFFF;
	font-size: 12px;
	font-weight: bold
}

A.rmarq:active,A.rmarq:link,A.rmarq:visited {
	color: #FFFFCC;
	font-size: 12px;
	font-weight: bold;
	text-decoration:none;
}

A.rmarq:hover {
	color: #FFFF99;
	font-size: 12px;
	font-weight: bold;
	text-decoration: underline;
}

.rnobg {
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	padding: 4px;
}

.rnorm {
	background-color: #FFFFFF;
	border: 1px solid #CCCCCC;
}

.rowalt {
	background-color: #EAF1FB;
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	padding: 4px;
}

A.rowalt:hover,A.rowalt:hover,A.rownorm:active,A.rownorm:hover {
	color: #333333;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	text-decoration: underline;
}

A.rowalt:link,A.rowalt:visited,A.rownorm:link,A.rownorm:visited {
	color: #333333;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	text-decoration:none;
}

.rownorm {
	background-color: #FFFFFF;
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	padding: 4px;
}

.rownormbold {
	background-color: #FFFFFF;
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;;
	padding: 4px
}

.rseparator {
	background-color: #CCCCCC;
}

.rshade {
	background-color: #E6E6E6;
	color: #000000;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	padding: 4px;
}

.rspacer {
	background-color: #999999;
	margin: 0;;
	padding: 0
}

.rsubbold {
	background-color: #FFFFFF;
	color: #808080;
	font-family: Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold;;
	padding: 4px
}

.rtitle {
	background-color: #808080;;
	color: #FFFFFF;
	font-family: Verdana, Arial, Helvetica, sans-serif;
	font-size: 12px;
	font-weight: bold
}

A.rtitle:active,A.rtitle:link,A.rtitle:visited {
	color: #FFFFCC;
	font-size: 12px;
	font-weight: bold;
	text-decoration:none;
}

</style>

<!-- BEGIN CONTENT -->

[perl tables=country]### pre-open database for calcs below[/perl] 

[loop list="[data session arg]"]
<table width="100%" border="0" cellspacing="0" cellpadding="0" class=block4bold>
   <tr> 
      <td> 
         <table width="100%" border="0" cellpadding="6" cellspacing="1" class="rseparator">
            <tr> 
               <td width="25%" nowrap class="block4bold">Order Number: &nbsp; <span class="block4">[loop-data transactions order_number]</span></td>
               <td width="25%" nowrap class="block4bold">
			   	Order Status: &nbsp;
						[display table=transactions col=status type=display key="[loop-code]"]
					</a>
					[if-loop-data transactions archived == 1]
					([L]archived[/L])
					[/if-loop-data]
					[if-loop-data transactions deleted == 1]
					([L]deleted[/L])
					[/if-loop-data]
					
				</td>
               <td width="25%" nowrap class="block4bold">
			   		
					Affiliate: &nbsp;
					[if-loop-data transactions affiliate]
						<span class="block4">[loop-data transactions affiliate]</span>
					[else]
							<span class="block4">none</span>
					[/else]
					[/if-loop-data]
				</td>
                <td width="25%" nowrap class="block4bold">
			   		Order Date: &nbsp; <span class="block4">
						[convert-date fmt="%b %e, %Y %l:%M %P"][loop-data transactions order_date][/convert-date]
					</span>
				</td>
            </tr>
         </table>
      </td>
   </tr>
   <tr> 
      <td height="6"><img src="bg.gif" width="1" height="6"></td>
   </tr>
   <tr> 
      <td> 
         <table width="100%" border="0" cellspacing="0" cellpadding="0">
            <tr> 
               <!-- CUSTOMER DETAILS -->
               <td width="3"><img src="bg.gif" width="3" height="1"></td>
               <!-- BILLING DETAILS -->
               <td width="48%%" valign="top"> 
                  <table width="100%" height="160" border="0" cellpadding="6" cellspacing="1" class="rseparator">
                     <tr> 
                        <td height="1%" class="block4">Billing Address</td>
                     </tr>
                     <tr> 
                        <td height="99%" valign="top" class="block4"> 
[if-loop-data transactions b_address1]
	[loop prefix=bill list="[loop-code]"]
                           <table width="100%" border="0" cellspacing="0" cellpadding="1">
                              <tr> 
                                 <td width="30%" class="block4bold">[L]Name[/L]:</td>
                                 <td width="70%" class="block4"><A HREF="[area
				href=account]"><u>[loop-data transactions b_fname] [loop-data transactions b_lname]</A>
                                 </td>
                              </tr>
							  [if-bill-data transactions b_company]
                              <tr> 
                                 <td width="30%" class="block4bold">[L]Company[/L]:</td>
                                 <td width="70%" class="block4">
								 	[loop-data transactions b_company]
                                 </td>
                              </tr>
							  [/if-bill-data]
                              <tr> 
                                 <td valign="top" class="block4bold">[L]Address[/L]:</td>
                                 <td class="block4">
								 [loop-data transactions b_address1]
								 [if-bill-data transactions b_address2]
								 <br>
								 [loop-data transactions b_address2]
								 [/if-bill-data]
								 </td>
                              </tr>
							  [if-bill-data transactions b_country =~ /^US|^CA/]
                              <tr> 
                                 <td class="block4bold">[L]City, State, Zip[/L]:</td>
                                 <td class="block4">[loop-data transactions b_city], [loop-data transactions state]  [loop-data transactions zip]</td>
                              </tr>
							  [else]
                              <tr> 
                                 <td class="block4bold">[L]City[/L]:</td>
                                 <td class="block4">[loop-data transactions b_city]</td>
                              </tr>
							  		[if-bill-data transactions b_state]
                              <tr> 
                                 <td class="block4bold">[L]State[/L]:</td>
                                 <td class="block4">[loop-data transactions b_state]</td>
                              </tr>
								    [/if-bill-data]
							  		[if-bill-data transactions b_zip]
                              <tr> 
                                 <td class="block4bold">[L]Postal code[/L]:</td>
                                 <td class="block4">[loop-data transactions b_zip]</td>
                              </tr>
								    [/if-bill-data]
							  [/else]
							  [/if-bill-data]
                              <tr> 
                                 <td class="block4bold">[L]Country[/L]:</td>
                                 <td class="block4">[data table=country col=name key="[loop-data transactions b_country]"]</td>
                              </tr>
                              <tr> 
                                 <td height="15" colspan="2" class="block4bold"><img src="bg.gif" width="1" height="1"></td>
                              </tr>
                           </table>
		[/loop]
[else]
						<i>Same as shipping address</i>
[/else]
[/if-loop-data]
                        </td>
                     </tr>
                  </table>
               </td>
               <td width="3"><img src="bg.gif" width="3" height="1"></td>
               <!-- SHIPPING DETAILS -->
               <td width="48%" valign="top" class=block4bold> 
                  <table width="100%" height="160" border="0" cellpadding="6" cellspacing="1" class="rseparator">
                     <tr> 
                        <td height="1%" class="block4">Shipping Address</td>
                     </tr>
                     <tr> 
                        <td height="99%" valign="top" class="block4"> 
                           <table width="100%" border="0" cellspacing="0" cellpadding="1">
                              <tr> 
                                 <td width="30%" class="block4bold">[L]Name[/L]:</td>
                                 <td width="70%" class="block4"><A HREF="[area
				href=account
		]"><u>[loop-data transactions fname] [loop-data transactions lname]</A>
                                 </td>
                              </tr>
							  [if-loop-data transactions company]
                              <tr> 
                                 <td width="30%" class="block4bold">[L]Company[/L]:</td>
                                 <td width="70%" class="block4">
								 	[loop-data transactions company]
                                 </td>
                              </tr>
							  [/if-loop-data]
                              <tr> 
                                 <td valign="top" class="block4bold">[L]Address[/L]:</td>
                                 <td class="block4">
								 [loop-data transactions address1]
								 [if-loop-data transactions address2]
								 <br>
								 [loop-data transactions address2]
								 [/if-loop-data]
								 </td>
                              </tr>
							  [if-loop-data transactions country =~ /^US|^CA/]
                              <tr> 
                                 <td class="block4bold">[L]City, State, Zip[/L]:</td>
                                 <td class="block4">[loop-data transactions city], [loop-data transactions state]  [loop-data transactions zip]</td>
                              </tr>
							  [else]
                              <tr> 
                                 <td class="block4bold">[L]City[/L]:</td>
                                 <td class="block4">[loop-data transactions city]</td>
                              </tr>
							  		[if-loop-data transactions state]
                              <tr> 
                                 <td class="block4bold">[L]State[/L]:</td>
                                 <td class="block4">[loop-data transactions state]</td>
                              </tr>
								    [/if-loop-data]
							  		[if-loop-data transactions zip]
                              <tr> 
                                 <td class="block4bold">[L]Postal code[/L]:</td>
                                 <td class="block4">[loop-data transactions zip]</td>
                              </tr>
								    [/if-loop-data]
							  [/else]
							  [/if-loop-data]
                              <tr> 
                                 <td class="block4bold">[L]Country[/L]:</td>
                                 <td class="block4">[data table=country col=name key="[loop-data transactions country]"]</td>
                              </tr>
                              <tr> 
                                 <td height="15" colspan="2" class="block4bold"><img src="bg.gif" width="1" height="1"></td>
                              </tr>
                           </table>
                        </td>
                     </tr>
                  </table>
               </td>
            </tr>
         </table>
      </td>
   </tr>
   <tr> 
      <td height=6><img src="bg.gif" width=1 height=6></td>
   </tr>
   <tr> 
      <td> 
         <!-- CUSTOMERS ORDER GRID -->
         <table width="100%" border=0 cellpadding=0 cellspacing=1 class=rseparator>
            <tr> 
               <td width="14%" class=rhead style="padding: 5px">[L]Status[/L]</td>
               <td width="14%" class=rhead style="padding: 5px">[L]SKU[/L]</td>
               <td width="14%" class=rhead style="padding: 5px">[L]Name[/L]</td>
               <td width="14%" class=rhead style="padding: 5px; text-align: right">[L]Qty[/L]</td>
               <td width="14%" class=rhead style="padding: 5px; text-align: right">[L]Unit Price[/L]</td>
               <td width="14%" class=rhead style="padding: 5px; text-align: right">[L]Total[/L]</td>
            </tr>
[query list=1 sql="select * from orderline where order_number = '[loop-code]'"]
            <tr class="[sql-alternate 2]rowalt[else]rownorm[/else][/sql-alternate]"> 
               <td style="padding: 5px">
                [display    table=transactions
                            column=status
                            key="[loop-code]"
                            arbitrary=order_view
                ]
[calc]
	$total_weight += ([field field=weight key="[sql-param sku]"] + 0 || 0) * [sql-data orderline quantity];
	return;
[/calc]
               <td style="padding: 5px">[sql-param sku]</td>
               <td style="padding: 5px">[sql-filter 30.][sql-param description][/sql-filter]</td>
               <td align=right style="padding: 5px">[sql-param quantity]</td>
               <td align=right style="padding: 5px">[sql-param price]</td>
               <td align=right style="padding: 5px">[sql-param subtotal]</td>
            </tr>
[/query]
            <tr> 
               <td height=4 colspan=5 class=lightshade><img src="bg.gif" width=1 height=4></td>
               <td class=lightshade><img src="bg.gif" width=1 height=4></td>
            </tr>
            <tr> 
               <td height=39 colspan=5 align=right class=rsubbold>[L]Item Total[/L]:</td>
               <td class=rownorm align=right>[currency][loop-data transactions subtotal][/currency]</td>
            </tr>
            <tr> 
               <td colspan=5 align=right class=rsubbold>[L]Tax:[/L]</td>
               <td class=rownorm align=right>[currency][loop-data transactions salestax][/currency]</td>
            </tr>
            <tr> 
               <td colspan=5 align=right class=rsubbold>[L]Total Weight:[/L]</td>
               <td class=rownorm align=right>[calc]$total_weight[/calc]</td>
            </tr>
			[if-loop-data transactions handling > 0]
            <tr> 
               <td colspan=5 align=right class=rsubbold>[L]Shipping[/L]</td>
               <td class=rownorm align=right>[currency][loop-data transactions shipping][/currency]</td>
            </tr>
			[/if-loop-data]
            <tr> 
               <td colspan=5 align=right class=rsubbold>[L]Shipping[/L]</td>
               <td class=rownorm align=right>[currency][loop-data transactions shipping][/currency]</td>
            </tr>
            <tr> 
               <td colspan=5 align=right class=rsubbold>[L]GRAND TOTAL:[/L]</td>
               <td class=rownormbold align=right>[currency][loop-data transactions total_cost][/currency]</td>
            </tr>
         </table>
      </td>
   </tr>
</table>

[/loop]

<br>
<div align=center>
	[page query/check_orders extra='style="font-size: larger"']Return</a>
</div>
<br>
<br>
<!-- END CONTENT -->

@_NOLEFT_BOTTOM_@
