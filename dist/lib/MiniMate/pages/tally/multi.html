<html>
<body>

<script language="Javascript">

// display a 2-dimensional array as a <select> box, nicely formatted
// and with column buttons which allow sorting (and reverse sorting)
// by column

// Jason E. Holt <jason@akopia.com>
// 20 May 2000
// For Akopia, Inc.





// -----------------------    Begin library calls
    // These are basically library functions, so everything in this
    // <script> tag can be put in a .js file, if you like.

    
var padding = 10; // How much blank space between columns?
var leader = " ";

var sort_column = 0; // used during sort() calls.  Don't touch.
var sort_dir = 'forward'; 

// Call after the <select> and array have been created to fill in
// the <select> box.
function init_select(sel, ary) {
    ary.select = sel;
    update_select(ary);
}

function update_padding(input) {
    leader = input.value;
}

// Call anytime you want to sync the array with its <select>
function update_select(ary) {
    var sel = ary.select;
    sel.length=ary.length;
    for(var r=0; r< ary.length; r++) {
	var rowtext = "";
	for(var c=0; c<ary[r].length; c++) {
	    rowtext += pad_cell(ary, r, c);
	}

	sel.options[r].selected=false;
	sel.options[r].text=rowtext;
	sel.options[r].value=ary[r].value;
    }
}

// Returns len bytes of whitespace
function whitespace(len) {
    var ws = "";
    for(i=0; i<len; i++) {
	ws += leader;
    }
    return ws;
}

// Returns an array with max width for each column of the array
function tabstops(ary) {
    var cols = ary[0].length;
    var tabstop = new Array();
    var r, c;

    for(c=0; c<cols; c++) { tabstop[c] = ary.heading[c].length; }

    for(r=0; r< ary.length; r++) {

	if(ary[r].length != cols) {
	    alert("Inconsistent number of columns (row " + (r+1) + ")!");
	}

	for(c=0;  c< cols; c++) { 
	    if(tabstop[c] < ary[r][c].length) {
		tabstop[c] = ary[r][c].length;
	    }
	}
    }
    return tabstop;
}

// Figures out how long each row will be when properly padded
// and returns a string of '.'s accordingly
function make_padding(ary) { 
  var ts = ary.tabstops; 
  var col, i, pad;

  pad = "";
  for(col=0; col<ts.length; col++){
      var width = ts[col];
      if(col + 1 < ts.length) { width += padding; }

      for(i=0; i< width; i++) {
	  pad = pad + ".";
      }
  }
  return pad;
}

// They're going to take me away, ha ha!
function pad_cell(ary, r, c) {
    return (ary[r][c] + 
	    whitespace(ary.tabstops[c]-ary[r][c].length + 
		       (c+1 == ary[r].length ? 0 : padding)));
}

// Returns <A> tags to place above the <select>.  These will be the 
// sort buttons
function make_heading(ary) {
    var h="";
    var cols = ary.heading.length;
    
    for(var c=0; c<cols; c++){
	h += 
	    '<a href="javascript:sort_col(' +ary.name+','+c+ ')">' 
	    +ary.heading[c]+ "</a>";
	h += whitespace((ary.tabstops[c]-ary.heading[c].length) +
				 (c+1 == cols ? 0 : padding)); 
    }

    return h;
}


function sort_func(x, y) {
    if(x[sort_column] < y[sort_column]) {
	return (sort_dir * -1);
    } else if(x[sort_column] > y[sort_column]) {
	return (sort_dir * 1);
    } else {
	return (sort_dir * 0);
    }
}

// Sort ary on col, remembering to sort backwards next time
function sort_col(ary, col) {

    // Set up the info sort_func will use
    sort_column = col;
    sort_dir = (ary.sortdir[col] == "backward" ? -1:1);

    ary.sort(sort_func);

    if(!ary.sortdir[col] || ary.sortdir[col] == "forward") {
	ary.sortdir[col] = "backward";
    } else if(ary.sortdir[col] == "backward") {
	ary.sortdir[col] = "forward";
    } else {
	alert("Reality check bounced in sort_col");
    }

    // Reset all the other columns to sort forward
    for(var i=0; i< ary.heading.length; i++) {
	if(i != col) {
	    ary.sortdir[i] = "forward";
	}
    }

    update_select(ary);
}


// -----------------------    End library routines
</script>

<script>
// ----------------------- Begin example code
    // Here we create an array whose values will create the 
    // text of the selection box and the sort button headings

    // "a" can be renamed anything you like, just update the 
    // calls to tabstops(), make_heading(), make_padding() and init_select()
    // accordingly.
a = new Array;

// a.select will get filled in during init_select
a.name = "a"; // Kludgy way to do soft references. See make_heading()
a.sortdir = new Array();

a.heading = new Array("Col 1", "Col 2", "Col 3");

// Basically equivalent to:
//   <option value=10>oof_    rab    zab
a[0] = new Array("oof_", "rabletcherous", "zab");
a[0].value = 10;

a[1] = new Array("foo_", "bar", "baz and lots and lots of other stuff");
a[1].value = 20;

a[2] = new Array("bar", "baz", "foo_");
a[2].value = 30;

a[3] = new Array("baz", "foo_", "bar");
a[3].value = 40;

// Compute the tab stops
a.tabstops = tabstops(a);
</script>

<!--
// This can be used as a boilerplate, optionally renaming the form
// and select.  Just call init_select accordingly.
-->

<form name="f">
<pre style="font-family:Courier">
<script>document.write(make_heading(a))</script>
<select size=10 name="s" style="font-family:Courier">
<script>document.write("<option>" + make_padding(a) + "</option>");</script>
</select>
</pre>



<input type=submit>
<br>
Whitespace leader: <input name="leader" value="" size=1 maxlength=1>
<br>
<a href="javascript:update_padding(document.f.leader); update_select(a)">Update</a>
</Form>

<script>
init_select(document.f.s, a);
</script>

</body>
</html>
