[set page_title]Individual Table Import[/set]
[set table_perm]=i[/set]
[set help_name]import.main[/set]
[set ui_class]Admin[/set]
[set icon_name]admin/icon_config.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

[if cgi ui_allow_multiple]
	[calc]
		my @tables = grep /\S/, split /[\s,\0]+/, q{[list-databases extended="i"]};
		for(@tables) {
			#Log("tagging write $_");
			$Tag->flag( { type => 'write', table => $_ } );
		}
		return;
	[/calc]
[/if]
[if type=explicit compare="[value-extended
							name=upload_file
							test=isfile]"]
	[title-bar]Import of table [cgi mv_data_file]:
	[value-extended
		name=upload_file
		outfile="upload/[cgi mv_data_table].[cgi ui_upload_ext]"
		yes=Succeeded
		no=FAILED
		][/title-bar]
	<P>
	[if type=file term="upload/[cgi mv_data_table].[cgi ui_upload_ext]"]
	[check-upload file="[cgi mv_data_table].[cgi ui_upload_ext]" same=1]
	[/if]

	[if type=file term="__UI_PRODUCT_DIR__/[cgi mv_data_table].[cgi ui_upload_ext]"]
	[flag type=write table="[cgi mv_data_table]"]
	[/if]

	[if cgi ui_upload_ext eq add]
	[import-fields	table="[cgi mv_data_table]"
					file="__UI_PRODUCT_DIR__/[cgi mv_data_table].add"
					multiple="[cgi ui_allow_multiple]"
					delete="[cgi ui_allow_delete]"
					quiet="[cgi ui_import_quiet]"
					move=1 add=1 dir=backup]
	[elsif cgi ui_upload_ext eq update]
	[import-fields	table="[cgi mv_data_table]"
					multiple="[cgi ui_allow_multiple]"
					delete="[cgi ui_allow_delete]"
					quiet="[cgi ui_import_quiet]"
					file="__UI_PRODUCT_DIR__/[cgi mv_data_table].update"
					move=1 dir=backup]
	[/elsif]
	[/if]
[/if]

[calc]
	return if ! $CGI->{mv_data_table};
	$Values->{mv_data_table} = $CGI->{mv_data_table};
	return;
[/calc]
<form action="[area @@MV_PAGE@@]" method="POST" ENCTYPE="multipart/form-data">
<INPUT TYPE=hidden NAME=mv_action     VALUE=return>
<INPUT TYPE=hidden NAME=ui_return_to VALUE="__UI_BASE__/genxport">
<table __UI_T_PROPERTIES__>
<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor="__UI_C_INTBLOCK__">
<input type=file name=upload_file>
<BR>
<input type="submit" value="Import">
<br>
<hr>
<SELECT NAME=ui_upload_ext>
	<OPTION VALUE=add> Add new items if present
	<OPTION VALUE=update> Ignore new items
</SELECT>&nbsp;&nbsp;&nbsp;<INPUT TYPE=checkbox NAME=ui_allow_delete VALUE=1> Allow delete
<BR><INPUT TYPE=checkbox NAME=ui_allow_multiple VALUE=1> Multiple tables (gnumeric simple text)
<BR><INPUT TYPE=radio NAME=ui_import_quiet VALUE=0 [checked name=ui_import_quiet value=0]> Show summary/add record/delete record messages
<BR><INPUT TYPE=radio NAME=ui_import_quiet VALUE=1 [checked name=ui_import_quiet value=1 default=1]> Show summary messages only
<BR><INPUT TYPE=radio NAME=ui_import_quiet VALUE=2 [checked name=ui_import_quiet value=2]> Show *no* messages
</td>
<td bgcolor="__UI_C_INTBLOCK__">

<select name="mv_data_table">
[loop list="[list-databases extended=i]" option=mv_data_table]<option value="[loop-code]"> [loop-code]
[/loop]
</select>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

</form>

<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
