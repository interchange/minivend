[set page_title]Customer manager: View customer[/set]
[set ui_class]Customers[/set]
[set page_banner]View customer[/set]
[set help_name]customer.view[/set]
[set icon_name]admin/icon_people.gif[/set]
@_UI_STD_HEAD_@
[calc]
	delete $Scratch->{ui_bounce};
	#Log("got here, customer=$CGI->{customer}, arg=$CGI->{mv_arg}");
	return if $CGI->{customer};
	$CGI->{customer} = $CGI->{mv_arg} 
		or $Scratch->{ui_bounce} = '__UI_BASE__/customer';
	return;
[/calc]
[if scratch ui_bounce]
	[bounce page="[scratch ui_bounce]"]
[/if]

<!-- ----- BEGIN REAL STUFF ----- -->
[update values]
[loop list="[value-extended customer]"]

<table border=0 __UI_T_PROPERTIES__>
<tr>
<td colspan=6 bgcolor=__UI_C_TITLEBARBG__><img src="@_UI_IMG_@admin/bg.gif" height=1></td>
</tr>

<tr>
<td colspan=6 align=left bgcolor=__UI_C_INTBLOCK__>
<table>
<tr><td align=right>
<b>Customer Username: </td><td>[loop-code]</b></td>
</tr><tr>
<td align=right><b>Customer: </td><td>
<A HREF="[area
				href=__UI_BASE__/customer_pref
				form=|
					customer=[cgi customer]
				|
		]"><u>[loop-data userdb fname] [loop-data userdb lname]</u></A>
		</b>
</td>
</tr>
</table>
</td>
</tr>

<tr>
<td colspan=2 valign=top>

<!-- ----- Customer information ----- -->

<form>

<table border=0>
<tr><td align=right>
<font size=2><b> Company: </b></font>
</td><td><font size=2>[loop-data userdb company]</font></td></tr>

<tr><td align=right>
<font size=2><b> Home phone: </b></font>
</td><td><font size=2>[loop-data userdb phone_night]</font></td></tr>

<tr><td align=right>
<font size=2><b> Work phone: </b></font>
</td><td><font size=2>[loop-data userdb phone_day]</font></td></tr>

<tr><td align=right>
<font size=2><b> Email: </b></font>
</td><td><font size=2> <a href="mailto:[loop-data userdb email]"><U>[loop-data userdb email]</U></a></font></td></tr>
<tr><td align=right>
<font size=2><b> Payment type: </b></font>
</td><td><font size=2>[display arbitrary=custview table=userdb column=fax_order key="[loop-code]"]</a></font></tr>

[if-loop-data userdb project_id]
<tr><td align=right>
<font size=2><b>PO Number:</b></font>&nbsp;
</td><td><font size=2>[loop-data userdb project_id]</font></td></tr>
[/if-loop-data]

[if-loop-data userdb fax]
<tr><td align=right>
<font size=2><b>FAX number:</b></font>&nbsp;
</td><td><font size=2>[loop-data userdb fax]</font></td></tr>
[/if-loop-data]

<tr><td align=right>
<font size=2><b>Dealer:</b></font>&nbsp;
</td><td><font size=2>[display arbitrary=custview table=userdb column=dealer key="[loop-code]"]</font></td></tr>


<tr><td align=right>
<font size=2><b>Wants email copy:</b></font>&nbsp;
</td><td><font size=2>[display arbitrary=custview table=userdb column=email_copy key="[loop-code]"]</font></td></tr>

<tr><td align=right>
<font size=2><b>Mail lists:</b></font>&nbsp;
</td><td><font size=2>[loop-data userdb mail_list]</font></td></tr>

</table>
</form>

</td><td valign=top colspan=4>
[set bill_address]
[loop-data userdb b_fname] [loop-data userdb b_lname]<br>
[loop-data userdb b_address1]<br>
[if-loop-data userdb b_address2]
[loop-data userdb b_address2]<br>
[/if-loop-data]
[loop-data userdb b_city], [loop-data userdb b_state] [loop-data userdb b_zip]<br>
[/set]

[set ship_address]
[loop-data userdb fname] [loop-data userdb lname]<br>
[loop-data userdb address1]<br>
[if-loop-data userdb address2]
[loop-data userdb address2]<br>
[/if-loop-data]
[loop-data userdb city], [loop-data userdb state] [loop-data userdb zip]<br>
[/set]

<font size=2>
<p>
[if-loop-data userdb username]
<A HREF="[area
				href=__UI_BASE__/customer_bill
				form=|
					customer=[loop-data userdb username]
				|
		]"><b><u>Bill To</u>:</b></A>
[else]
		<b>Bill To:</b>
[/else]
[/if-loop-data]
<blockquote>
[if-loop-data userdb b_address1]
[scratch bill_address]
[else]
[scratch ship_address]
[/else]
[/if-loop-data]
</blockquote>

<A HREF="[area
				href=__UI_BASE__/customer_ship
				form=|
					customer=[cgi customer]
				|
		]"><b><u>Ship To</u>:</b></A>
<br>
<blockquote>
[scratch ship_address]
</blockquote>
</font>

[set bill_address][/set]
[set ship_address][/set]
</td></tr>

<tr>
<td colspan=6 bgcolor=__UI_C_TITLEBARBG__><img src="@_UI_IMG_@admin/bg.gif" height=1></td>
</tr>

<tr>
<td width="20%" bgcolor=__UI_C_INTBLOCK__>
	<B>Order number</B>
</td>
<td width="20%" bgcolor=__UI_C_INTBLOCK__>
	<B>Order date</B>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
	<B>Order Total</B>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
	<B>Status</B>
</td>
</tr>
[query list=1
		st=db
		table=transactions 
		sql="select
			  order_number, order_date, salestax, shipping, total_cost, status
			  FROM transactions 
			  WHERE username = '[loop-code]'
			  ORDER BY order_date
			  "
			  ]
<tr>
<td>
	<A HREF="[area __UI_BASE__/order_view [sql-code]]"><U>[sql-code]</U></A>
</td>
<td>
	[sql-pos 1]
</td>
<td>
	[sql-pos 4]
</td>
<td>
<A HREF="[area
			href=__UI_BASE__/order_status
			form="
				order=[sql-code]
			"]"><U>[sql-pos 5]</U></A>
</td>
</tr>
[/query]
<tr>
<td colspan=6 bgcolor=__UI_C_TITLEBARBG__><img src="@_UI_IMG_@admin/bg.gif" height=1></td>
</tr>

</table>
<SMALL>
<form action="[area __UI_BASE__/customer]" method=post>
<input type=hidden name=mv_action value=back>
<input type=hidden name=customer value="[loop-data userdb username]">
<input type=hidden name=viewnext value=1>

[button text="Back"]
viewnext=
viewcustomer=
[/button]

[button text="Enter order"]
mv_nextpage=__UI_BASE__/entry
mv_todo=return
[/button] 

[if-mm advanced userdb=e]
[if-loop-data userdb inactive]
[button name="activate" text="Activate customer"][/button]
[else]
[button name="deactivate" text="Deactivate customer"
	confirm="Are you sure you want to deactivate this customer?"][/button]
[/else]
[/if-loop-data]

[button text="Change password"]
user_id=[loop-code]
mv_nextpage=__UI_BASE__/customer_change_pass
[/button]
[/if-mm]

[if-mm advanced userdb=d]
<input type=submit name="deletecustomer" value="Delete customer" 
 onClick="return confirm('Are you sure you want to delete this customer?')">
[/if-mm]

</form>
</SMALL>

[/loop]
<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
