<html>
<head>
<title>Section Properties -- [data table=area col=name key="[cgi area]"]</title>
</head>
<body bgcolor="__UI_C_INTBLOCK__" link="__UI_C_LINK__" alink="__UI_C_ALINK__" vlink="__UI_C_VLINK__">

<!-- ----- BEGIN REAL STUFF ----- -->
[if-mm !advanced sitedesign=e]
[set ui_error]Not authorized to edit layout.[/set]
[bounce page="__UI_BASE__/error"]
[/if-mm]


[value name=mv_data_table set="area" hide=1]

[if-mm !tables]
[bounce href="[area admin/special/table_violation]"]
[/if-mm]

[if-mm function=keys name="[cgi area]"]
[else][bounce href="[area admin/special/key_violation]"][/else]
[/if-mm]

[perl tables="[value mv_data_table]"]
my $table = $Values->{mv_data_table};
$Values->{ui_data_key_name} = $Db{$table}->config('KEY');
if ($table ne $Values->{mv_data_table}) {
	$Values->{mv_data_table} = $table;
}
$Values->{ui_data_fields} =
	$CGI->{ui_data_fields} ||
	$CGI->{mv_data_fields} ||
	$Values->{"$table:ui_data_fields"} || '' ;
$Values->{ui_data_fields} =~ s/\0+/ /g;
return;
[/perl]

[set process_ui_area]
setarea=[cgi selector]
[perl]
	my @filters = grep /^ui_filter:/, keys %$CGI;
	return unless @filters;
	foreach my $key (@filters) {
		my $val = delete $CGI->{$key};
		$key =~ s/ui_filter://;
		next unless $val;
		next unless defined $CGI->{$key};
		$CGI->{$key} = $Tag->filter($val, $CGI->{$key}, $key);
	}
	return;
[/perl]
[/set]


[if scratch ui_failure]
	<FONT COLOR=RED>Failed:
	[scratch ui_failure][set ui_failure][/set]</FONT><BR>
[/if]

[loop list="[value area]" prefix=table]
<FORM METHOD=POST name=layout_area_properties ACTION="[area ui]"
		onSubmit="
			document.layout_area_properties.submit();
			document.ui_prop.reload();
			return(false);
		">
<INPUT TYPE=hidden NAME=mv_doit VALUE="set">
<INPUT TYPE=hidden NAME=from_section VALUE=1>
<INPUT TYPE=hidden NAME=mv_click VALUE="process_ui_area">
<INPUT TYPE=hidden NAME=mv_nextpage VALUE="__UI_BASE__/layout">
<INPUT TYPE=hidden NAME=mv_data_table VALUE="[value mv_data_table]">
<INPUT TYPE=hidden NAME=mv_data_key VALUE="[value ui_data_key_name]">
<INPUT TYPE=hidden NAME=mv_update_empty VALUE="1">
<INPUT TYPE=hidden NAME=mv_data_fields VALUE="[db-columns]">
<INPUT TYPE=hidden NAME=code VALUE="[table-code]">

<table __UI_T_PROPERTIES__>

<td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff">Name and Link</td>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Name</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=20 NAME=name Value="[table-data area name]">
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Links to category with</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=20 NAME=selector Value="[either][table-data area selector][or][table-code][/either]" onChange="this.form.cat.value=this.form.selector.value>
	</td>
</tr>



<tr><td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff">Display Location (new locations in blank box)</td></tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Page&nbsp;class</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<input type=hidden name="ui_filter:which_page" value="null_to_space">
	<table> <tr> <td>
		<small>
		<select size=3 name="which_page" MULTIPLE>
		[calc]
			my (%current);
			my (%seen);
			my (@current) = split /\s+/, q{[table-data area which_page]};
			@current{@current} = @current;
			my @passed = grep !$seen{$_}, split /[\s,\0]+/,
							q{[loop search='
										fi=area
										st=db
										ra=yes
										un=yes
										rf=which_page
									'][loop-code] [/loop]};
			my $out = '';
			for (@passed) {
				$out .= qq{<OPTION};
				$out .= ' SELECTED' if defined $current{$_};
				$out .= qq{>$_};
			}
			return $out;
		[/calc]
		</select>
	</td>
	<td>
	<input size=16 name="which_page" value="">
	</td></tr></table>
	</small>
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Area</b>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<input type=hidden name="ui_filter:bar" value="nullselect">
	<table><tr><td>
	<small>
	<INPUT SIZE=8 NAME=bar value="">
	</td>
	<td>
	<small>
	<select name=bar>
	[calc]
		my (%current);
		my (%seen);
		my $curr = q{[table-data area bar]};
		my @passed = grep /\S/, split /\s+/, q{[loop search="ra=yes/fi=area/st=db/tf=bar/rf=bar/un=yes"][loop-code] [/loop]};
		my $out = '<option value=""> &lt;--New';
		for (@passed) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $curr eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</SELECT>
	</td></tr></table>
	</td>
</tr>

<tr><td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff">Link properties</td></tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>External</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<input type=hidden name="ui_filter:page" value="nullselect">
	<INPUT SIZE=50 NAME=page>
	</td>
</tr>

<tr><td colspan=2>&nbsp;&nbsp;<b>or</td></tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Internal</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<select name=page>
	[calc]
		my (%current);
		my (%seen);
		my $page;
		($page, $ui_arg) = split /\s+/, q{[table-data area page]}, 2;
		my @passed = split /\s+/, $Tag->list_pages();
		my $out = '<OPTION VALUE="">--none--';
		for (@passed) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $page eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</SELECT><INPUT NAME=page SIZE=16 VALUE="[calc]$ui_arg[/calc]">
	</td>
</tr>

<td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff">Images</td>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Banner&nbsp;image</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=50 NAME=banner_img value="[table-data area banner_img]">
	</td>
</tr>

<tr><td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff">Other</td></tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Sorting within area</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<select name=sort>
	<option value=0>--first--
	[calc]
		my $curr = q{[table-data cat sort]};
		for (1 .. 20) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $curr eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</select>
	</td>
</tr>


</table>

<p>

<input type=submit value="Ok" onClick="this.form.target=window.opener.name">

[seti Cancel]
mv_todo=return
mv_nextpage=[either][value-extended name=ui_return_to index=0][or]admin/flex_select[/either]
mv_data_table=[cgi mv_data_table]
[/seti]

<input type=submit name="mv_click" value="Cancel">
<BR>
[if-mm tables =x]
	[if !value ui_too_large]
	<INPUT TYPE=checkbox NAME=mv_auto_export CHECKED VALUE="[value mv_data_table]">
		Auto-export
	[/if]
[/if-mm]

</form>
[/loop]

</body>
</html>
