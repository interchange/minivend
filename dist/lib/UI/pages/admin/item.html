[if !cgi mv_data_table]
[calc]
	$CGI->{mv_data_table} = $Values->{mv_data_table} = $Config->{ProductFiles}[0];
	return;
[/calc]
[/if]
[comment]
[if-mm function="!tables" table=`$Config->{ProductFiles}[0]`]
[bounce page="__UI_BASE__/error"]
[/if-mm]
[/comment]

[set page_title]Item editor[/set]
[set table_perm]1[/set]
[set help_name]item.main[/set]
[set icon_name]admin/icon_item.gif[/set]
@@UI_STD_HEAD@@

[set Delete item]
[tag flag write]inventory pricing products[/tag]
mv_nextpage=__UI_BASE__/item
[if-mm advanced item=d]
	[perl tables="inventory pricing products"]
		my ($item) = $CGI->{item_id};
		my $out;
		for(qw/products pricing inventory/) {
			next unless $Db{$_};
			if ($Db{$_}->delete_record($item)) {
				$out .= "Deleted $item from $_ table<BR>";
			}
			else {
				$out .= "Item $item not in $_ table (or delete failed)<BR>";
			}
		}
		$Scratch->{ui_message} = $out;
		return;
	[/perl]
[else]
	[set ui_message]Not authorized to delete items.[/set]
[/else]
[/if-mm]
[/set]

<!-- ----- BEGIN REAL STUFF ----- -->
[if scratch ui_message]
<BLOCKQUOTE>
	[scratch ui_message]
	[set ui_message][/set]
</BLOCKQUOTE>
<p>
&nbsp;
[/if]
<form action="[area process]" method="post">
<INPUT TYPE=hidden NAME=mv_todo     VALUE=return>
<INPUT TYPE=hidden NAME=mv_nextpage VALUE="__UI_BASE__/item_edit">
<INPUT TYPE=hidden NAME=mv_data_table VALUE="[calc]$Config->{ProductFiles}[0][/calc]">
<INPUT TYPE=hidden NAME=ui_data_fields VALUE="[either]__UI_ITEM_FIELDS__[or]description image comment size color sku price weight category[/either]">
<INPUT TYPE=hidden NAME=ui_break_before VALUE="[either]__UI_ITEM_BREAK__[or]description image sku category[/either]">

<p>
&nbsp;
<table cellpadding=3 cellspacing=0>
<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_OVERALL_WIDTH__ height=1></td>
</tr>

[set Create new item]
ui_hide_key=0
item_id=new
sku=new
[/set]

<tr>
<td bgcolor="__UI_C_INTBLOCK__" width=__UI_LEFT_WIDTH__>
<input type="submit" name="mv_click" value="Create new item">
</td>

<td bgcolor="__UI_C_INTBLOCK__" width=__UI_RIGHT_WIDTH__>

&nbsp; <!-- make sure theres always *something* in the cell -->

</td></tr>

<tr>
<td colspan=2 bgcolor=__UI_C_INTBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_OVERALL_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor="__UI_C_INTBLOCK__">

<input type="submit" name="show_edit_cmd" value="Edit item">
<br>

<input type="submit" name="show_changematrix_cmd" value="Change matrix">
<br>
<input type="submit" name="show_editallvariants_cmd" value="Edit all 
 variations">
<br>
<input type="submit" name="mv_click" value="Delete item" 
 onClick="return confirm('Are you sure you want to delete this item?')">

</td>
<td bgcolor="__UI_C_INTBLOCK__">

<select name="item_id" size=10>
[loop search="
	fi=products
	st=db
	ra=yes
	ml=1000
	tf=description
	rf=sku,description
"]<option value="[loop-code]"> [loop-param description]
[/loop]
</select>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_OVERALL_WIDTH__ height=1></td>
</tr>

</table>

</form>


<!-- ----- END REAL STUFF ----- -->

@@UI_STD_FOOTER@@
<!-- page: @@MV_PAGE@@ -->
