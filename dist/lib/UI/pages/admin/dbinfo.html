[tmp page_perm]techadmin[/tmp]
[tmp page_title]Administration: [data session arg] table information[/tmp]
[tmp page_banner]<i>[calc]$Config->{CatalogName}[/calc]</i> table information [if session arg]([data session arg])[/if][/tmp]
[set ui_class]Admin[/set]
[tmp help_name]genconfig.main[/tmp]
[tmp icon_name]icon_config.gif[/tmp]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<center>
<table __UI_T_PROPERTIES__>

<tr>
<td bgcolor=__UI_C_TOPBLOCKBAR__ COLSPAN=2><img src="bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>
<tr><td align=left bgcolor=__UI_C_INTBLOCK__ colspan=2>
<TABLE border=0 width="100%">

[perl tables="[list-databases] __UI_META_TABLE__"]
	my @tables;
	if($Session->{arg}) {
		@tables = split /[\s,\0]+/, $Session->{arg};
	}
	else {
		@tables = sort keys %{$Config->{Database}};
	}
	my $mdb = $Db{__UI_META_TABLE__};
	my %ignore;
	my @ignore = qw/
			Class
			db_file
			db_file_extended
			db_file_extended
			db_text
			dir
			DSN
			dsn_id
			Exists_handle
			EXTENDED
			file
			_Insert_h
			name
			Object
			Read_only
			type
			Update_handle
		/;
	@ignore{@ignore} = @ignore;

	my %typemap = (
		1	=> 'DBM/Memory, auto-detect delimiter',
		2	=> 'DBM/Memory, LINE delimiter',
		3	=> 'DBM/Memory, %% delimiter',
		4	=> 'DBM/Memory, CSV delimiter',
		5	=> 'DBM/Memory, PIPE delimiter',
		6	=> 'DBM/Memory, TAB delimiter',
		7	=> 'This should never appear (old Msql)',
		8	=> 'DBI/SQL',
		9	=> 'LDAP',
	);
	my $tcount = 0;
	for (@tables) {
		my $tname = $_;
		my $bgcol = ($tcount++ % 2) ? '__UI_T_ROW_ODD__' : '__UI_T_ROW_EVEN__';
		my $tinfo = '';
		if($mdb and $mdb->record_exists($tname) ) {
			$tinfo = $mdb->field($tname, 'label');
			if($tinfo) {
				$tinfo .= "<br>($tinfo)";
			}
		}

		my $ref = $Config->{Database}{$_};
		my $class = $ref->{Class};
		my $file  = $ref->{file};
		my $dfile = ($class eq 'DBI' ? $ref->{db_file_extended} : $ref->{db_file});
		my $dfn   = $dfile;
		$dfile =~ s:^$Config->{ProductDir}/::o;
		my $dir   = $ref->{DIR} || $Config->{ProductDir};
		my %delim_map = (
			"|" => 'PIPE',
			"\t" => 'TAB',
			"\n" => 'LINE',
		);

		my $delim;
		$delim = $ref->{delimiter};
		$delim   = $delim_map{$delim} || $delim;

		my $type  = $typemap{$ref->{type}};

		$type .= " DSN=$ref->{DSN}" if $ref->{DSN};
		my $fn = "$dir/$file";
		$file .= "<BR><TT>mod date:   " . $Tag->file_info( { name => $fn, date => 1 } );
		$file .= "<BR>file size: " . $Tag->file_info( { name => $fn, size => 1 } );
		$file .= "</TT>";
		$dfile .= "<BR><B>(not significant for DBI types)</b>" if $class eq 'DBI';
		$dfile .= "<BR><TT>mod date:   " . $Tag->file_info( { name => $dfn, date => 1 } );
		$dfile .= "<BR>file size: " . $Tag->file_info( { name => $dfn, size => 1 } );
		$dfile .= "</TT>";
		my $obj   = $ref->{Object};
		$out .= <<EOF;
<TR>
	<TH VALIGN=TOP ALIGN=RIGHT width="15%" BGCOLOR="$bgcol">
	$tname$tinfo
	</TH>
	<td VALIGN=TOP>
		<TABLE border=1 width="100%">
		<tr>
			<th valign=top align=left>Type</th>
			<td>$type</td>
		</tr>
		<tr>
			<th valign=top align=left width="30%">Class</th>
			<td>$class</td>
		</tr>
		<tr>
			<th valign=top align=left width="30%">Directory</th>
			<td>$dir</td>
		</tr>
		<tr>
			<th valign=top align=left width="30%">Text File</th>
			<td>$file</td>
		</tr>
		<tr>
			<th valign=top align=left width="30%">DB File</th>
			<td>$dfile</td>
		</tr>
EOF

		$out .= <<EOF if $delim;
		<tr>
			<th valign=top align=left width="30%">Delimiter</th>
			<td>$delim</td>
		</tr>
EOF

		$out .= <<EOF;
		<tr>
			<th colspan=2>Other</th>
		</tr>
EOF
		for(sort keys %{$ref}) {
			next if $ignore{$_};
			my $key = $_;
			my $r = $ref->{$_};
			my $o = <<EOF;
		<tr>
			<th valign=top align=left width="30%">$_</th>
			<td>
EOF
			if(! defined $r) {
				$o .= "undef";
			}
			elsif(ref($r) =~ /^ARRAY/) {
				my $t = join "<br>", @$r;
				$o .= $t || '&nbsp;';
			}
			elsif(ref($r) =~ /^HASH/) {
				my $t = '';
				for(sort keys %$r) {
					if (! defined $r->{$_} and $key eq 'NUMERIC') {
						$t .= "$_<br>";
						next;
					}
					$t .= "$_ --&gt; $r->{$_}<br>";
				}
				$o .= $t || '&nbsp;';
			}
			elsif(! defined $r) {
				$o .= "&nbsp;";
			}
			elsif(! length($r)) {
				$o .= "&nbsp;";
			}
			else {
				$o .= $r;
			}
			$o .= <<EOF;
			</td>
		</tr>
EOF
			$out .= $o;
		}

		$out .= <<EOF;
		</TABLE>
	</TD>
</TR>
EOF

	}
	return $out;
[/perl]

<tr>
<td bgcolor=__UI_C_TOPBLOCKBAR__ COLSPAN=2><img src="bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</TABLE>

<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
