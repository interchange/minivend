[perl tables="__UI_META_TABLE__"]
	$CGI->{mv_data_table} = $Config->{ProductFiles}[0];
	$CGI->{ui_hide_key} = 1 unless $CGI->{ui_new_item};
	if(! $CGI->{ui_data_fields}) {
		$CGI->{ui_data_fields} =
				tag_data('__UI_META_TABLE__', 'options', $CGI->{mv_data_table})
				|| $Variable->{UI_ITEM_FIELDS}
				|| 'sku description category comment price image weight size color';
	}

	if(! $CGI->{ui_break_before}) {
		if($CGI->{ui_data_fields} =~ /\n[ \t]*\r?\n/) {
			my @breaks;
			my @break_labels;
			$CGI->{ui_data_fields} =~ s/\r\n/\n/g;
			$CGI->{ui_data_fields} =~ s/\r/\n/g;
			while ($CGI->{ui_data_fields} =~ s/\n+(?:\n=(.*)\n)?\n+(\w+)/\n$2/) {
				push @breaks, $2;
				push @break_labels, "$2=$1" if $1;
			}
			$CGI->{ui_break_before} = join " ", @breaks;
			$CGI->{ui_break_before_label} = join ",", @break_labels;
		}
		else {
			$CGI->{ui_break_before} = $Variable->{UI_ITEM_BREAK}
									|| 'image size';
		}
	}
	if(! $CGI->{ui_return_to} or $CGI->{ui_sequence_edit}) {
		my @args = (
			 '__UI_BASE__/item',
			 "item_id_left=$CGI->{item_id_left}",
			 "ui_sequence_edit=$CGI->{ui_sequence_edit}",
		);
		$CGI->{ui_return_to} = join "\0", @args;
	}
	return;
[/perl]

[if cgi ui_new_item]
	[loop list="__MV_ITEM_TABLES__"]
		[flag type=write table="[loop-code]"]
	[/loop]
	[perl tables="[cgi mv_data_table]"]
		my $db = $Db{$CGI->{mv_data_table}} or return;
		unless ($db->config('AUTO_SEQUENCE')) {
			$db->config('AUTO_NUMBER', '000001')
				unless $db->config('AUTO_NUMBER');
			$CGI->{item_id} = $db->autonumber();
		}
		if ($CGI->{ui_clone_id}) {
			$CGI->{ui_clone_tables} = '__UI_ITEM_TABLES__';
			my $db = $Db{$CGI->{mv_data_table}} or return;
			return unless $db->record_exists($CGI->{ui_clone_id});
			my $ref = $db->row_hash($CGI->{ui_clone_id});
			$CGI->{ $db->config('KEY') } = $CGI->{item_id}
				if defined $CGI->{item_id};
			@{$CGI}{ keys %$ref } = values %$ref;
		}
		return;
	[/perl]
[/if]

[set ui_class]Items[/set]
[seti page_title][L]Item editor[/L]: [cgi item_id][/seti]
[set help_name]edit.item[/set]
[set icon_name]icon_item.gif[/set]

[if-mm super]
[tmp page_banner][page href="__UI_BASE__/flex_editor"
				 form='
				 mv_data_table=__UI_META_TABLE__
				 ui_meta_view=dbconfig
				 ui_data_fields=code name height field outboard options help help_url display_filter
				 ui_break_before=height display_filter
				 page_title=[L]Change display information[/L]: [cgi mv_data_table]
				 ui_return_to=__UI_BASE__/item
				 ui_return_to=ui_scrub_table=1
				 item_id=[cgi mv_data_table]
		 '][L]Item editor[/L]</A> [msg arg.0="<B>[cgi item_id]</B>"]edit item %s[/msg]
[/tmp]
[else]
[tmp page_banner][L]Item editor[/L]: [msg arg.0="<B>[cgi item_id]</B>"]edit item %s[/msg][/tmp]
[/else]
[/if-mm]

@_UI_STD_HEAD_@
<P>
[table-editor file_upload=1 cgi=1]

[if-mm super]
<A HREF="[area href=admin/flex_editor
				form='
					item_id=[cgi item_id]
					mv_data_table=__ProductFiles_0__
					page_title=[L]Edit items[/L]: [cgi item_id]
					help_name=inventory.edit
					ui_no_meta_display=1
					ui_hide_key=1
					ui_return_to=__UI_BASE__/item
					icon_name=icon_item.gif
					']">[L]No meta display[/L]</A>
[/if-mm]

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
