[set page_title][L]Page editor[/L][/set]
[set ui_class]Content[/set]
[set help_name]page.main[/set]
[set icon_name]icon_pages.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<form action="[area @@MV_PAGE@@]" method=POST>
<input type=hidden name=mv_session_id value="[data session id]">
<input type=hidden name=mv_action value=back>

[if scratch ui_error]
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1>
[scratch ui_error][set ui_error][/set]
</FONT>
</BLOCKQUOTE>
[/if]

<table border=0 __UI_T_PROPERTIES__>
<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr bgcolor="__UI_C_INTBLOCK__">
<td width=25%>
[set [L]Create new page[/L]]
[if !cgi ui_page]
mv_nextpage=@@MV_PAGE@@
[set ui_error][L]Need to select a file name.[/L][/set]
mv_todo=return
[else]
mv_nextpage=__UI_BASE__/page_edit
mv_todo=return
[/else]
[/if]
[/set]

[set Preview template]
mv_nextpage=__UI_BASE__/page_preview
mv_todo=return
[/set]

1. [L]Choose a page template from the pull-down menu:[/L]

</td>
<td>
<select name="ui_template" size=1>
[calc]
	my $tdir = $Variable->{UI_TEMPLATE_DIR} || 'templates';
	@files = $Tag->list_glob("$tdir/*");
    $selected = ' SELECTED';
	for(@files) {
		next unless -f $_;
		my $name = $_;
		$data = $Tag->file($_);
		$name =~ s:.*/::;
		my $ref = {};
		$data =~ m{\[comment\]\s*(ui_.*?)\[/comment\]}s;
		my $structure = $1 || "ui_template_description: Unknown $name";
		my @lines = grep /\S/, split /\n/, $structure;
		for(@lines) {
			my ($el, $el_item, $el_data) = split /\s*:\s*/, $_;
			#Log ("found el=$el el_item=$el_item el_data=$el_data");
			if($el_data) {
				$ref->{$el} = { $el_item, $el_data };
			}
			else {
				$ref->{$el} = $el_item;
			}
		}
		#Log("ref is " . $Tag->uneval( { ref => $ref } ));
		push @out, qq{<OPTION VALUE="$_"$selected>$ref->{ui_template_description}};
        $selected = '';
	}
	return join "\n", @out;
[/calc]
</select>
</td>
</tr>
<tr>
<td>
2. [L](Optional)[/L] [L]Preview your selection:[/L]
</td>
<td>
<input type="submit" name="mv_click" value="[L]Preview template[/L]" onClick="this.form.target='_blank'"> &nbsp; [L](Opens a new window)[/L]
</td>
</tr>
<tr bgcolor="__UI_C_INTBLOCK__">
<td>
3. [L]Name the file you are creating:[/L]
</td>
<td>
<INPUT NAME=ui_page>
</td>
</tr>
<tr>
<td>
4. [L]Click this button to create the page:[/L]
</td>
<td>
<input type="submit" name="mv_click" value="[L]Create new page[/L]" onClick="this.form.target='_self'"><BR>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

</form>


<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
