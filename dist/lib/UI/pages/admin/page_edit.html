[set page_title][L]Edit Page[/L][/set]
[set ui_class]Content[/set]
[set help_name]page.main[/set]
[set icon_name]icon_pages.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->
[tmp ui_current_content][/tmp]
[perl] 
	my @choices = split /\s*\0\s*/, $CGI->{ui_page};
	my $page;
	for(@choices) {
		next if ! $_;
		$page = $_;
		$page .= $Config->{HTMLsuffix} if $page !~ /$Config->{HTMLsuffix}$/;
		$page = "pages/$page" if $page !~ m(^pages/);
		last;
	}
	my ($ary) = $Tag->read_ui_template($page);
	return unless $ary;
	$Scratch->{ui_current_content} = $ary->[0]->{ui_current_content};

#Log( "template structure: " . $Tag->uneval( { ref => $ary } ));
	my $tdir = $Variable->{UI_TEMPLATE_DIR} || 'templates';
	if(! $ary->[0]->{ui_template_elements}) {
		my $template = $ary->[0]->{ui_template_name};
		($ary) = $Tag->read_ui_template("$tdir/$template");
	}

	return unless $ary;
	my $ref = $ary->[0]
		or return;

	return unless 
		$Scratch->{ui_template_version} = $ref->{ui_template_version};

	$Scratch->{ui_template_structure} = $ref;
#Log("current: $Scratch->{ui_current_content}");
	return;
[/perl]

[if scratch ui_template_version]
[include include/page_edit]
[else]
[include include/page_edit_old]
[/else]
[/if]

<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
