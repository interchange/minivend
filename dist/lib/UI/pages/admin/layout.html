[set page_title]Layout Editor[/set]
[set page_banner]Layout Editor: Organize your site into categories[/set]
[set help_name]layout.edit[/set]
[set icon_name]admin/icon_pages.gif[/set]

@@UI_STD_HEAD@@

<!-- ----- BEGIN REAL STUFF ----- -->
<P>
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1><B>This page doesn't work yet.</B></FONT>
</BLOCKQUOTE>
<P>
<FORM METHOD=GET ACTION="[area @@MV_PAGE@@]" name="layoutform">
<input type=hidden name=mv_action value=return>

<table __UI_T_PROPERTIES__>

[if cgi newarea]
[value name=area set="[fcounter etc/area.recordnumber]" hide=1]
[data table=area column=name key="[value area]" value="[cgi newarea]"]
[elsif cgi newcat]
[value name=cat set="[fcounter etc/cat.recordnumber]" hide=1]
[data table=cat column=name key="[value cat]" value="[cgi newarea]"]
[data table=cat column=area key="[value cat]" value="[data table=area col=selector key='[value area]']"]
[/elsif]
[/if]

<tr>
<td [if value cat]colspan=3[elsif value area]colspan=2[/elsif][/if] bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td valign=top bgcolor="__UI_C_INTBLOCK__">

<script language="javascript">
<!--
   document.write("Edit area:<br>");
// -->
</script>
<noscript>
<input type="submit" value="Edit section:"><br>
</noscript>

<select name="area" size=10 [if !value area]onchange="document.layoutform.submit()"[/if]>
[loop   search="
			fi=area
			st=db
			ra=yes
			rf=code,name
		"
		option=area ]
<option value="[loop-code]"> [loop-param name]
[/loop]
</select>
<br>

<input type=submit value="Area Properties">

<br>

<input onclick="window.open('[area __UI_BASE__/layout_create.html]', 'create_window', 
			    'resizable=1,width=240,height=120')" 
	type="submit" value="Create new section">


</td>


[if value area]
<td valign=top bgcolor="__UI_C_INTBLOCK__">

<script language="javascript">
<!--
   document.write("Edit category:<br>");
// -->
</script>
<noscript>
<input type="submit" value="Edit category:"><br>
</noscript>

<select name="cat" size=10 [if !value cat]onchange="document.layoutform.submit()"[/if]>
[loop   search="
			fi=cat
			st=db
			ml=1000
			sf=area
			se=[data table=area col=selector key='[value area]']
			rf=code,name
		option=cat
			"]
<option value="[loop-code]"> [loop-param name]
[/loop]
</select>
<br>

<input type=submit value="Category Properties"><br>
[seti win_href][href form="cur_area=[value area]" href="__UI_BASE__/layout_subcat.html" ][/seti]

<input onclick="window.open('[scratch win_href]', 'create_window', 
			    'resizable=1,width=240,height=120')" 
	type=submit value="Create category">

</td>
[/if]

[if value cat]

<td bgcolor="__UI_C_INTBLOCK__">


<table>
<tr>

<td>

[seti cat_selector][data table=cat column=selector key="[value cat]"][/seti]
[seti cat_name][data table=cat column=name key="[value cat]"][/seti]
[seti cat_page][data table=cat column=page key="[value cat]"][/seti]
[seti cat_url][data table=cat column=url key="[value cat]"][/seti]

[perl]

 if($Scratch->{cat_url}) {

    $Scratch->{cat_type} = 'url';

 # We need a better way to differentiate between product pages
 # and other kinds of local pages
 } elsif($Tag->scratch(cat_page)) {

    $Scratch->{cat_type} = 'static';

 } else {

    $Scratch->{cat_type} = 'items';
 }
 return;
[/perl]

Type of category:
<select name="cat_type">
<option value="items" [if scratch cat_type eq items]selected[/if]>
  Product page
<option value="static" [if scratch cat_type eq static]selected[/if]>
  Content page
<option value="url" [if scratch cat_type eq url]selected[/if]>
  Link to a foreign page
</select>

<br>

[if scratch cat_type eq url]

URL: <input name="cat_url" size=20>

[/if]

[if scratch cat_type eq static]

<!-- should list files in catalogs/[...]/pages/, or something -->
Page name: 
<select NAME=cat_url>
[list-pages options=1]
</select>

[/if]

[if scratch cat_type eq items]


<hr size=3 noshade>
<br>


Add an item to "[scratch cat_name]":<br>
<select name="sku">
[loop search="
        fi=products
		ra=yes
		rf=description,sku
		ml=1000
"]
<option value="[loop-param sku]">[loop-param description]
[/loop]
</select>
<input type="submit" value="Add">
<br>

<hr>

Items in category "[scratch cat_name]":<br>

<select name="existing_items" size=10>
[loop search="
        fi=products
		sf=category
		se=[scratch cat_selector]
        st=db
		em=yes
        rf=description,sku
"]<option value="[loop-param sku]">[loop-param description]
[/loop]
</select>

</td>

</tr>
<tr>
<td>


<input type=submit value="Remove item from category">
<input type=submit value="Edit item">

<br>


[comment] cat_type: items [/comment]
[/if]

</td>

</tr>
</table>
</td>

</tr>

<tr>
<td colspan=3 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

[else]
<!-- wait for them to select a category first -->
</tr>
[/else]
[/if]

</table>

</form>
<P>
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1><B>This page doesn't work yet.</B></FONT>
</BLOCKQUOTE>
<P>

<BR>
@@UI_STD_FOOTER@@
<!-- page: @@MV_PAGE@@ -->






