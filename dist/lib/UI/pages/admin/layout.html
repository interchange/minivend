[set page_title]Layout Editor[/set]
[set page_banner]Layout Editor: Organize your site into sections[/set]
[set help_name]layout.edit[/set]
[set icon_name]admin/icon_pages.gif[/set]

@@UI_STD_HEAD@@

<!-- ----- BEGIN REAL STUFF ----- -->

<FORM METHOD=GET ACTION="[area @@MV_PAGE@@]" name="layoutform">

<table cellpadding=3 cellspacing=0>

<tr>
<td colspan=[if cgi cat]3[else]1[/else][/if] bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_OVERALL_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor="__UI_C_INTBLOCK__">

<script language="javascript">
<!--
   document.write("Edit section:<br>");
// -->
</script>
<noscript>
<input type="submit" value="Edit section:"><br>
</noscript>

<select name="cat" size=10 onchange="document.layoutform.submit()">
[loop   search="
        fi=cat
		st=db
		ra=yes
		rf=code,name "]
<option [if type=cgi term=cat op=eq compare=[loop-code]]selected[/if]
  value=[loop-code]>
[loop-param name]
[/loop]
</select>
<br>

<input type=submit value="Section Properties">

<br>

[if cgi cat]
[seti win_href][href form="cur_cat=[cgi cat]" href="__UI_BASE__/layout_subcat.html" ][/seti]

<input onclick="window.open('[scratch win_href]', 'create_window', 
			    'resizable=1,width=240,height=120')" 
	type=submit value="Create subsection">
[/if]

<input onclick="window.open('layout_create.html', 'create_window', 
			    'resizable=1,width=240,height=120')" 
	type="submit" value="Create new section">


</td>

[if cgi cat]

<td bgcolor="__UI_C_TOPBLOCKBAR__" width=1><img src="admin/cleardot.gif" width=1></td>

<td bgcolor="__UI_C_INTBLOCK__">


<table>
<tr>

<td>

[seti cat_selector][data table=cat column=selector key="[cgi cat]"][/seti]
[seti cat_name][data table=cat column=name key="[cgi cat]"][/seti]
[seti cat_page][data table=cat column=page key="[cgi cat]"][/seti]
[seti cat_url][data table=cat column=url key="[cgi cat]"][/seti]

[perl]

 if($Tag->scratch('cat_url')) {

    $Tag->set('cat_type', 'url');

 # We need a better way to differentiate between product pages
 # and other kinds of local pages
 } elsif($Tag->scratch('cat_page')) {

    $Tag->set('cat_type', 'static');

 } else {

    $Tag->set('cat_type', 'items');
 }

[/perl]

Type of section:
<select name="cat_type">
<option value="items" [if scratch cat_type eq items]selected[/if]>
  Product page
<option value="static" [if scratch cat_type eq static]selected[/if]>
  Content page
<option value="url" [if scratch cat_type eq url]selected[/if]>
  Link to a foreign page
</select>

<br>

[if scratch cat_type eq url]

URL: <input name="cat_url" size=20>

[/if]

[if scratch cat_type eq static]

<!-- should list files in catalogs/[...]/pages/, or something -->
Page name: <input size=20>

[/if]

[if scratch cat_type eq items]


<hr size=3 noshade>
<br>


Add an item to "[scratch cat_name]":<br>
<select name="sku">
[loop search="
        fi=products
		ra=yes
		rf=name,sku
		ml=1000
"]
<option value="[loop-param sku]">[loop-param name]
[/loop]
</select>
<input type="submit" value="Add">
<br>

<hr>

Items in section "[scratch cat_name]":<br>

<select name="existing_items" size=10>
[loop search="
        fi=products
		sf=Category
		se=[scratch cat_selector]
        st=db
		em=yes
        rf=name,sku
"]<option value="[loop-param sku]">[loop-param name]
[/loop]
</select>

</td>

</tr>
<tr>
<td>


<input type=submit value="Remove item from section">
<input type=submit value="Edit item">

<br>


[comment] cat_type: items [/comment]
[/if]

</td>

</tr>
</table>
</td>

</tr>

<tr>
<td colspan=3 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_OVERALL_WIDTH__ height=1></td>
</tr>

[else]
<!-- wait for them to select a category first -->
</tr>
[/else]
[/if]

</table>

</form>

<BR>
@@UI_STD_FOOTER@@
<!-- page: @@MV_PAGE@@ -->






