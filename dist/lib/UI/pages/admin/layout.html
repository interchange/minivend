[set page_title]Layout Editor[/set]
[set page_banner]Layout Editor: Organize your site into categories[/set]
[set page_perm]layout=e[/set]
[set help_name]layout.edit[/set]
[set icon_name]admin/icon_pages.gif[/set]
[seti ui_body_extra][/seti]

@_UI_STD_HEAD_@
[if scratch ui_message]
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1><B>[scratch ui_message][set ui_message][/set]</B></FONT>
</BLOCKQUOTE>
[/if]

[if scratch ui_failure]
	<FONT COLOR=RED>Failed:
	[scratch ui_failure][set ui_failure][/set]</FONT><BR>
[/if]

<!-- ----- BEGIN REAL STUFF ----- -->
<table __UI_T_PROPERTIES__>

[if cgi newarea]
<!-- Creating area: 
[flag type=write table=area]
[value name=area set="[fcounter etc/area.recordnumber]" hide=1]
[data table=area column=name key="[value area]" value="[cgi newarea]"] -->
[elsif cgi newcat]
<!-- Creating category: 
[flag type=write table=cat]
[value name=cat set="[fcounter etc/cat.recordnumber]" hide=1]
[data table=cat column=name key="[value cat]" value="[cgi newcat]"]
[data table=cat column=sel key="[value cat]" value="[value area]"] -->
[/elsif]
[elsif cgi setarea]
<!-- Setting area: [value name=area set="[value code]" hide=1] -->
[/elsif]
[elsif cgi setcat]
<!-- Setting cat: [value name=cat set="[value code]" hide=1] -->
[/elsif]
[/if]

[set Delete section]
[/set]

<tr>
<td [if value area]colspan=3[/if] bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td valign=top bgcolor="__UI_C_INTBLOCK__">

<FORM METHOD=GET ACTION="[process]" name="areaform">
<input type=hidden name=ui_window_name value="mainwindow[scratch window_name]">
<input type=hidden name=mv_todo        value=return>
<input type=hidden name=mv_nextpage    value="@@MV_PAGE@@">


<B>Area -- section:</B><br>

<select name="area" size=10 onchange="this.form.submit()">
[loop   search="
			fi=area
			tf=sel
			tf=sort
			tf=name
			st=db
			ra=yes
			rf=code,name,sel
		"
		option=area ]
<option value="[loop-code]">[loop-param sel] -- [loop-param name]
[/loop]
</select>
<br>

<small>
[button text="Section properties" hspace=2 vspace=5 src="admin/icon_pages.gif" hidetext=1]
[/button]

[button text="Sort section higher" src="admin/up.gif" hidetext=1]
	[flag type=write table=area]
	[perl tables=area]
		my $db = $Db{area} || return;
		my $curr = $db->field($CGI->{area}, 'sort');
		$curr =~ s/^0+//;
		$curr = 1 if ! $curr || $curr < 0;
		$curr--;
		$db->set_field($CGI->{area}, 'sort', sprintf("%02d", $curr));
		return;
	[/perl]
[/button]


[button text="Sort section lower" src="admin/down.gif" hidetext=1]
	[flag type=write table=area]
	[perl tables=area]
		my $db = $Db{area} || return;
		my $curr = $db->field($CGI->{area}, 'sort');
		$curr =~ s/^0+//;
		$curr = 0 if ! $curr || $curr < 0;
		$curr++;
		$db->set_field($CGI->{area}, 'sort', sprintf("%02d", $curr));
		return;
	[/perl]
[/button]

[button text="Create section" src="admin/plus.gif" hidetext=1]
	mv_todo=back
	newarea=NEW
[/button]

[button
	text="Delete section" src="admin/delete.gif" 
	confirm="Are you sure you want to delete this section?"
 hidetext=1]
	[tag flag write]area[/tag]
	[if-mm advanced sitedesign=d]
		[perl tables="area"]
			my ($item) = $CGI->{area};
			my $out;
			unless ($Db{area}) {
				Log("no site design table 'area'");
				return undef;
			}
			my $name = $Db{area}->field($item, 'name');
			if ($Db{area}->delete_record($item)) {
				$out .= "Deleted $name from area table<BR>";
			}
			else {
				$out .= "Item $item not in $_ table (or delete failed)<BR>";
			}
			$Scratch->{ui_message} = $out;
			return;
		[/perl]
	[else]
		[set ui_message]Not authorized to delete layout items.[/set]
	[/else]
	[/if-mm]
[/button]
</small>


</td>


[if value area]
[then]
<td valign=top bgcolor="__UI_C_INTBLOCK__">

<B>Contains:</B><BR>

<select name="cat" size=10 [if !value cat]onChange="this.form.submit()"[/if]>
[loop   search="
			fi=cat
			st=db
			ml=1000

			tf=sort
			tf=name

			co=yes

			sf=sel
			op=rm
			se=[value area]

			rf=code,name,sort
			" option=cat]
<OPTION VALUE="[loop-code]">[loop-param name]
[/loop]
</select>
<br>
<small>
[button text="Category properties" hspace=2 vspace=5 hidetext=1 src="admin/icon_pages.gif"][/button]

[button text="Sort category higher" hidetext=1 src="admin/up.gif"]
	[flag type=write table=cat]
	[perl tables=cat]
		my $db = $Db{cat} || return;
		my $curr = $db->field($CGI->{cat}, 'sort');
		$curr =~ s/^0+//;
		$curr = 1 if ! $curr || $curr < 0;
		$curr--;
		$db->set_field($CGI->{cat}, 'sort', sprintf("%02d", $curr));
		return;
	[/perl]
[/button]

[button text="Sort category lower" hidetext=1 src="admin/down.gif"]
	[flag type=write table=cat]
	[perl tables=cat]
		my $db = $Db{cat} || return;
		my $curr = $db->field($CGI->{cat}, 'sort');
		$curr =~ s/^0+//;
		$curr = 0 if ! $curr || $curr < 0;
		$curr++;
		$db->set_field($CGI->{cat}, 'sort', sprintf("%02d", $curr));
		return;
	[/perl]
[/button]

[button text="Create category" hidetext=1 src="admin/plus.gif"]
	mv_todo=back
	newcat=NEW
[/button]

[button text="Delete category" hidetext=1 src="admin/delete.gif"
	 confirm="Are you sure you want to delete this category?"
]
	[tag flag write]cat[/tag]
	mv_nextpage=@@MV_PAGE@@
	[if-mm advanced sitedesign=d]
		[perl tables="cat"]
			my ($item) = $CGI->{cat};
			my $out;
			unless ($Db{cat}) {
				Log("no site design table 'cat'");
				return undef;
			}
			my $name = $Db{cat}->field($item, 'name');
			if ($Db{cat}->delete_record($item)) {
				$out .= "Deleted $name from cat table<BR>";
			}
			else {
				$out .= "Item $item not in $_ table (or delete failed)<BR>";
			}
			$Scratch->{ui_message} = $out;
			return;
		[/perl]
	[else]
		[set ui_message]Not authorized to delete items.[/set]
	[/else]
	[/if-mm]
[/button]
</small>

</td>

<td bgcolor="__UI_C_INTBLOCK__" valign=top>


<table>
<tr>

<td>
[set name="<--"]
[/set]

[button text="Move category left" hidetext=1 src="admin/left.gif"]
[if-mm advanced layout=e]
[flag type=write table=cat]
[perl tables=cat]
	my $db = $Db{cat};
	if (! $db) {
		Log ("No category database.");
		return;
	}
	my $area = $CGI->{area};
	@codes = split /\0/, $CGI->{add_cat};
	for(@codes) {
		my $curr = $db->field($_, 'sel');
		if($curr) {
			$curr =~ s/\s+$//;
			$curr .= " $area";
		}
		else {
			$curr = $area;
		}
		$db->set_field($_, 'sel', $curr);
	}
	return;
[/perl]
[/if-mm]
[/button]

[button text="Move category right" hidetext=1 src="admin/right.gif"]
[if-mm advanced layout=e]
[flag type=write table=cat]
[perl tables=cat]
	my $db = $Db{cat};
	if (! $db) {
		Log ("No category database.");
		return;
	}
	my $area = $CGI->{area};
	@codes = split /\0/, $CGI->{cat};
	my @there;
	foreach my $one (@codes) {
		my %seen;
		my $curr = $db->field($one, 'sel');
		Log("current = $curr");
		@there = grep $_ ne $area, split /[\0\s]+/, $curr;
		Log("now = @there");
		@there = grep !$seen{$_}++, @there;
		$curr = join " ", @there;
		Log("now current = $curr");
		$db->set_field($one, 'sel', join " ", @there);
	}
	return;
[/perl]
[/if-mm]
[/button]
</td>

<td VALIGN=top><B>Available categories:</B><br>
<select name="add_cat" size=10>
[loop   search="
			fi=cat
			st=db
			ml=1000

			tf=name

			co=yes

			sf=sel
			op=rn
			se=[value area]

			rf=code,name
			"]
<OPTION VALUE="[loop-code]">[loop-param name]
[/loop]
</select>

</td>
</tr>
</table>
</form>
</td>
</tr>
</table>

<table __UI_T_PROPERTIES__>
<tr>
<td valign=top bgcolor="__UI_C_INTBLOCK__">
<!--- BEGIN SECTION PROPERTIES -->

[value name=mv_data_table set="area" hide=1]

[perl tables="[value mv_data_table]"]
my $table = $Values->{mv_data_table};
$Values->{ui_data_key_name} = $Db{$table}->config('KEY');
if ($table ne $Values->{mv_data_table}) {
	$Values->{mv_data_table} = $table;
}
$Values->{ui_data_fields} =
	$CGI->{ui_data_fields} ||
	$CGI->{mv_data_fields} ||
	$Values->{"$table:ui_data_fields"} || '' ;
$Values->{ui_data_fields} =~ s/\0+/ /g;
return;
[/perl]

[set process_ui_area]
setarea=[cgi selector]
[perl]
	my @filters = grep /^ui_filter:/, keys %$CGI;
	return unless @filters;
	foreach my $key (@filters) {
		my $val = delete $CGI->{$key};
		$key =~ s/ui_filter://;
		next unless $val;
		next unless defined $CGI->{$key};
		$CGI->{$key} = $Tag->filter($val, $CGI->{$key}, $key);
	}
	return;
[/perl]
[/set]


[loop list="[value area]" prefix=table]
<FORM METHOD=POST name=layout_area_properties ACTION="[area ui]">
<INPUT TYPE=hidden NAME=mv_doit VALUE="set">
<INPUT TYPE=hidden NAME=from_section VALUE=1>
<INPUT TYPE=hidden NAME=mv_click VALUE="process_ui_area">
<INPUT TYPE=hidden NAME=mv_nextpage VALUE="@@MV_PAGE@@">
<INPUT TYPE=hidden NAME=mv_data_table VALUE="[value mv_data_table]">
<INPUT TYPE=hidden NAME=mv_data_key VALUE="[value ui_data_key_name]">
<INPUT TYPE=hidden NAME=mv_update_empty VALUE="1">
<INPUT TYPE=hidden name=mv_data_fields value="code sel which_page link_type name display_type">
<INPUT TYPE=hidden NAME=code VALUE="[table-code]">

<table __UI_T_PROPERTIES__>

<tr>
<td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff"><img src="admin/icon_pages.gif">&nbsp;Section Properties</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Name</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=20 NAME=name Value="[table-data area name]">
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Page&nbsp;class</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<input type=hidden name="ui_filter:which_page" value="null_to_space">
	<table> <tr> <td>
		<small>
		<select size=3 name="which_page" MULTIPLE>
		[calc]
			my (%current);
			my (%seen);
			my (@current) = split /\s+/, q{[table-data area which_page]};
			@current{@current} = @current;
			my @passed = split /[\s,\0]+/,
							q{[loop search='
										fi=area
										st=db
										ra=yes
										un=yes
										rf=which_page
									'][loop-code] [/loop]};
			my @passed = grep !$seen{$_}++, @passed;
			my $out = '';
			for (@passed) {
				$out .= qq{<OPTION};
				$out .= ' SELECTED' if defined $current{$_};
				$out .= qq{>$_};
			}
			return $out;
		[/calc]
		</select>
	</td>
	<td>
	<input size=16 name="which_page" value="">
	</td></tr></table>
	</small>
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Page area</b>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<input type=hidden name="ui_filter:sel" value="nullselect">
	<table><tr><td>
	<small>
	<INPUT SIZE=8 NAME=sel value="">
	</td>
	<td>
	<small>
	<select name=sel>
	[calc]
		my (%current);
		my (%seen);
		my $curr = q{[table-data area sel]};
		my @passed = grep /\S/, split /\s+/, q{[loop search="ra=yes/fi=area/st=db/tf=sel/rf=sel/un=yes"][loop-code] [/loop]};
		my $out = '<option value=""> &lt;--New';
		for (@passed) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $curr eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</SELECT>
	</td></tr></table>
	</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_INTBLOCK__><HR></td>
</tr>

[set ui_area_type][table-data area link_type][/set]

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Link type</b>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
		[display table=area column=link_type key="[value area]" js=|onChange="this.form.submit()"|]
	</td>
</tr>

[if scratch ui_area_type eq external]
<INPUT TYPE=hidden NAME=mv_data_fields value="url">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>External</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=30 NAME=url value="[table-data area url]">
	</td>
</tr>
[elsif scratch ui_area_type eq internal]
<INPUT TYPE=hidden NAME=mv_data_fields value="url">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Interchange page</B></small>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<input type=hidden name="ui_filter:url" value="null_to_space">
	<select name=url>
	[calc]
		my (%current);
		my (%seen);
		my $url;
		($url, $ui_arg) = split /\s+/, q{[table-data area url]}, 2;
		my @passed = split /\s+/, $Tag->list_pages();
		my $out = '<OPTION VALUE="">--none--';
		for (@passed) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $url eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</SELECT>
	</td>
</tr>
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Parameters</B></small>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT NAME=url SIZE=16 VALUE="[calc]$ui_arg[/calc]">
	</td>
</tr>
[/elsif]
[elsif scratch ui_area_type eq simple]
<INPUT TYPE=hidden NAME=mv_data_fields value="tab selector page">
[calc]
	$Values->{tab} = q{[table-data area tab]} || $Config->{ProductFiles}[0];
	return;
[/calc]
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small><b>Table
	</td>
	<td>
		<small>
			<SELECT NAME=tab>
			[loop list="[list-databases]" option=tab]<OPTION>[loop-code][/loop]
			</SELECT>
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small><b>field=column pairs
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small>
		<TEXTAREA NAME=selector COLS=30 ROWS=3>[table-data area selector]</TEXTAREA>
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small><b>Results page
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small>
		<select name=page>
		[calc]
			my (%current);
			my (%seen);
			my $page = q{[table-data area page]};
			my @passed = split /\s+/, $Tag->list_pages();
			my $out = '<OPTION VALUE="">--default--';
			for (@passed) {
				$out .= qq{<OPTION};
				$out .= ' SELECTED' if $page eq $_;
				$out .= qq{>$_};
			}
			return $out;
		[/calc]
		</SELECT>
	</td>
</tr>

[/elsif]
[elsif scratch ui_area_type eq complex]

<INPUT TYPE=hidden NAME=mv_data_fields value="search">
<INPUT TYPE=hidden NAME=ui_target value="mainwindow[scratch win]">
<INPUT TYPE=hidden NAME=ui_searchblob value="">
<INPUT TYPE=hidden NAME=ui_return_to value="@@MV_PAGE@@">
<INPUT TYPE=hidden NAME=ui_return_to value="area=[table-code]">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	[set Create]
	mv_todo=back
	mv_nextpage=__UI_BASE__/search_wizard
	[/set]
	<B>Complex search link</B><br><small><INPUT TYPE=submit
						name=mv_click
						value="Create"
						onClick="
							this.form.ui_target.value=window.name;
							this.form.ui_searchblob.value=this.form.search.value;
							this.form.target='search_prop';
						">&nbsp;<small><INPUT TYPE=button onClick="this.form.search.value=''" VALUE="clear search">
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		[calc]
		my $n = 4;
		if($Scratch->{search_page}) {
			$stuff = delete $Scratch->{search_page};
			$stuff =~ s/.*?(['\|])(.*)\1.*/$2/s;
			$stuff =~ s/^\s+//mg;
			$stuff =~ s/\s+$//mg;
		}
		else {
			$stuff = q{[table-data area search]};
		}
		if($stuff =~ /\S/) {
			$n = 2 + ($stuff =~ s/[\r\n]+/\n/g);
		}
		else { $stuff = '' };
		return "<TEXTAREA name=search COLS=30 ROWS=$n>$stuff</TEXTAREA>";
		[/calc]
	</td>
</tr>

[/elsif]
[/if]

<tr>
<td colspan=2 bgcolor=__UI_C_INTBLOCK__><HR></td>
</tr>

[set ui_area_display][table-data area display_type][/set]

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Display type</b>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		[display table=area column=display_type key="[value area]" js=|onChange="this.form.submit()"|]
	</td>
</tr>

[if scratch ui_area_display =~ /icon|image/]
<INPUT TYPE=hidden NAME=mv_data_fields value="image">
<INPUT TYPE=hidden NAME=mv_data_fields value="image_prop">
<input type=hidden name="ui_filter:image" value="nullselect">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Image</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<small>
	[display table=area column=image key="[value area]" js=|onChange="this.form.submit()"|]
	</td>
</tr>
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Image properties</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		<input name="image_prop" size=30 VALUE="[calc]
		$image_prop = q{[table-data area image_prop]};
		$image_prop =~ s/"/&quot;/g;
		return $image_prop || 'border=0';
	[/calc]">
	</td>
</tr>
[/if]
</table>

[button text="Change area"][/button]

</form>
[/loop]

</td>
<!--- END SECTION PROPERTIES -->

<!--- BEGIN CATEGORY PROPERTIES -->
<td valign=top bgcolor="__UI_C_INTBLOCK__" width=50%">

[value name=mv_data_table set="cat" hide=1]

[perl tables="[value mv_data_table]"]
my $table = $Values->{mv_data_table};
$Values->{ui_data_key_name} = $Db{$table}->config('KEY');
if ($table ne $Values->{mv_data_table}) {
	$Values->{mv_data_table} = $table;
}
$Values->{ui_data_fields} =
	$CGI->{ui_data_fields} ||
	$CGI->{mv_data_fields} ||
	$Values->{"$table:ui_data_fields"} || '' ;
$Values->{ui_data_fields} =~ s/\0+/ /g;
return;
[/perl]

[set process_ui_cat]
setcat=[cgi selector]
[perl]
	my @filters = grep /^ui_filter:/, keys %$CGI;
	return unless @filters;
	foreach my $key (@filters) {
		my $val = delete $CGI->{$key};
		$key =~ s/ui_filter://;
		next unless $val;
		next unless defined $CGI->{$key};
		$CGI->{$key} = $Tag->filter($val, $CGI->{$key}, $key);
	}
return;
[/perl]
[/set]

[loop list="[either][value cat][or]NEW[/either]" prefix=table]
<FORM METHOD=POST ACTION="[area ui]">
<INPUT TYPE=hidden NAME=mv_doit VALUE="set">
<INPUT TYPE=hidden NAME=from_category VALUE=1>
<INPUT TYPE=hidden NAME=mv_click VALUE="process_ui_cat">
<INPUT TYPE=hidden NAME=mv_nextpage VALUE="@@MV_PAGE@@">
<INPUT TYPE=hidden NAME=mv_data_table VALUE="[value mv_data_table]">
<INPUT TYPE=hidden NAME=mv_data_key VALUE="[value ui_data_key_name]">
<INPUT TYPE=hidden NAME=mv_update_empty VALUE="1">
<INPUT TYPE=hidden NAME=mv_data_fields VALUE="code link_type name display_type">
<INPUT TYPE=hidden NAME=code VALUE="[table-code]">

<table __UI_T_PROPERTIES__>

<td bgcolor=__UI_C_TOPBLOCKBAR__ colspan=2><font color="#ffffff"><img src="admin/icon_pages.gif">&nbsp;Category properties</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Name</B></small>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=20 NAME=name Value="[table-data cat name]">
	</td>
</tr>

[set ui_cat_type][table-data cat link_type][/set]

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Link type</b>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
		[display table=cat column=link_type key="[value cat]" js=|onChange="this.form.submit()"|]
	</td>
</tr>
[set needs_banner_info][/set]

[if scratch ui_cat_type eq external]
<INPUT TYPE=hidden NAME=mv_data_fields value="url">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>External</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=30 NAME=url value="[table-data cat url]">
	</td>
</tr>
[elsif scratch ui_cat_type eq internal]
<INPUT TYPE=hidden NAME=mv_data_fields value="url">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Interchange page</B></small>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<input type=hidden name="ui_filter:url" value="null_to_space">
	<select name=url>
	[calc]
		my (%current);
		my (%seen);
		my $url;
		($url, $ui_arg) = split /\s+/, q{[table-data cat url]}, 2;
		my @passed = split /\s+/, $Tag->list_pages();
		my $out = '<OPTION VALUE="">--none--';
		for (@passed) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $url eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</SELECT>
	</td>
</tr>
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Parameters</B></small>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT NAME=url SIZE=16 VALUE="[calc]$ui_arg[/calc]">
	</td>
</tr>
[/elsif]
[elsif scratch ui_cat_type eq explode]
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Explode file</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<select name=explode>
	[calc]
		my (%current);
		my (%seen);
		my ($exp, $exp_parm) = q{[table-data cat explode]}, 2;
		my @passed = $Tag->list_glob("$Config->{ProductDir}/*.txt");
		my $out = '<OPTION VALUE="">--none--';
		for (@passed) {
			$out .= qq{<OPTION};
			$out .= ' SELECTED' if $exp eq $_;
			$out .= qq{>$_};
		}
		return $out;
	[/calc]
	</SELECT>&nbsp;Parameters:&nbsp;<INPUT NAME=explode SIZE=16 VALUE="[calc]$exp_parm[/calc]">
	</td>
</tr>
[/elsif]
[elsif scratch ui_cat_type eq simple]
[set needs_banner_info]1[/set]
<INPUT TYPE=hidden NAME=mv_data_fields value="tab selector page">
[calc]
	$Values->{tab} = q{[table-data cat tab]} || $Config->{ProductFiles}[0];
	return;
[/calc]
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small><b>Table
	</td>
	<td>
		<small>
			<SELECT NAME=tab>
			[loop list="[list-databases]" option=tab]<OPTION>[loop-code][/loop]
			</SELECT>
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small><b>field=column pairs
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small>
		<TEXTAREA NAME=selector COLS=30 ROWS=3>[table-data cat selector]</TEXTAREA>
	</td>
</tr>

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small><b>Results page
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
		<small>
		<select name=page>
		[calc]
			my (%current);
			my (%seen);
			my $page = q{[table-data cat page]};
			my @passed = split /\s+/, $Tag->list_pages();
			my $out = '<OPTION VALUE="">--default--';
			for (@passed) {
				$out .= qq{<OPTION};
				$out .= ' SELECTED' if $page eq $_;
				$out .= qq{>$_};
			}
			return $out;
		[/calc]
		</SELECT>
	</td>
</tr>

[/elsif]
[elsif scratch ui_cat_type eq complex]
[set needs_banner_info]1[/set]
<INPUT TYPE=hidden NAME=mv_data_fields value="search">
<INPUT TYPE=hidden NAME=ui_target value="mainwindow[scratch win]">
<INPUT TYPE=hidden NAME=ui_searchblob value="">
<INPUT TYPE=hidden NAME=ui_return_to value="@@MV_PAGE@@">
<INPUT TYPE=hidden NAME=ui_return_to value="cat=[table-code]">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	[set Create]
	mv_todo=back
	mv_nextpage=__UI_BASE__/search_wizard
	[/set]
	<B>Complex search link</B><br><small><INPUT TYPE=submit
						name=mv_click
						value="Create"
						onClick="
							this.form.ui_target.value=window.name;
							this.form.ui_searchblob.value=this.form.search.value;
							this.form.target='search_prop';
						">&nbsp;<small><INPUT TYPE=button onClick="this.form.search.value=''" VALUE="clear search">
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		[calc]
		my $n = 4;
		if($Scratch->{search_page}) {
			$stuff = delete $Scratch->{search_page};
			$stuff =~ s/.*?(['\|])(.*)\1.*/$2/s;
			$stuff =~ s/^[\s=0]+$//mg;
			$stuff =~ s/^\s+//mg;
			$stuff =~ s/\s+$//mg;
		}
		else {
			$stuff = q{[table-data cat search]};
		}
		if($stuff =~ /\S/) {
			$n = 2 + ($stuff =~ s/[\r\n]+/\n/g);
		}
		else { $stuff = '' };
		return "<TEXTAREA name=search COLS=30 ROWS=$n>$stuff</TEXTAREA>";
		[/calc]
	</td>
</tr>

[/elsif]
[/if]

[if scratch needs_banner_info]
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<INPUT TYPE=hidden NAME=mv_data_fields value="banner_text">
	<INPUT TYPE=hidden NAME=mv_data_fields value="banner_image">
	<small><b>Banner Text
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<INPUT SIZE=30 NAME=banner_text value="[table-data cat banner_text]">
	</td>
</tr>
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><b>Banner Image
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		<INPUT SIZE=30 NAME=banner_img value="[table-data cat banner_img]">
	</td>
</tr>
[/if]

<tr>
<td colspan=2 bgcolor=__UI_C_INTBLOCK__><HR></td>
</tr>

[set ui_cat_display][table-data cat display_type][/set]

<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small><B>Display type</b>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		[display table=cat column=display_type key="[value cat]" js=|onChange="this.form.submit()"|]
	</td>
</tr>

[if scratch ui_cat_display =~ /icon|image/]
<INPUT TYPE=hidden NAME=mv_data_fields value="image">
<INPUT TYPE=hidden NAME=mv_data_fields value="image_prop">
<input type=hidden name="ui_filter:image" value="nullselect">
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Image</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
	<small>
	[display table=cat column=image key="[value cat]" js=|onChange="this.form.submit()"|]
	</td>
</tr>
<tr>
	<td bgcolor=__UI_C_INTBLOCK__>
	<B>Image properties</B>
	</td>
	<td bgcolor=__UI_C_INTBLOCK__>
	<small>
		<input name="image_prop" size=30 VALUE="[calc]
		$image_prop = q{[table-data cat image_prop]};
		$image_prop =~ s/"/&quot;/g;
		return $image_prop || 'border=0';
	[/calc]">
	</td>
</tr>
[/if]

</table>

<INPUT TYPE=hidden NAME=mv_auto_export VALUE="[value mv_data_table]">

[button text="Change category"]
[/button]

</form>
[/loop]

</body>
</html>
</td>
<!--- END CATEGORY PROPERTIES -->
</tr>

<tr>
<td colspan=3 bgcolor=__UI_C_INTBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td colspan=3 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

[/then]
[else]
<!-- wait for them to select a category first -->
</tr>

<tr>
<td [if value area]colspan=2[/if] bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>
[/else]
[/if]

</table>

<BR>
@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->






