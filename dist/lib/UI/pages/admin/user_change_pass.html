[calc]
	$CGI->{no_dbmenu} = 1;
	$CGI->{access_menu} = 1;
	return [/calc]
[seti page_title]Change password: [cgi user_id][/seti]
[seti page_banner]Change password: <B>[cgi user_id]</B>[/seti]
[set ui_class]Admin[/set]
[set page_perm]access=e[/set]
[set help_name]access.main[/set]
[set icon_name]admin/icon_config.gif[/set]
[set no_old_needed][/set]
[if-mm super]
	[calc]
		$Scratch->{no_old_needed} = 1
			unless $CGI->{user_id} eq $Session->{username};
		return;
	[/calc]
[/if-mm]
@_UI_STD_HEAD_@

[if session failure]
<P>
&nbsp;
<BLOCKQUOTE>
<FONT COLOR=RED>[L]Failure:[/L]</FONT> [data session failure][data base=session field=failure value=""]
</BLOCKQUOTE>
<P>
&nbsp;
[/if]

[if scratch ui_message]
<P>
<BLOCKQUOTE>
	[scratch ui_message][set ui_message][/set]
</BLOCKQUOTE>
<P>
&nbsp;
[/if]

[if scratch no_old_needed]
[then]
[set no_old_needed][/set]
[loop list="[cgi user_id]"]

[set check_match]
[calc]
	if ($CGI->{password} eq $CGI->{verify}) {
		$CGI->{password} = $Tag->filter( 'crypt', $CGI->{password} );
		return 'mv_todo=set';
	}
	$Session->{failure} = "Password and verify do not match.";
	return "mv_todo=back\nmv_nextpage=@@MV_PAGE@@";
[/calc]
[/set]

<form action="[area ui]" method="post">
<INPUT TYPE=hidden NAME=mv_todo VALUE=back>
<INPUT TYPE=hidden NAME=mv_nextpage VALUE=__UI_BASE__/access>
<INPUT TYPE=hidden NAME=mv_data_table VALUE="[value mv_data_table]">
<INPUT TYPE=hidden NAME=mv_data_key VALUE="username">
<INPUT TYPE=hidden NAME=mv_click VALUE="check_match">
<INPUT TYPE=hidden NAME=mv_data_fields VALUE="username password">

<table __UI_T_PROPERTIES__>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor=__UI_C_INTBLOCK__ align=right>
<small>User name</small>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
	<input type=hidden name=mv_data_function value="update">
	<input type=hidden name=username value="[loop-code]">[loop-code]
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>
<tr>
<td bgcolor=__UI_C_INTBLOCK__ align=right>
<small>New password</small>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
<INPUT TYPE=password NAME=password VALUE="" SIZE=10>
</td>
</tr>

<td bgcolor=__UI_C_INTBLOCK__ align=right>
<small>Verify password</small>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
<INPUT TYPE=password SIZE=10 NAME=verify VALUE="">
</td>
</tr>


<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

<p>

[set Ok]
[/if-mm]
[/set]
[if-mm advanced access=e]
	[set Ok]
	mv_todo=set
	[/set]
	<input type=submit name="mv_click" value="Ok">
	<input type=submit value="Cancel">
[else]
	[set Back]
	mv_todo=back
	[/set]
	<input type=submit value="Back">
[/else]
[/if-mm]

</form>
[/loop]
[/then]
[else]

<FORM ACTION="[process]" METHOD=POST>
	<INPUT TYPE=hidden NAME=mv_click VALUE=MMChange>
	<INPUT TYPE=hidden NAME=mv_todo  VALUE=back>
	<INPUT TYPE=hidden NAME=mv_nextpage VALUE=__UI_BASE__/access>
	<INPUT TYPE=hidden NAME=mv_failpage VALUE=@@MV_PAGE@@>
	<INPUT TYPE=hidden NAME=mv_username VALUE="[cgi user_id]">
<table __UI_T_PROPERTIES__>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor=__UI_C_INTBLOCK__ align=right>
<small>Old password</small>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
<INPUT TYPE=password NAME=mv_password_old VALUE="" SIZE=10>
</td>
</tr>


<tr>
<td bgcolor=__UI_C_INTBLOCK__ align=right>
<small>New password</small>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
<INPUT TYPE=password NAME=mv_password VALUE="" SIZE=10>
</td>
</tr>

<tr>
<td bgcolor=__UI_C_INTBLOCK__ align=right>
<small>Verify password</small>
</td>
<td bgcolor=__UI_C_INTBLOCK__>
<INPUT TYPE=password NAME=mv_verify VALUE="" SIZE=10>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</TABLE>
<INPUT TYPE=submit VALUE="Change" SIZE=10>
</FORM>
[/else]
[/if]

@_UI_STD_FOOTER_@

<!-- page: @@MV_PAGE@@ -->
