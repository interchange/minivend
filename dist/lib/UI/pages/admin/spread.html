	[calc]
		return unless $CGI->{mv_more_ip};
		$CGI->{mv_data_table} = $Values->{mv_data_table};
		return;
	[/calc]
[seti page_title]
	[either]
		[cgi page_title]
	[or]
		Spreadsheet Edit: [cgi mv_data_table]
	[/either]
[/seti]
[seti help_name][either][cgi help_name][or]gensql.main[/either][/seti]
[seti icon_name][either][cgi icon_name][or]admin/icon_config.gif[/either][/seti]
[set meta_header]
<STYLE TYPE="text/css">
	td: { 
		backround-color: __UI_C_INTBLOCK__
	}
</STYLE>
[/set]
[calc] $CGI->{ui_no_meta_display} = '' [/calc]
@@UI_STD_HEAD@@

[perl tables="[cgi mv_data_table]"]
my $table = $CGI->{mv_data_table};
$Values->{mv_data_table} = $table;
$Values->{ui_data_key_name} = $Db{$table}->config('KEY');
$Values->{ui_data_fields} =
	$CGI->{mv_data_fields} ||
	$Values->{"spread:$table:ui_data_fields"} || '' ;
return;
[/perl]
[if scratch ui_failure]
<BLOCKQUOTE>
<FONT COLOR=__CONTRAST__>Error: [scratch ui_failure]</FONT>
[set ui_failure][/set]
</BLOCKQUOTE>
[/if]
<FORM METHOD=POST ACTION="[base-url]/ui">
<INPUT TYPE=hidden NAME="mv_todo" VALUE="set">
<INPUT TYPE=hidden NAME="mv_nextpage" VALUE="@@MV_PAGE@@">
<INPUT TYPE=hidden NAME="mv_data_table" VALUE="[value mv_data_table]">
<INPUT TYPE=hidden NAME="mv_data_key" VALUE="[value ui_data_key_name]">
<INPUT TYPE=hidden NAME="mv_data_decode" VALUE="yes">
<INPUT TYPE=hidden NAME="mv_update_empty" VALUE="1">
<INPUT TYPE=hidden NAME="mv_data_fields"
	VALUE="[value name=mv_data_fields set=|
				[db-columns columns='[value ui_data_fields]' ]
			|]">

<INPUT TYPE=hidden NAME="mv_data_function" VALUE="update">

[if !value ui_spreadsheet_rows]
[value name=ui_spreadsheet_rows set=10 hide=1]
[/if]
[comment]
[rotate-table rotate="0"]
[/comment]
[search-region more=1 arg="
				ra=yes
				ml=[value ui_spreadsheet_rows]
				rf=[value ui_data_key_name]
				tf=[value ui_data_key_name]
				st=db
				sp=@@MV_PAGE@@
				fi=[value mv_data_table]
			"]
[rotate-table reparse=0 rotate="[value ui_rotate_spread]" interpolate=1]
<table cellpadding=0 cellspacing=0>
[with param=table value="[value mv_data_table]"]
<TR BGCOLOR="__UI_C_INTBLOCK__" CELLPADDING=2>
	<TH ALIGN=CENTER>&nbsp;</TH>
	[row-edit columns="[value ui_data_fields]"]
</TR>

<tr>
<td colspan="[calc]
	@areas = grep /\S/, split /[\s,\0]+/, $Values->{mv_data_fields};
	return scalar(@areas) + 1;
[/calc]"
	bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/cleardot.gif" width=__UI_MAIN_WIDTH__ height=3></td>
</tr>

	[search-list]
	[if-mm keys [item-code]]
<TR BGCOLOR="__UI_C_INTBLOCK__">
	<TD ALIGN=RIGHT><B>
	[page href="__UI_BASE__/flex_editor"
	form=|
		page_title=Edit [value mv_data_table]: [item-code]
		mv_data_table=[value mv_data_table]
		item_id=[item-code]
	|]Edit</A></B>
	</TD>
	[row-edit key="[item-code]" size="[value ui_spread_size]" columns="[value ui_data_fields]"]
</TR>
	[/if-mm]
	[set row_number][item-increment][/set]
	[/search-list]

</TABLE>
[/rotate-table]
<P>
	[more-list]
<H3>	More pages: [more] </H3>
	[/more-list]
[/search-region]
<BR CLEAR=LEFT>
<INPUT TYPE=submit NAME=mv_click VALUE=Submit>&nbsp;&nbsp;&nbsp;
[if !value ui_too_large]
<INPUT TYPE=checkbox
		NAME=ui_auto_export CHECKED VALUE="[value mv_data_table]">
	Auto-export
[/if]
</FORM>
<FORM METHOD=POST ACTION="[process]">
<INPUT TYPE=hidden NAME="mv_nextpage" VALUE="__UI_BASE__/flex_editor">
Edit/Insert row:
<INPUT TYPE=hidden NAME="mv_data_table" VALUE="[value mv_data_table]">
<INPUT TYPE=TEXT SIZE=16 NAME="item_id" VALUE="new">
<INPUT TYPE=submit VALUE="Edit">
</FORM>
<P>
[title-bar 400 2]Limit fields to display (changes above will not be made)[/title-bar]
[seti ui_data_fields_name]spread:[value mv_data_table]:ui_data_fields[/seti]
<FORM METHOD=POST ACTION="[area @@MV_PAGE@@]">
<INPUT TYPE=hidden NAME=mv_action VALUE=return>
<INPUT TYPE=hidden NAME=mv_data_table VALUE="[value mv_data_table]">
<TABLE BORDER=1>
<TR>
<TD VALIGN=TOP ALIGN=RIGHT>Column width</TD>

<TD VALIGN=TOP>
<SELECT NAME="ui_spread_size">
	<OPTION>12
	<OPTION [selected ui_spread_size 8]>8
	<OPTION [selected ui_spread_size 20]>20
	<OPTION [selected ui_spread_size 40]>40
</SELECT>
</TD>

<TD ROWSPAN=3 VALIGN=TOP>
<INPUT TYPE=submit VALUE="Change and Limit"><BR>
<INPUT TYPE=submit name=mv_click VALUE="Display All Fields"><BR>
[set Display All Fields][scratch ui_data_fields_name]=
mv_todo=return
mv_nextpage=@@MV_PAGE@@
[/set]
<FONT SIZE="-1">
[widget name="[scratch ui_data_fields_name]"
		type="checkbox left 2"
		data="=ALL,[db-columns joiner=',']" ]
[/widget]</FONT>
</TD>
</TR>
<TR>

<TD VALIGN=TOP ALIGN=RIGH>Number of rows</TD>

<TD VALIGN=TOP>
<SELECT NAME="ui_spreadsheet_rows">
	<OPTION>10
	<OPTION [selected ui_spreadsheet_rows 20]>20
	<OPTION [selected ui_spreadsheet_rows 50]>50
</SELECT> 
</TD>

</TR>

<TR>
<TD VALIGN=TOP ALIGN=RIGH>Decode HTML entities</TD>
<TD VALIGN=TOP>
<SELECT NAME=mv_data_decode>
<OPTION VALUE="0">No
<OPTION VALUE="1" [selected mv_data_decode 1]>Yes
</SELECT>
</TD>
</TR>
</TABLE>
</FORM>

<!-- ----- END REAL STUFF ----- -->

@@UI_STD_FOOTER@@
