[set page_title]Page editor[/set]
[set ui_class]Content[/set]
[set help_name]page.main[/set]
[set icon_name]admin/icon_pages.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<form action="[area @@MV_PAGE@@]" method=POST>
<input type=hidden name=mv_action value=back>

[if scratch ui_error]
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1>
[scratch ui_error][set ui_error][/set]
</FONT>
</BLOCKQUOTE>
[/if]

<table __UI_T_PROPERTIES__>
<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor="__UI_C_INTBLOCK__" width=__UI_LEFT_WIDTH__>
[set Create new page]
[if !cgi ui_page]
mv_nextpage=@@MV_PAGE@@
[set ui_error]Need to select a file name.[/set]
mv_todo=return
[else]
mv_nextpage=__UI_BASE__/page_edit
mv_todo=return
[/else]
[/if]
[/set]

[set Preview template]
mv_nextpage=__UI_BASE__/page_preview
mv_todo=return
[/set]

<input type="submit" name="mv_click" value="Create new page" onClick="this.form.target='_self'"><BR>
<input type="submit" name="mv_click" value="Preview template" onClick="this.form.target='_blank'">
</td>
<td bgcolor="__UI_C_INTBLOCK__" width=__UI_RIGHT_WIDTH__>
&nbsp;

<select name="ui_template" size=1>
<option value=> Please select a type
[calc]
	@files = $Tag->list_glob('templates/*');
	for(@files) {
		my $name = $_;
		$data = $Tag->file($_);
		$name =~ s:.*/::;
		my $ref = {};
		$data =~ m{\[comment\]\s*(ui_.*?)\[/comment\]}s;
		my $structure = $1 || "ui_template_description: Unknown $name";
		my @lines = grep /\S/, split /\n/, $structure;
		for(@lines) {
			my ($el, $el_item, $el_data) = split /\s*:\s*/, $_;
			#Log ("found el=$el el_item=$el_item el_data=$el_data");
			if($el_data) {
				$ref->{$el} = { $el_item, $el_data };
			}
			else {
				$ref->{$el} = $el_item;
			}
		}
		#Log("ref is " . $Tag->uneval( { ref => $ref } ));
		push @out, qq{<OPTION VALUE="$_">$ref->{ui_template_description}};
	}
	return join "\n", @out;
[/calc]
</select>
<BR><B>File name:<B> <INPUT NAME=ui_page>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

<tr>
<td bgcolor="__UI_C_INTBLOCK__" colspan=2>
[file-navigator mask="pages" start_open="pages" edit_only=1]
</td></tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

</form>


<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
