[set page_title]Database export[/set]
[set ui_class]Admin[/set]
[set help_name]dbdownload.main[/set]
[set icon_name]admin/icon_config.gif[/set]
[set page_perm]dbdownload[/set]
[set exported_tables][/set]
[if cgi ui_do_export]
	<!-- exporting
	[calc]
		$Values->{ui_gnumeric} = $CGI->{ui_gnumeric};
		$Values->{ui_compress} = $CGI->{ui_compress};
		$Scratch->{exported_tables} = join "\n",
			 grep /\S/, split /[,\s\0]+/, $CGI->{ui_do_export};
	[/calc] -->
[/if]
@_UI_STD_HEAD_@

[if scratch exported_tables]
<BLOCKQUOTE>
	[backup-database
		compress="[cgi ui_compress]"
		gnumeric="[cgi ui_gnumeric]"
		xls="[cgi ui_export_xls]"
		tables="[scratch exported_tables]"
	] tables backed up.
</BLOCKQUOTE>
[/if]

[if file backup/DBDOWNLOAD.all.gz]
<BLOCKQUOTE>
	[page href="ui/backup/DBDOWNLOAD.all.gz"
			form="
				mv_data_file=backup/DBDOWNLOAD.all.gz
				mv_todo=deliver
			"]Download compressed gnumeric file</A><BR>
</BLOCKQUOTE>
[/if]

[if file backup/DBDOWNLOAD.all]
	[calc] $Scratch->{mv_deliver} = 'backup/DBDOWNLOAD.all'; return; [/calc]
	[page href="ui/backup/DBDOWNLOAD.all"
			form="
				mv_data_file=backup/DBDOWNLOAD.all
				mv_todo=deliver
			"]Download gnumeric file</A><BR>
[/if]
[if file backup/DBDOWNLOAD.xls]
	[calc] $Scratch->{mv_deliver} .= ' backup/DBDOWNLOAD.xls'; return; [/calc]
	[page href="ui/backup/DBDOWNLOAD.xls"
			form="
				mv_data_file=backup/DBDOWNLOAD.xls
				mv_todo=deliver
			"]Download XLS file</A><BR>
[/if]

[if scratch ui_error]
	<B>Errors on last operation:</B>
	[scratch ui_error][set ui_error][/set]
[/if]

<form ACTION="[area @@MV_PAGE@@]" method="post">
<table __UI_T_PROPERTIES__>

<tr>
<td bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" height=1></td>
</tr>

<tr>
<td bgcolor=__UI_C_INTBLOCK__>
&nbsp;
<p>

<TABLE>
<TR>
<TD VALIGN=top>
What data would you like to export?
<blockquote>
[loop list="[list-databases]"]
<INPUT type=checkbox value="[loop-code]" name="ui_do_export" [if-loop-data __UI_META_TABLE__ backup][else]CHECKED[/else][/if-loop-data]> [loop-code]
	[if-loop-data __UI_META_TABLE__ name]
		(<small>[loop-data __UI_META_TABLE__ name]</small>)
	[/if-loop-data]
	<BR>
[/loop]
</blockquote>
</td>
<td valign=top>
	<B>Options:</B><BR><BR>
	<BLOCKQUOTE>
	<INPUT TYPE=checkbox NAME=ui_compress VALUE=on [checked ui_compress on]> Compress (if available)<BR>
	<INPUT TYPE=radio VALUE=0 NAME=ui_gnumeric  [if !value ui_gnumeric]
												CHECKED
												[/if]
												>
		No Gnumeric output<BR>

	<INPUT TYPE=radio NAME=ui_gnumeric VALUE=on [checked ui_gnumeric on]>
		Gnumeric simple text format<BR>
	<INPUT TYPE=radio NAME=ui_gnumeric VALUE=compressed [checked ui_gnumeric compressed]>
		Gnumeric simple text format, compressed
	[if type=explicit compare="[version extended=1 modtest='Spreadsheet::WriteExcel']"]
	<BR><INPUT TYPE=checkbox VALUE=1 NAME=ui_export_xls> Create XLS spreadsheet
	[/if]
	</BLOCKQUOTE>
	<p>
	<input type=submit name="do_download" value="Perform export">
	</td>
</tr>
</table>
&nbsp;
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="@_UI_IMG_@admin/bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

</form>



<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
