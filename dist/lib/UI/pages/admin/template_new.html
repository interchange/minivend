[set page_title][L]Template editor[/L] -- [L]create new[/L][/set]
[set ui_class]Content[/set]
[set help_name]page.main[/set]
[set icon_name]icon_pages.gif[/set]
@_UI_STD_HEAD_@

<!-- ----- BEGIN REAL STUFF ----- -->

<form action="[area href="__UI_BASE__/template_edit"]" method=POST ENCTYPE="multipart/form-data">
<input type=hidden name=mv_session_id value="[data session id]">
<input type=hidden name=mv_action value=back>

[if scratch ui_error]
<BLOCKQUOTE>
<FONT COLOR="__CONTRAST__" SIZE=+1>
[scratch ui_error][set ui_error][/set]
</FONT>
</BLOCKQUOTE>
[/if]

<table border=0 __UI_T_PROPERTIES__>
<tr class=rborder>
<td colspan=2><img src="bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

[set [L]Create new template[/L]]
[if !cgi ui_template_new]
mv_nextpage=@@MV_PAGE@@
[set ui_error][L]Need to select a file name.[/L][/set]
mv_todo=return
[else]
mv_nextpage=__UI_BASE__/template_edit
mv_todo=return
[/else]
[/if]
[/set]

[set Preview template]
mv_nextpage=__UI_BASE__/page_preview
mv_todo=return
[/set]


<tr id=rnorm>
<td colspan=2>
<B>1.</B> [L]Either...[/L]
</tr>

<tr class=ralt>
<td width=25%>
<b>a.</B> [L]Choose a page template to base the new template on:[/L]
</td>
<td>
<select name="ui_template_template" size=1>
<option value=> [L]Select a page template to base this on (optional)[/L]
[calc]
	my $tdir = $Variable->{UI_TEMPLATE_DIR} || 'templates';
	@files = $Tag->list_glob("$tdir/*");
	for(@files) {
		next unless -f $_;
		my $name = $_;
		$data = $Tag->file($_)
			or next;
		$name =~ s:.*/::;
		my $ref = {};
		$data =~ m{\[comment\]\s*(ui_.*?)\[/comment\]}s
			or next;
		my $structure = $1 || "ui_template_description: no description";
		my @lines = grep /\S/, split /\n/, $structure;
		for(@lines) {
			my ($el, $el_item, $el_data) = split /\s*:\s*/, $_;
			#Log ("found el=$el el_item=$el_item el_data=$el_data");
			if($el_data) {
				$ref->{$el} = { $el_item, $el_data };
			}
			else {
				$ref->{$el} = $el_item;
			}
		}
		#Log("ref is " . $Tag->uneval( { ref => $ref } ));
		push @out, qq{<OPTION VALUE="$_">$name: $ref->{ui_template_description}};
	}
	return join "\n", @out;
[/calc]
</select>
</td>
</tr>

<tr id=rnorm>
<td colspan=2>
<blockquote>[L]or...[/L]</blockquote>
</tr>

<tr id=rnorm>
<td valign=top>
<B>b.</b>[L]Upload a page to base it on:[/L]
</td>
<td>
<input type="file" name="ui_upload_template"><BR>
<span style="font-size: smaller; font-style: italic">
[L TEMPLATE_NEW_PAR_1]You must have set up the page properly, with a
&lt;!-- BEGIN CONTENT --&gt; and &lt;!-- END CONTENT --&gt; pair to
delineate the top and bottom areas.[/L]</span>
</td>
</tr>

<tr id=ralt>
<td>
<B>2.</b> [L]Name the template you are creating:[/L]
</td>
<td>
<INPUT NAME=ui_template_new>
</td>
</tr>

<tr id=ralt>
<td>
<B>3.</b> [L]Short description of the template (if any):[/L]
</td>
<td>
<INPUT NAME=ui_template_description>
</td>
</tr>

<tr id=ralt>
<td>
<B>4.</b> [L]Click this button to create the template[/L]:
</td>
<td>
<input type="submit" name="mv_click" value="[L]Create new template[/L]" onClick="this.form.target='_self'"><INPUT TYPE=hidden NAME=ui_show_template VALUE=1>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" width=__UI_MAIN_WIDTH__ height=1></td>
</tr>

</table>

</form>


<!-- ----- END REAL STUFF ----- -->

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ -->
