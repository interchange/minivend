[if cgi fieldmeta]
	[cgi name=item_id set="[cgi fieldmeta]"]
[/if]
[if !cgi item_id]
	[bounce page="__UI_BASE__/gentable"]
[/if]
[calc]
	my $location = $CGI->{item_id};
	my @parts = split /::/, $location;
	if($Config->{Database}{$parts[0]}) {
		($m_table, $m_col, $m_key) = @parts;
	}
	else {
		($m_view, $m_table, $m_col, $m_key) = @parts;
	}
	my @frags;
	push(@frags,errmsg('Meta field edit') . ':');
    push(@frags,errmsg('view=%s', $m_view)) if $m_view;
    push(@frags,errmsg('table=%s column=%s', $m_table, $m_col));
	push(@frags,errmsg('key=%s', $m_key)) if $m_key;
	$Scratch->{page_title} = join(' ',@frags);

	my $string = <<EOF;
	<B>Meta information edit&nbsp;&nbsp;&nbsp;</b><BR>
	<table>
EOF

	$string .= <<EOF if $m_view;
	<tr>
	<td align=right>view:</td>
	<td><B>$m_view</b></td>
	</tr>
EOF

	$string .= <<EOF;
	<tr>
	<td align=right>table:</td>
	<td><B>$m_table</b></td>
	</tr>
	<tr>
	<td align=right>column:</td>
	<td><B>$m_col</b></td>
	</tr>
	</table>
EOF

	$Scratch->{page_banner} = $string;
	if(! $CGI->{mv_data_table}) {
		$CGI->{mv_data_table} = '__UI_META_TABLE__';
	}
	if(! $CGI->{ui_data_fields}) {
		$CGI->{ui_data_fields} = 'code label help help_url type width height options filter lookup field db lookup_exclude outboard pre_filter prepend append';
										
	}
	if(! $CGI->{ui_break_before}) {
		$CGI->{ui_break_before} = 'help type lookup outboard prepend';
		$CGI->{ui_break_before_label} = 'type=Display control, help=Help information, lookup=Database lookup, outboard=Advanced';
	}
	return;
[/calc]

[set ui_class]Tables[/set]
[set help_name]meta.edit[/set]
[set icon_name]icon_config.gif[/set]

@_UI_STD_HEAD_@

[flag type=write table="[cgi mv_data_table]"]

[perl table="[cgi mv_data_table]"]
	### If there is a view, set defaults from non-view record
	### for this item
	
	# Always want this removed first, don't proceed if no view
	$Tag->tmp('tmp_defaults');
	return unless $CGI->{ui_meta_view};

	my $db = $Db{$CGI->{mv_data_table}};

	# Don't bother if already exists
	return if $db->record_exists($CGI->{item_id});

	my $id = $CGI->{item_id};
	$id =~ s/^[^:]+:+//;
	my $rec = $db->row_hash($id)
		or return;
	delete $rec->{code};
	$Scratch->{tmp_defaults} = $rec;
	return;
[/perl]

[table-editor
	item_id="[cgi item_id]"
	table="[cgi mv_data_table]"
	no-table-meta=1
	no-meta=1
	start-at="[cgi start_at]"
	default=`$Scratch->{tmp_defaults}`
	ui_data_fields="
		=Typical

		code
		label
		type
		filter
		width
		height
		options
		default

	   =Help and Check

	   help
	   help_url
	   extended.maxlength
	   extended.js_check

	   =Database lookup

	   lookup
	   field
	   db
	   extended.lookup_query
	   extended.lookup_merge
	   lookup_exclude

	   =Select page behavior

	   extended.ui_more_alpha
	   extended.ui_sort_option
	   extended.fs_no_group
	   extended.fs_display_filter
	   extended.fs_link_page
	   extended.fs_link_anchor
	   extended.fs_link_parm
	   extended.fs_link_parm_extra
	   extended.fs_data_calc
	   extended.fs_data_tables
	   extended.header_row_class
	   extended.data_row_class_odd
	   extended.data_row_class_even
	   extended.header_cell_class
	   extended.header_cell_style
	   extended.header_link_class
	   extended.data_cell_class
	   extended.data_cell_style

	   =Advanced

	   outboard
	   pre_filter
	   prepend
	   append
	   __UI_META_ADDITIONAL__
	"

	options=`{
		'extended.ui_sort_option' => qq{=--default--,f=Case insensitive, fr=Case insensitive/Reverse, n=Numeric, nr=Reverse Numeric},
	}`

	label=`{
		'extended.ui_more_alpha' => 'Alphabetic more links',
		'extended.ui_sort_option' => 'Sort option',
		'extended.fs_no_group' => 'No group link',
		'extended.fs_display_filter' => 'Filter(s) for select display',
		'extended.fs_link_page' => 'Page to link to',
		'extended.fs_link_anchor' => 'Anchor for link',
		'extended.fs_link_parm' => 'Parameters to send as',
		'extended.fs_link_parm_extra' => 'Additional parms to send (from CGI)',
		'extended.fs_data_calc' => 'Embedded perl code to run on data',
		'extended.fs_data_tables' => 'Tables to have open for perl code',
		'extended.fs_display_calc' => 'Embedded perl code to run on header',
		'extended.header_link_class' => 'Header row link CSS class',
		'extended.header_cell_class' => 'Header cell CSS class',
		'extended.header_cell_style' => 'Header cell CSS style',
		'extended.header_row_class' => 'Header row CSS class',
		'extended.header_row_style' => 'Header row CSS style',
		'extended.data_row_class_odd' => 'Data row CSS class, odd numbers',
		'extended.data_row_class_even' => 'Data row CSS class, even numbers',
		'extended.data_cell_class' => 'Data cell CSS class',
		'extended.data_cell_style' => 'Data cell CSS style',
	}`
	help=`{
		'extended.fs_data_calc' => 'Current record passed as $item',
		'extended.fs_data_tables' => 'To have open for Safe module',
	}`
	widget=`{
		extended => "textarea_5_50",
		'extended.ui_more_alpha' => 'yesno',
		'extended.ui_sort_option' => 'select',
		'extended.fs_no_group' => 'yesno',
		'extended.fs_display_filter' => 'text_50',
		'extended.fs_data_calc' => 'textarea_4_70',
	}`

	ui_style=1
	output_map=1
	tabbed=1
	][/table-editor]

@_UI_STD_FOOTER_@
<!-- page: @@MV_PAGE@@ version: $Revision$ -->
