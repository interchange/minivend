[calc] $CGI->{no_dbmenu} = 1; $CGI->{access_menu} = 1; return [/calc]
[set page_title]Administration Group Manager[/set]
[set ui_class]Admin[/set]
[set page_perm]group=l[/set]
[set help_name]group.main[/set]
[set icon_name]icon_config.gif[/set]

@_UI_STD_HEAD_@
[if scratch ui_message]
<P>
<BLOCKQUOTE>
	[scratch ui_message][set ui_message][/set]
</BLOCKQUOTE>
<P>
&nbsp;
[/if]

<form action="[area ui]" method=POST>
<INPUT TYPE=hidden NAME=mv_todo VALUE=back>
<INPUT TYPE=hidden NAME=mv_nextpage VALUE="__UI_BASE__/group_edit">
<INPUT TYPE=hidden NAME=ui_hide_key VALUE="1">

<table __UI_T_PROPERTIES__>
<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" width=600 height=1></td>
</tr>

[set Create new group]
mv_nextpage=__UI_BASE__/group_edit
group_id=NEW
ui_hide_key=0
[/set]

[set Show permissions]
user_id=[cgi group_id]
mv_nextpage=__UI_BASE__/access_permissions
ui_return_to=@@MV_PAGE@@
[/set]


[set Delete group]
mv_nextpage=@@MV_PAGE@@
[flag type=write table="__UI_ACCESS_TABLE__"]
[if-mm advanced access=d]
[perl table="__UI_ACCESS_TABLE__"]
	my $db = $Db{__UI_ACCESS_TABLE__};
	if(! $db) {
		$Scratch->{ui_message} = "Bad access table __UI_ACCESS_TABLE__";
		return;
	}
	unless ( $db->delete_record($CGI->{group_id}) ) {
		$Scratch->{ui_message} =
			"Failed to delete group $CGI->{group_id} from table __UI_ACCESS_TABLE__";
		return;
	}
	$Scratch->{ui_message} =
			"Deleted group $CGI->{group_id} from table __UI_ACCESS_TABLE__";
	return;
[/perl]
[else]
[set ui_message]Not authorized to delete groups.[/set]
[/else]
[/if-mm]
[/set]

<tr>
<td colspan=2 bgcolor="__UI_C_INTBLOCK__">
<input type="submit" name="mv_click" value="Create new group">
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" width=600 height=1></td>
</tr>

<tr>
<td bgcolor="__UI_C_INTBLOCK__" width=150>
<input type="submit" value="Edit group"><br><br>
<input type="submit" name="mv_click" value="Show permissions"><p>
[if-mm advanced access=d]
<input type="submit" name="mv_click" value="Delete group" 
 onClick="return confirm('Are you sure you want to delete this group?')">
[/if-mm]
</td>

<td bgcolor="__UI_C_INTBLOCK__" width=450>
<select name="group_id" size=10>
[loop search="fi=access/st=db/co=yes/sf=username/se=:/bs=yes/tf=name"]
  <option value="[loop-code]">[loop-data access name]
[/loop]
</select>
</td>
</tr>

<tr>
<td colspan=2 bgcolor=__UI_C_TOPBLOCKBAR__><img src="bg.gif" width=600 height=1></td>
</tr>

</table>

<p>

[set Back]
mv_todo=back
mv_nextpage=index
[/set]

</form>

@_UI_STD_FOOTER_@

<!-- page: @@MV_PAGE@@ -->
