[comment]
	There are 3 special help keys: home, faq, and 404. They have editable
	database entries like any other, but the keys get special handling here.

	One special token can be used in the helptext: ~~HELP_TOPICS~~.
	It's replaced with an HTML list of links to all help topics except the
	three listed above and whatever the current topic is.
[/comment]

[tmp fontface]Verdana, Arial, Helvetica, sans-serif[/tmp]

[comment]
	This is a grievous hack made necessary by Apache mod_rewrite, which
	re-urlencodes query strings on a rewrite.
[/comment]
[tmp help_key][/tmp]
[calc]
    my $topic = $CGI->{topic}; 
	$topic =~ s/\%(\w\w)/chr( hex($1))/eg;
	$Scratch->{help_orig} = $Scratch->{help_key}=$topic;
	return;
[/calc]


[if scratch help_key =~ /^\s*$/]
	[tmp help_key]home[/tmp]
[/if]

[if type=data term="@_UI_HELP_TABLE_@::code::[scratch help_key]" op=eq compare=""]
	[tmp help_key]404[/tmp]
[/if]

[tmp help_title]
[either]
	[data table=@_UI_HELP_TABLE_@ field=title key="[scratch help_key]"]
[or]
	[scratch help_key]
[/either]
[/tmp]

[tmp help_text]
[either]
	[data table=@_UI_HELP_TABLE_@ field=helptext key="[scratch help_key]"]
[or]
	<p>[L]No help text has been entered yet for the key[/L] '[scratch help_key]'.</p>
	<p>[L]Perhaps one of these topics will be helpful:[/L]</p>
	~~HELP_TOPICS~~
[/either]
[/tmp]

[calc]
	if ($Scratch->{help_text} =~ /~~HELP_TOPICS~~/) {
		my $help_index = <<EOF;
<ul>
[search-region more=1
               form="topic=[scratch help_key]"
	       search="
	fi=@_UI_HELP_TABLE_@
	ra=yes
	rf=code,title
	tf=title
	ml=20
	sp=@@MV_PAGE@@
"]
[search-list]
[if type=explicit compare="q{[item-code]} !~ m{^(?:faq|home|404|\Q[scratch help_key]\E)$}"]
	<li>[page href="@@MV_PAGE@@" form="topic=[item-code]"][item-pos 1]</a>
[/if]
[/search-list]
</ul>
[more-list]More help topics: [more][/more-list]
[/search-region]

EOF
		$Scratch->{help_text} =~ s/~~HELP_TOPICS~~/$help_index/g;
	}
	return;
[/calc]

<html>
<head>
<title>[L]Interchange Help:[/L] [scratch help_title]</title>
<style type="text/css">
<!--
BODY { font-family: [scratch fontface] }
P    { font-family: [scratch fontface] }
H1   { font-family: [scratch fontface] }
H2   { font-family: [scratch fontface] }
H3   { font-family: [scratch fontface] }
B    { font-family: [scratch fontface] }
I    { font-family: [scratch fontface] }
TD   { font-family: [scratch fontface] }

A:link    { text-decoration: none } 
A:visited { text-decoration: none } 
A:active  { text-decoration: none }
A:hover   { color: #663333; text-decoration: none }
-->
</style>
</head>
<body bgcolor="#ffffff" link="#660000" alink="#660000" vlink="#660000">

<div align=center>

<table width="100%" border=0 cellspacing=0 cellpadding=0>
<tr>
<td height=23 bgcolor="CC0000" valign=middle>
<table width="100%" border=0 cellpadding=0 cellspacing=0>
<tr>
<td valign=middle width=530>
<img src="cleardot.gif" height=1 width=12>
[if scratch help_key ne 'home']
	[page href="@@MV_PAGE@@" form="topic=home"]<font face="[scratch fontface]" size=2>Home</font></a>
	<img src="cleardot.gif" height=1 width=12>
[/if]
[if scratch help_key ne 'faq']
	[page href="@@MV_PAGE@@" form="topic=faq"]<font face="[scratch fontface]" size=2>FAQ</font></a>
	<img src="cleardot.gif" height=1 width=12>
[/if]
</td>
<td align=right valign=middle width=40>
<a href="javascript:history.go(-1)" target="Help" onmouseover="window.status='Help';return true;" onmouseout="window.status='';return true;"><font face="[scratch fontface]" size=2>Back</font></a><img src="cleardot.gif" height=1 width=12>
</td>
</tr>
</table>
</td>
</tr>
</table>

<table border=0 cellspacing=0 cellpadding=2 width=450>
<tr>
<td>

<h2>&nbsp;<br>
[scratch help_title]
</h2>

<hr noshade size=2 width="100%">

[scratch help_text]

<br>

<hr noshade size=2 width="100%">

<p><font face="[scratch fontface]" size=1>
<b><a href="http://www.redhat.com/ecommerce" target="_new">Interchange</a> -
<a href="http://www.redhat.com/" target="_new">&copy; 2001 Red Hat, Inc.</a></b>
</font></p>

</td>
</tr>
</table>

</div>

</body>
</html>
